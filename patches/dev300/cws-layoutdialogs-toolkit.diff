Index: toolkit/doc/layout/ChangeLog
===================================================================
RCS file: /cvs/gsl/toolkit/doc/layout/ChangeLog,v
retrieving revision 1.2
retrieving revision 1.2.6.1
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.1
--- toolkit/doc/layout/ChangeLog	6 Mar 2008 11:34:46 -0000	1.2
+++ toolkit/doc/layout/ChangeLog	20 Mar 2008 11:56:24 -0000	1.2.6.1
@@ -1,3 +1,300 @@
+2008-03-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/awt/vclxwindow.cxx: Fix compile warning.
+
+2008-03-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* util/makefile.mk: Revert obsolete VERSION addition.
+
+2008-03-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/controls/dialogcontrol.cxx,
+	source/controls/unocontrol.cxx, source/helper/tkresmgr.cxx,
+	util/defs/wntmsci11: Revert weird initial patch.
+
+2008-03-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO: Doc update.
+
+2008-03-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-post.hxx, inc/layout/layout-pre.hxx,
+	inc/layout/layout.hxx, source/awt/vclxbutton.cxx,
+	source/vclcompat/wbutton.cxx, workben/layout/recover.xml: Implement
+	MoreButton.  TODO: images.
+
+2008-03-19  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/vclcompat/wbutton.cxx: Remove redraw cruft, rename
+	redrawAlready to redraw.
+
+2008-03-19  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-post.hxx, source/vclcompat/wbutton.cxx: Step
+	towards cleaner redraw.
+
+2008-03-19  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-post.hxx, inc/layout/layout-pre.hxx,
+	inc/layout/layout.hxx, source/awt/vclxbutton.cxx,
+	source/awt/vclxbutton.hxx, source/layout/helper.cxx,
+	source/vclcompat/wbutton.cxx, workben/layout/recover.cxx,
+	workben/layout/recover.hxx: Extract AdvancedButton implementation
+	from recover.cxx into new widget.
+
+2008-03-19  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* workben/layout/recover.cxx, workben/layout/recover.hxx,
+	workben/layout/recover.xml: Update recover dialog, make
+	advanced/simple switching work.
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* workben/layout/zoom.cxx: In test mode, enable everything.
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* workben/layout/localize.sdf: Manually add new translatable strings
+	and translations for de, nl.
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* workben/layout/zoom.xml: Update zoom to have hbox of Zoom factor
+	and View layout alongside each other.
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* workben/layout/zoom.cxx, workben/layout/zoom.hxx,
+	workben/layout/zoom.xml: Merge upstream's zoom.
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/vclcompat/wbutton.cxx, source/vclcompat/wrapper.hxx: 
+	Nitpick, debugging aid.
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout.hxx, source/vclcompat/wrapper.cxx: Implement
+	FixedLine.IsEnabled().
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* util/makefile.mk: Build lib name fix.
+
+2008-03-14  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-post.hxx, inc/layout/layout-pre.hxx,
+	inc/layout/layout.hxx, source/vclcompat/wcontainer.cxx,
+	workben/layout/recover.cxx, workben/layout/recover.hxx,
+	workben/layout/recover.xml: Complete VBox/HBox wrappers.  Not use
+	them in recover, spacing still wrong.
+
+2008-03-13  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, workben/layout/recover.cxx,
+	workben/layout/recover.hxx, workben/layout/recover.xml: More
+	recovery dialog mockuping.
+
+2008-03-13  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/layout/box-base.cxx: Implement visibility of
+	elements/containers better.
+
+2008-03-13  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-post.hxx, inc/layout/layout-pre.hxx,
+	inc/layout/layout.hxx, source/layout/helper.cxx,
+	source/layout/import.cxx, source/layout/proplist.cxx,
+	source/vclcompat/wbutton.cxx, source/vclcompat/wfield.cxx,
+	source/vclcompat/wrapper.cxx, source/vclcompat/wrapper.hxx: 
+	Implement FixedImage.  Needed for recovery dialog.
+
+2008-02-28  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/layout/box-base.hxx, workben/layout/editor.cxx: Give
+	ChildData virtual distructor.
+
+2008-02-28  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-post.hxx, inc/layout/layout-pre.hxx,
+	inc/layout/layout.hxx, source/layout/helper.cxx,
+	source/vclcompat/makefile.mk, source/vclcompat/wrapper.cxx,
+	util/makefile.mk, workben/layout/makefile.mk,
+	workben/layout/recover.cxx, workben/layout/recover.hxx,
+	workben/layout/recover.xml, workben/layout/test.cxx: Stab at new
+	recover dialog.
+
+2008-02-28  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* workben/layout/editor.cxx: Do not clear fresh container.  Disable
+	debug printing.
+
+2008-02-27  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, workben/layout/localize.sdf: Fix localize.sdf for
+	wordcount.
+
+2008-02-27  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-pre.hxx, source/layout/dialogbuttonhbox.cxx: Fix
+	ID for displaying dialogs.
+
+2008-02-27  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, workben/layout/localize.sdf,
+	workben/layout/wordcount.xml, workben/layout/zoom.xml: Add strings
+	for all languages.
+
+2008-02-27  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, source/awt/vclxsplitter.cxx,
+	source/awt/vclxsplitter.hxx, source/awt/vclxtabcontrol.cxx,
+	source/awt/vclxtabcontrol.hxx, source/layout/box-base.cxx,
+	source/layout/box-base.hxx, source/layout/box.cxx,
+	source/layout/box.hxx, source/layout/container.cxx,
+	source/layout/dialogbuttonhbox.cxx,
+	source/layout/dialogbuttonhbox.hxx, source/layout/factory.cxx,
+	source/layout/flow.cxx, source/layout/helper.cxx,
+	source/layout/import.hxx, source/layout/makefile.mk,
+	source/layout/proplist.cxx, source/layout/root.cxx,
+	source/layout/table.cxx, source/layout/table.hxx,
+	source/layout/timer.cxx, source/vclcompat/wcontainer.cxx,
+	source/vclcompat/wfield.cxx, source/vclcompat/wrapper.cxx: Clean-up
+	code duplication from layout: new Box_Base class implements
+	addChild, removeChild, getChildren, getChildProperties for Box,
+	Table, VCLXSplitter, VCLXTabControl.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, source/layout/root.cxx: Document more fixmes.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, source/layout/proplist.cxx: Remove m237
+	workaround.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/layout/helper.cxx: More comment cleanups.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/awt/vclxtabcontrol.cxx, source/layout/box.cxx,
+	source/layout/container.cxx, source/vclcompat/wrapper.cxx: 
+	Commented-out code cleanups.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout-post.hxx, inc/layout/layout-pre.hxx,
+	inc/layout/layout.hxx, inc/layout/layoutcore.hxx,
+	source/awt/forward.hxx, source/awt/vclxbutton.cxx,
+	source/awt/vclxbutton.hxx, source/awt/vclxdialog.cxx,
+	source/awt/vclxdialog.hxx, source/awt/vclxfixedline.cxx,
+	source/awt/vclxfixedline.hxx, source/awt/vclxscroller.cxx,
+	source/awt/vclxscroller.hxx, source/awt/vclxsplitter.cxx,
+	source/awt/vclxsplitter.hxx, source/awt/vclxtabcontrol.cxx,
+	source/awt/vclxtabcontrol.hxx, source/layout/bin.cxx,
+	source/layout/bin.hxx, source/layout/box.cxx,
+	source/layout/box.hxx, source/layout/container.cxx,
+	source/layout/container.hxx, source/layout/dialogbuttonhbox.cxx,
+	source/layout/dialogbuttonhbox.hxx, source/layout/factory.cxx,
+	source/layout/factory.hxx, source/layout/flow.cxx,
+	source/layout/flow.hxx, source/layout/helper.cxx,
+	source/layout/helper.hxx, source/layout/import.cxx,
+	source/layout/import.hxx, source/layout/makefile.mk,
+	source/layout/precompiled_xmlscript.hxx,
+	source/layout/proplist.cxx, source/layout/proplist.hxx,
+	source/layout/root.cxx, source/layout/root.hxx,
+	source/layout/table.cxx, source/layout/table.hxx,
+	source/layout/timer.cxx, source/layout/timer.hxx,
+	source/layout/translate.cxx, source/layout/translate.hxx,
+	source/vclcompat/makefile.mk, source/vclcompat/wbutton.cxx,
+	source/vclcompat/wcontainer.cxx, source/vclcompat/wfield.cxx,
+	source/vclcompat/wrapper.cxx, source/vclcompat/wrapper.hxx,
+	workben/layout/editor.cxx, workben/layout/editor.hxx,
+	workben/layout/makefile.mk, workben/layout/simple-paragraph.cxx,
+	workben/layout/simple-paragraph.hxx, workben/layout/test.cxx,
+	workben/layout/uno.hxx, workben/layout/zoom_def.hxx: Add licence
+	headers.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* workben/layout/meekfile.mk: Junk meekfile.mk
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO: Update TODO.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/toolkit/awt/vclxwindows.hxx, source/awt/vclxwindow.cxx,
+	source/awt/vclxwindows.cxx: Move VCLXScrollBar's getMinimumSize()
+	from VCLXWindow's switch to method.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/toolkit/awt/vclxwindows.hxx, source/awt/vclxwindow.cxx,
+	source/awt/vclxwindows.cxx: Move VCLXMessageBox's getMinimumSize()
+	from VCLXWindow's switch to method.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, inc/toolkit/awt/vclxtopwindow.hxx,
+	source/awt/vclxdialog.cxx, source/awt/vclxdialog.hxx,
+	source/awt/vclxtopwindow.cxx: Remove code duplication from
+	VCLXDialog.
+
+2008-02-26  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* source/awt/vclxdialog.cxx, source/vclcompat/wbutton.cxx,
+	source/vclcompat/wcontainer.cxx, source/vclcompat/wrapper.hxx: 
+	Comment cleanup.
+
+2008-02-21  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, source/layout/helper.hxx,
+	workben/layout/editor.cxx, workben/layout/wordcountdialog.cxx: Fix
+	remaining SUN warnings.
+
+2008-02-21  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/layout/layout.hxx, source/awt/vclxfixedline.hxx,
+	source/layout/byteseq.cxx, source/layout/helper.hxx,
+	source/layout/import.cxx, source/layout/makefile.mk,
+	source/layout/proplist.cxx, source/layout/translate.hxx,
+	source/vclcompat/wbutton.cxx, source/vclcompat/wcontainer.cxx,
+	source/vclcompat/wfield.cxx, source/vclcompat/wrapper.cxx,
+	source/vclcompat/wrapper.hxx, workben/layout/editor.cxx: Fix some
+	sunstudio12 warnings.
+
+2008-02-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* doc/layout/TODO, source/awt/makefile.mk,
+	source/awt/vclxbutton.cxx, source/awt/vclxbutton.hxx,
+	source/awt/vclxproxy.cxx, source/awt/vclxproxy.hxx,
+	source/layout/helper.cxx: Junk VCLXProxy.
+
+2008-02-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* inc/toolkit/awt/vclxwindows.hxx,
+	inc/toolkit/helper/listenermultiplexer.hxx,
+	source/awt/vclxbutton.cxx, source/awt/vclxbutton.hxx,
+	source/awt/vclxtabcontrol.cxx, source/awt/vclxtabcontrol.hxx,
+	source/layout/helper.cxx: Hello world on AWTVCLXCancelButton() label
+	and images.
+
+2008-02-20  Jan Nieuwenhuizen <janneke@gnu.org>
+
+	* .gitignore, source/awt/forward.hxx, source/awt/makefile.mk,
+	source/awt/vclxdialog.cxx, source/awt/vclxdialog.hxx,
+	source/awt/vclxfixedline.cxx, source/awt/vclxfixedline.hxx,
+	source/awt/vclxscroller.cxx, source/awt/vclxscroller.hxx,
+	source/awt/vclxsplitter.cxx, source/awt/vclxsplitter.hxx,
+	source/awt/vclxtabcontrol.cxx, source/awt/vclxtabcontrol.hxx,
+	source/layout/makefile.mk, workben/layout/localize-de.sdf,
+	workben/layout/localize-nl.sdf: Cleanup of includes, namespace in
+	headers in awt.
+
 2008-02-11  Jan Nieuwenhuizen <janneke@gnu.org>
 
 	* prj/build.lst: Have workspace depend on util, fixes parallel build
Index: toolkit/doc/layout/TODO
===================================================================
RCS file: /cvs/gsl/toolkit/doc/layout/TODO,v
retrieving revision 1.2
retrieving revision 1.2.6.1
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.1
--- toolkit/doc/layout/TODO	6 Mar 2008 11:35:44 -0000	1.2
+++ toolkit/doc/layout/TODO	20 Mar 2008 11:56:24 -0000	1.2.6.1
@@ -1,14 +1,32 @@
 -*-outline-*-
 
 * CWS
-** 3.0 feature freeze: March 6
+** Move everything & development into new layout-dialogs CWS
+
 ** cleanups
-*** remove stuff
-**** vclxproxy -> move into source/awt widgets 
-**** toplevel dialog/container?
+*** layout/import.hxx: what's this generator stuff?
+#if 0
+// generator
+class Widget
+*** root.hxx:
+/*
+  TODO: (ricardo) I think we should cut on LayoutRoot, stripping out its widget
+  proxy interface (just make it return the root widget).
+
+*** root.cxx:
+LayoutWidget::~LayoutWidget()
+{
+    /* should we dispose of the references...? */
+    // at least of its children... Or should root?
+*** root.cxx:
+LayoutRoot::~LayoutRoot()
+{
+// TODO: we want to delete the top level LayoutWidget...
+
 
 * portability
-** --enable-layout does not compile on Sun
+** --enable-layout does not compile on Sun?
+[SunStudio12 on Linux works...]
 
 TODO: Try not including layout-pre.hxx twice, but use
 layout-pre-header.hxx and layout-pre-source.hxx (both include an
@@ -36,20 +54,40 @@ un-multiple-inclusion-shielded layout-pr
     aUserEdit . Disable ( ) ;
     return 0 ;
     }
-** LayoutDialogs compilation errors on Windows (--disable-layout?)
+
+** LayoutDialogs compilation errors on Windows
 in VCL headers there, need to include more headers to also get stuff like HWND defined.
 
 * code
 ** features
+*** Symbols on MoreButton/AdvancedButton?
+
+*** support more widgets (as necessary)
+**** see toolkit/source/awt/vclxtoolkit.cxx and svtools/source/uno/unoiface.cxx
+**** SubDialog
+**** Pull-down menu
+**** embed custom widget
+**** embed old .src TAB
+**** have a LAYOUT TAB be embedded in an old .src dialog
+**** FileControl?
+**** roadmap?
+**** datefield?
+**** patternfield?
+**** patternbox?
+**** dockingarea?
+**** errorbox?
+**** groupbox?
+**** menubutton?
+**** messbox?
+**** simpleanimation?
+
 *** support cnt:cnt:? 
 *** support using label (verb) on yes/ok no/cancel buttons for some platforms
 but keep using yes/no on Windows, eg?
-*** remove -DTEST_LAYOUT=1 from util/makefile.mk
+*** remove -DTEST_LAYOUT=1 from util/makefile.mk?
 
 ** fixes
 *** mpRadioGroup HACK --> use radiogroup property
-*** toolkit/source/awt/vclxwindow.cxx
-   empty-out VCLXWindow::getMinimumSize
 *** missing properties
 	'title' -> 'Set Zoom'
 Missing prop Title
@@ -62,9 +100,14 @@ Missing prop Default
 *** Remove magic constants
 fHorAlign = fVerAlign = 0.5; --> float const [CENTER?] = 0.5;
 
-*** remove stuff?
+** include full translations
+*** zoom
+grep zoom.src svx/source/dialog/localize.sdf | awk -F'\t' '{printf "%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n", "layout", "janneke\\vc\\layout-cws\\toolkit\\workben\\layout\\zoom.xml", $3, "layout", $6 "_label", "", "", $8, "0", $10, $11, $12, "", $14, $15}' | sed -e 's/FL_\(ZOOM\)_label/FL_\1_text/' -e 's/\t_label/\tRID_SVXDLG_ZOOM_title/'
+**** done, except for View Layout update: no strings in localize.sdf yet,
+     must redo.
+*** wordcount
+grep wordcountdialog.src sw/source/ui/dialog/localize.sdf | awk -F'\t' '{printf "%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\t%s\n", "layout", "janneke\\vc\\layout-cws\\toolkit\\workben\\layout\\workben.xml", $3, "layout", $6 "_label", "", "", $8, "0", $10, $11, $12, "", $14, $15}' | sed -e 's/FL_\([A-Z]*\)_label/FL_\1_text/' -e 's/\t_label/\tDLG_WORDCOUNT_title/'s
 
-*** box.hxx: use vbox/hbox polymorphism instead of if (mbHorizontal)
 
 * i18n
     + forget java property files nonsense
@@ -102,13 +145,26 @@ m1'''': c93389f7
 ** Zoom dialog
 *** list of radio buttons indented: workben/zoom-indent.xml ?
 ** Word Count dialog
-** 'Format' dialog
+** Recover dialog (redesign)
+** pivotfilter dialog (Kohei?)
+** paragraph dialog
+
+
 TODO
 
 
 * play with / improve Ricardo's editor
 ** broken after new uno registration
-	+ this is not meant to be a production level tool, but still,
+
+   it barfs on
+   
+    void selectedWidget( Widget *pWidget )
+    {
+        clear();
+
+   it looks like a window is deleted twice.
+
+** this is not meant to be a production level tool, but still,
 	  it can be improved I think :-)
 
 * improve Kohei's converter (poke him on IRC (afternoons) about this)
Index: toolkit/inc/layout/layout-post.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/inc/layout/layout-post.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/inc/layout/layout-post.hxx	6 Mar 2008 11:37:06 -0000	1.2
+++ toolkit/inc/layout/layout-post.hxx	30 Jul 2008 11:12:10 -0000	1.2.6.2
@@ -1,18 +1,61 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef _LAYOUT_POST_HXX
 #define _LAYOUT_POST_HXX
 
 #if ENABLE_LAYOUT
 
+#undef AdvancedButton
+#undef Box
 #undef Button
 #undef CancelButton
+#undef CheckBox
+#undef Container
+#undef FixedImage
 #undef FixedInfo
 #undef FixedLine
 #undef FixedText
 #undef HelpButton
+#undef HBox
 #undef MetricField
+#undef MoreButton
+#undef MultiLineEdit
 #undef OKButton
+#undef ProgressBar
+#undef PushButton
 #undef RadioButton
 #undef SfxModalDialog
+#undef Table
+#undef VBox
 
 #undef Window
 
Index: toolkit/inc/layout/layout-pre.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/inc/layout/layout-pre.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/inc/layout/layout-pre.hxx	6 Mar 2008 11:37:18 -0000	1.2
+++ toolkit/inc/layout/layout-pre.hxx	30 Jul 2008 11:11:39 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef _LAYOUT_PRE_HXX
 #define _LAYOUT_PRE_HXX
 
@@ -13,16 +44,28 @@
 //typedef layout::Dialog SfxModalDialog;
 //typedef layout::FixedLine FixedLine;
 
+#define AdvancedButton layout::AdvancedButton
+#define Box layout::Box
 #define Button layout::Button
 #define CancelButton layout::CancelButton
+#define CheckBox layout::CheckBox
+#define Container layout::Container
+#define FixedImage layout::FixedImage
 #define FixedInfo layout::FixedInfo
 #define FixedLine layout::FixedLine
 #define FixedText layout::FixedText
+#define HBox layout::HBox
 #define HelpButton layout::HelpButton
 #define MetricField layout::MetricField
+#define MoreButton layout::MoreButton
+#define MultiLineEdit layout::MultiLineEdit
 #define OKButton layout::OKButton
+#define ProgressBar layout::ProgressBar
+#define PushButton layout::PushButton
 #define RadioButton layout::RadioButton
 #define SfxModalDialog layout::Dialog
+#define Table layout::Table
+#define VBox layout::VBox
 
 /* FIXME: why are we defaulting to layout::Window?
    /home/janneke/vc/ooo-build/build/hack/sw/source/ui/dialog/wordcountdialog.cxx:87: error: no matching function for call to 'layout::Dialog::Dialog(Window*&, const char [14], const char [7])'
@@ -41,20 +84,29 @@
  * but is not scalable. */
 #ifdef _LAYOUT_POST_HXX
 
-#ifdef _SVX_ZOOM_CXX
+#ifdef _SVX_RECOVER_CXX
 #undef SfxModalDialog
-#define SfxModalDialog( pParent, SVX_RES_RID ) layout::Dialog( pParent, "zoom.xml", "dialog" )
-#define _SVX_ZOOM_HRC
-#endif /* _SVX_ZOOM_CXX */
+// 3rd parameter must match ID in <modaldialog> "RID_SVXDLG_RECOVER", localize.sdf
+#define SfxModalDialog( pParent, SVX_RES_RID ) layout::Dialog( pParent, "recover.xml", "RID_SVXDLG_RECOVER" )
+//#define _SVX_RECOVER_HRC
+#endif /* _SVX_RECOVER_CXX */
 
 #ifdef SW_WORDCOUNTDIALOG_HXX
 #undef SfxModalDialog
-#define SfxModalDialog( pParent, SW_RES_RID ) layout::Dialog( pParent, "wordcount.xml", "dialog" )
+// 3rd parameter must match ID in <modaldialog> "DLG_WORDCOUNT", localize.sdf
+#define SfxModalDialog( pParent, SW_RES_RID ) layout::Dialog( pParent, "wordcount.xml", "DLG_WORDCOUNT" )
 #define SW_WORDCOUNTDIALOG_HRC
 #endif /* SW_WORDCOUNTDIALOG_HXX */
 
+#ifdef _SVX_ZOOM_CXX
+#undef SfxModalDialog
+// 3rd parameter must match ID in <modaldialog> "RID_SVXDLG_ZOOM", localize.sdf
+#define SfxModalDialog( pParent, SVX_RES_RID ) layout::Dialog( pParent, "zoom.xml", "RID_SVXDLG_ZOOM" )
+#define _SVX_ZOOM_HRC
 #endif /* _SVX_ZOOM_CXX */
 
+#endif /* _LAYOUT_POST_HXX */
+
 #else /* !ENABLE_LAYOUT */
 
 #define LAYOUT_PRE_POST
Index: toolkit/inc/layout/layout.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/inc/layout/layout.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/inc/layout/layout.hxx	6 Mar 2008 11:37:31 -0000	1.2
+++ toolkit/inc/layout/layout.hxx	30 Jul 2008 11:12:22 -0000	1.2.6.3
@@ -1,10 +1,40 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef _LAYOUT_HXX
 #define _LAYOUT_HXX
 
-#if ENABLE_LAYOUT
-
 #include <com/sun/star/uno/XInterface.hpp>
 #include <com/sun/star/awt/XLayoutContainer.hpp>
+#include <com/sun/star/util/Color.hpp>
 #include <tools/link.hxx>
 #include <tools/string.hxx>
 
@@ -16,6 +46,7 @@
 #include <toolkit/dllapi.h>
 
 class Window;
+class Image;
 
 namespace layout
 {
@@ -28,32 +59,22 @@ class TOOLKIT_DLLPUBLIC Context
 {
     ContextImpl *pImpl;
 public:
-    Context( const char *pPath );
+    Context( char const* pPath );
     ~Context();
-    PeerHandle GetPeerHandle( const char *pId, sal_uInt32 nId = 0 ) const;
+    PeerHandle GetPeerHandle( char const* pId, sal_uInt32 nId = 0 ) const;
     void setToplevel( PeerHandle xToplevel );
     PeerHandle getToplevel();
     PeerHandle getRoot();
 };
 
-class ImageImpl;
-class TOOLKIT_DLLPUBLIC Image
-{
-    ImageImpl *pImpl;
-public:
-    Image( const char *pName );
-    ~Image();
-    ImageImpl &getImpl() const { return *pImpl; }
-};
-
 // make declaring wrappers easier ...
 #define DECL_CONSTRUCTORS(t,par,defaultWinBit) \
     protected:                                 \
         explicit t( WindowImpl *pImpl ) : \
             par( pImpl ) {} \
-        const char *GetUnoName() const; \
+        char const* GetUnoName() const; \
     public: \
-        t( Context *pCtx, const char *pId, sal_uInt32 nId = 0 ); \
+        t( Context *pCtx, char const* pId, sal_uInt32 nId = 0 ); \
         t( Window *pParent, WinBits nStyle = defaultWinBit )
 #define DECL_GET_IMPL(t) \
         inline t##Impl &getImpl() const
@@ -61,12 +82,12 @@ public:
 // follows the VCL inheritance hierarchy ...
 
 class WindowImpl;
-class TOOLKIT_DLLPUBLIC TOOLKIT_DLLPUBLIC Window
+class TOOLKIT_DLLPUBLIC Window
 {
 protected:
     WindowImpl *mpImpl;
     static PeerHandle CreatePeer( Window *pParent, WinBits nStyle,
-                                  const char *pName);
+                                  char const* pName);
 public:
     PeerHandle GetPeer();
     Context *getContext();
@@ -91,7 +112,7 @@ class TOOLKIT_DLLPUBLIC Control : public
     DECL_GET_IMPL( Control );
     DECL_CONSTRUCTORS( Control, Window, 0 );
 public:
-// void SetText( const String& rStr ); - can't do this here ...
+// void SetText( String const& rStr ); - can't do this here ...
 };
 
 class FixedLineImpl;
@@ -100,6 +121,8 @@ class TOOLKIT_DLLPUBLIC FixedLine : publ
     friend class FixedLineImpl;
     DECL_GET_IMPL( FixedLine );
     DECL_CONSTRUCTORS( FixedLine, Control, WB_HORZ );
+public:
+    bool IsEnabled();
 };
 
 class FixedTextImpl;
@@ -109,7 +132,17 @@ class TOOLKIT_DLLPUBLIC FixedText : publ
     DECL_GET_IMPL( FixedText );
     DECL_CONSTRUCTORS( FixedText, Control, 0 );
 public:
-    void SetText( const String& rStr );
+    void SetText( String const& rStr );
+};
+
+class FixedImageImpl;
+class TOOLKIT_DLLPUBLIC FixedImage : public Control
+{
+    friend class FixedImageImpl;
+    DECL_GET_IMPL( FixedImage );
+    DECL_CONSTRUCTORS( FixedImage, Control, 0 );
+public:
+    void setImage( ::Image const& );
 };
 
 class FixedInfoImpl;
@@ -120,6 +153,16 @@ class TOOLKIT_DLLPUBLIC FixedInfo : publ
     DECL_CONSTRUCTORS( FixedInfo, FixedText, 0 );
 };
 
+class ImageImpl;
+class TOOLKIT_DLLPUBLIC Image
+{
+    ImageImpl *pImpl;
+public:
+    Image( char const* pName );
+    ~Image();
+    ImageImpl &getImpl() const { return *pImpl; }
+};
+
 class ButtonImpl;
 class TOOLKIT_DLLPUBLIC Button : public Control
 {
@@ -127,11 +170,11 @@ class TOOLKIT_DLLPUBLIC Button : public 
     DECL_GET_IMPL( Button );
     DECL_CONSTRUCTORS( Button, Control, 0 );
 public:
-    void SetText( const String& rStr );
+    void SetText( String const& rStr );
     BOOL SetModeImage( const Image& rImage );
     void SetImageAlign( ImageAlign eAlign );
 
-    void SetClickHdl( const Link& rLink );
+    void SetClickHdl( Link const& rLink );
     virtual void Click() /* pure virtual? */;
 };
 
@@ -145,7 +188,7 @@ public:
     BOOL IsChecked() const;
 
     void Toggle();
-    void SetToggleHdl( const Link& rLink );
+    void SetToggleHdl( Link const& rLink );
 };
 
 class TOOLKIT_DLLPUBLIC OKButton : public PushButton
@@ -185,6 +228,27 @@ class TOOLKIT_DLLPUBLIC HelpButton : pub
     DECL_CONSTRUCTORS( HelpButton, PushButton, 0 );
 };
 
+class AdvancedButtonImpl;
+class TOOLKIT_DLLPUBLIC AdvancedButton : public PushButton
+{
+    DECL_CONSTRUCTORS( AdvancedButton, PushButton, 0 );
+    DECL_GET_IMPL( AdvancedButton );
+    
+    void AddAdvanced( Window* w );
+    void AddSimple( Window* w );
+    void RemoveAdvanced( Window* w );
+    void RemoveSimple( Window* w );
+};
+
+class MoreButtonImpl;
+class TOOLKIT_DLLPUBLIC MoreButton : public AdvancedButton
+{
+    DECL_CONSTRUCTORS( MoreButton, AdvancedButton, 0 );
+    DECL_GET_IMPL( MoreButton );
+    void AddWindow( Window* w );
+    void RemoveWindow( Window* w );
+};
+
 class RadioButtonImpl;
 class TOOLKIT_DLLPUBLIC RadioButton : public Button
 {
@@ -195,11 +259,11 @@ public:
     BOOL IsChecked() const;
 
     void Toggle();
-    void SetToggleHdl( const Link& rLink );
+    void SetToggleHdl( Link const& rLink );
 };
 
 class CheckBoxImpl;
-class TOOLKIT_DLLPUBLIC TOOLKIT_DLLPUBLIC CheckBox : public Button
+class TOOLKIT_DLLPUBLIC CheckBox : public Button
 {
     DECL_GET_IMPL( CheckBox );
     DECL_CONSTRUCTORS( CheckBox, Button, 0 );
@@ -208,7 +272,7 @@ public:
     BOOL IsChecked() const;
 
     void Toggle();
-    void SetToggleHdl( const Link& rLink );
+    void SetToggleHdl( Link const& rLink );
 };
 
 class EditImpl;
@@ -217,9 +281,9 @@ class TOOLKIT_DLLPUBLIC Edit : public Co
     DECL_GET_IMPL( Edit );
     DECL_CONSTRUCTORS( Edit, Control, WB_BORDER );
 public:
-    void SetText( const XubString& rStr ) const;
+    void SetText( XubString const& rStr ) const;
     XubString GetText() const;
-    void SetModifyHdl( const Link& rLink );
+    void SetModifyHdl( Link const& rLink );
 };
 
 class MultiLineEditImpl;
@@ -267,7 +331,7 @@ class TOOLKIT_DLLPUBLIC NumericField : p
 {
     DECL_GET_IMPL( NumericField );
 public:
-    NumericField( Context *pCtx, const char *pId, sal_uInt32 nId = 0 );
+    NumericField( Context *pCtx, char const* pId, sal_uInt32 nId = 0 );
     NumericField( Window *pParent, WinBits nStyle );
 };
 
@@ -294,7 +358,7 @@ class TOOLKIT_DLLPUBLIC MetricField : pu
 {
     DECL_GET_IMPL( MetricField );
 public:
-    MetricField( Context *pCtx, const char *pId, sal_uInt32 nId = 0 );
+    MetricField( Context *pCtx, char const* pId, sal_uInt32 nId = 0 );
     MetricField( Window *pParent, WinBits nStyle );
 };
 
@@ -307,17 +371,17 @@ class TOOLKIT_DLLPUBLIC ComboBox : publi
     DECL_CONSTRUCTORS( ComboBox, Edit, 0 );
 
 public:
-    USHORT InsertEntry( const XubString& rStr, USHORT nPos = COMBOBOX_APPEND );
-    void RemoveEntry( const XubString& rStr );
+    USHORT InsertEntry( XubString const& rStr, USHORT nPos = COMBOBOX_APPEND );
+    void RemoveEntry( XubString const& rStr );
     void RemoveEntry( USHORT nPos );
     void Clear();
 
-    USHORT GetEntryPos( const XubString& rStr ) const;
+    USHORT GetEntryPos( XubString const& rStr ) const;
     XubString GetEntry( USHORT nPos ) const;
     USHORT GetEntryCount() const;
 
-    void SetClickHdl( const Link& rLink );
-    void SetSelectHdl( const Link& rLink );
+    void SetClickHdl( Link const& rLink );
+    void SetSelectHdl( Link const& rLink );
 };
 
 #define LISTBOX_APPEND               ((USHORT)0xFFFF)
@@ -328,25 +392,25 @@ class TOOLKIT_DLLPUBLIC ListBox : public
     DECL_GET_IMPL( ListBox );
     DECL_CONSTRUCTORS( ListBox, Control, WB_BORDER );
 public:
-    USHORT InsertEntry( const XubString& rStr, USHORT nPos = LISTBOX_APPEND );
+    USHORT InsertEntry( XubString const& rStr, USHORT nPos = LISTBOX_APPEND );
 
-    void RemoveEntry( const XubString& rStr );
+    void RemoveEntry( XubString const& rStr );
     void RemoveEntry( USHORT nPos );
     void Clear();
 
-    USHORT GetEntryPos( const XubString& rStr ) const;
+    USHORT GetEntryPos( XubString const& rStr ) const;
     XubString GetEntry( USHORT nPos ) const;
     USHORT GetEntryCount() const;
 
-    void SelectEntry( const XubString& rStr, BOOL bSelect = TRUE );
+    void SelectEntry( XubString const& rStr, BOOL bSelect = TRUE );
     void SelectEntryPos( USHORT nPos, BOOL bSelect = TRUE );
 
     USHORT GetSelectEntryCount() const;
     XubString GetSelectEntry( USHORT nSelIndex = 0 ) const;
     USHORT GetSelectEntryPos( USHORT nSelIndex = 0 ) const;
 
-    void SetSelectHdl( const Link& rLink );
-    void SetClickHdl( const Link& rLink );
+    void SetSelectHdl( Link const& rLink );
+    void SetClickHdl( Link const& rLink );
 };
 
 class DialogImpl;
@@ -356,11 +420,24 @@ class TOOLKIT_DLLPUBLIC Dialog : public 
     void SetParent( Window *pParent );
     void SetParent( ::Window *pParent );
 public:
-    Dialog( Window *pOptParent, const char *pXMLPath, const char *pId, sal_uInt32 nId = 0 );
-    Dialog( ::Window *pOptParent, const char *pXMLPath, const char *pId, sal_uInt32 nId = 0 );
+    Dialog( Window *pOptParent, char const* pXMLPath, char const* pId, sal_uInt32 nId = 0 );
+    Dialog( ::Window *pOptParent, char const* pXMLPath, char const* pId, sal_uInt32 nId = 0 );
     short Execute();
     void EndDialog( long nResult = 0 );
-    void SetText( const String& rStr );
+    void SetText( String const& rStr );
+};
+
+class ProgressBarImpl;
+class TOOLKIT_DLLPUBLIC ProgressBar : public Control
+{
+    DECL_GET_IMPL( ProgressBar );
+    DECL_CONSTRUCTORS( ProgressBar, Control, WB_BORDER );
+public:
+    void SetForegroundColor( css::util::Color color );
+    void SetBackgroundColor( css::util::Color color );
+    void SetValue( sal_Int32 i );
+    void SetRange( sal_Int32 min, sal_Int32 max );
+    sal_Int32 GetValue();
 };
 
 // -----------------------------------------------------------------
@@ -371,9 +448,9 @@ class TOOLKIT_DLLPUBLIC Container
 {
 protected:
     css::uno::Reference< css::awt::XLayoutContainer > mxContainer;
-    Container( const rtl::OUString &rName, sal_Int32 nBorder );
+    Container( rtl::OUString const& rName, sal_Int32 nBorder );
 public:
-    Container( const Context *pCtx, const char *pId );
+    Container( Context const* pCtx, char const* pId );
 
     void Add( Window *pWindow );
     void Add( Container *pContainer );
@@ -385,6 +462,8 @@ public:
     // besides we would need to keep track of children, uh
 
     void ShowAll( bool bVisible );
+    void Show();
+    void Hide();
 
     css::uno::Reference< css::awt::XLayoutContainer > getImpl()
     { return mxContainer; }
@@ -395,8 +474,7 @@ class TOOLKIT_DLLPUBLIC Table : public C
 protected:
     Table( sal_Int32 nBorder, sal_Int32 nColumns );
 public:
-    Table( const Context *pCtx, const char *pId )
-        : Container( pCtx, pId ) {}
+    Table( Context const* pCtx, char const* pId );
     void Add( Window *pWindow, bool bXExpand, bool bYExpand,
               sal_Int32 nXSpan = 1, sal_Int32 nYSpan = 1 );
     void Add( Container *pContainer, bool bXExpand, bool bYExpand,
@@ -410,10 +488,9 @@ private:
 class TOOLKIT_DLLPUBLIC Box : public Container
 {
 protected:
-    Box( const rtl::OUString &rName, sal_Int32 nBorder, bool bHomogeneous );
+    Box( rtl::OUString const& rName, sal_Int32 nBorder, bool bHomogeneous );
 public:
-    Box( const Context *pCtx, const char *pId )
-        : Container( pCtx, pId ) {}
+    Box( Context const* pCtx, char const* pId );
     void Add( Window *pWindow, bool bExpand, bool bFill, sal_Int32 nPadding);
     void Add( Container *pContainer, bool bExpand, bool bFill, sal_Int32 nPadding);
 
@@ -425,18 +502,16 @@ private:
 class TOOLKIT_DLLPUBLIC HBox : public Box
 {
 public:
-    HBox( sal_Int32 nBorder, bool bHomogeneous )
-        : Box( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "hbox" ) ), nBorder, bHomogeneous ) {}
+    HBox( Context const* pCtx, char const* pId );
+    HBox( sal_Int32 nBorder, bool bHomogeneous );
 };
 class TOOLKIT_DLLPUBLIC VBox : public Box
 {
 public:
-    VBox( sal_Int32 nBorder, bool bHomogeneous )
-        : Box( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "vbox" ) ), nBorder, bHomogeneous ) {}
+    VBox( Context const* pCtx, char const* pId );
+    VBox( sal_Int32 nBorder, bool bHomogeneous );
 };
 
 } // end namespace layout
 
-#endif /* ENABLE_LAYOUT */
-
 #endif /* _LAYOUT_HXX */
Index: toolkit/inc/layout/layoutcore.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/inc/layout/layoutcore.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/inc/layout/layoutcore.hxx	6 Mar 2008 11:37:48 -0000	1.2
+++ toolkit/inc/layout/layoutcore.hxx	30 Jul 2008 11:12:27 -0000	1.2.6.3
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef _LAYOUT_CORE_HXX_
 #define _LAYOUT_CORE_HXX_
 
@@ -33,15 +64,15 @@ css::uno::Reference< css::graphic::XGrap
 namespace prophlp
 {
 // can we set properties on this handle ?
-bool canHandleProps( const css::uno::Reference< css::uno::XInterface > &xRef );
+bool TOOLKIT_DLLPUBLIC canHandleProps( const css::uno::Reference< css::uno::XInterface > &xRef );
 // if so which properties ?
-css::uno::Reference< css::beans::XPropertySetInfo > queryPropertyInfo(
+css::uno::Reference< css::beans::XPropertySetInfo > TOOLKIT_DLLPUBLIC queryPropertyInfo(
     const css::uno::Reference< css::uno::XInterface > &xRef );
 // set / get ...
-void setProperty( const css::uno::Reference< css::uno::XInterface > &xRef,
+void TOOLKIT_DLLPUBLIC setProperty( const css::uno::Reference< css::uno::XInterface > &xRef,
                   const rtl::OUString &rName,
                   css::uno::Any aValue );
-css::uno::Any getProperty( const css::uno::Reference< css::uno::XInterface > &xRef,
+css::uno::Any TOOLKIT_DLLPUBLIC getProperty( const css::uno::Reference< css::uno::XInterface > &xRef,
                            const rtl::OUString &rName );
 } // namespace prophlp
 } // namespace layoutimpl
Index: toolkit/inc/toolkit/awt/vclxtopwindow.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/inc/toolkit/awt/vclxtopwindow.hxx,v
retrieving revision 1.6
retrieving revision 1.5.30.5
diff -p -u -u -p -b -w -B -r1.6 -r1.5.30.5
--- toolkit/inc/toolkit/awt/vclxtopwindow.hxx	11 Apr 2008 08:49:02 -0000	1.6
+++ toolkit/inc/toolkit/awt/vclxtopwindow.hxx	30 Jul 2008 12:36:45 -0000	1.5.30.5
@@ -37,26 +37,56 @@
 #include <cppuhelper/weak.hxx>
 #include <osl/mutex.hxx>
 
+#include <cppuhelper/implbase2.hxx>
+
 #include <toolkit/awt/vclxcontainer.hxx>
 
+typedef ::cppu::ImplHelper2 < ::com::sun::star::awt::XTopWindow,
+                              ::com::sun::star::awt::XSystemDependentWindowPeer
+                              > VCLXTopWindow_XBase;
+
+class TOOLKIT_DLLPUBLIC VCLXTopWindow_Base: public VCLXTopWindow_XBase
+{
+protected:
+  	::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar> mxMenuBar;
+
+	virtual ::vos::IMutex& GetMutexImpl() = 0;
+    virtual Window* GetWindowImpl() = 0;
+	virtual TopWindowListenerMultiplexer& GetTopWindowListenersImpl() = 0;
+
+public:
+    virtual ~VCLXTopWindow_Base();
+
+    // ::com::sun::star::awt::XSystemDependentWindowPeer
+    ::com::sun::star::uno::Any SAL_CALL getWindowHandle( const ::com::sun::star::uno::Sequence< sal_Int8 >& ProcessId, sal_Int16 SystemType ) throw(::com::sun::star::uno::RuntimeException);
+
+    // ::com::sun::star::awt::XTopWindow
+    void SAL_CALL addTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException);
+    void SAL_CALL removeTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException);
+    void SAL_CALL toFront() throw(::com::sun::star::uno::RuntimeException);
+    void SAL_CALL toBack() throw(::com::sun::star::uno::RuntimeException);
+    void SAL_CALL setMenuBar( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar >& xMenu ) throw(::com::sun::star::uno::RuntimeException);
+};
+
 //	----------------------------------------------------
 //	class VCLXTopWindow
 //	----------------------------------------------------
 
-class VCLXTopWindow :	public ::com::sun::star::awt::XTopWindow,
-            public ::com::sun::star::awt::XSystemDependentWindowPeer,
+class VCLXTopWindow: public VCLXTopWindow_Base,
 						public VCLXContainer
 {
 private:
-	::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar> mxMenuBar;
     bool m_bWHWND;
+
+protected:
+    virtual vos::IMutex& GetMutexImpl();
+    virtual Window* GetWindowImpl();
+    virtual TopWindowListenerMultiplexer& GetTopWindowListenersImpl();
+
 public:	
 	VCLXTopWindow(bool bWHWND = false);
 	~VCLXTopWindow();
 	
-	// ::com::sun::star::awt::XSystemDependendtWindowPeer
-    ::com::sun::star::uno::Any SAL_CALL getWindowHandle( const ::com::sun::star::uno::Sequence< sal_Int8 >& ProcessId, sal_Int16 SystemType ) throw(::com::sun::star::uno::RuntimeException);
-    
 	// ::com::sun::star::uno::XInterface
     ::com::sun::star::uno::Any	SAL_CALL queryInterface( const ::com::sun::star::uno::Type & rType ) throw(::com::sun::star::uno::RuntimeException);
 	void						SAL_CALL acquire() throw()	{ OWeakObject::acquire(); }
@@ -66,13 +96,6 @@ public:	
 	::com::sun::star::uno::Sequence< ::com::sun::star::uno::Type >	SAL_CALL getTypes() throw(::com::sun::star::uno::RuntimeException);
 	::com::sun::star::uno::Sequence< sal_Int8 >						SAL_CALL getImplementationId() throw(::com::sun::star::uno::RuntimeException);
 
-	// ::com::sun::star::awt::XTopWindow
-    void SAL_CALL addTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL removeTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL toFront(  ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL toBack(  ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL setMenuBar( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar >& xMenu ) throw(::com::sun::star::uno::RuntimeException);
-
     static void     ImplGetPropertyIds( std::list< sal_uInt16 > &aIds );
     virtual void    GetPropertyIds( std::list< sal_uInt16 > &aIds ) { return ImplGetPropertyIds( aIds ); }
 };
Index: toolkit/inc/toolkit/awt/vclxwindows.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/inc/toolkit/awt/vclxwindows.hxx,v
retrieving revision 1.40
retrieving revision 1.39.26.3
diff -p -u -u -p -b -w -B -r1.40 -r1.39.26.3
--- toolkit/inc/toolkit/awt/vclxwindows.hxx	11 Apr 2008 08:50:53 -0000	1.40
+++ toolkit/inc/toolkit/awt/vclxwindows.hxx	30 Jul 2008 12:36:39 -0000	1.39.26.3
@@ -375,6 +375,9 @@ public:
     ::rtl::OUString SAL_CALL getMessageText(  ) throw(::com::sun::star::uno::RuntimeException);
     sal_Int16 SAL_CALL execute(  ) throw(::com::sun::star::uno::RuntimeException);
 
+    // ::com::sun::star::awt::XLayoutConstrains
+    ::com::sun::star::awt::Size SAL_CALL getMinimumSize() throw(::com::sun::star::uno::RuntimeException);
+
     static void     ImplGetPropertyIds( std::list< sal_uInt16 > &aIds );
     virtual void    GetPropertyIds( std::list< sal_uInt16 > &aIds ) { return ImplGetPropertyIds( aIds ); }
 };
@@ -594,6 +597,10 @@ public:
     void SAL_CALL setProperty( const ::rtl::OUString& PropertyName, const ::com::sun::star::uno::Any& Value ) throw(::com::sun::star::uno::RuntimeException);
     ::com::sun::star::uno::Any SAL_CALL getProperty( const ::rtl::OUString& PropertyName ) throw(::com::sun::star::uno::RuntimeException);
 
+    // ::com::sun::star::awt::XLayoutConstrains
+    ::com::sun::star::awt::Size SAL_CALL getMinimumSize() throw(::com::sun::star::uno::RuntimeException);
+    static ::com::sun::star::awt::Size SAL_CALL implGetMinimumSize( Window* p ) throw(::com::sun::star::uno::RuntimeException);
+
     static void     ImplGetPropertyIds( std::list< sal_uInt16 > &aIds );
     virtual void    GetPropertyIds( std::list< sal_uInt16 > &aIds ) { return ImplGetPropertyIds( aIds ); }
 };
Index: toolkit/prj/build.lst
===================================================================
RCS file: /cvs/gsl/toolkit/prj/build.lst,v
retrieving revision 1.5
retrieving revision 1.5.6.1
diff -p -u -u -p -b -w -B -r1.5 -r1.5.6.1
--- toolkit/prj/build.lst	6 Mar 2008 11:38:23 -0000	1.5
+++ toolkit/prj/build.lst	26 Mar 2008 13:45:00 -0000	1.5.6.1
@@ -9,4 +9,3 @@ ti	toolkit\source\controls\tree			nmake	
 ti	toolkit\source\layout    nmake	-	all	ti_layout NULL
 ti	toolkit\source\vclcompat nmake	-	all	ti_vclcompat NULL
 ti	toolkit\util							nmake	-	all	ti_util ti_awt ti_controls ti_layout ti_helper ti_tree ti_vclcompat NULL
-ti	toolkit\workben\layout   nmake	-	all	ti_layout_workben ti_util NULL
Index: toolkit/prj/d.lst
===================================================================
RCS file: /cvs/gsl/toolkit/prj/d.lst,v
retrieving revision 1.23
retrieving revision 1.23.4.3
diff -p -u -u -p -b -w -B -r1.23 -r1.23.4.3
--- toolkit/prj/d.lst	6 Mar 2008 11:38:39 -0000	1.23
+++ toolkit/prj/d.lst	28 Mar 2008 11:17:42 -0000	1.23.4.3
@@ -50,14 +50,5 @@ mkdir: %_DEST%\inc%_EXT%\toolkit\control
 
 mkdir: %_DEST%\inc%_EXT%\layout
 ..\%__SRC%\lib\*.dylib %_DEST%\lib%_EXT%\*.dylib
-..\%__SRC%\lib\layout.lib %_DEST%\lib%_EXT%\tklayout.lib
-..\%__SRC%\bin\layout*.dll %_DEST%\bin%_EXT%\tklayout*.dll
-..\%__SRC%\misc\layout*.map %_DEST%\bin%_EXT%\tklayout*.map
-
-..\%__SRC%\lib\*.xml %_DEST%\lib%_EXT%\*.xml
-mkdir: %_DEST%\lib%_EXT%\de
-..\%__SRC%\lib\de\*.xml %_DEST%\lib%_EXT%\de\*.xml
-mkdir: %_DEST%\lib%_EXT%\nl
-..\%__SRC%\lib\nl\*.xml %_DEST%\lib%_EXT%\nl\*.xml
 
 ..\inc\layout\*.hxx %_DEST%\inc%_EXT%\layout\*.hxx
Index: toolkit/source/awt/forward.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/forward.hxx,v
retrieving revision 1.3
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.2
--- toolkit/source/awt/forward.hxx	11 Apr 2008 09:13:52 -0000	1.3
+++ toolkit/source/awt/forward.hxx	30 Jul 2008 11:12:32 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef AWT_FORWARD_HXX
 #define AWT_FORWARD_HXX
 
Index: toolkit/source/awt/makefile.mk
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/makefile.mk,v
retrieving revision 1.34
retrieving revision 1.33.6.3
diff -p -u -u -p -b -w -B -r1.34 -r1.33.6.3
--- toolkit/source/awt/makefile.mk	11 Apr 2008 09:14:30 -0000	1.34
+++ toolkit/source/awt/makefile.mk	30 Jul 2008 12:29:06 -0000	1.33.6.3
@@ -43,6 +43,9 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Files --------------------------------------------------------
 
+# FIXME: This is bad, hmkay
+CFLAGS+= -I$(PRJ)/source
+
 .IF "$(GUIBASE)"=="aqua"
 OBJCXXFLAGS=-x objective-c++ -fobjc-exceptions
 CFLAGSCXX+=$(OBJCXXFLAGS)
@@ -68,25 +71,17 @@ SLOFILES=   \
 			$(SLO)$/vclxspinbutton.obj                  \
 			$(SLO)$/xsimpleanimation.obj                \
 			$(SLO)$/xthrobber.obj						\
-			$(SLO)$/asynccallback.obj
-
-SRS1NAME=$(TARGET)
-SRC1FILES=\
-            xthrobber.src
-
-.IF "$(ENABLE_LAYOUT)" == "TRUE"
-
-SECOND_BUILD=layout
-layout_SLOFILES=\
+			$(SLO)$/asynccallback.obj\
 	$(SLO)/vclxbutton.obj\
 	$(SLO)/vclxdialog.obj\
 	$(SLO)/vclxfixedline.obj\
-	$(SLO)/vclxproxy.obj\
 	$(SLO)/vclxscroller.obj\
 	$(SLO)/vclxsplitter.obj\
 	$(SLO)/vclxtabcontrol.obj
 
-.ENDIF # ENABLE_LAYOUT == TRUE
+SRS1NAME=$(TARGET)
+SRC1FILES=\
+            xthrobber.src
 
 # --- Targets ------------------------------------------------------
 
Index: toolkit/source/awt/vclxbutton.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxbutton.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/awt/vclxbutton.cxx	6 Mar 2008 11:39:31 -0000	1.2
+++ toolkit/source/awt/vclxbutton.cxx	30 Jul 2008 11:12:38 -0000	1.2.6.3
@@ -1,15 +1,52 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "vclxbutton.hxx"
 
-#include "layoutcore.hxx"
+#include "layout/layoutcore.hxx"
 #include <com/sun/star/awt/ImagePosition.hpp>
 #include <vcl/button.hxx>
 
 namespace css = com::sun::star;
 
-IconButton::IconButton( css::uno::Reference< css::uno::XInterface > xButton,
-                        rtl::OUString aDefaultLabel, const char *pGraphName )
-    : VCLXProxy( xButton )
+namespace layoutimpl
 {
+
+VCLXIconButton::VCLXIconButton( Window *p, rtl::OUString aDefaultLabel, char const *pGraphName )
+    : VCLXButton()
+{
+    /* FIXME: before Window is set, setLabel, setProperty->setImage
+     * are silent no-ops.  */
+    p->SetComponentInterface( this );
+
     setLabel( aDefaultLabel );
     setProperty( rtl::OUString::createFromAscii( "Graphic" ),
                  css::uno::Any( layoutimpl::loadGraphic( pGraphName ) ) );
@@ -21,110 +58,73 @@ IconButton::IconButton( css::uno::Refere
 
 // FIXME: l10n/i18n of Reset & Apply
 
-VCLXOKButton::VCLXOKButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, Button::GetStandardText( BUTTON_OK ),
+VCLXOKButton::VCLXOKButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_OK ),
                   "res/commandimagelist/sc_ok.png" )
 {
 }
 
-VCLXCancelButton::VCLXCancelButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, Button::GetStandardText( BUTTON_CANCEL ),
-//    : IconButton( xButton, rtl::OUString::createFromAscii( "~Cancel " ),
+VCLXCancelButton::VCLXCancelButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_CANCEL ),
+//    : VCLXIconButton( xButton, rtl::OUString::createFromAscii( "~Cancel " ),
                   "res/commandimagelist/sc_cancel.png" )
 {
 }
 
-VCLXYesButton::VCLXYesButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, Button::GetStandardText( BUTTON_YES ),
+VCLXYesButton::VCLXYesButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_YES ),
                   "res/commandimagelist/sc_yes.png" )
 {
 }
 
-VCLXNoButton::VCLXNoButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, Button::GetStandardText( BUTTON_NO ),
+VCLXNoButton::VCLXNoButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_NO ),
                   "res/commandimagelist/sc_no.png" )
 {
 }
 
-VCLXRetryButton::VCLXRetryButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, Button::GetStandardText( BUTTON_RETRY ),
+VCLXRetryButton::VCLXRetryButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_RETRY ),
                   "res/commandimagelist/sc_retry.png" )
 {
 }
 
-VCLXIgnoreButton::VCLXIgnoreButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, Button::GetStandardText( BUTTON_IGNORE ),
+VCLXIgnoreButton::VCLXIgnoreButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_IGNORE ),
                   "res/commandimagelist/sc_ignore.png" )
 {
 }
 
-VCLXResetButton::VCLXResetButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, rtl::OUString::createFromAscii( "~Reset " ),
+VCLXResetButton::VCLXResetButton( Window *p )
+    : VCLXIconButton( p, rtl::OUString::createFromAscii( "~Reset " ),
                   "res/commandimagelist/sc_reset.png" )
 {
 }
 
-VCLXApplyButton::VCLXApplyButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, rtl::OUString::createFromAscii( "Apply" ),
+VCLXApplyButton::VCLXApplyButton( Window *p )
+    : VCLXIconButton( p, rtl::OUString::createFromAscii( "Apply" ),
                   "res/commandimagelist/sc_apply.png" )
 {
 }
 
-VCLXHelpButton::VCLXHelpButton( css::uno::Reference< css::uno::XInterface > xButton )
-    : IconButton( xButton, Button::GetStandardText( BUTTON_HELP ),
+VCLXHelpButton::VCLXHelpButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_HELP ),
                   "res/commandimagelist/sc_help.png" )
 {
 }
 
-namespace layoutimpl
+VCLXMoreButton::VCLXMoreButton( Window *p )
+    : VCLXIconButton( p, Button::GetStandardText( BUTTON_MORE ),
+//    : VCLXIconButton( p, rtl::OUString::createFromAscii( "More " ),
+                  "res/commandimagelist/sc_more.png" )
 {
-css::uno::Reference< css::awt::XLayoutConstrains >
-createInternalWidget( css::uno::Reference< css::awt::XToolkit > xToolkit,
-                      css::uno::Reference< css::uno::XInterface > xParent,
-                      const rtl::OUString &rName, long nProps )
-{
-    css::uno::Reference< css::awt::XLayoutConstrains > xRef, xWrapped;
-    bool bOK = false;
-    bool bCancel = false;
-    bool bYes = false;
-    bool bNo = false;
-    bool bRetry = false;
-    bool bIgnore = false;
-    bool bReset = false;
-    bool bApply = false;
-    bool bHelp = false;
-    if ( ( bOK = rName.equalsAscii( "okbutton" ) )
-         || ( bCancel = rName.equalsAscii( "cancelbutton" ) )
-         || ( bYes = rName.equalsAscii( "yesbutton" ) )
-         || ( bNo = rName.equalsAscii( "nobutton" ) )
-         || ( bRetry = rName.equalsAscii( "retrybutton" ) )
-         || ( bIgnore = rName.equalsAscii( "ignorebutton" ) )
-         || ( bReset = rName.equalsAscii( "resetbutton" ) )
-         || ( bApply = rName.equalsAscii( "applybutton" ) )
-         || ( bHelp = rName.equalsAscii( "helpbutton" ) ) )
-    {
-        xWrapped = createWidget( xToolkit, xParent,
-                                 rtl::OUString::createFromAscii( "pushbutton" ),
-                                 nProps );
-        if ( bOK )
-            xRef = new VCLXOKButton( xWrapped );
-        if ( bCancel )
-            xRef = new VCLXCancelButton( xWrapped );
-        if ( bYes )
-            xRef = new VCLXYesButton( xWrapped );
-        if ( bNo )
-            xRef = new VCLXNoButton( xWrapped );
-        if ( bRetry )
-            xRef = new VCLXRetryButton( xWrapped );
-        if ( bIgnore )
-            xRef = new VCLXIgnoreButton( xWrapped );
-        if ( bReset )
-            xRef = new VCLXResetButton( xWrapped );
-        if ( bApply )
-            xRef = new VCLXApplyButton( xWrapped );
-        if ( bHelp )
-            xRef = new VCLXHelpButton( xWrapped );
     }
-    return xRef;
+
+VCLXAdvancedButton::VCLXAdvancedButton( Window *p )
+//    : VCLXIconButton( p, Button::GetStandardText( BUTTON_ADVANCED ),
+    : VCLXIconButton( p, rtl::OUString::createFromAscii( "Advanced " ),
+                  "res/commandimagelist/sc_advanced.png" )
+{
 }
-};
+
+} // namespace layoutimpl
Index: toolkit/source/awt/vclxbutton.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxbutton.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/awt/vclxbutton.hxx	6 Mar 2008 11:39:43 -0000	1.2
+++ toolkit/source/awt/vclxbutton.hxx	30 Jul 2008 11:12:44 -0000	1.2.6.3
@@ -1,69 +1,118 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef LAYOUT_AWT_VCLXBUTTON_HXX
 #define LAYOUT_AWT_VCLXBUTTON_HXX
 
-#include "vclxproxy.hxx"
+#include <toolkit/awt/vclxwindows.hxx>
 
 /* Replacements for broken toolkit/ impls. of ok, cancel, help button, etc. */
 
-class IconButton : public VCLXProxy
+namespace layoutimpl
+{
+
+class VCLXIconButton : public VCLXButton
 {
-protected:
-    IconButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton,
-                rtl::OUString aDefaultLabel, const char *pGraphName );
+public:
+    VCLXIconButton( Window* p, rtl::OUString aDefaultLabel, const char *pGraphName );
+    void Show ();
 };
 
-class VCLXOKButton : public IconButton
+class VCLXOKButton : public VCLXIconButton
 {
 public:
-    VCLXOKButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXOKButton( Window *p );
 };
 
-class VCLXCancelButton : public IconButton
+class VCLXCancelButton : public VCLXIconButton
 {
 public:
-    VCLXCancelButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXCancelButton( Window *p );
 };
 
-class VCLXYesButton : public IconButton
+class VCLXYesButton : public VCLXIconButton
 {
 public:
-    VCLXYesButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXYesButton( Window *p );
 };
 
-class VCLXNoButton : public IconButton
+class VCLXNoButton : public VCLXIconButton
 {
 public:
-    VCLXNoButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXNoButton( Window *p );
 };
 
-class VCLXRetryButton : public IconButton
+class VCLXRetryButton : public VCLXIconButton
 {
 public:
-    VCLXRetryButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXRetryButton( Window *p );
 };
 
-class VCLXIgnoreButton : public IconButton
+class VCLXIgnoreButton : public VCLXIconButton
 {
 public:
-    VCLXIgnoreButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXIgnoreButton( Window *p );
 };
 
-class VCLXResetButton : public IconButton
+class VCLXResetButton : public VCLXIconButton
 {
 public:
-    VCLXResetButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXResetButton( Window *p );
 };
 
-class VCLXApplyButton : public IconButton
+class VCLXApplyButton : public VCLXIconButton
 {
 public:
-    VCLXApplyButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXApplyButton( Window *p );
 };
 
-class VCLXHelpButton : public IconButton
+class VCLXHelpButton : public VCLXIconButton
 {
 public:
-    VCLXHelpButton( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xButton );
+    VCLXHelpButton( Window *p );
 };
 
+// TODO.  Reuse vcl/Morebutton, or make AdvancedButton reuse me?
+class VCLXMoreButton : public VCLXIconButton
+{
+public:
+    VCLXMoreButton( Window *p );
+};
+
+class VCLXAdvancedButton : public VCLXIconButton
+{
+public:
+    VCLXAdvancedButton( Window *p );
+};
+
+} // namespace layoutimpl
+
 #endif // LAYOUT_AWT_VCLXBUTTON_HXX
Index: toolkit/source/awt/vclxdialog.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxdialog.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.6
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.6
--- toolkit/source/awt/vclxdialog.cxx	11 Apr 2008 09:16:59 -0000	1.3
+++ toolkit/source/awt/vclxdialog.cxx	30 Jul 2008 11:12:50 -0000	1.2.6.6
@@ -1,54 +1,77 @@
-#include "vclxdialog.hxx"
-#include "toolkit/helper/property.hxx"
-#include <com/sun/star/awt/ScrollBarOrientation.hpp>
-
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
 
-#include <tools/debug.hxx>
+#include "vclxdialog.hxx"
 
-#include <vcl/msgbox.hxx>
-#include <vcl/wrkwin.hxx>
-#include <vcl/syswin.hxx>
-#include <vcl/menu.hxx>
-#include <vcl/dialog.hxx>
+#include <com/sun/star/awt/PosSize.hpp>
+#include <com/sun/star/awt/SystemDependentXWindow.hpp>
+#include <com/sun/star/lang/SystemDependent.hpp>
 
-#include <vcl/svapp.hxx>
-#include <vcl/syschild.hxx>
-#include <vcl/sysdata.hxx>
 #include <cppuhelper/typeprovider.hxx>
 
 #include <toolkit/awt/vclxmenu.hxx>
 #include <toolkit/helper/macros.hxx>
+#include <toolkit/helper/property.hxx>
 
-#include <com/sun/star/lang/SystemDependent.hpp>
-#include <com/sun/star/awt/SystemDependentXWindow.hpp>
-#include <toolkit/helper/vclunohelper.hxx>
+#ifdef WNT
+#include <tools/prewin.h>
+#include <windows.h>
+#include <tools/postwin.h>
+#endif
 
-#include <com/sun/star/awt/PosSize.hpp>
+#ifdef QUARTZ
+#include "premac.h"
+#include <Cocoa/Cocoa.h>
+#include "postmac.h"
+#endif
+
+#include <vcl/dialog.hxx>
+#include <vcl/msgbox.hxx>
+#include <vcl/svapp.hxx>
+#include <vcl/sysdata.hxx>
+#include <vcl/wrkwin.hxx>
 
-#include "../layout/timer.hxx"
+#include "forward.hxx"
 
-using namespace toolkit;
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
 
-using namespace ::com::sun::star::uno;
-using namespace ::com::sun::star::awt;
-using namespace ::com::sun::star::lang;
-using namespace ::com::sun::star::beans;
-using namespace ::com::sun::star;
-
-//====================================================================
-//= VCLXDialog
-//====================================================================
 DBG_NAME( VCLXDialog )
-//--------------------------------------------------------------------
+
 VCLXDialog::VCLXDialog()
 : VCLXWindow()
     , VCLXDialog_Base()
     , Bin()
-    , bRealized( false ), bResizeSafeguard( false )
+    , bRealized( false )
+    , bResizeSafeguard( false )
 {
     DBG_CTOR( VCLXDialog, NULL );
 
@@ -56,25 +79,36 @@ VCLXDialog::VCLXDialog()
           assert(mxLayoutUnit.is());*/
 }
 
-//--------------------------------------------------------------------
 VCLXDialog::~VCLXDialog()
 {
     DBG_DTOR( VCLXDialog, NULL );
 }
 
-//--------------------------------------------------------------------
-IMPLEMENT_2_FORWARD_XINTERFACE2( VCLXDialog, VCLXWindow, Bin, VCLXDialog_Base )
+vos::IMutex& VCLXDialog::GetMutexImpl()
+{
+    return VCLXWindow::GetMutex();
+}
+
+Window* VCLXDialog::GetWindowImpl()
+{
+    return VCLXWindow::GetWindow();
+}
+
+TopWindowListenerMultiplexer& VCLXDialog::GetTopWindowListenersImpl()
+{
+    return VCLXWindow::GetTopWindowListeners();
+}
+
+IMPLEMENT_2_FORWARD_XINTERFACE2( VCLXDialog, VCLXWindow, Bin, VCLXDialog_Base );
 
-//--------------------------------------------------------------------
-IMPLEMENT_FORWARD_XTYPEPROVIDER2( VCLXDialog, VCLXWindow, VCLXDialog_Base )
+IMPLEMENT_FORWARD_XTYPEPROVIDER2( VCLXDialog, VCLXWindow, VCLXDialog_Base );
 
-//--------------------------------------------------------------------
-void SAL_CALL VCLXDialog::dispose( ) throw(RuntimeException)
+void SAL_CALL VCLXDialog::dispose() throw(::com::sun::star::uno::RuntimeException)
 {
     {
         ::vos::OGuard aGuard( GetMutex() );
 
-        EventObject aDisposeEvent;
+        ::com::sun::star::lang::EventObject aDisposeEvent;
         aDisposeEvent.Source = *this;
 //            maTabListeners.disposeAndClear( aDisposeEvent );
     }
@@ -90,32 +124,31 @@ void VCLXDialog::resizedCb()
 void SAL_CALL VCLXDialog::allocateArea( const css::awt::Rectangle &rArea )
     throw (css::uno::RuntimeException)
 {
-    awt::Size reqSize = Bin::getMinimumSize();
+    ::com::sun::star::awt::Size reqSize = Bin::getMinimumSize();
     reqSize.Height = getHeightForWidth( rArea.Width );
 
     if ( !bRealized )
     {
-        setPosSize( 0, 0, reqSize.Width, reqSize.Height, PosSize::SIZE );
+        setPosSize( 0, 0, reqSize.Width, reqSize.Height, ::com::sun::star::awt::PosSize::SIZE );
         bRealized = true;
         setVisible( true );
     }
     else
     {
-        awt::Size curSize = getSize();
+        ::com::sun::star::awt::Size curSize = getSize();
         if ( reqSize.Width > curSize.Width )
-            setPosSize( 0, 0, reqSize.Width, 0, PosSize::WIDTH );
+            setPosSize( 0, 0, reqSize.Width, 0, ::com::sun::star::awt::PosSize::WIDTH );
         if ( reqSize.Height > curSize.Height )
-            setPosSize( 0, 0, 0, reqSize.Height, PosSize::HEIGHT );
+            setPosSize( 0, 0, 0, reqSize.Height, ::com::sun::star::awt::PosSize::HEIGHT );
     }
 
-    awt::Size size = getSize();
+    ::com::sun::star::awt::Size size = getSize();
     maAllocation.Width = size.Width;
     maAllocation.Height = size.Height;
 
     Bin::allocateArea( maAllocation );
 }
 
-//--------------------------------------------------------------------
 void VCLXDialog::ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent )
 {
     ::vos::OClearableGuard aGuard( GetMutex() );
@@ -131,143 +164,42 @@ void VCLXDialog::ProcessWindowEvent( con
     }
 }
 
-//--------------------------------------------------------------------
-void SAL_CALL VCLXDialog::setProperty( const ::rtl::OUString& PropertyName, const Any &Value ) throw(RuntimeException)
+void SAL_CALL VCLXDialog::setProperty( const ::rtl::OUString& PropertyName, const ::com::sun::star::uno::Any &Value ) throw(::com::sun::star::uno::RuntimeException)
 {
     ::vos::OGuard aGuard( GetMutex() );
 
     if ( GetWindow() )
     {
-        sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
+/*        sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
         switch ( nPropertyId )
         {
             default:
+*/
                 VCLXWindow::setProperty( PropertyName, Value );
-        }
+/*        }
+*/
     }
 }
 
-//--------------------------------------------------------------------
-Any SAL_CALL VCLXDialog::getProperty( const ::rtl::OUString& PropertyName ) throw(RuntimeException)
+::com::sun::star::uno::Any SAL_CALL VCLXDialog::getProperty( const ::rtl::OUString& PropertyName ) throw(::com::sun::star::uno::RuntimeException)
 {
     ::vos::OGuard aGuard( GetMutex() );
 
-    Any aReturn;
+    ::com::sun::star::uno::Any aReturn;
     if ( GetWindow() )
     {
+/*
         sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
         switch ( nPropertyId )
         {
             default:
+*/
                 aReturn = VCLXWindow::getProperty( PropertyName );
-        }
-    }
-    return aReturn;
-}
-
-//---------------------------------------------------------------------
-
-::com::sun::star::uno::Any VCLXDialog::getWindowHandle( const ::com::sun::star::uno::Sequence< sal_Int8 >& /*ProcessId*/, sal_Int16 SystemType ) throw(::com::sun::star::uno::RuntimeException)
-{
-    ::vos::OGuard aGuard( GetMutex() );
-
-    ::com::sun::star::uno::Any aRet;
-    Window* pWindow = VCLXWindow::GetWindow();
-    if ( pWindow )
-    {
-        const SystemEnvData* pSysData = ((SystemWindow *)pWindow)->GetSystemData();
-        if ( pSysData )
-        {
-#if (defined WNT)
-            if ( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_WIN32 )
-            {
-                aRet <<= (sal_Int32)pSysData->hWnd;
-            }
-#elif (defined OS2)
-            if ( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_OS2 )
-            {
-                aRet <<= (sal_Int32)pSysData->hWnd;
-            }
-#elif (defined QUARTZ)
-            if ( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_MAC )
-            {
-                aRet <<= (sal_IntPtr)pSysData->rWindow;
-            }
-#elif (defined UNX)
-            if ( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_XWINDOW )
-            {
-                ::com::sun::star::awt::SystemDependentXWindow aSD;
-                aSD.DisplayPointer = sal::static_int_cast< sal_Int64 >(reinterpret_cast< sal_IntPtr >(pSysData->pDisplay));
-                aSD.WindowHandle = pSysData->aWindow;
-                aRet <<= aSD;
-            }
-#endif
-        }
-    }
-    return aRet;
-}
-
-
-void VCLXDialog::addTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException)
-{
-#if 1
-    ::vos::OGuard aGuard( GetMutex() );
-
-    GetTopWindowListeners().addInterface( rxListener );
-#else
-#endif
-}
-
-void VCLXDialog::removeTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException)
-{
-#if 1
-    ::vos::OGuard aGuard( GetMutex() );
-
-    GetTopWindowListeners().removeInterface( rxListener );
-#endif
-}
-
-void VCLXDialog::toFront(  ) throw(::com::sun::star::uno::RuntimeException)
-{
-    ::vos::OGuard aGuard( GetMutex() );
-
-    Window* pWindow = GetWindow();
-    if ( pWindow )
-        ((WorkWindow*)pWindow)->ToTop( TOTOP_RESTOREWHENMIN );
-}
-
-void VCLXDialog::toBack(  ) throw(::com::sun::star::uno::RuntimeException)
-{
-/* Not possible in VCL...
-
-   ::vos::OGuard aGuard( GetMutex() );
-
-   Window* pWindow = GetWindow();
-   if ( pWindow )
-   {
-   ((WorkWindow*)pWindow)->ToBack();
+/*
    }
 */
 }
-
-void VCLXDialog::setMenuBar( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar >& /*rxMenu*/ ) throw(::com::sun::star::uno::RuntimeException)
-{
-#if 0
-    ::vos::OGuard aGuard( GetMutex() );
-
-    SystemWindow* pWindow = (SystemWindow*) GetWindow();
-    if ( pWindow )
-    {
-        pWindow->SetMenuBar( NULL );
-        if ( rxMenu.is() )
-        {
-            VCLXMenu* pMenu = VCLXMenu::GetImplementation( rxMenu );
-            if ( pMenu && !pMenu->IsPopupMenu() )
-                pWindow->SetMenuBar( (MenuBar*) pMenu->GetMenu() );
-        }
-    }
-    mxMenuBar = rxMenu;
-#endif
+    return aReturn;
 }
 
 void VCLXDialog::setTitle( const ::rtl::OUString& Title ) throw(::com::sun::star::uno::RuntimeException)
@@ -340,6 +272,4 @@ void VCLXDialog::endExecute() throw(::co
     endDialog( 0 );
 }
 
-//........................................................................
-} // namespace toolkit
-//........................................................................
+} // namespace layoutimpl
Index: toolkit/source/awt/vclxdialog.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxdialog.hxx,v
retrieving revision 1.3
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.4
--- toolkit/source/awt/vclxdialog.hxx	11 Apr 2008 09:17:22 -0000	1.3
+++ toolkit/source/awt/vclxdialog.hxx	30 Jul 2008 11:12:56 -0000	1.2.6.4
@@ -1,51 +1,66 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef LAYOUT_AWT_VCLXDIALOG_HXX
 #define LAYOUT_AWT_VCLXDIALOG_HXX
 
-#include <toolkit/awt/vclxwindow.hxx>
-#include <toolkit/helper/listenermultiplexer.hxx>
-#include <cppuhelper/implbase3.hxx>
-#include <comphelper/uno3.hxx>
-
+#include <com/sun/star/awt/XDialog2.hpp>
 #include <com/sun/star/awt/XSystemDependentWindowPeer.hpp>
 #include <com/sun/star/awt/XTopWindow.hpp>
-#include <com/sun/star/awt/XMenuBar.hpp>
-#include <com/sun/star/awt/XDialog2.hpp>
-
-#include <com/sun/star/awt/XSimpleTabController.hpp>
-#include "../layout/bin.hxx"
-
-#include <com/sun/star/awt/MaxChildrenException.hpp>
-#include <com/sun/star/beans/XPropertySet.hpp>
-
-#include "forward.hxx"
-
-using namespace toolkit;
+#include <comphelper/uno3.hxx>
+#include <layout/bin.hxx>
+#include <toolkit/awt/vclxtopwindow.hxx>
 
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
 
-//====================================================================
-//= VCLXDialog
-//====================================================================
-
-typedef ::cppu::ImplHelper3 < ::com::sun::star::awt::XTopWindow,
-                              ::com::sun::star::awt::XSystemDependentWindowPeer,
-                              ::com::sun::star::awt::XDialog2
-                              >   VCLXDialog_Base;
+typedef ::cppu::ImplHelper1 < ::com::sun::star::awt::XDialog2 > VCLXDialog_Base;
 
 class VCLXDialog :public VCLXWindow
+                 ,public VCLXTopWindow_Base
                  ,public VCLXDialog_Base
                  ,public Bin
 {
-public:
-    VCLXDialog();
+private:
+    bool bRealized, bResizeSafeguard;
+    css::uno::Reference< css::awt::XLayoutUnit > mxLayoutUnit;
 
-    // ::com::sun::star::awt::XDialog2
-    void SAL_CALL endDialog( sal_Int32 nResult ) throw(::com::sun::star::uno::RuntimeException);
+    VCLXDialog( const VCLXDialog& );            // never implemented
+    VCLXDialog& operator=( const VCLXDialog& ); // never implemented
 
 protected:
+    vos::IMutex& GetMutexImpl();
+    Window* GetWindowImpl();
+    TopWindowListenerMultiplexer& GetTopWindowListenersImpl();
+
     ~VCLXDialog( );
 
     // XInterface
@@ -64,16 +79,6 @@ protected:
     // VCLXWindow
     void ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent );
 
-    // ::com::sun::star::awt::XSystemDependendtWindowPeer
-    ::com::sun::star::uno::Any SAL_CALL getWindowHandle( const ::com::sun::star::uno::Sequence< sal_Int8 >& ProcessId, sal_Int16 SystemType ) throw(::com::sun::star::uno::RuntimeException);
-
-    // ::com::sun::star::awt::XTopWindow
-    void SAL_CALL addTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL removeTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL toFront(  ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL toBack(  ) throw(::com::sun::star::uno::RuntimeException);
-    void SAL_CALL setMenuBar( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar >& xMenu ) throw(::com::sun::star::uno::RuntimeException);
-
     // ::com::sun::star::awt::XDialog
     void SAL_CALL setTitle( const ::rtl::OUString& Title ) throw(::com::sun::star::uno::RuntimeException);
     ::rtl::OUString SAL_CALL getTitle(  ) throw(::com::sun::star::uno::RuntimeException);
@@ -91,16 +96,15 @@ protected:
     }
     virtual void    GetPropertyIds( std::list< sal_uInt16 > &aIds ) { return ImplGetPropertyIds( aIds ); }
 
-private:
-    VCLXDialog( const VCLXDialog& );            // never implemented
-    VCLXDialog& operator=( const VCLXDialog& ); // never implemented
-    bool bRealized, bResizeSafeguard;
 
-    css::uno::Reference< css::awt::XLayoutUnit > mxLayoutUnit;
+public:
+    VCLXDialog();
+
+    // ::com::sun::star::awt::XDialog2
+    void SAL_CALL endDialog( sal_Int32 nResult ) throw(::com::sun::star::uno::RuntimeException);
+
 };
 
-//........................................................................
 } // namespace layoutimpl
-//........................................................................
 
 #endif /*LAYOUT_AWT_VCLXDIALOG_HXX*/
Index: toolkit/source/awt/vclxfixedline.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxfixedline.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.5
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.5
--- toolkit/source/awt/vclxfixedline.cxx	11 Apr 2008 09:17:36 -0000	1.3
+++ toolkit/source/awt/vclxfixedline.cxx	30 Jul 2008 11:13:02 -0000	1.2.6.5
@@ -1,16 +1,46 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "vclxfixedline.hxx"
-#include "toolkit/helper/property.hxx"
+
+#include <com/sun/star/awt/PosSize.hpp>
+#include <toolkit/helper/property.hxx>
+#include <toolkit/helper/vclunohelper.hxx>
 #include <tools/debug.hxx>
 #include <vcl/fixed.hxx>
-#include <toolkit/helper/vclunohelper.hxx>
 
-#include <com/sun/star/awt/PosSize.hpp>
+#include "forward.hxx"
 
-using namespace toolkit;
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
 
 using namespace ::com::sun::star::uno;
 using namespace ::com::sun::star::awt;
@@ -18,30 +48,21 @@ using namespace ::com::sun::star::lang;
 using namespace ::com::sun::star::beans;
 using namespace ::com::sun::star;
 
-//====================================================================
-//= VCLXFixedLine
-//====================================================================
 DBG_NAME( VCLXFixedLine )
-//--------------------------------------------------------------------
+
 VCLXFixedLine::VCLXFixedLine()
 : VCLXWindow()
 {
     DBG_CTOR( VCLXFixedLine, NULL );
 }
 
-//--------------------------------------------------------------------
 VCLXFixedLine::~VCLXFixedLine()
 {
     DBG_DTOR( VCLXFixedLine, NULL );
 }
 
-//--------------------------------------------------------------------
-//    IMPLEMENT_FORWARD_XINTERFACE1( VCLXFixedLine, VCLXWindow )
-
-//--------------------------------------------------------------------
-IMPLEMENT_FORWARD_XTYPEPROVIDER1( VCLXFixedLine, VCLXWindow )
+IMPLEMENT_FORWARD_XTYPEPROVIDER1( VCLXFixedLine, VCLXWindow );
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXFixedLine::dispose( ) throw(RuntimeException)
 {
     {
@@ -54,44 +75,45 @@ void SAL_CALL VCLXFixedLine::dispose( ) 
     VCLXWindow::dispose();
 }
 
-//--------------------------------------------------------------------
 ::com::sun::star::awt::Size SAL_CALL VCLXFixedLine::getMinimumSize()
     throw(::com::sun::star::uno::RuntimeException)
 {
     return awt::Size( 8, 8 );
 }
 
-//--------------------------------------------------------------------
 void VCLXFixedLine::ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent )
 {
     ::vos::OClearableGuard aGuard( GetMutex() );
-
+/*
     switch ( _rVclWindowEvent.GetId() )
     {
         default:
             aGuard.clear();
+*/
             VCLXWindow::ProcessWindowEvent( _rVclWindowEvent );
+/*
             break;
     }
+*/
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXFixedLine::setProperty( const ::rtl::OUString& PropertyName, const Any &Value ) throw(RuntimeException)
 {
     ::vos::OGuard aGuard( GetMutex() );
 
     if ( GetWindow() )
     {
+/*
         sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
         switch ( nPropertyId )
         {
             default:
+*/
                 VCLXWindow::setProperty( PropertyName, Value );
-        }
+//        }
     }
 }
 
-//--------------------------------------------------------------------
 Any SAL_CALL VCLXFixedLine::getProperty( const ::rtl::OUString& PropertyName ) throw(RuntimeException)
 {
     ::vos::OGuard aGuard( GetMutex() );
@@ -99,16 +121,16 @@ Any SAL_CALL VCLXFixedLine::getProperty(
     Any aReturn;
     if ( GetWindow() )
     {
+/*
         sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
         switch ( nPropertyId )
         {
             default:
+*/
                 aReturn = VCLXWindow::getProperty( PropertyName );
-        }
+  //      }
     }
     return aReturn;
 }
 
-//........................................................................
-} // namespace toolkit
-//........................................................................
+} // namespace layoutimpl
Index: toolkit/source/awt/vclxfixedline.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxfixedline.hxx,v
retrieving revision 1.3
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.3
--- toolkit/source/awt/vclxfixedline.hxx	11 Apr 2008 09:17:50 -0000	1.3
+++ toolkit/source/awt/vclxfixedline.hxx	30 Jul 2008 11:13:07 -0000	1.2.6.3
@@ -1,28 +1,46 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef LAYOUT_AWT_VCLXFIXEDLINE_HXX
 #define LAYOUT_AWT_VCLXFIXEDLINE_HXX
 
-#include <toolkit/awt/vclxwindow.hxx>
-#include <toolkit/helper/listenermultiplexer.hxx>
-#include <cppuhelper/implbase1.hxx>
 #include <comphelper/uno3.hxx>
-
-#include <com/sun/star/beans/XPropertySet.hpp>
-
-#include "forward.hxx"
+#include <toolkit/awt/vclxwindow.hxx>
 
 /* We just provide our own FixedLine, because default has no width... */
 
 class FixedLine;
-using namespace toolkit;
 
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
-
-//====================================================================
-//= VCLXFixedLine
-//====================================================================
 
 class VCLXFixedLine :public VCLXWindow
 {
@@ -56,8 +74,6 @@ private:
     VCLXFixedLine& operator=( const VCLXFixedLine& ); // never implemented
 };
 
-//........................................................................
-} // namespacetoolkit
-//........................................................................
+} // namespace layoutimpl
 
 #endif /*LAYOUT_AWT_VCLXFIXEDLINE_HXX*/
Index: toolkit/source/awt/vclxproxy.cxx
===================================================================
RCS file: toolkit/source/awt/vclxproxy.cxx
diff -N toolkit/source/awt/vclxproxy.cxx
--- toolkit/source/awt/vclxproxy.cxx	6 Mar 2008 11:40:52 -0000	1.2
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,448 +0,0 @@
-#include "vclxproxy.hxx"
-
-namespace css = com::sun::star;
-
-// This is a generic proxy class - override it to wrap &
-// extend these interfaces
-// Warning: this is of course not complete ...
-
-VCLXProxy::VCLXProxy( css::uno::Reference< css::uno::XInterface > xObject )
-    : mxDevice( xObject, css::uno::UNO_QUERY )
-    , mxTypeProvider( xObject, css::uno::UNO_QUERY )
-    , mxUnoTunnel( xObject, css::uno::UNO_QUERY )
-    , mxComponent( xObject, css::uno::UNO_QUERY )
-    , mxWindow( xObject, css::uno::UNO_QUERY )
-    , mxWindow2( xObject, css::uno::UNO_QUERY )
-    , mxWindowPeer( xObject, css::uno::UNO_QUERY )
-    , mxVclWindowPeer( xObject, css::uno::UNO_QUERY )
-    , mxLayoutConstrains( xObject, css::uno::UNO_QUERY )
-    , mxView( xObject, css::uno::UNO_QUERY )
-    , mxDockableWindow( xObject, css::uno::UNO_QUERY )
-    , mxAccessible( xObject, css::uno::UNO_QUERY )
-    , mxEventListener( xObject, css::uno::UNO_QUERY )
-    , mxPropertySetInfo( xObject, css::uno::UNO_QUERY )
-    , mxItemEventBroadcaster( xObject, css::uno::UNO_QUERY )
-    , mxImageConsumer( xObject, css::uno::UNO_QUERY )
-    , mxButton( xObject, css::uno::UNO_QUERY )
-    , mxToggleButton( xObject, css::uno::UNO_QUERY )
-{
-}
-
-css::uno::Any SAL_CALL
-VCLXProxy::queryInterface( const css::uno::Type & rType ) throw (css::uno::RuntimeException)
-{
-    css::uno::Any aRet;
-
-#define QI(t,memb) \
-    if (!aRet.hasValue() && memb.is() && rType == t::static_type()) \
-        aRet = css::uno::Any( css::uno::Reference< t >( static_cast<t *>(this) ) )
-
-    // VCLXDevice
-    QI( css::awt::XDevice, mxDevice );
-    QI( css::lang::XTypeProvider, mxTypeProvider );
-    QI( css::lang::XUnoTunnel, mxUnoTunnel );
-
-    // VCLXWindow
-    if (!aRet.hasValue() && mxComponent.is() &&
-        rType == css::lang::XComponent::static_type())
-        aRet = css::uno::Any( css::uno::Reference< css::lang::XComponent >( static_cast<css::awt::XWindow *>(this) ) );
-
-    QI( css::awt::XWindow, mxWindow );
-    QI( css::awt::XWindow2, mxWindow2 );
-    QI( css::awt::XWindowPeer, mxWindowPeer );
-    QI( css::awt::XVclWindowPeer, mxVclWindowPeer );
-    QI( css::awt::XLayoutConstrains, mxLayoutConstrains );
-    QI( css::awt::XView, mxView );
-    QI( css::awt::XDockableWindow, mxDockableWindow );
-    QI( css::accessibility::XAccessible, mxAccessible );
-    QI( css::lang::XEventListener, mxEventListener );
-
-    QI( css::beans::XPropertySetInfo, mxPropertySetInfo );
-    QI( css::awt::XItemEventBroadcaster, mxItemEventBroadcaster );
-    // VCLXImageConsumer
-    QI( css::awt::XImageConsumer, mxImageConsumer );
-    // VCLXButton
-    QI( css::awt::XButton, mxButton );
-    QI( css::awt::XToggleButton, mxToggleButton );
-#undef QI
-
-    if ( !aRet.hasValue() )
-        aRet = OWeakObject::queryInterface( rType );
-    return aRet;
-}
-
-
-// Tons of boilerplate ... urgh [!]
-
-// lang::XComponent
-void VCLXProxy::dispose() throw (css::uno::RuntimeException)
-{
-    mxComponent->dispose();
-}
-void VCLXProxy::addEventListener( const css::uno::Reference< css::lang::XEventListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxComponent->addEventListener( xListener );
-}
-void VCLXProxy::removeEventListener( const css::uno::Reference< css::lang::XEventListener >& aListener ) throw (css::uno::RuntimeException)
-{
-    mxComponent->removeEventListener( aListener );
-}
-
-// awt::XWindowPeer
-css::uno::Reference< css::awt::XToolkit > VCLXProxy::getToolkit() throw (css::uno::RuntimeException)
-{
-    return mxWindowPeer->getToolkit();
-}
-void VCLXProxy::setPointer( const css::uno::Reference< css::awt::XPointer >& Pointer ) throw (css::uno::RuntimeException)
-{
-    mxWindowPeer->setPointer( Pointer );
-}
-void VCLXProxy::setBackground( ::sal_Int32 Color ) throw (css::uno::RuntimeException)
-{
-    mxWindowPeer->setBackground( Color );
-}
-void VCLXProxy::invalidate( ::sal_Int16 Flags ) throw (css::uno::RuntimeException)
-{
-    mxWindowPeer->invalidate( Flags );
-}
-void VCLXProxy::invalidateRect( const css::awt::Rectangle& Rect, ::sal_Int16 Flags ) throw (css::uno::RuntimeException)
-{
-    mxWindowPeer->invalidateRect( Rect, Flags );
-}
-
-// awt::XDevice
-css::uno::Reference< css::awt::XGraphics > VCLXProxy::createGraphics() throw (css::uno::RuntimeException)
-{
-    return mxDevice->createGraphics();
-}
-css::uno::Reference< css::awt::XDevice > VCLXProxy::createDevice( ::sal_Int32 nWidth, ::sal_Int32 nHeight ) throw (css::uno::RuntimeException)
-{
-    return mxDevice->createDevice( nWidth, nHeight );
-}
-css::awt::DeviceInfo VCLXProxy::getInfo() throw (css::uno::RuntimeException)
-{
-    return mxDevice->getInfo();
-}
-css::uno::Sequence< css::awt::FontDescriptor > VCLXProxy::getFontDescriptors() throw (css::uno::RuntimeException)
-{
-    return mxDevice->getFontDescriptors();
-}
-css::uno::Reference< css::awt::XFont > VCLXProxy::getFont( const css::awt::FontDescriptor& aDescriptor ) throw (css::uno::RuntimeException)
-{
-    return mxDevice->getFont( aDescriptor );
-}
-css::uno::Reference< css::awt::XBitmap > VCLXProxy::createBitmap( ::sal_Int32 nX, ::sal_Int32 nY, ::sal_Int32 nWidth, ::sal_Int32 nHeight ) throw (css::uno::RuntimeException)
-{
-    return mxDevice->createBitmap( nX, nY, nWidth, nHeight );
-}
-css::uno::Reference< css::awt::XDisplayBitmap > VCLXProxy::createDisplayBitmap( const css::uno::Reference< css::awt::XBitmap >& Bitmap ) throw (css::uno::RuntimeException)
-{
-    return mxDevice->createDisplayBitmap( Bitmap );
-}
-
-// lang::XTypeProvider
-css::uno::Sequence< css::uno::Type > VCLXProxy::getTypes() throw (css::uno::RuntimeException)
-{
-    return mxTypeProvider->getTypes();
-}
-css::uno::Sequence< ::sal_Int8 > VCLXProxy::getImplementationId() throw (css::uno::RuntimeException)
-{
-    return mxTypeProvider->getImplementationId();
-}
-
-// lang::XUnoTunnel
-::sal_Int64 VCLXProxy::getSomething( const css::uno::Sequence< ::sal_Int8 >& aIdentifier ) throw (css::uno::RuntimeException)
-{
-    return mxUnoTunnel->getSomething( aIdentifier );
-}
-
-// awt::XWindow2
-void VCLXProxy::setOutputSize( const css::awt::Size& aSize ) throw (css::uno::RuntimeException)
-{
-    mxWindow2->setOutputSize( aSize );
-}
-css::awt::Size VCLXProxy::getOutputSize() throw (css::uno::RuntimeException)
-{
-    return mxWindow2->getOutputSize();
-}
-::sal_Bool VCLXProxy::isVisible() throw (css::uno::RuntimeException)
-{
-    return mxWindow2->isVisible();
-}
-::sal_Bool VCLXProxy::isActive() throw (css::uno::RuntimeException)
-{
-    return mxWindow2->isActive();
-}
-::sal_Bool VCLXProxy::isEnabled() throw (css::uno::RuntimeException)
-{
-    return mxWindow2->isEnabled();
-}
-::sal_Bool VCLXProxy::hasFocus() throw (css::uno::RuntimeException)
-{
-    return mxWindow2->hasFocus();
-}
-
-// awt::XWindow
-void VCLXProxy::setPosSize( ::sal_Int32 X, ::sal_Int32 Y, ::sal_Int32 Width, ::sal_Int32 Height, ::sal_Int16 Flags ) throw (css::uno::RuntimeException)
-{
-    mxWindow->setPosSize( X, Y, Width, Height, Flags );
-}
-css::awt::Rectangle VCLXProxy::getPosSize() throw (css::uno::RuntimeException)
-{
-    return mxWindow->getPosSize();
-}
-void VCLXProxy::setVisible( ::sal_Bool Visible ) throw (css::uno::RuntimeException)
-{
-    mxWindow->setVisible( Visible );
-}
-void VCLXProxy::setEnable( ::sal_Bool Enable ) throw (css::uno::RuntimeException)
-{
-    mxWindow->setEnable( Enable );
-}
-void VCLXProxy::setFocus() throw (css::uno::RuntimeException)
-{
-    mxWindow->setFocus();
-}
-void VCLXProxy::addWindowListener( const css::uno::Reference< css::awt::XWindowListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->addWindowListener( xListener );
-}
-void VCLXProxy::removeWindowListener( const css::uno::Reference< css::awt::XWindowListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->removeWindowListener( xListener );
-}
-void VCLXProxy::addFocusListener( const css::uno::Reference< css::awt::XFocusListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->addFocusListener( xListener );
-}
-void VCLXProxy::removeFocusListener( const css::uno::Reference< css::awt::XFocusListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->removeFocusListener( xListener );
-}
-void VCLXProxy::addKeyListener( const css::uno::Reference< css::awt::XKeyListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->addKeyListener( xListener );
-}
-void VCLXProxy::removeKeyListener( const css::uno::Reference< css::awt::XKeyListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->removeKeyListener( xListener );
-}
-void VCLXProxy::addMouseListener( const css::uno::Reference< css::awt::XMouseListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->addMouseListener( xListener );
-}
-void VCLXProxy::removeMouseListener( const css::uno::Reference< css::awt::XMouseListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->removeMouseListener( xListener );
-}
-void VCLXProxy::addMouseMotionListener( const css::uno::Reference< css::awt::XMouseMotionListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->addMouseMotionListener( xListener );
-}
-void VCLXProxy::removeMouseMotionListener( const css::uno::Reference< css::awt::XMouseMotionListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->removeMouseMotionListener( xListener );
-}
-void VCLXProxy::addPaintListener( const css::uno::Reference< css::awt::XPaintListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->addPaintListener( xListener );
-}
-void VCLXProxy::removePaintListener( const css::uno::Reference< css::awt::XPaintListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxWindow->removePaintListener( xListener );
-}
-
-// awt::XVclWindowPeer
-::sal_Bool VCLXProxy::isChild( const css::uno::Reference< css::awt::XWindowPeer >& Peer ) throw (css::uno::RuntimeException)
-{
-    return mxVclWindowPeer->isChild( Peer );
-}
-void VCLXProxy::setDesignMode( ::sal_Bool bOn ) throw (css::uno::RuntimeException)
-{
-    mxVclWindowPeer->setDesignMode( bOn );
-}
-::sal_Bool VCLXProxy::isDesignMode() throw (css::uno::RuntimeException)
-{
-    return mxVclWindowPeer->isDesignMode();
-}
-void VCLXProxy::enableClipSiblings( ::sal_Bool bClip ) throw (css::uno::RuntimeException)
-{
-    mxVclWindowPeer->enableClipSiblings( bClip );
-}
-void VCLXProxy::setForeground( ::sal_Int32 Color ) throw (css::uno::RuntimeException)
-{
-    mxVclWindowPeer->setForeground( Color );
-}
-void VCLXProxy::setControlFont( const css::awt::FontDescriptor& aFont ) throw (css::uno::RuntimeException)
-{
-    mxVclWindowPeer->setControlFont( aFont );
-}
-void VCLXProxy::getStyles( ::sal_Int16 nType, css::awt::FontDescriptor& Font, ::sal_Int32& ForegroundColor, ::sal_Int32& BackgroundColor ) throw (css::uno::RuntimeException)
-{
-    mxVclWindowPeer->getStyles( nType, Font, ForegroundColor, BackgroundColor );
-}
-void VCLXProxy::setProperty( const ::rtl::OUString& PropertyName, const css::uno::Any& Value ) throw (css::uno::RuntimeException)
-{
-    mxVclWindowPeer->setProperty( PropertyName, Value );
-}
-css::uno::Any VCLXProxy::getProperty( const ::rtl::OUString& PropertyName ) throw (css::uno::RuntimeException)
-{
-    return mxVclWindowPeer->getProperty( PropertyName );
-}
-
-// awt::XLayoutConstrains
-css::awt::Size VCLXProxy::getMinimumSize() throw (css::uno::RuntimeException)
-{
-    return mxLayoutConstrains->getMinimumSize();
-}
-css::awt::Size VCLXProxy::getPreferredSize() throw (css::uno::RuntimeException)
-{
-    return mxLayoutConstrains->getPreferredSize();
-}
-css::awt::Size VCLXProxy::calcAdjustedSize( const css::awt::Size& aNewSize ) throw (css::uno::RuntimeException)
-{
-    return mxLayoutConstrains->calcAdjustedSize( aNewSize );
-}
-
-// awt::XView
-::sal_Bool VCLXProxy::setGraphics( const css::uno::Reference< css::awt::XGraphics >& aDevice ) throw (css::uno::RuntimeException)
-{
-    return mxView->setGraphics( aDevice );
-}
-css::uno::Reference< css::awt::XGraphics > VCLXProxy::getGraphics() throw (css::uno::RuntimeException)
-{
-    return mxView->getGraphics();
-}
-css::awt::Size VCLXProxy::getSize() throw (css::uno::RuntimeException)
-{
-    return mxView->getSize();
-}
-void VCLXProxy::draw( ::sal_Int32 nX, ::sal_Int32 nY ) throw (css::uno::RuntimeException)
-{
-    mxView->draw( nX, nY );
-}
-void VCLXProxy::setZoom( float fZoomX, float fZoomY ) throw (css::uno::RuntimeException)
-{
-    mxView->setZoom( fZoomX, fZoomY );
-}
-
-// awt::XDockableWindow
-void VCLXProxy::addDockableWindowListener( const css::uno::Reference< css::awt::XDockableWindowListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxDockableWindow->addDockableWindowListener( xListener );
-}
-void VCLXProxy::removeDockableWindowListener( const css::uno::Reference< css::awt::XDockableWindowListener >& xListener ) throw (css::uno::RuntimeException)
-{
-    mxDockableWindow->removeDockableWindowListener( xListener );
-}
-void VCLXProxy::enableDocking( ::sal_Bool bEnable ) throw (css::uno::RuntimeException)
-{
-    mxDockableWindow->enableDocking( bEnable );
-}
-::sal_Bool VCLXProxy::isFloating() throw (css::uno::RuntimeException)
-{
-    return mxDockableWindow->isFloating();
-}
-void VCLXProxy::setFloatingMode( ::sal_Bool bFloating ) throw (css::uno::RuntimeException)
-{
-    mxDockableWindow->setFloatingMode( bFloating );
-}
-void VCLXProxy::lock() throw (css::uno::RuntimeException)
-{
-    mxDockableWindow->lock();
-}
-void VCLXProxy::unlock() throw (css::uno::RuntimeException)
-{
-    mxDockableWindow->unlock();
-}
-::sal_Bool VCLXProxy::isLocked() throw (css::uno::RuntimeException)
-{
-    return mxDockableWindow->isLocked();
-}
-void VCLXProxy::startPopupMode( const css::awt::Rectangle& WindowRect ) throw (css::uno::RuntimeException)
-{
-    mxDockableWindow->startPopupMode( WindowRect );
-}
-::sal_Bool VCLXProxy::isInPopupMode() throw (css::uno::RuntimeException)
-{
-    return mxDockableWindow->isInPopupMode();
-}
-
-// accessibility::XAccessible
-css::uno::Reference< css::accessibility::XAccessibleContext > VCLXProxy::getAccessibleContext() throw (css::uno::RuntimeException)
-{
-    return mxAccessible->getAccessibleContext();
-}
-
-// lang::XEventListener
-void VCLXProxy::disposing( const css::lang::EventObject& Source ) throw (css::uno::RuntimeException)
-{
-    mxEventListener->disposing( Source );
-}
-
-// beans::XPropertySetInfo
-css::uno::Sequence< css::beans::Property > VCLXProxy::getProperties() throw (css::uno::RuntimeException)
-{
-    return mxPropertySetInfo->getProperties();
-}
-css::beans::Property VCLXProxy::getPropertyByName( const ::rtl::OUString& aName ) throw (css::beans::UnknownPropertyException, css::uno::RuntimeException)
-{
-    return mxPropertySetInfo->getPropertyByName( aName );
-}
-::sal_Bool VCLXProxy::hasPropertyByName( const ::rtl::OUString& Name ) throw (css::uno::RuntimeException)
-{
-    return mxPropertySetInfo->hasPropertyByName( Name );
-}
-
-// awt::XImageConsumer
-void VCLXProxy::init( ::sal_Int32 Width, ::sal_Int32 Height ) throw (css::uno::RuntimeException)
-{
-    mxImageConsumer->init( Width, Height );
-}
-void VCLXProxy::setColorModel( ::sal_Int16 BitCount, const css::uno::Sequence< ::sal_Int32 >& RGBAPal, ::sal_Int32 RedMask, ::sal_Int32 GreenMask, ::sal_Int32 BlueMask, ::sal_Int32 AlphaMask ) throw (css::uno::RuntimeException)
-{
-    mxImageConsumer->setColorModel( BitCount, RGBAPal, RedMask, GreenMask, BlueMask, AlphaMask );
-}
-void VCLXProxy::setPixelsByBytes( ::sal_Int32 nX, ::sal_Int32 nY, ::sal_Int32 nWidth, ::sal_Int32 nHeight, const css::uno::Sequence< ::sal_Int8 >& aProducerData, ::sal_Int32 nOffset, ::sal_Int32 nScanSize ) throw (css::uno::RuntimeException)
-{
-    mxImageConsumer->setPixelsByBytes( nX, nY, nWidth, nHeight, aProducerData, nOffset, nScanSize );
-}
-void VCLXProxy::setPixelsByLongs( ::sal_Int32 nX, ::sal_Int32 nY, ::sal_Int32 nWidth, ::sal_Int32 nHeight, const css::uno::Sequence< ::sal_Int32 >& aProducerData, ::sal_Int32 nOffset, ::sal_Int32 nScanSize ) throw (css::uno::RuntimeException)
-{
-    mxImageConsumer->setPixelsByLongs( nX, nY, nWidth, nHeight, aProducerData, nOffset, nScanSize );
-}
-void VCLXProxy::complete( ::sal_Int32 Status, const css::uno::Reference< css::awt::XImageProducer >& xProducer ) throw (css::uno::RuntimeException)
-{
-    mxImageConsumer->complete( Status, xProducer );
-}
-
-// awt::XButton
-void VCLXProxy::addActionListener( const css::uno::Reference< css::awt::XActionListener >& l ) throw (css::uno::RuntimeException)
-{
-    mxButton->addActionListener( l );
-}
-void VCLXProxy::removeActionListener( const css::uno::Reference< css::awt::XActionListener >& l ) throw (css::uno::RuntimeException)
-{
-    mxButton->removeActionListener( l );
-}
-void VCLXProxy::setLabel( const ::rtl::OUString& Label ) throw (css::uno::RuntimeException)
-{
-    if ( mxButton.is() )
-        mxButton->setLabel( Label );
-}
-void VCLXProxy::setActionCommand( const ::rtl::OUString& Command ) throw (css::uno::RuntimeException)
-{
-    mxButton->setActionCommand( Command );
-}
-
-// awt::XItemEventBroadcaster
-void VCLXProxy::addItemListener( const css::uno::Reference< css::awt::XItemListener >& l ) throw (css::uno::RuntimeException)
-{
-    if ( mxItemEventBroadcaster.is() )
-        mxItemEventBroadcaster->addItemListener( l );
-}
-void VCLXProxy::removeItemListener( const css::uno::Reference< css::awt::XItemListener >& l ) throw (css::uno::RuntimeException)
-{
-    if ( mxItemEventBroadcaster.is() )
-        mxItemEventBroadcaster->removeItemListener( l );
-}
Index: toolkit/source/awt/vclxproxy.hxx
===================================================================
RCS file: toolkit/source/awt/vclxproxy.hxx
diff -N toolkit/source/awt/vclxproxy.hxx
--- toolkit/source/awt/vclxproxy.hxx	6 Mar 2008 11:41:03 -0000	1.2
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,204 +0,0 @@
-#ifndef LAYOUT_AWT_VCLXPROXY_HXX
-#define LAYOUT_AWT_VCLXPROXY_HXX
-
-#include <com/sun/star/awt/XDevice.hpp>
-#include <com/sun/star/lang/XTypeProvider.hpp>
-#include <com/sun/star/lang/XUnoTunnel.hpp>
-
-#include <com/sun/star/awt/XWindow.hpp>
-#include <com/sun/star/awt/XWindow2.hpp>
-#include <com/sun/star/awt/XVclWindowPeer.hpp>
-#include <com/sun/star/awt/XLayoutConstrains.hpp>
-#include <com/sun/star/awt/XView.hpp>
-#include <com/sun/star/awt/XPointer.hpp>
-#include <com/sun/star/awt/XGraphics.hpp>
-#include <com/sun/star/beans/XPropertyChangeListener.hpp>
-#include <com/sun/star/beans/XPropertySetInfo.hpp>
-#include <com/sun/star/accessibility/XAccessible.hpp>
-#include <com/sun/star/accessibility/XAccessibleContext.hpp>
-#include <com/sun/star/awt/XDockableWindow.hpp>
-
-#include <com/sun/star/awt/XImageConsumer.hpp>
-#include <com/sun/star/awt/XButton.hpp>
-#include <com/sun/star/awt/XToggleButton.hpp>
-
-#include <cppuhelper/weak.hxx>
-
-// This is a generic proxy class - override it to wrap &
-// extend these interfaces
-// Warning: this is of course not complete ...
-class VCLXProxy :
-    // VCLXDevice
-    public com::sun::star::awt::XDevice,
-    public com::sun::star::lang::XTypeProvider,
-    public com::sun::star::lang::XUnoTunnel,
-    // VCLXWindow
-    public com::sun::star::awt::XWindow2,
-    public com::sun::star::awt::XVclWindowPeer,
-    public com::sun::star::awt::XLayoutConstrains,
-    public com::sun::star::awt::XView,
-    public com::sun::star::awt::XDockableWindow,
-    public com::sun::star::accessibility::XAccessible,
-    public com::sun::star::lang::XEventListener,
-    public com::sun::star::beans::XPropertySetInfo,
-    // VCLXImageConsumer
-    public com::sun::star::awt::XImageConsumer,
-    // VCLXButton
-    public com::sun::star::awt::XButton,
-    public com::sun::star::awt::XToggleButton,
-    public ::cppu::OWeakObject
-{
-    // VCLXDevice
-    com::sun::star::uno::Reference< com::sun::star::awt::XDevice > mxDevice;
-    com::sun::star::uno::Reference< com::sun::star::lang::XTypeProvider > mxTypeProvider;
-    com::sun::star::uno::Reference< com::sun::star::lang::XUnoTunnel > mxUnoTunnel;
-
-    // VCLXWindow
-    com::sun::star::uno::Reference< com::sun::star::lang::XComponent > mxComponent;
-    com::sun::star::uno::Reference< com::sun::star::awt::XWindow > mxWindow;
-    com::sun::star::uno::Reference< com::sun::star::awt::XWindow2 > mxWindow2;
-    com::sun::star::uno::Reference< com::sun::star::awt::XWindowPeer > mxWindowPeer;
-    com::sun::star::uno::Reference< com::sun::star::awt::XVclWindowPeer > mxVclWindowPeer;
-    com::sun::star::uno::Reference< com::sun::star::awt::XLayoutConstrains > mxLayoutConstrains;
-    com::sun::star::uno::Reference< com::sun::star::awt::XView > mxView;
-    com::sun::star::uno::Reference< com::sun::star::awt::XDockableWindow > mxDockableWindow;
-    com::sun::star::uno::Reference< com::sun::star::accessibility::XAccessible > mxAccessible;
-    com::sun::star::uno::Reference< com::sun::star::lang::XEventListener > mxEventListener;
-    com::sun::star::uno::Reference< com::sun::star::beans::XPropertySetInfo > mxPropertySetInfo;
-    com::sun::star::uno::Reference< com::sun::star::awt::XItemEventBroadcaster > mxItemEventBroadcaster;
-
-    // VCLXImageConsumer
-    com::sun::star::uno::Reference< com::sun::star::awt::XImageConsumer > mxImageConsumer;
-
-    // VCLXButton
-    com::sun::star::uno::Reference< com::sun::star::awt::XButton > mxButton;
-    com::sun::star::uno::Reference< com::sun::star::awt::XToggleButton > mxToggleButton;
-
-public:
-    VCLXProxy( com::sun::star::uno::Reference< com::sun::star::uno::XInterface > xObject );
-
-    // XInterface
-    virtual void SAL_CALL acquire() throw() { ::cppu::OWeakObject::acquire(); }
-    virtual void SAL_CALL release() throw() { ::cppu::OWeakObject::release(); }
-    virtual com::sun::star::uno::Any SAL_CALL queryInterface( const com::sun::star::uno::Type & rType ) throw (com::sun::star::uno::RuntimeException);
-
-    // lang::XComponent
-    virtual void SAL_CALL dispose() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL addEventListener( const com::sun::star::uno::Reference< com::sun::star::lang::XEventListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeEventListener( const com::sun::star::uno::Reference< com::sun::star::lang::XEventListener >& aListener ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XWindowPeer
-    virtual com::sun::star::uno::Reference< com::sun::star::awt::XToolkit > SAL_CALL getToolkit() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setPointer( const com::sun::star::uno::Reference< com::sun::star::awt::XPointer >& Pointer ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setBackground( ::sal_Int32 Color ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL invalidate( ::sal_Int16 Flags ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL invalidateRect( const com::sun::star::awt::Rectangle& Rect, ::sal_Int16 Flags ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XDevice
-    virtual com::sun::star::uno::Reference< com::sun::star::awt::XGraphics > SAL_CALL createGraphics() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Reference< com::sun::star::awt::XDevice > SAL_CALL createDevice( ::sal_Int32 nWidth, ::sal_Int32 nHeight ) throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::awt::DeviceInfo SAL_CALL getInfo() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Sequence< com::sun::star::awt::FontDescriptor > SAL_CALL getFontDescriptors() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Reference< com::sun::star::awt::XFont > SAL_CALL getFont( const com::sun::star::awt::FontDescriptor& aDescriptor ) throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Reference< com::sun::star::awt::XBitmap > SAL_CALL createBitmap( ::sal_Int32 nX, ::sal_Int32 nY, ::sal_Int32 nWidth, ::sal_Int32 nHeight ) throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Reference< com::sun::star::awt::XDisplayBitmap > SAL_CALL createDisplayBitmap( const com::sun::star::uno::Reference< com::sun::star::awt::XBitmap >& Bitmap ) throw (com::sun::star::uno::RuntimeException);
-
-    // lang::XTypeProvider
-    virtual com::sun::star::uno::Sequence< com::sun::star::uno::Type > SAL_CALL getTypes() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Sequence< ::sal_Int8 > SAL_CALL getImplementationId() throw (com::sun::star::uno::RuntimeException);
-
-    // lang::XUnoTunnel
-    virtual ::sal_Int64 SAL_CALL getSomething( const com::sun::star::uno::Sequence< ::sal_Int8 >& aIdentifier ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XWindow2
-    virtual void SAL_CALL setOutputSize( const com::sun::star::awt::Size& aSize ) throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::awt::Size SAL_CALL getOutputSize() throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL isVisible() throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL isActive() throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL isEnabled() throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL hasFocus() throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XWindow
-    virtual void SAL_CALL setPosSize( ::sal_Int32 X, ::sal_Int32 Y, ::sal_Int32 Width, ::sal_Int32 Height, ::sal_Int16 Flags ) throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::awt::Rectangle SAL_CALL getPosSize() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setVisible( ::sal_Bool Visible ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setEnable( ::sal_Bool Enable ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setFocus() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL addWindowListener( const com::sun::star::uno::Reference< com::sun::star::awt::XWindowListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeWindowListener( const com::sun::star::uno::Reference< com::sun::star::awt::XWindowListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL addFocusListener( const com::sun::star::uno::Reference< com::sun::star::awt::XFocusListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeFocusListener( const com::sun::star::uno::Reference< com::sun::star::awt::XFocusListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL addKeyListener( const com::sun::star::uno::Reference< com::sun::star::awt::XKeyListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeKeyListener( const com::sun::star::uno::Reference< com::sun::star::awt::XKeyListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL addMouseListener( const com::sun::star::uno::Reference< com::sun::star::awt::XMouseListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeMouseListener( const com::sun::star::uno::Reference< com::sun::star::awt::XMouseListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL addMouseMotionListener( const com::sun::star::uno::Reference< com::sun::star::awt::XMouseMotionListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeMouseMotionListener( const com::sun::star::uno::Reference< com::sun::star::awt::XMouseMotionListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL addPaintListener( const com::sun::star::uno::Reference< com::sun::star::awt::XPaintListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removePaintListener( const com::sun::star::uno::Reference< com::sun::star::awt::XPaintListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XVclWindowPeer
-    virtual ::sal_Bool SAL_CALL isChild( const com::sun::star::uno::Reference< com::sun::star::awt::XWindowPeer >& Peer ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setDesignMode( ::sal_Bool bOn ) throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL isDesignMode() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL enableClipSiblings( ::sal_Bool bClip ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setForeground( ::sal_Int32 Color ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setControlFont( const com::sun::star::awt::FontDescriptor& aFont ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL getStyles( ::sal_Int16 nType, com::sun::star::awt::FontDescriptor& Font, ::sal_Int32& ForegroundColor, ::sal_Int32& BackgroundColor ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setProperty( const ::rtl::OUString& PropertyName, const com::sun::star::uno::Any& Value ) throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Any SAL_CALL getProperty( const ::rtl::OUString& PropertyName ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XLayoutConstrains
-    virtual com::sun::star::awt::Size SAL_CALL getMinimumSize() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::awt::Size SAL_CALL getPreferredSize() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::awt::Size SAL_CALL calcAdjustedSize( const com::sun::star::awt::Size& aNewSize ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XView
-    virtual ::sal_Bool SAL_CALL setGraphics( const com::sun::star::uno::Reference< com::sun::star::awt::XGraphics >& aDevice ) throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::uno::Reference< com::sun::star::awt::XGraphics > SAL_CALL getGraphics() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::awt::Size SAL_CALL getSize() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL draw( ::sal_Int32 nX, ::sal_Int32 nY ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setZoom( float fZoomX, float fZoomY ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XDockableWindow
-    virtual void SAL_CALL addDockableWindowListener( const com::sun::star::uno::Reference< com::sun::star::awt::XDockableWindowListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeDockableWindowListener( const com::sun::star::uno::Reference< com::sun::star::awt::XDockableWindowListener >& xListener ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL enableDocking( ::sal_Bool bEnable ) throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL isFloating() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setFloatingMode( ::sal_Bool bFloating ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL lock() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL unlock() throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL isLocked() throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL startPopupMode( const com::sun::star::awt::Rectangle& WindowRect ) throw (com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL isInPopupMode() throw (com::sun::star::uno::RuntimeException);
-
-    // accessibility::XAccessible
-    virtual com::sun::star::uno::Reference< com::sun::star::accessibility::XAccessibleContext > SAL_CALL getAccessibleContext() throw (com::sun::star::uno::RuntimeException);
-
-    // lang::XEventListener
-    virtual void SAL_CALL disposing( const com::sun::star::lang::EventObject& Source ) throw (com::sun::star::uno::RuntimeException);
-
-    // beans::XPropertySetInfo
-    virtual com::sun::star::uno::Sequence< com::sun::star::beans::Property > SAL_CALL getProperties() throw (com::sun::star::uno::RuntimeException);
-    virtual com::sun::star::beans::Property SAL_CALL getPropertyByName( const ::rtl::OUString& aName ) throw (com::sun::star::beans::UnknownPropertyException, com::sun::star::uno::RuntimeException);
-    virtual ::sal_Bool SAL_CALL hasPropertyByName( const ::rtl::OUString& Name ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XImageConsumer
-    virtual void SAL_CALL init( ::sal_Int32 Width, ::sal_Int32 Height ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setColorModel( ::sal_Int16 BitCount, const com::sun::star::uno::Sequence< ::sal_Int32 >& RGBAPal, ::sal_Int32 RedMask, ::sal_Int32 GreenMask, ::sal_Int32 BlueMask, ::sal_Int32 AlphaMask ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setPixelsByBytes( ::sal_Int32 nX, ::sal_Int32 nY, ::sal_Int32 nWidth, ::sal_Int32 nHeight, const com::sun::star::uno::Sequence< ::sal_Int8 >& aProducerData, ::sal_Int32 nOffset, ::sal_Int32 nScanSize ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setPixelsByLongs( ::sal_Int32 nX, ::sal_Int32 nY, ::sal_Int32 nWidth, ::sal_Int32 nHeight, const com::sun::star::uno::Sequence< ::sal_Int32 >& aProducerData, ::sal_Int32 nOffset, ::sal_Int32 nScanSize ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL complete( ::sal_Int32 Status, const com::sun::star::uno::Reference< com::sun::star::awt::XImageProducer >& xProducer ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XButton
-    virtual void SAL_CALL addActionListener( const com::sun::star::uno::Reference< com::sun::star::awt::XActionListener >& l ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeActionListener( const com::sun::star::uno::Reference< com::sun::star::awt::XActionListener >& l ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setLabel( const ::rtl::OUString& Label ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL setActionCommand( const ::rtl::OUString& Command ) throw (com::sun::star::uno::RuntimeException);
-
-    // awt::XItemEventBroadcaster
-    virtual void SAL_CALL addItemListener( const com::sun::star::uno::Reference< com::sun::star::awt::XItemListener >& l ) throw (com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL removeItemListener( const com::sun::star::uno::Reference< com::sun::star::awt::XItemListener >& l ) throw (com::sun::star::uno::RuntimeException);
-};
-
-#endif // LAYOUT_AWT_VCLXPROXY_HXX
Index: toolkit/source/awt/vclxscroller.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxscroller.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.5
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.5
--- toolkit/source/awt/vclxscroller.cxx	11 Apr 2008 09:19:31 -0000	1.3
+++ toolkit/source/awt/vclxscroller.cxx	30 Jul 2008 11:13:13 -0000	1.2.6.5
@@ -1,22 +1,48 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "vclxscroller.hxx"
-#include "toolkit/helper/property.hxx"
-#include <com/sun/star/awt/ScrollBarOrientation.hpp>
-#include <tools/debug.hxx>
-#include <vcl/scrbar.hxx>
-#include <toolkit/helper/vclunohelper.hxx>
 
+#include <assert.h>
 #include <com/sun/star/awt/PosSize.hpp>
-
+#include <com/sun/star/awt/ScrollBarOrientation.hpp>
 #include <sal/macros.h>
-#include <assert.h>
+#include <toolkit/helper/property.hxx>
+#include <tools/debug.hxx>
+#include <vcl/scrbar.hxx>
 
-//#include <vcl/fixed.h>
+#include "forward.hxx"
 
-using namespace toolkit;
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
 
 using namespace ::com::sun::star::uno;
 using namespace ::com::sun::star::awt;
@@ -24,11 +50,8 @@ using namespace ::com::sun::star::lang;
 using namespace ::com::sun::star::beans;
 using namespace ::com::sun::star;
 
-//====================================================================
-//= VCLXScroller
-//====================================================================
 DBG_NAME( VCLXScroller )
-//--------------------------------------------------------------------
+
 VCLXScroller::VCLXScroller( )
 : VCLXWindow()
     , Bin()
@@ -37,19 +60,15 @@ VCLXScroller::VCLXScroller( )
     mpHorScrollBar = mpVerScrollBar = 0;
 }
 
-//--------------------------------------------------------------------
 VCLXScroller::~VCLXScroller()
 {
     DBG_DTOR( VCLXScroller, NULL );
 }
 
-//--------------------------------------------------------------------
-IMPLEMENT_2_FORWARD_XINTERFACE1( VCLXScroller, VCLXWindow, Container )
+IMPLEMENT_2_FORWARD_XINTERFACE1( VCLXScroller, VCLXWindow, Container );
 
-//--------------------------------------------------------------------
-IMPLEMENT_FORWARD_XTYPEPROVIDER1( VCLXScroller, VCLXWindow )
+IMPLEMENT_FORWARD_XTYPEPROVIDER1( VCLXScroller, VCLXWindow );
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXScroller::dispose( ) throw(RuntimeException)
 {
     {
@@ -63,7 +82,6 @@ void SAL_CALL VCLXScroller::dispose( ) t
     VCLXWindow::dispose();
 }
 
-//--------------------------------------------------------------------
 void VCLXScroller::ensureScrollBars()
 {
 
@@ -86,7 +104,6 @@ void VCLXScroller::ensureScrollBars()
 
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXScroller::allocateArea(
     const ::com::sun::star::awt::Rectangle &rArea )
     throw (::com::sun::star::uno::RuntimeException)
@@ -118,7 +135,6 @@ void SAL_CALL VCLXScroller::allocateArea
         allocateChildAt( mxChild, childRect );
 }
 
-//--------------------------------------------------------------------
 #define MAX_CHILD_REQ 40
 ::com::sun::star::awt::Size SAL_CALL VCLXScroller::getMinimumSize()
     throw(::com::sun::star::uno::RuntimeException)
@@ -134,37 +150,42 @@ void SAL_CALL VCLXScroller::allocateArea
     return maRequisition;
 }
 
-//--------------------------------------------------------------------
 void VCLXScroller::ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent )
 {
+/*
     ::vos::OClearableGuard aGuard( GetMutex() );
 
     switch ( _rVclWindowEvent.GetId() )
     {
         default:
             aGuard.clear();
+*/
             VCLXWindow::ProcessWindowEvent( _rVclWindowEvent );
+/*
             break;
     }
+*/
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXScroller::setProperty( const ::rtl::OUString& PropertyName, const Any &Value ) throw(RuntimeException)
 {
     ::vos::OGuard aGuard( GetMutex() );
 
     if ( GetWindow() )
     {
+/*
         sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
         switch ( nPropertyId )
         {
             default:
+*/
                 VCLXWindow::setProperty( PropertyName, Value );
+/*
         }
+*/
     }
 }
 
-//--------------------------------------------------------------------
 Any SAL_CALL VCLXScroller::getProperty( const ::rtl::OUString& PropertyName ) throw(RuntimeException)
 {
     ::vos::OGuard aGuard( GetMutex() );
@@ -172,12 +193,15 @@ Any SAL_CALL VCLXScroller::getProperty( 
     Any aReturn;
     if ( GetWindow() )
     {
+/*
         sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
         switch ( nPropertyId )
         {
             default:
+*/
                 aReturn = VCLXWindow::getProperty( PropertyName );
-        }
+
+//        }
     }
     return aReturn;
 }
@@ -189,6 +213,4 @@ IMPL_LINK( VCLXScroller, ScrollHdl, Scro
     return 0;
 }
 
-//........................................................................
-} // namespace toolkit
-//........................................................................
+} // namespace layoutimpl
Index: toolkit/source/awt/vclxscroller.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxscroller.hxx,v
retrieving revision 1.3
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.3
--- toolkit/source/awt/vclxscroller.hxx	11 Apr 2008 09:19:47 -0000	1.3
+++ toolkit/source/awt/vclxscroller.hxx	30 Jul 2008 11:13:18 -0000	1.2.6.3
@@ -1,29 +1,46 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef LAYOUT_AWT_VCLXSCROLLER_HXX
 #define LAYOUT_AWT_VCLXSCROLLER_HXX
 
-#include <toolkit/awt/vclxwindow.hxx>
-#include <toolkit/helper/listenermultiplexer.hxx>
-#include <cppuhelper/implbase1.hxx>
 #include <comphelper/uno3.hxx>
-#include "../layout/bin.hxx"
-
-#include <com/sun/star/awt/MaxChildrenException.hpp>
-#include <com/sun/star/beans/XPropertySet.hpp>
-
-#include "forward.hxx"
+#include <layout/bin.hxx>
+#include <toolkit/awt/vclxwindow.hxx>
 
 class ScrollBar;
 class FixedImage;
-using namespace toolkit;
 
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
-
-//====================================================================
-//= VCLXScroller
-//====================================================================
 
 class VCLXScroller :public VCLXWindow
                    ,public Bin
@@ -69,8 +86,6 @@ private:
     DECL_LINK( ScrollHdl, ScrollBar* );
 };
 
-//........................................................................
-} // namespacetoolkit
-//........................................................................
+} // namespace layoutimpl
 
 #endif /*LAYOUT_AWT_VCLXSCROLLER_HXX*/
Index: toolkit/source/awt/vclxsplitter.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxsplitter.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.4
--- toolkit/source/awt/vclxsplitter.cxx	11 Apr 2008 09:20:21 -0000	1.3
+++ toolkit/source/awt/vclxsplitter.cxx	30 Jul 2008 11:13:24 -0000	1.2.6.4
@@ -1,19 +1,47 @@
-#include "vclxsplitter.hxx"
-#include "toolkit/helper/property.hxx"
-#include <tools/debug.hxx>
-#include <vcl/split.hxx>
-#include <toolkit/helper/vclunohelper.hxx>
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
 
-#include <com/sun/star/awt/PosSize.hpp>
+#include "vclxsplitter.hxx"
 
 #include <assert.h>
+#include <com/sun/star/awt/PosSize.hpp>
 #include <sal/macros.h>
+#include <toolkit/helper/property.hxx>
+#include <toolkit/helper/vclunohelper.hxx>
+#include <vcl/split.hxx>
+
+#include "forward.hxx"
 
-using namespace toolkit;
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
 
 using namespace ::com::sun::star::uno;
 using namespace ::com::sun::star::awt;
@@ -21,26 +49,37 @@ using namespace ::com::sun::star::lang;
 using namespace ::com::sun::star::beans;
 using namespace ::com::sun::star;
 
-class SplitterChildProps : public PropHelper
-{
-public:
-    SplitterChildProps( VCLXSplitter::ChildData *pData )
+VCLXSplitter::ChildProps::ChildProps( VCLXSplitter::ChildData *pData )
     {
         addProp( RTL_CONSTASCII_USTRINGPARAM( "Shrink" ),
                  ::getCppuType( static_cast< const rtl::OUString* >( NULL ) ),
-                 &(pData->bShrink) );
+             &(pData->mbShrink) );
+}
+
+VCLXSplitter::ChildData::ChildData( uno::Reference< awt::XLayoutConstrains > const& xChild )
+    : Box_Base::ChildData( xChild )
+    , mbShrink( false )
+{
+}
+
+VCLXSplitter::ChildData*
+VCLXSplitter::createChild( uno::Reference< awt::XLayoutConstrains > const& xChild )
+{
+    return new ChildData( xChild );
     }
-    PROPHELPER_SET_INFO
-};
 
-//====================================================================
-//= VCLXSplitter
-//====================================================================
-DBG_NAME( VCLXSplitter )
-//--------------------------------------------------------------------
+VCLXSplitter::ChildProps*
+VCLXSplitter::createChildProps( Box_Base::ChildData *pData )
+{
+    return new ChildProps( static_cast<VCLXSplitter::ChildData*> ( pData ) );
+}
+
+
+DBG_NAME( VCLXSplitter );
+
 VCLXSplitter::VCLXSplitter( bool bHorizontal )
 : VCLXWindow()
-    , Container()
+  , Box_Base()
 {
     DBG_CTOR( VCLXSplitter, NULL );
     mnHandleRatio = 0.5;
@@ -49,19 +88,25 @@ VCLXSplitter::VCLXSplitter( bool bHorizo
     mpSplitter = NULL;
 }
 
-//--------------------------------------------------------------------
 VCLXSplitter::~VCLXSplitter()
 {
     DBG_DTOR( VCLXSplitter, NULL );
 }
 
-//--------------------------------------------------------------------
-IMPLEMENT_2_FORWARD_XINTERFACE1( VCLXSplitter, VCLXWindow, Container )
+IMPLEMENT_2_FORWARD_XINTERFACE1( VCLXSplitter, VCLXWindow, Container );
 
-//--------------------------------------------------------------------
-IMPLEMENT_FORWARD_XTYPEPROVIDER1( VCLXSplitter, VCLXWindow )
+IMPLEMENT_FORWARD_XTYPEPROVIDER1( VCLXSplitter, VCLXWindow );
+
+VCLXSplitter::ChildData*
+VCLXSplitter::getChild( int i )
+{
+    if ( maChildren.size() && i == 0 )
+        return static_cast<VCLXSplitter::ChildData*>( maChildren.front() );
+    else if ( maChildren.size() > 1 && i == 1 )
+        return static_cast<VCLXSplitter::ChildData*>( maChildren.back() );
+    return 0;
+}
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXSplitter::dispose( ) throw(RuntimeException)
 {
     {
@@ -75,7 +120,6 @@ void SAL_CALL VCLXSplitter::dispose( ) t
     VCLXWindow::dispose();
 }
 
-//--------------------------------------------------------------------
 void VCLXSplitter::ensureSplitter()
 {
     if ( !mpSplitter )
@@ -86,86 +130,15 @@ void VCLXSplitter::ensureSplitter()
     }
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXSplitter::addChild(
     const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains > &xChild )
     throw (::com::sun::star::uno::RuntimeException, ::com::sun::star::awt::MaxChildrenException)
 {
-    ChildData *pData;
-    if ( ! maChildren[ 0 ].xChild.is() )
-        pData = &maChildren[ 0 ];
-    else if ( ! maChildren[ 1 ].xChild.is() )
-        pData = &maChildren[ 1 ];
-    else
+    if ( maChildren.size() == 2 )
         throw css::awt::MaxChildrenException();
-
-    if ( xChild.is() )
-    {
-        pData->xChild = xChild;
-        setChildParent( xChild );
-        queueResize();
-    }
-}
-
-//--------------------------------------------------------------------
-void SAL_CALL VCLXSplitter::removeChild( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains > &xChild )
-    throw (::com::sun::star::uno::RuntimeException)
-{
-    ChildData *pData = 0;
-    if ( maChildren[ 0 ].xChild == xChild )
-        pData = &maChildren[ 0 ];
-    else if ( maChildren[ 1 ].xChild == xChild )
-        pData = &maChildren[ 1 ];
-
-    if ( pData )
-    {
-        pData->xChild = uno::Reference< awt::XLayoutConstrains >();
-        unsetChildParent( xChild );
-        queueResize();
-    }
-}
-
-//--------------------------------------------------------------------
-::com::sun::star::uno::Sequence< ::com::sun::star::uno::Reference
-                                 < ::com::sun::star::awt::XLayoutConstrains > > SAL_CALL VCLXSplitter::getChildren()
-    throw (::com::sun::star::uno::RuntimeException)
-{
-    int childLen = (maChildren[ 0 ].xChild.is() ? 1: 0) +
-        (maChildren[ 1 ].xChild.is() ? 1: 0);
-    uno::Sequence< uno::Reference< awt::XLayoutConstrains > > childrenSeq( childLen );
-    int i = 0;
-    if ( maChildren[ 0 ].xChild.is() )
-        childrenSeq[ i++ ] = maChildren[ 0 ].xChild;
-    if ( maChildren[ 1 ].xChild.is() )
-        childrenSeq[ i++ ] = maChildren[ 1 ].xChild;
-    return childrenSeq;
+    Box_Base::addChild( xChild );
 }
 
-//--------------------------------------------------------------------
-uno::Reference< beans::XPropertySet > SAL_CALL
-VCLXSplitter::getChildProperties( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw (uno::RuntimeException)
-{
-    ChildData *pData = 0;
-    if ( maChildren[ 0 ].xChild == xChild )
-        pData = &maChildren[ 0 ];
-    else if ( maChildren[ 1 ].xChild == xChild )
-        pData = &maChildren[ 1 ];
-
-    if ( pData )
-    {
-        if ( !pData->xProps.is() )
-        {
-            PropHelper *pProps = new SplitterChildProps( pData );
-            pProps->setChangeListener( this );
-            pData->xProps = pProps;
-        }
-        return pData->xProps;
-    }
-    return uno::Reference< beans::XPropertySet >();
-}
-
-//--------------------------------------------------------------------
 void SAL_CALL VCLXSplitter::allocateArea(
     const ::com::sun::star::awt::Rectangle &rArea )
     throw (::com::sun::star::uno::RuntimeException)
@@ -195,7 +168,7 @@ void SAL_CALL VCLXSplitter::allocateArea
     int leftWidth = splitPos;
     int rightWidth = width - splitPos;
 
-    if ( maChildren[ 0 ].xChild.is() )
+    if ( getChild( 0 ) && getChild( 0 )->mxChild.is() )
     {
         awt::Rectangle childRect( 0, 0, rArea.Width, rArea.Height );
 
@@ -203,9 +176,9 @@ void SAL_CALL VCLXSplitter::allocateArea
             childRect.Width = leftWidth - 2;
         else
             childRect.Height = leftWidth - 2;
-        allocateChildAt( maChildren[ 0 ].xChild, childRect );
+        allocateChildAt( getChild( 0 )->mxChild, childRect );
     }
-    if ( maChildren[ 1 ].xChild.is() )
+    if ( getChild( 0 ) && getChild( 0 )->mxChild.is() )
     {
         awt::Rectangle childRect( 0, 0, rArea.Width, rArea.Height );
 
@@ -219,11 +192,10 @@ void SAL_CALL VCLXSplitter::allocateArea
             childRect.Y += leftWidth + splitLen + 2;
             childRect.Height = rightWidth;
         }
-        allocateChildAt( maChildren[ 1 ].xChild, childRect );
+        allocateChildAt( getChild( 1 )->mxChild, childRect );
     }
 }
 
-//--------------------------------------------------------------------
 ::com::sun::star::awt::Size SAL_CALL VCLXSplitter::getMinimumSize()
     throw(::com::sun::star::uno::RuntimeException)
 {
@@ -232,9 +204,9 @@ void SAL_CALL VCLXSplitter::allocateArea
     awt::Size size( mbHorizontal ? 2 : 0, mbHorizontal ? 0 : 2 );
     for( unsigned int i = 0; i < 2; i++ )
     {
-        if ( maChildren[ i ].xChild.is() )
+        if ( getChild( i ) && getChild( i )->mxChild.is() )
         {
-            awt::Size childSize = maChildren[ i ].xChild->getMinimumSize();
+            awt::Size childSize = getChild( i )->mxChild->getMinimumSize();
             if ( mbHorizontal )
             {
                 size.Width += childSize.Width;
@@ -252,51 +224,19 @@ void SAL_CALL VCLXSplitter::allocateArea
     return size;
 }
 
-//--------------------------------------------------------------------
 void VCLXSplitter::ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent )
 {
-    ::vos::OClearableGuard aGuard( GetMutex() );
-    switch ( _rVclWindowEvent.GetId() )
-    {
-        default:
-            aGuard.clear();
             VCLXWindow::ProcessWindowEvent( _rVclWindowEvent );
-            break;
-    }
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXSplitter::setProperty( const ::rtl::OUString& PropertyName, const Any &Value ) throw(RuntimeException)
 {
-    ::vos::OGuard aGuard( GetMutex() );
-
-    if ( GetWindow() )
-    {
-        sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
-        switch ( nPropertyId )
-        {
-            default:
                 VCLXWindow::setProperty( PropertyName, Value );
         }
-    }
-}
 
-//--------------------------------------------------------------------
 Any SAL_CALL VCLXSplitter::getProperty( const ::rtl::OUString& PropertyName ) throw(RuntimeException)
 {
-    ::vos::OGuard aGuard( GetMutex() );
-
-    Any aReturn;
-    if ( GetWindow() )
-    {
-        sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
-        switch ( nPropertyId )
-        {
-            default:
-                aReturn = VCLXWindow::getProperty( PropertyName );
-        }
-    }
-    return aReturn;
+    return VCLXWindow::getProperty( PropertyName );
 }
 
 IMPL_LINK( VCLXSplitter, HandleMovedHdl, Splitter *, pSplitter )
@@ -306,6 +246,4 @@ IMPL_LINK( VCLXSplitter, HandleMovedHdl,
     return 0;
 }
 
-//........................................................................
-} // namespace toolkit
-//........................................................................
+} // namespace layoutimpl
Index: toolkit/source/awt/vclxsplitter.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxsplitter.hxx,v
retrieving revision 1.3
retrieving revision 1.2.6.5
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.5
--- toolkit/source/awt/vclxsplitter.hxx	11 Apr 2008 09:20:37 -0000	1.3
+++ toolkit/source/awt/vclxsplitter.hxx	30 Jul 2008 11:13:29 -0000	1.2.6.5
@@ -1,32 +1,55 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef LAYOUT_AWT_VCLXSPLITTER_HXX
 #define LAYOUT_AWT_VCLXSPLITTER_HXX
 
-#include <toolkit/awt/vclxwindow.hxx>
-#include <toolkit/helper/listenermultiplexer.hxx>
-#include <cppuhelper/implbase1.hxx>
-#include <comphelper/uno3.hxx>
-#include "../layout/container.hxx"
-
 #include <com/sun/star/awt/MaxChildrenException.hpp>
 #include <com/sun/star/beans/XPropertySet.hpp>
-
-#include "forward.hxx"
+#include <comphelper/uno3.hxx>
+#include <layout/box-base.hxx>
+#include <toolkit/awt/vclxwindow.hxx>
 
 class Splitter;
-using namespace toolkit;
 
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
-
-//====================================================================
-//= VCLXSplitter
-//====================================================================
 
 class VCLXSplitter :public VCLXWindow
-                   ,public Container
+                   ,public Box_Base
 {
+private:
+    VCLXSplitter( const VCLXSplitter& );            // never implemented
+    VCLXSplitter& operator=( const VCLXSplitter& ); // never implemented
+
 public:
     VCLXSplitter( bool bHorizontal );
 
@@ -46,12 +69,6 @@ protected:
     virtual void SAL_CALL addChild(
         const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains >& Child )
         throw (::com::sun::star::uno::RuntimeException, ::com::sun::star::awt::MaxChildrenException);
-    virtual void SAL_CALL removeChild( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains >& Child )
-        throw (::com::sun::star::uno::RuntimeException);
-
-    virtual ::com::sun::star::uno::Sequence< ::com::sun::star::uno::Reference
-                                             < ::com::sun::star::awt::XLayoutConstrains > > SAL_CALL getChildren()
-        throw (::com::sun::star::uno::RuntimeException);
 
     virtual void SAL_CALL allocateArea( const ::com::sun::star::awt::Rectangle &rArea )
         throw (::com::sun::star::uno::RuntimeException);
@@ -59,10 +76,6 @@ protected:
     virtual ::com::sun::star::awt::Size SAL_CALL getMinimumSize()
         throw(::com::sun::star::uno::RuntimeException);
 
-    virtual css::uno::Reference< css::beans::XPropertySet > SAL_CALL getChildProperties(
-        const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
-        throw (css::uno::RuntimeException);
-
     // unimplemented:
     virtual sal_Bool SAL_CALL hasHeightForWidth()
         throw(css::uno::RuntimeException)
@@ -78,21 +91,25 @@ protected:
     // VCLXWindow
     void ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent );
 
-private:
-    VCLXSplitter( const VCLXSplitter& );            // never implemented
-    VCLXSplitter& operator=( const VCLXSplitter& ); // never implemented
-
+public:
     // Maps page ids to child references
-    friend class SplitterChildProps;
-    struct ChildData
+    struct ChildData : public Box_Base::ChildData
     {
-        sal_Bool bShrink;
+        sal_Bool mbShrink;
+        ChildData( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
+    };
 
-        css::uno::Reference< css::awt::XLayoutConstrains > xChild;
-        css::uno::Reference< css::beans::XPropertySet >    xProps;
-        bool isVisible();
+    struct ChildProps : public Box_Base::ChildProps
+    {
+        ChildProps( VCLXSplitter::ChildData *pData );
     };
-    ChildData maChildren[ 2 ];  // some may be null
+
+protected:
+
+    ChildData *createChild( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
+    ChildProps *createChildProps( Box_Base::ChildData* pData );
+
+    ChildData* getChild( int i );
 
     float mnHandleRatio;
     bool mbHandlePressed;
@@ -103,8 +120,6 @@ private:
     void ensureSplitter();
 };
 
-//........................................................................
-} // namespacetoolkit
-//........................................................................
+} // namespace layoutimpl
 
 #endif /*LAYOUT_AWT_VCLXSPLITTER_HXX*/
Index: toolkit/source/awt/vclxtabcontrol.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxtabcontrol.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.4
--- toolkit/source/awt/vclxtabcontrol.cxx	11 Apr 2008 09:21:14 -0000	1.3
+++ toolkit/source/awt/vclxtabcontrol.cxx	30 Jul 2008 11:13:35 -0000	1.2.6.4
@@ -1,21 +1,47 @@
-#include "vclxtabcontrol.hxx"
-#include "toolkit/helper/property.hxx"
-#include <com/sun/star/awt/ScrollBarOrientation.hpp>
-
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
 
-#include <tools/debug.hxx>
-#include <vcl/tabctrl.hxx>
-#include <toolkit/helper/vclunohelper.hxx>
+#include "vclxtabcontrol.hxx"
 
-#include <vcl/tabpage.hxx>
 #include <com/sun/star/awt/PosSize.hpp>
 #include <sal/macros.h>
+#include <toolkit/helper/property.hxx>
+#include <toolkit/helper/vclunohelper.hxx>
+#include <vcl/tabctrl.hxx>
+#include <vcl/tabpage.hxx>
+
+#include "forward.hxx"
 
-using namespace toolkit;
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
 
 using namespace ::com::sun::star::uno;
 using namespace ::com::sun::star::awt;
@@ -23,46 +49,51 @@ using namespace ::com::sun::star::lang;
 using namespace ::com::sun::star::beans;
 using namespace ::com::sun::star;
 
-class TabChildProps : public PropHelper
-{
-public:
-    TabChildProps( VCLXTabControl::ChildData *pData )
+VCLXTabControl::ChildProps::ChildProps( VCLXTabControl::ChildData *pData )
     {
         addProp( RTL_CONSTASCII_USTRINGPARAM( "Title" ),
                  ::getCppuType( static_cast< const rtl::OUString* >( NULL ) ),
-                 &(pData->aTitle) );
+             &(pData->maTitle) );
+}
+
+VCLXTabControl::ChildData::ChildData( uno::Reference< awt::XLayoutConstrains > const& xChild )
+    : Box_Base::ChildData( xChild )
+    , maTitle()
+{
+}
+
+VCLXTabControl::ChildData*
+VCLXTabControl::createChild( uno::Reference< awt::XLayoutConstrains > const& xChild )
+{
+    return new ChildData( xChild );
     }
-    PROPHELPER_SET_INFO
-};
 
-//====================================================================
-//= VCLXTabControl
-//====================================================================
-DBG_NAME( VCLXTabControl )
-//--------------------------------------------------------------------
+VCLXTabControl::ChildProps*
+VCLXTabControl::createChildProps( Box_Base::ChildData *pData )
+{
+    return new ChildProps( static_cast<VCLXTabControl::ChildData*> ( pData ) );
+}
+
+DBG_NAME( VCLXTabControl );
+
 VCLXTabControl::VCLXTabControl()
 : VCLXWindow()
     , VCLXTabControl_Base()
-    , Container()
+  , Box_Base()
+  , mnNextTabId( 1 )
 {
     DBG_CTOR( VCLXTabControl, NULL );
-    mnNextTabId = 1;
-    mnChildrenNb = 0;
 }
 
-//--------------------------------------------------------------------
 VCLXTabControl::~VCLXTabControl()
 {
     DBG_DTOR( VCLXTabControl, NULL );
 }
 
-//--------------------------------------------------------------------
-IMPLEMENT_2_FORWARD_XINTERFACE2( VCLXTabControl, VCLXWindow, Container, VCLXTabControl_Base )
+IMPLEMENT_2_FORWARD_XINTERFACE2( VCLXTabControl, VCLXWindow, Container, VCLXTabControl_Base );
 
-//--------------------------------------------------------------------
-IMPLEMENT_FORWARD_XTYPEPROVIDER2( VCLXTabControl, VCLXWindow, VCLXTabControl_Base )
+IMPLEMENT_FORWARD_XTYPEPROVIDER2( VCLXTabControl, VCLXWindow, VCLXTabControl_Base );
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::dispose( ) throw(RuntimeException)
 {
     {
@@ -75,23 +106,21 @@ void SAL_CALL VCLXTabControl::dispose( )
 
     VCLXWindow::dispose();
 }
-/*
-//--------------------------------------------------------------------
+
+#if 0
 void SAL_CALL VCLXTabControl::addTabListener( const Reference< XTabListener >& listener ) throw (RuntimeException)
 {
 if ( listener.is() )
 maTabListeners.addInterface( listener );
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::removeTabListener( const Reference< XTabListener >& listener ) throw (RuntimeException)
 {
 if ( listener.is() )
 maTabListeners.removeInterface( listener );
 }
-*/
+#endif
 
-//--------------------------------------------------------------------
 TabControl *VCLXTabControl::getTabControl() const throw (RuntimeException)
 {
     TabControl *pTabControl = static_cast< TabControl* >( GetWindow() );
@@ -100,48 +129,42 @@ TabControl *VCLXTabControl::getTabContro
     throw RuntimeException();
 }
 
-//--------------------------------------------------------------------
 sal_Int32 SAL_CALL VCLXTabControl::insertTab() throw (RuntimeException)
 {
     TabControl *pTabControl = getTabControl();
-    int id = mnNextTabId++;
+    USHORT id = sal::static_int_cast< USHORT >( mnNextTabId++ );
     rtl::OUString title (RTL_CONSTASCII_USTRINGPARAM( "" ) );
     pTabControl->InsertPage( id, title.getStr(), TAB_APPEND );
     pTabControl->SetTabPage( id, new TabPage( pTabControl ) );
     return id;
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::removeTab( sal_Int32 ID ) throw (RuntimeException, IndexOutOfBoundsException)
 {
     TabControl *pTabControl = getTabControl();
-    if ( pTabControl->GetTabPage( ID ) == NULL )
+    if ( pTabControl->GetTabPage( sal::static_int_cast< USHORT >( ID ) ) == NULL )
         throw IndexOutOfBoundsException();
-    pTabControl->RemovePage( ID );
+    pTabControl->RemovePage( sal::static_int_cast< USHORT >( ID ) );
 }
 
-
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::activateTab( sal_Int32 ID ) throw (RuntimeException, IndexOutOfBoundsException)
 {
     TabControl *pTabControl = getTabControl();
-    if ( pTabControl->GetTabPage( ID ) == NULL )
+    if ( pTabControl->GetTabPage( sal::static_int_cast< USHORT >( ID ) ) == NULL )
         throw IndexOutOfBoundsException();
-    pTabControl->SelectTabPage( ID );
+    pTabControl->SelectTabPage( sal::static_int_cast< USHORT >( ID ) );
 }
 
-//--------------------------------------------------------------------
 sal_Int32 SAL_CALL VCLXTabControl::getActiveTabID() throw (RuntimeException)
 {
     return getTabControl()->GetCurPageId( );
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::addTabListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTabListener >& xListener ) throw (::com::sun::star::uno::RuntimeException)
 {
-    std::list< ::com::sun::star::uno::Reference
-        < ::com::sun::star::awt::XTabListener > >::const_iterator it;
-    for( it = mxTabListeners.begin(); it != mxTabListeners.end(); it++)
+    for ( std::list< ::com::sun::star::uno::Reference
+              < ::com::sun::star::awt::XTabListener > >::const_iterator it
+              = mxTabListeners.begin(); it != mxTabListeners.end(); it++ )
     {
         if ( *it == xListener )
             // already added
@@ -150,12 +173,11 @@ void SAL_CALL VCLXTabControl::addTabList
     mxTabListeners.push_back( xListener );
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::removeTabListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTabListener >& xListener ) throw (::com::sun::star::uno::RuntimeException)
 {
-    std::list< ::com::sun::star::uno::Reference
-        < ::com::sun::star::awt::XTabListener > >::iterator it;
-    for( it = mxTabListeners.begin(); it != mxTabListeners.end(); it++)
+    for ( std::list< ::com::sun::star::uno::Reference
+              < ::com::sun::star::awt::XTabListener > >::iterator it
+              = mxTabListeners.begin(); it != mxTabListeners.end(); it++ )
     {
         if ( *it == xListener )
         {
@@ -165,11 +187,10 @@ void SAL_CALL VCLXTabControl::removeTabL
     }
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::setTabProps( sal_Int32 ID, const Sequence< NamedValue >& Properties ) throw (RuntimeException, IndexOutOfBoundsException)
 {
     TabControl *pTabControl = getTabControl();
-    if ( pTabControl->GetTabPage( ID ) == NULL )
+    if ( pTabControl->GetTabPage( sal::static_int_cast< USHORT >( ID ) ) == NULL )
         throw IndexOutOfBoundsException();
 
     for( int i = 0; i < Properties.getLength(); i++ )
@@ -180,17 +201,16 @@ void SAL_CALL VCLXTabControl::setTabProp
         if ( name  == rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Title" ) ) )
         {
             rtl::OUString title = value.get<rtl::OUString>();
-            pTabControl->SetPageText( ID, title.getStr() );
+            pTabControl->SetPageText( sal::static_int_cast< USHORT >( ID ), title.getStr() );
         }
     }
 }
 
-//--------------------------------------------------------------------
 Sequence< NamedValue > SAL_CALL VCLXTabControl::getTabProps( sal_Int32 ID )
     throw (IndexOutOfBoundsException, RuntimeException)
 {
     TabControl *pTabControl = getTabControl();
-    if ( pTabControl->GetTabPage( ID ) == NULL )
+    if ( pTabControl->GetTabPage( sal::static_int_cast< USHORT >( ID ) ) == NULL )
         throw IndexOutOfBoundsException();
 
 #define ADD_PROP( seq, i, name, val ) {                                \
@@ -201,21 +221,19 @@ Sequence< NamedValue > SAL_CALL VCLXTabC
     }
 
     Sequence< NamedValue > props( 2 );
-    ADD_PROP( props, 0, "Title", rtl::OUString( pTabControl->GetPageText( ID ) ) );
-    ADD_PROP( props, 1, "Position", pTabControl->GetPagePos( ID ) );
+    ADD_PROP( props, 0, "Title", rtl::OUString( pTabControl->GetPageText( sal::static_int_cast< USHORT >( ID ) ) ) );
+    ADD_PROP( props, 1, "Position", pTabControl->GetPagePos( sal::static_int_cast< USHORT >( ID ) ) );
 #undef ADD_PROP
     return props;
 }
 
-//--------------------------------------------------------------------
-
 // TODO: draw tab border here
 void SAL_CALL VCLXTabControl::draw( sal_Int32 nX, sal_Int32 nY ) throw(::com::sun::star::uno::RuntimeException)
 {
     ::vos::OGuard aGuard( GetMutex() );
 
     TabControl *pTabControl = getTabControl();
-    TabPage *pTabPage = pTabControl->GetTabPage( getActiveTabID() );
+    TabPage *pTabPage = pTabControl->GetTabPage( sal::static_int_cast< USHORT >(  getActiveTabID() ) );
     if ( pTabPage )
     {
         ::Point aPos( nX, nY );
@@ -231,93 +249,28 @@ void SAL_CALL VCLXTabControl::draw( sal_
     VCLXWindow::draw( nX, nY );
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::addChild(
     const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains > &xChild )
     throw (::com::sun::star::uno::RuntimeException, ::com::sun::star::awt::MaxChildrenException)
 {
-    unsigned int id = insertTab();
-    if ( maChildren.size() < id )
-        maChildren.resize( id, 0 );
-    mnChildrenNb++;
-
-    if ( xChild.is() )
-    {
-        ChildData *pData = new ChildData();
-        pData->xChild = xChild;
-        maChildren[ id-1 ] = pData;
-
-        setChildParent( xChild );
-        queueResize();
+    mIdMap[ xChild ] = insertTab();
+    Box_Base::addChild( xChild );
     }
-}
-
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::removeChild( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains > &xChild )
     throw (::com::sun::star::uno::RuntimeException)
 {
-    for( unsigned i = 0; i < maChildren.size(); i++)
-    {
-        if ( maChildren[ i ] && maChildren[ i ]->xChild == xChild )
-        {
-            removeTab( i );
-            delete maChildren[ i ];
-            maChildren[ i ] = NULL;
-            mnChildrenNb--;
-
-            unsetChildParent( xChild );
-            queueResize();
-            break;
-        }
-    }
+    removeTab( mIdMap[xChild] );
+    mIdMap[ xChild ] = -1;
+    Box_Base::removeChild( xChild );
 }
 
-//--------------------------------------------------------------------
-::com::sun::star::uno::Sequence< ::com::sun::star::uno::Reference
-                                 < ::com::sun::star::awt::XLayoutConstrains > > SAL_CALL VCLXTabControl::getChildren()
-    throw (::com::sun::star::uno::RuntimeException)
-{
-    uno::Sequence< uno::Reference< awt::XLayoutConstrains > > childrenSeq( mnChildrenNb );
-    for( unsigned si = 0, ci = 0; ci < maChildren.size(); ci++)
-    {
-        if ( maChildren[ ci ] && maChildren[ ci ]->xChild.is() )
-            childrenSeq[si++] = maChildren[ ci ]->xChild;
-    }
-    return childrenSeq;
-}
-
-//--------------------------------------------------------------------
-uno::Reference< beans::XPropertySet > SAL_CALL
-VCLXTabControl::getChildProperties( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw (uno::RuntimeException)
-{
-    std::vector< ChildData * >::iterator iter;
-    for( iter = maChildren.begin(); iter != maChildren.end(); iter++)
-    {
-        if ( (*iter)->xChild == xChild )
-        {
-            if ( !(*iter)->xProps.is() )
-            {
-                // FIXME: make me safe !
-                PropHelper *pProps = new TabChildProps( *iter );
-                pProps->setChangeListener( this );
-                (*iter)->xProps = pProps;
-            }
-            return (*iter)->xProps;
-        }
-    }
-    return uno::Reference< beans::XPropertySet >();
-}
-
-// TEMP:
 static void setChildrenVisible( uno::Reference < awt::XLayoutConstrains > xChild, bool visible )
 {
     uno::Reference< awt::XWindow > xWin( xChild, uno::UNO_QUERY);
     if ( xWin.is() )
     {
         xWin->setVisible( visible );
-//xWin->setPosSize( 0, 0, 5, 5, PosSize::POSSIZE );
     }
 
     uno::Reference < awt::XLayoutContainer > xCont( xChild, uno::UNO_QUERY );
@@ -331,7 +284,6 @@ static void setChildrenVisible( uno::Ref
     }
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::allocateArea(
     const ::com::sun::star::awt::Rectangle &rArea )
     throw (::com::sun::star::uno::RuntimeException)
@@ -350,12 +302,13 @@ void SAL_CALL VCLXTabControl::allocateAr
 
     // FIXME: we can save cycles by setting visibility more sensibly. Having
     // it here does makes it easier when changing tabs (just needs a recalc())
-    for( unsigned int i = 0; i < maChildren.size(); i++ )
+    unsigned i = 0;
+    for ( std::list<Box_Base::ChildData *>::const_iterator it
+              = maChildren.begin(); it != maChildren.end(); it++, i++ )
     {
-        if ( !maChildren[ i ] )
-            continue;
+        ChildData *child = static_cast<VCLXTabControl::ChildData*> ( *it );
         ::com::sun::star::uno::Reference
-              < ::com::sun::star::awt::XLayoutConstrains > xChild( maChildren[ i ]->xChild );
+              < ::com::sun::star::awt::XLayoutConstrains > xChild( child->mxChild );
         if ( xChild.is() )
         {
             uno::Reference< awt::XWindow > xWin( xChild, uno::UNO_QUERY );
@@ -372,8 +325,8 @@ void SAL_CALL VCLXTabControl::allocateAr
 
             if ( active )
             {
-                ::Rectangle label_rect = pTabControl->GetTabBounds( i+1 );
-                ::Rectangle page_rect = pTabControl->GetTabPageBounds( i+1 );
+                ::Rectangle label_rect = pTabControl->GetTabBounds( sal::static_int_cast< USHORT >( i+1 ) );
+                ::Rectangle page_rect = pTabControl->GetTabPageBounds( sal::static_int_cast< USHORT >( i+1 ) );
 
                 awt::Rectangle childRect;
                 childRect.X = page_rect.Left();
@@ -387,7 +340,6 @@ void SAL_CALL VCLXTabControl::allocateAr
     }
 }
 
-//--------------------------------------------------------------------
 ::com::sun::star::awt::Size SAL_CALL VCLXTabControl::getMinimumSize()
     throw(::com::sun::star::uno::RuntimeException)
 {
@@ -399,15 +351,17 @@ void SAL_CALL VCLXTabControl::allocateAr
         return size;
 
     // calculate size to accomodate all children
-    for( unsigned int i = 0; i < maChildren.size(); i++ )
+    unsigned i = 0;
+    for ( std::list<Box_Base::ChildData *>::const_iterator it
+              = maChildren.begin(); it != maChildren.end(); it++, i++ )
     {
-        ChildData *pChild = maChildren[ i ];
-        if ( pChild && pChild->xChild.is() )
+        ChildData *child = static_cast<VCLXTabControl::ChildData*> ( *it );
+        if ( child->mxChild.is() )
         {
             // set the title prop here...
-            pTabControl->SetPageText( i+1, pChild->aTitle.getStr() );
+            pTabControl->SetPageText( sal::static_int_cast< USHORT >( i+1 ), child->maTitle.getStr() );
 
-            awt::Size childSize( pChild->xChild->getMinimumSize() );
+            awt::Size childSize( child->mxChild->getMinimumSize() );
             childrenSize.Width = SAL_MAX( childSize.Width, childrenSize.Width );
             childrenSize.Height = SAL_MAX( childSize.Height, childrenSize.Height );
         }
@@ -419,7 +373,6 @@ void SAL_CALL VCLXTabControl::allocateAr
     return size;
 }
 
-//--------------------------------------------------------------------
 void VCLXTabControl::ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent )
 {
     ::vos::OClearableGuard aGuard( GetMutex() );
@@ -438,9 +391,9 @@ void VCLXTabControl::ProcessWindowEvent(
         case VCLEVENT_TABPAGE_PAGETEXTCHANGED:
         {
             ULONG page = (ULONG) _rVclWindowEvent.GetData();
-            std::list< ::com::sun::star::uno::Reference
-                < ::com::sun::star::awt::XTabListener > >::iterator it;
-            for( it = mxTabListeners.begin(); it != mxTabListeners.end(); it++)
+            for ( std::list< ::com::sun::star::uno::Reference
+                      < ::com::sun::star::awt::XTabListener > >::iterator it
+                      = mxTabListeners.begin(); it != mxTabListeners.end(); it++)
             {
                 ::com::sun::star::uno::Reference
                     < ::com::sun::star::awt::XTabListener > listener = *it;
@@ -463,7 +416,7 @@ void VCLXTabControl::ProcessWindowEvent(
                     case VCLEVENT_TABPAGE_REMOVEDALL:
                         for( int i = 1; i < mnNextTabId; i++)
                         {
-                            if ( pTabControl->GetTabPage( i ) )
+                            if ( pTabControl->GetTabPage( sal::static_int_cast< USHORT >( i ) ) )
                                 listener->removed( i );
                         }
                         break;
@@ -481,40 +434,14 @@ void VCLXTabControl::ProcessWindowEvent(
     }
 }
 
-//--------------------------------------------------------------------
 void SAL_CALL VCLXTabControl::setProperty( const ::rtl::OUString& PropertyName, const Any &Value ) throw(RuntimeException)
 {
-    ::vos::OGuard aGuard( GetMutex() );
-
-    if ( GetWindow() )
-    {
-        sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
-        switch ( nPropertyId )
-        {
-            default:
                 VCLXWindow::setProperty( PropertyName, Value );
         }
-    }
-}
 
-//--------------------------------------------------------------------
 Any SAL_CALL VCLXTabControl::getProperty( const ::rtl::OUString& PropertyName ) throw(RuntimeException)
 {
-    ::vos::OGuard aGuard( GetMutex() );
-
-    Any aReturn;
-    if ( GetWindow() )
-    {
-        sal_uInt16 nPropertyId = GetPropertyId( PropertyName );
-        switch ( nPropertyId )
-        {
-            default:
-                aReturn = VCLXWindow::getProperty( PropertyName );
-        }
-    }
-    return aReturn;
+    return VCLXWindow::getProperty( PropertyName );
 }
 
-//........................................................................
-} // namespace toolkit
-//........................................................................
+} // namespace layoutimpl
Index: toolkit/source/awt/vclxtabcontrol.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxtabcontrol.hxx,v
retrieving revision 1.3
retrieving revision 1.2.6.6
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.6
--- toolkit/source/awt/vclxtabcontrol.hxx	11 Apr 2008 09:21:32 -0000	1.3
+++ toolkit/source/awt/vclxtabcontrol.hxx	30 Jul 2008 11:13:41 -0000	1.2.6.6
@@ -1,36 +1,54 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef LAYOUT_AWT_VCLXTABCONTROLLER_HXX
 #define LAYOUT_AWT_VCLXTABCONTROLLER_HXX
 
-#include <toolkit/awt/vclxwindow.hxx>
-#include <toolkit/helper/listenermultiplexer.hxx>
-#include <cppuhelper/implbase1.hxx>
-#include <comphelper/uno3.hxx>
 #include <com/sun/star/awt/XSimpleTabController.hpp>
-#include "../layout/container.hxx"
-
-#include <com/sun/star/awt/MaxChildrenException.hpp>
-#include <com/sun/star/beans/XPropertySet.hpp>
-
-#include "forward.hxx"
+#include <comphelper/uno3.hxx>
+#include <layout/box-base.hxx>
+#include <map>
+#include <toolkit/awt/vclxwindow.hxx>
 
 class TabControl;
-using namespace toolkit;
 
-//........................................................................
 namespace layoutimpl
 {
-//........................................................................
-
-//====================================================================
-//= VCLXTabControl
-//====================================================================
 
 typedef ::cppu::ImplHelper1 <   ::com::sun::star::awt::XSimpleTabController
                                 >   VCLXTabControl_Base;
 
 class VCLXTabControl :public VCLXWindow
                      ,public VCLXTabControl_Base
-                     ,public Container
+                     ,public Box_Base
 {
 public:
     VCLXTabControl();
@@ -47,7 +65,7 @@ protected:
     // XComponent
     void SAL_CALL dispose( ) throw(::com::sun::star::uno::RuntimeException);
 
-    virtual SAL_CALL void draw( sal_Int32 nX, sal_Int32 nY ) throw        (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL draw( sal_Int32 nX, sal_Int32 nY ) throw        (::com::sun::star::uno::RuntimeException);
 
     // XSimpleTabController
     virtual ::sal_Int32 SAL_CALL insertTab() throw (::com::sun::star::uno::RuntimeException);
@@ -69,20 +87,12 @@ protected:
     virtual void SAL_CALL removeChild( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains >& Child )
         throw (::com::sun::star::uno::RuntimeException);
 
-    virtual ::com::sun::star::uno::Sequence< ::com::sun::star::uno::Reference
-                                             < ::com::sun::star::awt::XLayoutConstrains > > SAL_CALL getChildren()
-        throw (::com::sun::star::uno::RuntimeException);
-
     virtual void SAL_CALL allocateArea( const ::com::sun::star::awt::Rectangle &rArea )
         throw (::com::sun::star::uno::RuntimeException);
 
     virtual ::com::sun::star::awt::Size SAL_CALL getMinimumSize()
         throw(::com::sun::star::uno::RuntimeException);
 
-    virtual css::uno::Reference< css::beans::XPropertySet > SAL_CALL getChildProperties(
-        const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
-        throw (css::uno::RuntimeException);
-
     // unimplemented:
     virtual sal_Bool SAL_CALL hasHeightForWidth()
         throw(css::uno::RuntimeException)
@@ -98,35 +108,40 @@ protected:
     // VCLXWindow
     void ProcessWindowEvent( const VclWindowEvent& _rVclWindowEvent );
 
-private:
-    VCLXTabControl( const VCLXTabControl& );            // never implemented
-    VCLXTabControl& operator=( const VCLXTabControl& ); // never implemented
 
     // Each tab page needs an unique id.
     int mnNextTabId;
 
+public:
     // Maps page ids to child references
-    friend class TabChildProps;
-    struct ChildData
+    struct ChildData : public Box_Base::ChildData
+    {
+        rtl::OUString maTitle;
+        ChildData( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
+    };
+
+    struct ChildProps : public Box_Base::ChildProps
     {
-        rtl::OUString aTitle;
-        css::awt::Size aRequisition;
-        css::uno::Reference< css::awt::XLayoutConstrains > xChild;
-        css::uno::Reference< css::beans::XPropertySet >    xProps;
-        bool isVisible();
+        ChildProps( VCLXTabControl::ChildData *pData );
     };
-    std::vector< ChildData * > maChildren;  // some may be null
-    int mnChildrenNb;
 
+protected:
+    ChildData *createChild( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
+    ChildProps *createChildProps( Box_Base::ChildData* pData );
+
+
+    std::map< ::com::sun::star::uno::Reference< ::com::sun::star::awt::XLayoutConstrains >, sal_Int32 > mIdMap;
     // FIXME: we might want to use a Multiplexer
     std::list< ::com::sun::star::uno::Reference
                < ::com::sun::star::awt::XTabListener > > mxTabListeners;
 
     inline TabControl *getTabControl( ) const throw (::com::sun::star::uno::RuntimeException);
+
+private:
+    VCLXTabControl( const VCLXTabControl& );            // never implemented
+    VCLXTabControl& operator=( const VCLXTabControl& ); // never implemented
 };
 
-//........................................................................
-} // namespacetoolkit
-//........................................................................
+} // namespace layoutimpl
 
 #endif /*LAYOUT_AWT_VCLXTABCONTROLLER_HXX*/
Index: toolkit/source/awt/vclxtopwindow.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxtopwindow.cxx,v
retrieving revision 1.13
retrieving revision 1.12.30.4
diff -p -u -u -p -b -w -B -r1.13 -r1.12.30.4
--- toolkit/source/awt/vclxtopwindow.cxx	11 Apr 2008 09:22:05 -0000	1.13
+++ toolkit/source/awt/vclxtopwindow.cxx	30 Jul 2008 12:29:07 -0000	1.12.30.4
@@ -59,6 +59,106 @@
 
 #include <tools/debug.hxx>
 
+VCLXTopWindow_Base::~VCLXTopWindow_Base()
+{
+}
+
+::com::sun::star::uno::Any VCLXTopWindow_Base::getWindowHandle( const ::com::sun::star::uno::Sequence< sal_Int8 >& /*ProcessId*/, sal_Int16 SystemType ) throw(::com::sun::star::uno::RuntimeException)
+{
+	::vos::OGuard aGuard( GetMutexImpl() );
+
+	// TODO, check the process id
+	::com::sun::star::uno::Any aRet;
+	Window* pWindow = GetWindowImpl();
+	if ( pWindow )
+	{
+		const SystemEnvData* pSysData = ((SystemWindow *)pWindow)->GetSystemData();
+		if( pSysData )
+		{
+#if (defined WNT)
+			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_WIN32 )
+			{
+				 aRet <<= (sal_Int32)pSysData->hWnd;
+			}
+#elif (defined OS2)
+			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_OS2 )
+			{
+				 aRet <<= (sal_Int32)pSysData->hWnd;
+			}
+#elif (defined QUARTZ)
+			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_MAC )
+			{
+				 aRet <<= (sal_IntPtr)pSysData->pView;
+			}
+#elif (defined UNX)
+			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_XWINDOW )
+			{
+				::com::sun::star::awt::SystemDependentXWindow aSD;
+				aSD.DisplayPointer = sal::static_int_cast< sal_Int64 >(reinterpret_cast< sal_IntPtr >(pSysData->pDisplay));
+				aSD.WindowHandle = pSysData->aWindow;
+				aRet <<= aSD;
+			}
+#endif
+		}
+	}
+	return aRet;
+}
+
+void VCLXTopWindow_Base::addTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException)
+{
+	::vos::OGuard aGuard( GetMutexImpl() );
+
+	GetTopWindowListenersImpl().addInterface( rxListener );
+}
+
+void VCLXTopWindow_Base::removeTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException)
+{
+	::vos::OGuard aGuard( GetMutexImpl() );
+
+	GetTopWindowListenersImpl().removeInterface( rxListener );
+}
+
+void VCLXTopWindow_Base::toFront(  ) throw(::com::sun::star::uno::RuntimeException)
+{
+	::vos::OGuard aGuard( GetMutexImpl() );
+
+	Window* pWindow = GetWindowImpl();
+	if ( pWindow )
+		((WorkWindow*)pWindow)->ToTop( TOTOP_RESTOREWHENMIN );
+}
+
+void VCLXTopWindow_Base::toBack(  ) throw(::com::sun::star::uno::RuntimeException)
+{
+#if 0 // Not possible in VCL...
+
+	::vos::OGuard aGuard( GetMutexImpl() );
+
+	Window* pWindow = GetWindowImpl();
+	if ( pWindow )
+	{
+		((WorkWindow*)pWindow)->ToBack();
+	}
+#endif
+}
+
+void VCLXTopWindow_Base::setMenuBar( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar >& rxMenu ) throw(::com::sun::star::uno::RuntimeException)
+{
+	::vos::OGuard aGuard( GetMutexImpl() );
+	
+	SystemWindow* pWindow = (SystemWindow*) GetWindowImpl();
+	if ( pWindow )
+	{
+		pWindow->SetMenuBar( NULL );
+		if ( rxMenu.is() )
+		{
+			VCLXMenu* pMenu = VCLXMenu::GetImplementation( rxMenu );
+			if ( pMenu && !pMenu->IsPopupMenu() )
+				pWindow->SetMenuBar( (MenuBar*) pMenu->GetMenu() );
+		}
+	}
+	mxMenuBar = rxMenu;
+}
+
 //	----------------------------------------------------
 //	class VCLXTopWindow
 //	----------------------------------------------------
@@ -77,6 +177,21 @@ VCLXTopWindow::~VCLXTopWindow()
 {
 }
 
+vos::IMutex& VCLXTopWindow::GetMutexImpl()
+{
+    return VCLXContainer::GetMutex();
+}
+
+Window* VCLXTopWindow::GetWindowImpl()
+{
+    return VCLXContainer::GetWindow();
+}
+
+TopWindowListenerMultiplexer& VCLXTopWindow::GetTopWindowListenersImpl()
+{
+    return VCLXContainer::GetTopWindowListeners();
+}
+
 // ::com::sun::star::uno::XInterface
 ::com::sun::star::uno::Any VCLXTopWindow::queryInterface( const ::com::sun::star::uno::Type & rType ) throw(::com::sun::star::uno::RuntimeException)
 {
@@ -167,104 +282,3 @@ VCLXTopWindow::~VCLXTopWindow()
         return (*pCollection).getTypes();
     }
 }
-
-::com::sun::star::uno::Any VCLXTopWindow::getWindowHandle( const ::com::sun::star::uno::Sequence< sal_Int8 >& /*ProcessId*/, sal_Int16 SystemType ) throw(::com::sun::star::uno::RuntimeException)
-{
-	::vos::OGuard aGuard( GetMutex() );
-
-	// TODO, check the process id
-	::com::sun::star::uno::Any aRet;
-	Window* pWindow = GetWindow();
-	if ( pWindow )
-	{
-		const SystemEnvData* pSysData = ((SystemWindow *)pWindow)->GetSystemData();
-		if( pSysData )
-		{
-#if (defined WNT)
-			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_WIN32 )
-			{
-				 aRet <<= (sal_Int32)pSysData->hWnd;
-			}
-#elif (defined OS2)
-			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_OS2 )
-			{
-				 aRet <<= (sal_Int32)pSysData->hWnd;
-			}
-#elif (defined QUARTZ)
-			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_MAC )
-			{
-				 aRet <<= (sal_IntPtr)pSysData->pView;
-			}
-#elif (defined UNX)
-			if( SystemType == ::com::sun::star::lang::SystemDependent::SYSTEM_XWINDOW )
-			{
-				::com::sun::star::awt::SystemDependentXWindow aSD;
-				aSD.DisplayPointer = sal::static_int_cast< sal_Int64 >(reinterpret_cast< sal_IntPtr >(pSysData->pDisplay));
-				aSD.WindowHandle = pSysData->aWindow;
-				aRet <<= aSD;
-			}
-#endif
-		}
-	}
-	return aRet;
-}
-
-
-void VCLXTopWindow::addTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException)
-{
-	::vos::OGuard aGuard( GetMutex() );
-
-	GetTopWindowListeners().addInterface( rxListener );
-}
-
-void VCLXTopWindow::removeTopWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTopWindowListener >& rxListener ) throw(::com::sun::star::uno::RuntimeException)
-{
-	::vos::OGuard aGuard( GetMutex() );
-
-	GetTopWindowListeners().removeInterface( rxListener );
-}
-
-void VCLXTopWindow::toFront(  ) throw(::com::sun::star::uno::RuntimeException)
-{
-	::vos::OGuard aGuard( GetMutex() );
-
-	Window* pWindow = GetWindow();
-	if ( pWindow )
-		((WorkWindow*)pWindow)->ToTop( TOTOP_RESTOREWHENMIN );
-}
-
-void VCLXTopWindow::toBack(  ) throw(::com::sun::star::uno::RuntimeException)
-{
-/* Not possible in VCL...
-
-	::vos::OGuard aGuard( GetMutex() );
-
-	Window* pWindow = GetWindow();
-	if ( pWindow )
-	{
-		((WorkWindow*)pWindow)->ToBack();
-	}
-*/
-}
-
-void VCLXTopWindow::setMenuBar( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar >& rxMenu ) throw(::com::sun::star::uno::RuntimeException)
-{
-	::vos::OGuard aGuard( GetMutex() );
-	
-	SystemWindow* pWindow = (SystemWindow*) GetWindow();
-	if ( pWindow )
-	{
-		pWindow->SetMenuBar( NULL );
-		if ( rxMenu.is() )
-		{
-			VCLXMenu* pMenu = VCLXMenu::GetImplementation( rxMenu );
-			if ( pMenu && !pMenu->IsPopupMenu() )
-				pWindow->SetMenuBar( (MenuBar*) pMenu->GetMenu() );
-		}
-	}
-	mxMenuBar = rxMenu;
-}
-
-
-
-
Index: toolkit/source/awt/vclxwindow.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxwindow.cxx,v
retrieving revision 1.89
retrieving revision 1.85.26.2
diff -p -u -u -p -b -w -B -r1.89 -r1.85.26.2
--- toolkit/source/awt/vclxwindow.cxx	17 Jul 2008 11:08:13 -0000	1.89
+++ toolkit/source/awt/vclxwindow.cxx	30 Jul 2008 12:29:07 -0000	1.85.26.2
@@ -45,6 +45,7 @@
 #include <com/sun/star/style/VerticalAlignment.hpp>
 #include <toolkit/awt/vclxwindow.hxx>
 #include <toolkit/awt/vclxpointer.hxx>
+#include <toolkit/awt/vclxwindows.hxx>
 #include <toolkit/helper/macros.hxx>
 #include <toolkit/helper/vclunohelper.hxx>
 #include <toolkit/helper/convert.hxx>
@@ -458,7 +459,8 @@ void VCLXWindowImpl::processEvent( const
             break;
         }
     }
-    else {
+    else
+    {
         DBG_ERROR( "VCLXWindowImpl::processEvent: what kind of event *is* this (3)?" );
     }
 }
@@ -2258,14 +2260,6 @@ void VCLXWindow::setProperty( const ::rt
 		WindowType nWinType = GetWindow()->GetType();
 		switch ( nWinType )
 		{
-			case WINDOW_MESSBOX:
-			case WINDOW_INFOBOX:
-			case WINDOW_WARNINGBOX:
-			case WINDOW_ERRORBOX:
-			case WINDOW_QUERYBOX:
-				aSz = Size( 250, 100 );
-			break;
-
 			case WINDOW_CONTROL:
 				aSz.Width() = GetWindow()->GetTextWidth( GetWindow()->GetText() )+2*12;
 				aSz.Height() = GetWindow()->GetTextHeight()+2*6;
@@ -2282,12 +2276,7 @@ void VCLXWindow::setProperty( const ::rt
 				aSz.Height() = GetWindow()->GetTextHeight()+2*2;
 			break;
 			case WINDOW_SCROLLBARBOX:
-			case WINDOW_SCROLLBAR:
-			{
-				long n = GetWindow()->GetSettings().GetStyleSettings().GetScrollBarSize();
-				aSz = Size( n, n );
-			}
-			break;
+                return VCLXScrollBar::implGetMinimumSize( GetWindow() );
 			default:
 				aSz = GetWindow()->GetOptimalSize( WINDOWSIZE_MINIMUM );
 		}
Index: toolkit/source/awt/vclxwindows.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxwindows.cxx,v
retrieving revision 1.68
retrieving revision 1.67.26.2
diff -p -u -u -p -b -w -B -r1.68 -r1.67.26.2
--- toolkit/source/awt/vclxwindows.cxx	11 Apr 2008 09:22:58 -0000	1.68
+++ toolkit/source/awt/vclxwindows.cxx	30 Jul 2008 12:29:07 -0000	1.67.26.2
@@ -2127,7 +2127,11 @@ sal_Int16 VCLXMessageBox::execute() thro
 	return pBox ? pBox->Execute() : 0;
 }
 
-
+::com::sun::star::awt::Size SAL_CALL VCLXMessageBox::getMinimumSize() throw(::com::sun::star::uno::RuntimeException)
+{
+    ::vos::OGuard aGuard( GetMutex() );
+    return ::com::sun::star::awt::Size( 250, 100 );
+}
 
 //	----------------------------------------------------
 //	class VCLXDialog
@@ -3276,6 +3280,19 @@ void VCLXScrollBar::ProcessWindowEvent( 
 	}
 }
 
+::com::sun::star::awt::Size SAL_CALL VCLXScrollBar::implGetMinimumSize( Window* p ) throw(::com::sun::star::uno::RuntimeException)
+{
+    long n = p->GetSettings().GetStyleSettings().GetScrollBarSize();
+    return ::com::sun::star::awt::Size( n, n );
+}
+
+::com::sun::star::awt::Size SAL_CALL VCLXScrollBar::getMinimumSize() throw(::com::sun::star::uno::RuntimeException)
+{
+	::vos::OGuard aGuard( GetMutex() );
+    return implGetMinimumSize( GetWindow() );
+}
+
+
 //	----------------------------------------------------
 //	class VCLXEdit
 //	----------------------------------------------------
Index: toolkit/source/helper/registerservices.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/helper/registerservices.cxx,v
retrieving revision 1.19
retrieving revision 1.18.26.2
diff -p -u -u -p -b -w -B -r1.19 -r1.18.26.2
--- toolkit/source/helper/registerservices.cxx	11 Apr 2008 09:37:15 -0000	1.19
+++ toolkit/source/helper/registerservices.cxx	30 Jul 2008 12:36:13 -0000	1.18.26.2
@@ -205,6 +205,8 @@ extern ::com::sun::star::uno::Reference<
 extern sal_Bool SAL_CALL comp_AsyncCallback_component_writeInfo( void * serviceManager, void * registryKey );
 extern void * SAL_CALL comp_AsyncCallback_component_getFactory( const char * implName, void * serviceManager, void * registryKey );
 
+extern sal_Bool SAL_CALL comp_Layout_component_writeInfo( void * serviceManager, void * registryKey );
+extern void * SAL_CALL comp_Layout_component_getFactory( const char * implName, void * serviceManager, void * registryKey );
 
 extern "C"
 {
@@ -285,7 +287,9 @@ TOOLKIT_DLLPUBLIC sal_Bool SAL_CALL comp
 		registerServices( xRegistryKey, "UnoThrobberControl", szServiceName_UnoThrobberControl );
         registerServices( xRegistryKey, "UnoFixedHyperlinkControl", szServiceName_UnoControlFixedHyperlink );
         registerServices( xRegistryKey, "UnoControlFixedHyperlinkModel", szServiceName_UnoControlFixedHyperlinkModel );
+
         comp_AsyncCallback_component_writeInfo( _pServiceManager, _pRegistryKey );
+        comp_Layout_component_writeInfo( _pServiceManager, _pRegistryKey );
 
         return sal_True;
 	}
@@ -368,6 +372,10 @@ TOOLKIT_DLLPUBLIC void* SAL_CALL compone
 
     	if ( rtl_str_compare( sImplementationName, "com.sun.star.awt.comp.AsyncCallback" ) == 0 )
             return comp_AsyncCallback_component_getFactory( sImplementationName, _pServiceManager, _pRegistryKey );
+
+
+		if( pRet == 0 )
+			pRet = comp_Layout_component_getFactory( sImplementationName, _pServiceManager, _pRegistryKey );
 	}
 	return pRet;
 }
Index: toolkit/source/layout/bin.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/bin.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/bin.cxx	6 Mar 2008 11:42:48 -0000	1.2
+++ toolkit/source/layout/bin.cxx	30 Jul 2008 11:13:46 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "bin.hxx"
 
 #include <sal/macros.h>
Index: toolkit/source/layout/bin.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/bin.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/bin.hxx	6 Mar 2008 11:43:00 -0000	1.2
+++ toolkit/source/layout/bin.hxx	30 Jul 2008 11:13:51 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 /* A few simple binary containers */
 
 #ifndef CORE_BIN_HXX
Index: toolkit/source/layout/box-base.cxx
===================================================================
RCS file: toolkit/source/layout/box-base.cxx
diff -N toolkit/source/layout/box-base.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ toolkit/source/layout/box-base.cxx	30 Jul 2008 11:13:57 -0000	1.1.2.2
@@ -0,0 +1,170 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include "box.hxx"
+
+#include <tools/debug.hxx>
+#include <sal/macros.h>
+
+#include <com/sun/star/awt/XWindow2.hpp>
+
+// fixed point precision for distributing error
+#define FIXED_PT 16
+
+namespace layoutimpl
+{
+
+using namespace css;
+
+Box_Base::ChildData::ChildData( uno::Reference< awt::XLayoutConstrains > const& xChild )
+    : mxChild( xChild )
+    , mxProps()
+    , maRequisition()
+{
+}
+
+static bool isVisible( uno::Reference< awt::XLayoutConstrains > xWidget )
+{
+    if ( !xWidget.is() )
+    {
+        DBG_ERROR( "FIXME: invalid child !" );
+        return true;
+    }
+
+    uno::Reference< awt::XWindow2 > xWindow( xWidget, uno::UNO_QUERY );
+    if ( xWindow.is() && !xWindow->isVisible() )
+        return false;
+
+    uno::Reference< awt::XLayoutContainer > xContainer( xWidget, uno::UNO_QUERY );
+    if ( xContainer.is() )
+    {
+        uno::Sequence< uno::Reference< awt::XLayoutConstrains > > aChildren
+            = xContainer->getChildren();
+
+        // FIXME: <flow> workaround: empty visible containers always visible:
+        if ( !aChildren.getLength() )
+            return true;
+
+        for ( int i = 0; i < aChildren.getLength(); i++ )
+            if ( isVisible( aChildren[i] ) )
+                return true;
+        return false; // this would kill flow without workaround above
+    }
+
+    return true;
+}
+    
+bool Box_Base::ChildData::isVisible()
+{
+    // FIXME: call the 'isVisible' method on it ?
+    return layoutimpl::isVisible( mxChild );
+}
+
+void SAL_CALL
+Box_Base::addChild( const uno::Reference< awt::XLayoutConstrains >& xChild )
+    throw (uno::RuntimeException, awt::MaxChildrenException)
+{
+    if ( xChild.is() )
+    {
+        ChildData *pData = createChild( xChild );
+        maChildren.push_back( pData );
+        setChildParent( xChild );
+        queueResize();
+    }
+}
+
+Box_Base::ChildData*
+Box_Base::removeChildData( std::list< ChildData* > lst, css::uno::Reference< css::awt::XLayoutConstrains > const& xChild )
+{
+    for ( std::list< ChildData* >::iterator it = lst.begin();
+          it != lst.end(); it++ )
+    {
+        if ( (*it)->mxChild == xChild )
+        {
+            lst.erase( it );
+            return *it;
+        }
+    }
+    return 0;
+}
+
+void SAL_CALL
+Box_Base::removeChild( const uno::Reference< awt::XLayoutConstrains >& xChild )
+    throw (uno::RuntimeException)
+{
+    if ( ChildData* p = removeChildData( maChildren, xChild ) )
+    {
+        delete p;
+        unsetChildParent( xChild );
+        queueResize();
+    }
+    else
+    {
+        DBG_ERROR( "Box_Base: removeChild: no such child" );
+    }
+}
+
+uno::Sequence< uno::Reference < awt::XLayoutConstrains > > SAL_CALL
+Box_Base::getChildren()
+    throw (uno::RuntimeException)
+{
+    uno::Sequence< uno::Reference< awt::XLayoutConstrains > > children( maChildren.size() );
+    unsigned int index = 0;
+    for ( std::list< ChildData* >::iterator it = maChildren.begin();
+          it != maChildren.end(); it++, index++ )
+        children[index] = ( *it )->mxChild;
+
+    return children;
+}
+
+uno::Reference< beans::XPropertySet > SAL_CALL
+Box_Base::getChildProperties( const uno::Reference< awt::XLayoutConstrains >& xChild )
+    throw (uno::RuntimeException)
+{
+    
+    for ( std::list< ChildData * >::iterator it = maChildren.begin();
+          it != maChildren.end(); it++)
+    {
+        if ( ( *it )->mxChild == xChild )
+        {
+            if ( !( *it )->mxProps.is() )
+            {
+                PropHelper *pProps = createChildProps( *it );
+                pProps->setChangeListener( this );
+                ( *it )->mxProps = pProps;
+            }
+            return (*it)->mxProps;
+        }
+    }
+    return uno::Reference< beans::XPropertySet >();
+}
+
+} // namespace layoutimpl
Index: toolkit/source/layout/box-base.hxx
===================================================================
RCS file: toolkit/source/layout/box-base.hxx
diff -N toolkit/source/layout/box-base.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ toolkit/source/layout/box-base.hxx	30 Jul 2008 11:14:02 -0000	1.1.2.3
@@ -0,0 +1,90 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef CORE_BOX_BASE_HXX
+#define CORE_BOX_BASE_HXX
+
+#include "container.hxx"
+
+#include <list>
+
+namespace layoutimpl
+{
+
+class Box_Base : public Container
+{
+public:
+    // Children properties
+    struct ChildData
+    {
+        css::uno::Reference< css::awt::XLayoutConstrains > mxChild;
+        css::uno::Reference< css::beans::XPropertySet > mxProps;
+        css::awt::Size maRequisition;
+        virtual bool isVisible();
+        
+        ChildData( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
+        virtual ~ChildData() { };
+    };
+
+    struct ChildProps: public PropHelper
+    {
+        //ChildProps( ChildProps* );
+        PROPHELPER_SET_INFO
+    };
+
+protected:
+    std::list< ChildData* > maChildren;
+
+
+    virtual ChildData *createChild( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild ) = 0;
+    virtual ChildProps *createChildProps( ChildData* pData ) = 0;
+    
+    ChildData *removeChildData( std::list< ChildData *>, css::uno::Reference< css::awt::XLayoutConstrains > const& Child );
+    
+public:
+    // css::awt::XLayoutContainer
+    virtual void SAL_CALL addChild( const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
+        throw (css::uno::RuntimeException, css::awt::MaxChildrenException);
+    virtual void SAL_CALL removeChild( const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
+        throw (css::uno::RuntimeException);
+
+    virtual css::uno::Sequence< css::uno::Reference
+                                < css::awt::XLayoutConstrains > > SAL_CALL getChildren()
+        throw (css::uno::RuntimeException);
+    
+    virtual css::uno::Reference< css::beans::XPropertySet > SAL_CALL getChildProperties(
+        const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
+        throw (css::uno::RuntimeException);
+};
+
+} //  namespace layoutimpl
+
+#endif /* CORE_BOX__BASE HXX */
Index: toolkit/source/layout/box.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/box.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/box.cxx	6 Mar 2008 11:43:11 -0000	1.2
+++ toolkit/source/layout/box.cxx	30 Jul 2008 11:14:08 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "box.hxx"
 
 #include <tools/debug.hxx>
@@ -11,36 +42,41 @@ namespace layoutimpl
 
 using namespace css;
 
-class BoxChildProps : public PropHelper
-{
-public:
-    BoxChildProps( Box::ChildData *pData )
+Box::ChildProps::ChildProps( Box::ChildData *pData )
     {
         addProp( RTL_CONSTASCII_USTRINGPARAM( "Expand" ),
                  ::getCppuType( static_cast< const sal_Bool* >( NULL ) ),
-                 &(pData->bExpand) );
+             &(pData->mbExpand) );
         addProp( RTL_CONSTASCII_USTRINGPARAM( "Fill" ),
                  ::getCppuType( static_cast< const sal_Bool* >( NULL ) ),
-                 &(pData->bFill) );
+             &(pData->mbFill) );
         addProp( RTL_CONSTASCII_USTRINGPARAM( "Padding" ),
                  ::getCppuType( static_cast< const sal_Int32* >( NULL ) ),
-                 &(pData->nPadding) );
+             &(pData->mnPadding) );
     }
-    PROPHELPER_SET_INFO
-};
 
-bool Box::ChildData::isVisible()
+Box::ChildData::ChildData( uno::Reference< awt::XLayoutConstrains > const& xChild )
+    : Box_Base::ChildData( xChild )
+    , mnPadding( 0 )
+    , mbExpand( true )
+    , mbFill( true )
 {
-    // FIXME: call the 'isVisible' method on it ?
-    if ( !xChild.is() )
+}
+
+Box::ChildData*
+Box::createChild( uno::Reference< awt::XLayoutConstrains > const& xChild )
     {
-        DBG_ERROR( "FIXME: invalid child !" );
+    return new ChildData( xChild );
     }
-    return xChild.is();
+
+Box::ChildProps*
+Box::createChildProps( Box_Base::ChildData *pData )
+{
+    return new ChildProps( static_cast<Box::ChildData*> ( pData ) );
 }
 
 Box::Box( bool horizontal )
-    : Container()
+    : Box_Base()
     , mnSpacing( 0 )
     , mbHomogeneous( false )
     , mbHorizontal( horizontal )
@@ -54,119 +90,28 @@ Box::Box( bool horizontal )
     mbHasFlowChildren = false;
 }
 
-Box::ChildData *
-Box::createChild( uno::Reference< awt::XLayoutConstrains > const& xChild )
-{
-    ChildData *p = new ChildData();
-
-    p->nPadding = 0;
-    p->bExpand = true;
-    p->bFill = true;
-    p->xChild = xChild;
-    return p;
-}
-
-void SAL_CALL
-Box::addChild( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw (uno::RuntimeException, awt::MaxChildrenException)
-{
-    if ( xChild.is() )
-    {
-        ChildData *pData = createChild( xChild );
-        maChildren.push_back( pData );
-        setChildParent( xChild );
-        queueResize();
-    }
-}
-
-Box::ChildData *
-Box::removeChildData( std::list< ChildData *> lst, css::uno::Reference< css::awt::XLayoutConstrains > const& xChild )
-{
-    for( std::list< ChildData * >::iterator it = lst.begin();
-         it != lst.end(); it++ )
-    {
-        if ( (*it)->xChild == xChild )
-        {
-            lst.erase( it );
-            return *it;
-        }
-    }
-    return 0;
-}
-
-void SAL_CALL
-Box::removeChild( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw (uno::RuntimeException)
-{
-    if ( ChildData *p = removeChildData( maChildren, xChild ) )
-    {
-        // CHECK: BoxChildProps leaks?
-        delete p;
-        unsetChildParent( xChild );
-        queueResize();
-    }
-    else
-    {
-        DBG_ERROR( "Box: removeChild: no such child" );
-    }
-}
-
-uno::Sequence< uno::Reference < awt::XLayoutConstrains > > SAL_CALL
-Box::getChildren()
-    throw (uno::RuntimeException)
-{
-    uno::Sequence< uno::Reference< awt::XLayoutConstrains > > children( maChildren.size() );
-    unsigned int i = 0;
-    for( std::list< ChildData * >::iterator it = maChildren.begin();
-         it != maChildren.end(); it++, i++ )
-        children[i] = (*it)->xChild;
-
-    return children;
-}
-
-uno::Reference< beans::XPropertySet > SAL_CALL
-Box::getChildProperties( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw (uno::RuntimeException)
-{
-    std::list< ChildData * >::iterator iter;
-    for( iter = maChildren.begin(); iter != maChildren.end(); iter++)
-    {
-        if ( (*iter)->xChild == xChild )
-        {
-            if ( !(*iter)->xProps.is() )
-            {
-                // FIXME: make me safe !
-                PropHelper *pProps = new BoxChildProps( *iter );
-                pProps->setChangeListener( this );
-                (*iter)->xProps = pProps;
-            }
-            return (*iter)->xProps;
-        }
-    }
-    return uno::Reference< beans::XPropertySet >();
-}
-
 awt::Size
 Box::calculateSize( long nWidth )
 {
     int nVisibleChildren = 0;
     // primary vs secundary axis (instead of a X and Y)
-    int nPrimSize = 0, nSecSize = 0;
+    int nPrimSize = 0;
+    int nSecSize = 0;
     int nFlowMinWidth = 0;  // in case the box only has flow children
 
     mbHasFlowChildren = false;
 
-    std::list<ChildData *>::const_iterator it;
-    for( it = maChildren.begin(); it != maChildren.end(); it++ )
+    for ( std::list<Box_Base::ChildData *>::const_iterator it
+              = maChildren.begin(); it != maChildren.end(); it++ )
     {
-        ChildData *child = *it;
+        ChildData *child = static_cast<Box::ChildData*> ( *it );
         if ( !child->isVisible() )
             continue;
 
-        uno::Reference< awt::XLayoutContainer > xChildCont( child->xChild, uno::UNO_QUERY );
+        uno::Reference< awt::XLayoutContainer > xChildCont( child->mxChild, uno::UNO_QUERY );
         bool bFlow = xChildCont.is() && xChildCont->hasHeightForWidth();
 
-        awt::Size aChildSize = child->aRequisition = child->xChild->getMinimumSize();
+        awt::Size aChildSize = child->maRequisition = child->mxChild->getMinimumSize();
 
         if ( !mbHorizontal /*vertical*/ && bFlow )
         {
@@ -176,7 +121,7 @@ Box::calculateSize( long nWidth )
         }
         else
         {
-            int size = primDim( aChildSize ) + child->nPadding * 2;
+            int size = primDim( aChildSize ) + child->mnPadding * 2;
             if ( mbHomogeneous )
                 nPrimSize = SAL_MAX( nPrimSize, size );
             else
@@ -198,13 +143,14 @@ Box::calculateSize( long nWidth )
     {
         if ( nWidth == 0 )
             nWidth = nSecSize ? nSecSize : nFlowMinWidth;
-        for( it = maChildren.begin(); it != maChildren.end(); it++ )
+        for ( std::list<Box_Base::ChildData *>::const_iterator it
+                  = maChildren.begin(); it != maChildren.end(); it++ )
         {
-            ChildData *child = *it;
+            ChildData *child = static_cast<Box::ChildData*> ( *it );
             if ( !child->isVisible() )
                 continue;
 
-            uno::Reference< awt::XLayoutContainer > xChildCont( child->xChild, uno::UNO_QUERY );
+            uno::Reference< awt::XLayoutContainer > xChildCont( child->mxChild, uno::UNO_QUERY );
             bool bFlow = xChildCont.is() && xChildCont->hasHeightForWidth();
 
             if ( bFlow )
@@ -248,14 +194,14 @@ Box::allocateArea( const awt::Rectangle 
     maAllocation = newArea;
     int nVisibleChildren = 0, nExpandChildren = 0;
 
-    std::list<ChildData *>::const_iterator it;
-    for( it = maChildren.begin(); it != maChildren.end(); it++ )
+    for ( std::list<Box_Base::ChildData *>::const_iterator it
+              = maChildren.begin(); it != maChildren.end(); it++ )
     {
-        ChildData *child = *it;
+        ChildData *child = static_cast<Box::ChildData*> ( *it );
         if ( child->isVisible() )
         {
             nVisibleChildren++;
-            if ( child->bExpand )
+            if ( child->mbExpand )
                 nExpandChildren++;
         }
     }
@@ -285,9 +231,10 @@ Box::allocateArea( const awt::Rectangle 
     int nStartPoint = primDim( newPoint ) + mnBorderWidth;
     int nBoxSecSize = SAL_MAX( 1, secDim( newSize ) - mnBorderWidth * 2 );
 
-    for( it = maChildren.begin(); it != maChildren.end(); it++ )
+    for ( std::list<Box_Base::ChildData *>::const_iterator it
+              = maChildren.begin(); it != maChildren.end(); it++ )
     {
-        ChildData *child = *it;
+        ChildData *child = static_cast<Box::ChildData*> ( *it );
         if ( !child->isVisible() )
             continue;
 
@@ -298,26 +245,26 @@ Box::allocateArea( const awt::Rectangle 
             nBoxPrimSize = nExtraSpace;
         else
         {
-            uno::Reference< awt::XLayoutContainer > xChildCont( child->xChild, uno::UNO_QUERY );
+            uno::Reference< awt::XLayoutContainer > xChildCont( child->mxChild, uno::UNO_QUERY );
             bool bFlow = xChildCont.is() && xChildCont->hasHeightForWidth();
             if ( !mbHorizontal && bFlow )
                 nBoxPrimSize = xChildCont->getHeightForWidth( newArea.Width );
             else
-                nBoxPrimSize = primDim( child->aRequisition );
-            nBoxPrimSize += child->nPadding;
-            if ( child->bExpand )
+                nBoxPrimSize = primDim( child->maRequisition );
+            nBoxPrimSize += child->mnPadding;
+            if ( child->mbExpand )
                 nBoxPrimSize += nExtraSpace;
         }
 
-        nChildPrimPoint = nStartPoint + child->nPadding;
+        nChildPrimPoint = nStartPoint + child->mnPadding;
         nChildSecPoint = secDim( newPoint ) + mnBorderWidth;
 
         nChildSecSize = nBoxSecSize;
-        if ( child->bFill )
-            nChildPrimSize = SAL_MAX( 1, nBoxPrimSize - child->nPadding);
+        if ( child->mbFill )
+            nChildPrimSize = SAL_MAX( 1, nBoxPrimSize - child->mnPadding);
         else
         {
-            nChildPrimSize = primDim( child->aRequisition );
+            nChildPrimSize = primDim( child->maRequisition );
             nChildPrimPoint += (nBoxPrimSize - nChildPrimSize) / 2;
 
             nChildSecPoint += (nBoxSecSize - nChildSecSize) / 2;
@@ -329,9 +276,9 @@ Box::allocateArea( const awt::Rectangle 
         area.Width = mbHorizontal ? nChildPrimSize : nChildSecSize;
         area.Height = mbHorizontal ? nChildSecSize : nChildPrimSize;
 
-        allocateChildAt( child->xChild, area );
+        allocateChildAt( child->mxChild, area );
 
-        nStartPoint += nBoxPrimSize + mnSpacing + child->nPadding;
+        nStartPoint += nBoxPrimSize + mnSpacing + child->mnPadding;
     }
 }
 
Index: toolkit/source/layout/box.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/box.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/box.hxx	6 Mar 2008 11:43:24 -0000	1.2
+++ toolkit/source/layout/box.hxx	30 Jul 2008 11:14:15 -0000	1.2.6.3
@@ -1,57 +1,74 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_BOX_HXX
 #define CORE_BOX_HXX
 
-#include "container.hxx"
+#include "box-base.hxx"
 
 #include <com/sun/star/awt/Point.hpp>
 
-#include <list>
-
 namespace layoutimpl
 {
 
-class Box : public Container
+class Box : public Box_Base
 {
-    friend class BoxChildProps;
 protected:
     // Box properties (i.e. affect all children)
     sal_Int32 mnSpacing;
     sal_Bool mbHomogeneous;
     sal_Bool mbHorizontal;  // false for Vertical
+    bool mbHasFlowChildren;
 
+public:
     // Children properties
-    struct ChildData
+    struct ChildData : public Box_Base::ChildData
     {
-      sal_Int32 nPadding;
-      sal_Bool  bExpand, bFill;
-      css::awt::Size aRequisition;
-      css::uno::Reference< css::awt::XLayoutConstrains > xChild;
-      css::uno::Reference< css::beans::XPropertySet > xProps;
-      bool isVisible();
+        sal_Int32 mnPadding;
+        sal_Bool mbExpand;
+        sal_Bool mbFill;
+        ChildData( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
     };
-    std::list< ChildData * > maChildren;
-    bool mbHasFlowChildren;
-
-public:
-    Box( bool horizontal );
-
-    static ChildData *createChild( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
 
-    ChildData *removeChildData( std::list< ChildData *>, css::uno::Reference< css::awt::XLayoutConstrains > const& Child );
-
-    // css::awt::XLayoutContainer
-    virtual void SAL_CALL addChild( const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
-        throw (css::uno::RuntimeException, css::awt::MaxChildrenException);
-    virtual void SAL_CALL removeChild( const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
-        throw (css::uno::RuntimeException);
+    struct ChildProps : public Box_Base::ChildProps
+    {
+        ChildProps( ChildData *pData );
+    };
 
-    virtual css::uno::Sequence< css::uno::Reference
-                < css::awt::XLayoutConstrains > > SAL_CALL getChildren()
-        throw (css::uno::RuntimeException);
+protected:
+    ChildData *createChild( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
+    ChildProps *createChildProps( Box_Base::ChildData* pData );
 
-    virtual css::uno::Reference< css::beans::XPropertySet > SAL_CALL getChildProperties(
-        const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
-        throw (css::uno::RuntimeException);
+public:
+    Box( bool horizontal );
 
     virtual void SAL_CALL allocateArea( const css::awt::Rectangle &rArea )
         throw (css::uno::RuntimeException);
Index: toolkit/source/layout/byteseq.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/byteseq.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.6
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.6
--- toolkit/source/layout/byteseq.cxx	11 Apr 2008 09:39:39 -0000	1.3
+++ toolkit/source/layout/byteseq.cxx	30 Jul 2008 12:36:16 -0000	1.2.6.6
@@ -28,43 +28,52 @@
  *
  ************************************************************************/
 
-/* We do not link to xmlscript, because that would introduce an extra
-   toolkit dependency.  */
-#include <xml_helper/xml_byteseq.cxx>
-
-#include <stdio.h>
 #include <com/sun/star/io/XInputStream.hpp>
-#include <com/sun/star/lang/XMultiServiceFactory.hpp>
+#include <osl/file.hxx>
+#include <comphelper/oslfile2streamwrap.hxx>
+
+using osl::File;
+using osl::FileBase;
+using namespace ::com::sun::star;
 
 namespace layoutimpl
 {
 
-uno::Reference< io::XInputStream >
-getFileAsStream( const uno::Reference< lang::XMultiServiceFactory > &xFactory,
-                 const rtl::OUString &rName );
-
-uno::Reference< io::XInputStream >
-getFileAsStream( const uno::Reference< lang::XMultiServiceFactory > & /* xFactory */,
-                 const rtl::OUString &rName )
+uno::Reference< io::XInputStream > getFileAsStream( const rtl::OUString &rName )
 {
-    rtl::OString fname = rtl::OUStringToOString( rName, RTL_TEXTENCODING_UTF8 );
-    // create the input stream
-    FILE *f = ::fopen( fname, "rb" );
-    if (f)
+    rtl::OUString sFileURL;
+    if( FileBase::E_None != FileBase::getFileURLFromSystemPath( rName, sFileURL ) )
+        sFileURL = rName; // maybe it already was a file url
+
+    File * blobFile = new File(sFileURL);
+    File::RC errorCode = blobFile->open(OpenFlag_Read);
+
+    uno::Reference<io::XInputStream> xResult;
+    switch (errorCode)
     {
-        ::fseek( f, 0 ,SEEK_END );
-        int nLength = ::ftell( f );
-        ::fseek( f, 0, SEEK_SET );
-
-        ByteSequence bytes( nLength );
-        ::fread( bytes.getArray(), nLength, 1, f );
-        ::fclose( f );
+    case osl::File::E_None: // got it
+        xResult.set( new comphelper::OSLInputStreamWrapper(blobFile,true) );
+        break;
+
+    case osl::File::E_NOENT: // no file => no stream
+        delete blobFile;
+        break;
+
+    default:
+        delete blobFile;
+/*            {
+            rtl::OUStringBuffer sMsg;
+            sMsg.appendAscii("Cannot open output file \"");
+            sMsg.append(aURL);
+            sMsg.appendAscii("\" : ");
+            sMsg.append(configmgr::FileHelper::createOSLErrorString(errorCode));
 
-        return new xmlscript::BSeqInputStream( bytes );
+            throw io::IOException(sMsg.makeStringAndClear(),NULL);
+        }   
+*/
     }
 
-    throw Exception( OUString( RTL_CONSTASCII_USTRINGPARAM("### Cannot read file!") ),
-                     Reference< XInterface >() );
+    return xResult;
 }
 
 } // namespace layoutimpl
Index: toolkit/source/layout/container.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/container.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/container.cxx	6 Mar 2008 11:43:57 -0000	1.2
+++ toolkit/source/layout/container.cxx	30 Jul 2008 11:14:20 -0000	1.2.6.3
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "container.hxx"
 
 #include <com/sun/star/awt/XWindow.hpp>
@@ -126,13 +157,8 @@ Container::getLabel()  // debug label
 
 void Container::propertiesChanged()
 {
-    if ( !mxParent.is() )
-    {
-        DBG_ERROR( "Properties listener: error container doesn't have parent" );
-    }
-
-    // ask parent to be re-calculated
-// FIXME: thats wrongg actually. We just need to do a "queueResize();"
+    // cl: why this assertion? This is also called to set properties at the top level widget which has no parent!?
+    // DBG_ASSERT( mxParent.is(), "Properties listener: error container doesn't have parent" );
     
     if ( mxLayoutUnit.is() && mxParent.is() )
         mxLayoutUnit->queueResize( mxParent );
Index: toolkit/source/layout/container.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/container.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/container.hxx	6 Mar 2008 11:44:10 -0000	1.2
+++ toolkit/source/layout/container.hxx	30 Jul 2008 11:14:26 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_CONTAINER_HXX
 #define CORE_CONTAINER_HXX
 
Index: toolkit/source/layout/dialogbuttonhbox.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/dialogbuttonhbox.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/dialogbuttonhbox.cxx	6 Mar 2008 11:44:23 -0000	1.2
+++ toolkit/source/layout/dialogbuttonhbox.cxx	30 Jul 2008 11:14:31 -0000	1.2.6.3
@@ -1,11 +1,41 @@
-#include "dialogbuttonhbox.hxx"
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
 
+#include <awt/vclxbutton.hxx>
 #include <tools/debug.hxx>
 #include <toolkit/awt/vclxwindows.hxx>
 #include <vcl/button.hxx>
 
+#include "dialogbuttonhbox.hxx"
 #include "flow.hxx"
-#include "../awt/vclxbutton.hxx"
 #include "proplist.hxx"
 
 #if TEST_LAYOUT && !defined( DBG_UTIL )
@@ -26,7 +56,7 @@ using namespace css;
 //FIXME: how to set platform-dependant variables?
 DialogButtonHBox::Ordering const DialogButtonHBox::DEFAULT_ORDERING =
 #if defined( MACOSX )
-    DialogButtonHBox::MacOS;
+    DialogButtonHBox::MACOS;
 #elif defined( SAL_W32 )
 DialogButtonHBox::WINDOWS;
 #elif defined( ENABLE_KDE )
@@ -129,23 +159,23 @@ DialogButtonHBox::removeChild( uno::Refe
     if ( !xChild.is ())
         return;
 
-    ChildData *p = 0;
+    Box_Base::ChildData *p = 0;
 
-    if ( mpAction && mpAction->xChild == xChild )
+    if ( mpAction && mpAction->mxChild == xChild )
         p = mpAction;
-    else if ( mpAffirmative && mpAffirmative->xChild == xChild )
+    else if ( mpAffirmative && mpAffirmative->mxChild == xChild )
         p = mpAffirmative;
-    else if ( mpAlternate && mpAlternate->xChild == xChild )
+    else if ( mpAlternate && mpAlternate->mxChild == xChild )
         p = mpAlternate;
-    else if ( mpApply && mpApply->xChild == xChild )
+    else if ( mpApply && mpApply->mxChild == xChild )
         p = mpApply;
-    else if ( mpCancel && mpCancel->xChild == xChild )
+    else if ( mpCancel && mpCancel->mxChild == xChild )
         p = mpCancel;
-    else if ( mpFlow && mpFlow->xChild == xChild )
+    else if ( mpFlow && mpFlow->mxChild == xChild )
         p = mpFlow;
-    else if ( mpReset && mpReset->xChild == xChild )
+    else if ( mpReset && mpReset->mxChild == xChild )
         p = mpReset;
-    else if ( mpHelp && mpHelp->xChild == xChild )
+    else if ( mpHelp && mpHelp->mxChild == xChild )
         p = mpHelp;
     else
         p = removeChildData( maOther, xChild );
@@ -166,7 +196,7 @@ DialogButtonHBox::removeChild( uno::Refe
 void
 DialogButtonHBox::gnomeOrdering()
 {
-    std::list< ChildData * > ordered;
+    std::list< Box_Base::ChildData * > ordered;
     if ( mpHelp )
         ordered.push_back( mpHelp );
     if ( mpReset )
@@ -190,7 +220,7 @@ DialogButtonHBox::gnomeOrdering()
 void
 DialogButtonHBox::kdeOrdering()
 {
-    std::list< ChildData * > ordered;
+    std::list< Box_Base::ChildData * > ordered;
     if ( mpHelp )
         ordered.push_back( mpHelp );
     if ( mpReset )
@@ -214,7 +244,7 @@ DialogButtonHBox::kdeOrdering()
 void
 DialogButtonHBox::macosOrdering()
 {
-    std::list< ChildData * > ordered;
+    std::list< Box_Base::ChildData * > ordered;
     if ( mpHelp )
         ordered.push_back( mpHelp );
     if ( mpReset )
@@ -240,7 +270,7 @@ DialogButtonHBox::macosOrdering()
 void
 DialogButtonHBox::windowsOrdering()
 {
-    std::list< ChildData * > ordered;
+    std::list< Box_Base::ChildData * > ordered;
     if ( mpReset )
         ordered.push_back( mpReset );
     if ( mpReset && mpFlow )
Index: toolkit/source/layout/dialogbuttonhbox.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/dialogbuttonhbox.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/dialogbuttonhbox.hxx	6 Mar 2008 11:44:34 -0000	1.2
+++ toolkit/source/layout/dialogbuttonhbox.hxx	30 Jul 2008 11:14:36 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_DIALOGBUTTONHBOX_HXX
 #define CORE_DIALOGBUTTONHBOX_HXX
 
@@ -38,7 +69,7 @@ private:
     ChildData *mpHelp;
     ChildData *mpReset;
 
-    std::list< ChildData *> maOther;
+    std::list< Box_Base::ChildData *> maOther;
 };
 
 } // namespace layoutimpl
Index: toolkit/source/layout/factory.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/factory.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/factory.cxx	6 Mar 2008 11:44:46 -0000	1.2
+++ toolkit/source/layout/factory.cxx	30 Jul 2008 11:14:42 -0000	1.2.6.3
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "factory.hxx"
 
 #include <com/sun/star/registry/XRegistryKey.hpp>
@@ -9,17 +40,7 @@
 using namespace ::com::sun::star;
 using namespace layoutimpl;
 
-extern "C"
-{
-
-    TOOLKIT_DLLPUBLIC void 
-    SAL_CALL component_getImplementationEnvironment( const sal_Char ** ppEnvTypeName, uno_Environment ** /*ppEnv*/ )
-    {
-        *ppEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME;
-    }
-
-    TOOLKIT_DLLPUBLIC void * SAL_CALL
-    component_getFactory( const sal_Char * pImplName, void * pServiceManager, void * /*pRegistryKey*/ )
+void * SAL_CALL comp_Layout_component_getFactory( const char * pImplName, void * pServiceManager, void * /*registryKey*/ )
     {
         void * pRet = 0;
 
@@ -40,8 +61,7 @@ extern "C"
         return pRet;
     }
 
-    TOOLKIT_DLLPUBLIC sal_Bool SAL_CALL
-    component_writeInfo( void * /*pServiceManager*/, void * pRegistryKey )
+sal_Bool SAL_CALL comp_Layout_component_writeInfo( void * /*serviceManager*/, void * pRegistryKey )
     {
         if ( pRegistryKey )
         {
@@ -61,13 +81,13 @@ extern "C"
                 return sal_True;
             }
             catch (registry::InvalidRegistryException &)
-            {   OSL_ENSURE( sal_False, "### InvalidRegistryException!" );   }
+        {
+            OSL_ENSURE( sal_False, "### InvalidRegistryException!" );
+        }
         }
         return sal_False;
     }
 
-} // extern "C"
-
 // Component registration
 ::rtl::OUString SAL_CALL LayoutFactory::impl_staticGetImplementationName()
 {
Index: toolkit/source/layout/factory.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/factory.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/factory.hxx	6 Mar 2008 11:44:57 -0000	1.2
+++ toolkit/source/layout/factory.hxx	30 Jul 2008 11:14:47 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef FACTORY_HXX_
 #define FACTORY_HXX_
 
Index: toolkit/source/layout/flow.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/flow.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/flow.cxx	6 Mar 2008 11:45:11 -0000	1.2
+++ toolkit/source/layout/flow.cxx	30 Jul 2008 11:14:53 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "flow.hxx"
 
 #include <sal/macros.h>
Index: toolkit/source/layout/flow.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/flow.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/flow.hxx	6 Mar 2008 11:45:24 -0000	1.2
+++ toolkit/source/layout/flow.hxx	30 Jul 2008 11:14:58 -0000	1.2.6.3
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_FLOW_HXX
 #define CORE_FLOW_HXX
 
@@ -15,6 +46,7 @@ protected:
     sal_Int32 mnSpacing;
     sal_Bool mbHomogeneous;
 
+public:
     // Children properties
     struct ChildData
     {
@@ -23,6 +55,8 @@ protected:
         css::uno::Reference< css::beans::XPropertySet >    xProps;
         bool isVisible();
     };
+
+protected:
     std::list< ChildData * > maChildren;
     long mnEachWidth;  // on homogeneous, the width of every child
 
Index: toolkit/source/layout/helper.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/helper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.5
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.5
--- toolkit/source/layout/helper.cxx	6 Mar 2008 11:45:38 -0000	1.2
+++ toolkit/source/layout/helper.cxx	30 Jul 2008 11:15:04 -0000	1.2.6.5
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "helper.hxx"
 
 #include <assert.h>
@@ -8,7 +39,7 @@
 #include <tools/debug.hxx>
 
 #include "proplist.hxx"
-#include "layoutcore.hxx"
+#include "layout/layoutcore.hxx"
 
 #if TEST_LAYOUT && !defined( DBG_UTIL )
 #include <stdio.h>
@@ -143,6 +174,7 @@ createToolkitWidget( uno::Reference< awt
     uno::Reference< awt::XWindowPeer > xWinPeer;
     try
     {
+//        DBG_ERROR1("Asking toolkit: %s\n", OUSTRING_CSTR( desc.WindowServiceName ) );
         xWinPeer = xToolkit->createWindow( desc );
         if ( !xWinPeer.is() )
             throw uno::RuntimeException(
@@ -150,9 +182,9 @@ createToolkitWidget( uno::Reference< awt
                 uno::Reference< uno::XInterface >() );
         xPeer = uno::Reference< awt::XLayoutConstrains >( xWinPeer, uno::UNO_QUERY );
     }
-    catch( uno::Exception &ex )
+    catch( uno::Exception & )
     {
-        DBG_ERROR1( "Warning:  %s is not a recognized type", OUSTRING_CSTR( rName ) );
+        DBG_ERROR1( "Warning: %s is not a recognized type\n", OUSTRING_CSTR( rName ) );
         return uno::Reference< awt::XLayoutConstrains >();
     }
 
@@ -182,10 +214,6 @@ createWidget( uno::Reference< awt::XTool
     if ( xPeer.is() )
         return xPeer;
 
-    xPeer = createInternalWidget( xToolkit, xParent, rName, nProps );
-    if ( xPeer.is() )
-        return xPeer;
-
 #if FIXED_INFO
     OUString tName = rName;
     // FIXME
@@ -314,19 +342,23 @@ PropHelper::queryInterface( const ::com:
 
 } // namespace layoutimpl
 
-#include "../awt/vclxdialog.hxx"
-#include "../awt/vclxfixedline.hxx"
-#include "../awt/vclxproxy.hxx"
-#include "../awt/vclxscroller.hxx"
-#include "../awt/vclxsplitter.hxx"
-#include "../awt/vclxtabcontrol.hxx"
+#include <awt/vclxbutton.hxx>
+#include <awt/vclxdialog.hxx>
+#include <awt/vclxfixedline.hxx>
+#include <awt/vclxscroller.hxx>
+#include <awt/vclxsplitter.hxx>
+#include <awt/vclxtabcontrol.hxx>
 #include <toolkit/awt/vclxtoolkit.hxx>
 #include <toolkit/awt/vclxwindow.hxx>
+#include <vcl/button.hxx>
 #include <vcl/dialog.hxx>
 #include <vcl/fixed.hxx>
 #include <vcl/tabctrl.hxx>
 #include <vcl/tabpage.hxx>
 
+
+///#include <svtools/prgsbar.hxx>
+
 namespace layoutimpl
 {
 
@@ -346,10 +378,7 @@ uno::Reference< awt::XLayoutConstrains >
     if ( aName.equalsAscii( "dialog" ) )
     {
         if ( pParent == NULL )
-            // DIALOG_NO_PARENT == 0xffff
-            // it would crash otherwise
-// FIXME: check for crash
-            pParent = DIALOG_NO_PARENT; /*DIALOG_NO_PARENT == 0xffff ?! :P*/
+            pParent = DIALOG_NO_PARENT;
         pNewWindow = new Dialog( pParent,
                                  ImplGetWinBits( WindowAttributes, 0 ) );
         pNewComp = new layoutimpl::VCLXDialog();
@@ -394,6 +423,61 @@ uno::Reference< awt::XLayoutConstrains >
         pNewWindow = new FixedLine( pParent, nStyle );
         pNewComp = new layoutimpl::VCLXFixedLine();
     }
+    else if ( aName.equalsAscii( "okbutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXOKButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "cancelbutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXCancelButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "yesbutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXYesButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "nobutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXNoButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "retrybutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXRetryButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "ignorebutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXIgnoreButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "resetbutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXResetButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "applybutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXApplyButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "helpbutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXHelpButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "morebutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXMoreButton( pNewWindow );
+    }
+    else if ( aName.equalsAscii( "advancedbutton" ) )
+    {
+        pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        pNewComp = new layoutimpl::VCLXAdvancedButton( pNewWindow );
+    }
 
     if ( !pNewWindow )
         return xRef;
Index: toolkit/source/layout/helper.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/helper.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.4
--- toolkit/source/layout/helper.hxx	6 Mar 2008 11:45:51 -0000	1.2
+++ toolkit/source/layout/helper.hxx	30 Jul 2008 11:15:10 -0000	1.2.6.4
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef HELPER_HXX
 #define HELPER_HXX
 
@@ -62,6 +93,7 @@ public:
         throw(css::lang::IllegalArgumentException);
     virtual void SAL_CALL setFastPropertyValue_NoBroadcast( sal_Int32 nHandle,
                                                             const css::uno::Any& rValue ) throw (css::uno::Exception);
+    using OPropertySetHelper::getFastPropertyValue;
     virtual void SAL_CALL getFastPropertyValue( css::uno::Any& rValue,
                                                 sal_Int32 nHandle ) const;
 
Index: toolkit/source/layout/import.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/import.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/import.cxx	6 Mar 2008 11:46:13 -0000	1.2
+++ toolkit/source/layout/import.cxx	30 Jul 2008 11:15:17 -0000	1.2.6.3
@@ -1,13 +1,48 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "import.hxx"
 
 #include <com/sun/star/awt/XButton.hpp>
 #include <com/sun/star/awt/XDialog2.hpp>
+#include <vcl/image.hxx>
 #include <tools/debug.hxx>
 
 #include "root.hxx"
 #include "helper.hxx"
 #include "dialogbuttonhbox.hxx"
 
+// Hmm...
+#include "layout/layout.hxx"
+#include "layout/layoutcore.hxx"
 
 #define XMLNS_LAYOUT_URI    "http://openoffice.org/2007/layout"
 #define XMLNS_CONTAINER_URI "http://openoffice.org/2007/layout/container"
@@ -71,14 +106,21 @@ SAL_THROW (())
         DBG_ERROR( "Fatal error: top node isn't a dialog" );
     }
 
-    bool bOrdering;
+#if 0
+    // Hack moved to proplist.cxx
+    OUString aGraphic;
+    if ( findAndRemove( "graphic", aProps, aGraphic ) )
+        //if ( layout::FixedImage *i = dynamic_cast<layout::FixedImage *> ( mpWidget->getPeer().get() ) )
+        // FIXME: huh? XImageProducer::complete( XImageConsumer )
+        //i->setImage( Image( loadGraphic( OUSTRING_CSTR( aGraphic ) ) ) );
+        mpWidget->setProperty( OUString::createFromAscii( "graphic" ),
+                               loadGraphic( OUSTRING_CSTR( aGraphic ) ) );
+#endif
+
     OUString aOrdering;
-    bOrdering = findAndRemove( "ordering", aProps, aOrdering );
+    if ( findAndRemove( "ordering", aProps, aOrdering ) )
     if ( DialogButtonHBox *b = dynamic_cast<DialogButtonHBox *> ( mpWidget->getPeer().get() ) )
-    {
-        if ( bOrdering )
             b->setOrdering ( aOrdering );
-    }
 
 #ifdef IMPORT_RADIOGROUP
     bool bSetRadioGroup, bSetTitle;
@@ -201,7 +243,6 @@ uno::Reference< xml::input::XElement > I
         throw xml::sax::SAXException(
             OUString( RTL_CONSTASCII_USTRINGPARAM( "invalid namespace!" ) ),
             uno::Reference< uno::XInterface >(), uno::Any() );
-    else
         return new ToplevelElement( rLocalName, xAttributes, this );
 }
 
Index: toolkit/source/layout/import.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/import.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/import.hxx	6 Mar 2008 11:46:38 -0000	1.2
+++ toolkit/source/layout/import.hxx	30 Jul 2008 11:15:22 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef IMPORT_HXX
 #define IMPORT_HXX
 
@@ -87,7 +118,8 @@ private:
             {
                 mxSelectedRadio->setState( false );
                 // the only radio button selected would be the one that fired the event
-                for( RadioButtonsList::iterator it = mxRadios.begin(); it != mxRadios.end(); it++ )
+                for ( RadioButtonsList::iterator it = mxRadios.begin();
+                      it != mxRadios.end(); it++ )
                     if ( (*it)->getState() )
                     {
                         mxSelectedRadio = *it;
Index: toolkit/source/layout/makefile.mk
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/makefile.mk,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/makefile.mk	6 Mar 2008 11:46:52 -0000	1.2
+++ toolkit/source/layout/makefile.mk	30 Jul 2008 11:15:28 -0000	1.2.6.3
@@ -1,39 +1,52 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile$
+#
+# $Revision$
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
 PRJ=..$/..
 PRJNAME=toolkit
 TARGET=layoutcore
 ENABLE_EXCEPTIONS=true
-TARGETTYPE=GUI
+
+# --- Settings -----------------------------------------------------
 
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
-.IF "$(ENABLE_LAYOUT)" == "TRUE"
+# --- Files --------------------------------------------------------
 
-.IF "$(COMNAME)" == "gcc3"
-CFLAGS+=-I../$(PRJ)/xmlscript/source
-CFLAGS+=-Wall -Wno-non-virtual-dtor
-.ENDIF
-
-##CFLAGS += -DENABLE_LAYOUT=1
-
-CXXFILES= \
-	bin.cxx \
-	box.cxx \
-	byteseq.cxx \
-	container.cxx \
-	dialogbuttonhbox.cxx \
-	factory.cxx \
-	flow.cxx \
-	helper.cxx \
-	import.cxx \
-	proplist.cxx \
-	root.cxx \
-	table.cxx \
-	timer.cxx \
-	translate.cxx
+# FIXME: This is bad, hmkay
+CFLAGS+= -I$(PRJ)/source
 
 SLOFILES= \
 	$(SLO)$/bin.obj \
+	$(SLO)$/box-base.obj \
 	$(SLO)$/box.obj \
 	$(SLO)$/byteseq.obj \
 	$(SLO)$/container.obj \
@@ -48,6 +61,6 @@ SLOFILES= \
 	$(SLO)$/timer.obj \
 	$(SLO)$/translate.obj
 
-.ENDIF # ENABLE_LAYOUT == "TRUE"
+# --- Targets ------------------------------------------------------
 
 .INCLUDE : target.mk
Index: toolkit/source/layout/precompiled_xmlscript.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/precompiled_xmlscript.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/precompiled_xmlscript.hxx	6 Mar 2008 11:47:03 -0000	1.2
+++ toolkit/source/layout/precompiled_xmlscript.hxx	30 Jul 2008 11:15:34 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 /*
   xmlscript/source/xml_helper/xml_byteseq.cxx compile helper.
 
Index: toolkit/source/layout/proplist.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/proplist.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.4
--- toolkit/source/layout/proplist.cxx	6 Mar 2008 11:47:20 -0000	1.2
+++ toolkit/source/layout/proplist.cxx	30 Jul 2008 11:15:40 -0000	1.2.6.4
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "proplist.hxx"
 
 #include <rtl/ustrbuf.hxx>
@@ -8,6 +39,8 @@
 #include <com/sun/star/awt/VclWindowPeerAttribute.hpp>
 #include <tools/debug.hxx>
 
+#include "layout/layoutcore.hxx"
+
 #if TEST_LAYOUT && !defined( DBG_UTIL )
 #include <stdio.h>
 #undef DBG_ERROR
@@ -85,8 +118,14 @@ getProperty( const uno::Reference< uno::
 
 /* Given a string and a type, it converts the string to the type, and returns
    it encapsulated in Any. */
-uno::Any anyFromString( const OUString &value, const uno::Type &type )
+uno::Any anyFromString( OUString const& value, uno::Type const& type )
 {
+    sal_Int16 radix = 10;
+    OUString intval = value;
+    if ( value.getLength() > 2 && value[0] == '0' && value[1] == 'x' )
+        intval = value.copy( 2 ), radix = 16;
+    else if ( value.getLength() > 1 && value[0] == '#' )
+        intval = value.copy( 1 ), radix = 16;
     switch ( type.getTypeClass() )
     {
         case uno::TypeClass_CHAR:
@@ -98,21 +137,21 @@ uno::Any anyFromString( const OUString &
                 return uno::makeAny( false );
             break;  // ends switch, throws exception
         case uno::TypeClass_BYTE:
-            return uno::makeAny( ( sal_uInt8 ) value.toInt32() );
+            return uno::makeAny( ( sal_uInt8 ) intval.toInt32( radix ) );
         case uno::TypeClass_SHORT:
-            return uno::makeAny( ( sal_Int16 ) value.toInt32() );
+            return uno::makeAny( ( sal_Int16 ) intval.toInt32( radix ) );
         case uno::TypeClass_UNSIGNED_SHORT:
-            return uno::makeAny( ( sal_uInt16 ) value.toInt32() );
+            return uno::makeAny( ( sal_uInt16 ) intval.toInt32( radix ) );
         case uno::TypeClass_ENUM:
-            return uno::makeAny( ( sal_Int16 ) value.toInt32() );
+            return uno::makeAny( ( sal_Int16 ) intval.toInt32( radix ) );
         case uno::TypeClass_LONG:
-            return uno::makeAny( ( sal_Int32 ) value.toInt32() );
+            return uno::makeAny( ( sal_Int32 ) intval.toInt32( radix ) );
         case uno::TypeClass_UNSIGNED_LONG:
-            return uno::makeAny( ( sal_uInt32 ) value.toInt32() );
+            return uno::makeAny( ( sal_uInt32 ) intval.toInt32( radix ) );
         case uno::TypeClass_HYPER:
-            return uno::makeAny( ( sal_Int64 ) value.toInt64() );
+            return uno::makeAny( ( sal_Int64 ) intval.toInt64( radix ) );
         case uno::TypeClass_UNSIGNED_HYPER:
-            return uno::makeAny( ( sal_uInt16 ) value.toInt64() );
+            return uno::makeAny( ( sal_uInt16 ) intval.toInt64( radix ) );
         case uno::TypeClass_FLOAT:
             return uno::makeAny( value.toFloat() );
         case uno::TypeClass_DOUBLE:
@@ -120,9 +159,9 @@ uno::Any anyFromString( const OUString &
         case uno::TypeClass_STRING:
             return uno::makeAny( value );
         case uno::TypeClass_CONSTANT:
-            if ( value.getLength() > 2 && value[0] == '0' && value[1] == 'x' )
-                return uno::makeAny( value.copy( 2 ).toInt32( 16 ) );
-            return uno::makeAny( value.toInt32() );
+            return uno::makeAny( intval.toInt32( radix ) );
+        case uno::TypeClass_INTERFACE:
+            return uno::makeAny( loadGraphic( OUSTRING_CSTR( value ) ) );
         case uno::TypeClass_SEQUENCE:
         {
             sal_Int32 i = 0;
@@ -163,10 +202,9 @@ uno::Any anyFromString( const OUString &
 
             return uno::makeAny( seq );
         }
-        break;
 
         default:
-            DBG_ERROR1( "ERROR: unknown property type of value: `%s'", OUSTRING_CSTR( value ) );
+            DBG_ERROR1( "ERROR: unknown property type of value: `%s'\n", OUSTRING_CSTR( value ) );
             break;
     }
     throw uno::RuntimeException();
@@ -212,7 +250,7 @@ setProperties( uno::Reference< uno::XInt
 {
     if ( !prophlp::canHandleProps( xPeer ) )
     {
-        DBG_ERROR( "Error: setProperties - bad handle ignoring props:" );
+        DBG_ERROR( "Error: setProperties - bad handle ignoring props:\n" );
         PropList::const_iterator cur;
         for( cur = rProps.begin(); cur != rProps.end(); cur++ )
         {
@@ -233,6 +271,7 @@ setProperty( uno::Reference< uno::XInter
 {
     OUString unoAttr = toUnoNaming( attr );
 
+    OSL_TRACE( "setting %s=%s\n", OUSTRING_CSTR( attr ), OUSTRING_CSTR( value ) );
     // get a Property object
     beans::Property prop;
     try
@@ -241,15 +280,15 @@ setProperty( uno::Reference< uno::XInter
             = prophlp::queryPropertyInfo( xPeer );
         prop = xInfo->getPropertyByName( unoAttr );
     }
-    catch( beans::UnknownPropertyException &ex )
+    catch( beans::UnknownPropertyException & )
     {
-        DBG_ERROR1( "Warning: unknown attribute: `%s'", OUSTRING_CSTR( unoAttr ) );
+        DBG_ERROR1( "Warning: unknown attribute: `%s'\n", OUSTRING_CSTR( unoAttr ) );
         return;
     }
 
     if ( prop.Name.getLength() <= 0 )
     {
-        DBG_ERROR1( "Warning: missing prop: `%s'", OUSTRING_CSTR( unoAttr ) );
+        DBG_ERROR1( "Warning: missing prop: `%s'\n", OUSTRING_CSTR( unoAttr ) );
         return;
     }
 
@@ -259,9 +298,9 @@ setProperty( uno::Reference< uno::XInter
     {
         any = anyFromString( value, prop.Type );
     }
-    catch( uno::RuntimeException &ex )
+    catch( uno::RuntimeException & )
     {
-        DBG_ERROR5( "Warning: %s( %s )( %s ) attribute is of type %s( rejected: %s )", OUSTRING_CSTR( unoAttr ), OUSTRING_CSTR( value ), OUSTRING_CSTR( prop.Name ),  OUSTRING_CSTR( prop.Type.getTypeName() ), OUSTRING_CSTR( value ) );
+        DBG_ERROR5( "Warning: %s( %s )( %s ) attribute is of type %s( rejected: %s )\n", OUSTRING_CSTR( unoAttr ), OUSTRING_CSTR( value ), OUSTRING_CSTR( prop.Name ),  OUSTRING_CSTR( prop.Type.getTypeName() ), OUSTRING_CSTR( value ) );
         return;
     }
 
@@ -272,7 +311,7 @@ setProperty( uno::Reference< uno::XInter
     }
     catch( ... )
     {
-        DBG_ERROR2( "Warning: cannot set attribute %s to %s ", OUSTRING_CSTR( unoAttr ), OUSTRING_CSTR( value ) );
+        DBG_ERROR2( "Warning: cannot set attribute %s to %s \n", OUSTRING_CSTR( unoAttr ), OUSTRING_CSTR( value ) );
     }
 }
 
@@ -301,8 +340,7 @@ static const AttributesMap attribsMap[] 
     { "left",         awt::VclWindowPeerAttribute::LEFT,         false },
     { "moveable",     awt::WindowAttribute::MOVEABLE,            true },
     { "noborder",     awt::VclWindowPeerAttribute::NOBORDER,     false },
-// Comment-out for <= m237
-//    { "nolabel",      awt::VclWindowPeerAttribute::NOLABEL,      false },
+    { "nolabel",      awt::VclWindowPeerAttribute::NOLABEL,      false },
     { "optimumsize",  awt::WindowAttribute::OPTIMUMSIZE,         false },
     { "readonly",     awt::VclWindowPeerAttribute::READONLY,     false },
     { "right",        awt::VclWindowPeerAttribute::RIGHT,        false },
Index: toolkit/source/layout/proplist.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/proplist.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/proplist.hxx	6 Mar 2008 11:47:31 -0000	1.2
+++ toolkit/source/layout/proplist.hxx	30 Jul 2008 11:15:46 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_PROPLIST_HXX
 #define CORE_PROPLIST_HXX
 
Index: toolkit/source/layout/root.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/root.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.8
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.8
--- toolkit/source/layout/root.cxx	6 Mar 2008 11:47:44 -0000	1.2
+++ toolkit/source/layout/root.cxx	30 Jul 2008 11:15:53 -0000	1.2.6.8
@@ -1,6 +1,45 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "root.hxx"
 
 #include <assert.h>
+#include <stdio.h>
+
+#include <com/sun/star/awt/WindowAttribute.hpp>
+#include <com/sun/star/awt/XMessageBox.hpp>
+#include <com/sun/star/awt/MessageBoxButtons.hpp>
+#include <com/sun/star/frame/XDesktop.hpp>
+#include <com/sun/star/awt/XMessageBoxFactory.hpp>
+#include <com/sun/star/xml/sax/SAXParseException.hpp>
 #include <com/sun/star/xml/sax/XParser.hpp>
 
 #include "helper.hxx"
@@ -42,6 +82,37 @@ LayoutRoot::~LayoutRoot()
     }
 }
 
+void ShowMessageBox( uno::Reference< lang::XMultiServiceFactory > const& xFactory, uno::Reference< awt::XToolkit > xToolkit, OUString const& aTitle, OUString const& aMessage )
+{
+    uno::Reference< uno::XInterface > iDesktop = xFactory->createInstance
+        ( OUString::createFromAscii( "com.sun.star.frame.Desktop" ) );
+    uno::Reference< frame::XDesktop > xDesktop ( iDesktop, uno::UNO_QUERY );
+    uno::Reference< frame::XFrame > xFrame ( xDesktop->getCurrentFrame() );
+    uno::Reference< awt::XWindow > xContainerWindow( xFrame->getContainerWindow() );
+    uno::Reference< awt::XWindowPeer > xWindowPeer( xContainerWindow, uno::UNO_QUERY_THROW );
+    uno::Reference< awt::XMessageBoxFactory > xMessageBoxFactory( xToolkit, uno::UNO_QUERY );
+
+    awt::Rectangle aRectangle;
+    uno::Reference< awt::XMessageBox > xMessageBox
+        = xMessageBoxFactory->createMessageBox
+        ( xWindowPeer, aRectangle, OUString::createFromAscii( "errorbox" ),
+          awt::MessageBoxButtons::BUTTONS_OK, aTitle, aMessage );
+
+    if ( xMessageBox.is() )
+        xMessageBox->execute();
+    //FIXME: exceptions not caught and printed at top level??
+    //else
+    printf( "%s\n", OUSTRING_CSTR( aMessage ) );
+}
+
+void LayoutRoot::error( OUString const& message )
+{
+    ShowMessageBox( mxFactory, mxToolkit,
+                    OUString::createFromAscii( "Fatal error" ),
+                    message );
+    throw uno::RuntimeException( message, uno::Reference< uno::XInterface >() );
+}
+
 // XInitialization
 void SAL_CALL LayoutRoot::initialize( const uno::Sequence< uno::Any >& aArguments )
     throw ( uno::Exception,
@@ -66,36 +137,36 @@ void SAL_CALL LayoutRoot::initialize( co
 
     uno::Reference< xml::sax::XParser > xParser
         ( mxFactory->createInstance(
-            OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.xml.sax.Parser" ) ) ),
+            OUString::createFromAscii( "com.sun.star.xml.sax.Parser" ) ),
           uno::UNO_QUERY );
     OSL_ASSERT( xParser.is() );
     if (! xParser.is())
     {
         throw uno::RuntimeException(
-            OUString( RTL_CONSTASCII_USTRINGPARAM( "cannot create sax-parser component" ) ),
+            OUString::createFromAscii( "cannot create sax-parser component" ),
             uno::Reference< uno::XInterface >() );
     }
 
-    OUString aXMLFile = readRightTranslation( aXMLName );
-
-    uno::Reference< io::XInputStream > xStream = getFileAsStream( mxFactory,
-                                                                  aXMLFile );
-
-    // error handler, entity resolver omitted
-
     // FIXME: quite possibly we want to pass this in ...
     uno::Reference< awt::XToolkit > xToolkit;
 
     mxToolkit = uno::Reference< awt::XToolkit >(
         mxFactory->createInstance(
-            OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.awt.Toolkit" ) ) ),
+            OUString::createFromAscii( "com.sun.star.awt.Toolkit" ) ),
         uno::UNO_QUERY );
 
     if ( !mxToolkit.is() )
         throw uno::RuntimeException(
-            OUString( RTL_CONSTASCII_USTRINGPARAM( "failed to create toolkit!" ) ),
+            OUString::createFromAscii( "failed to create toolkit!" ),
             uno::Reference< uno::XInterface >() );
 
+    OUString aXMLFile = readRightTranslation( aXMLName );
+    uno::Reference< io::XInputStream > xStream = getFileAsStream( aXMLFile );
+    if (! xStream.is() )
+        error( OUString::createFromAscii( "Installation problem: cannot find XML file:" ) + aXMLName );
+
+    // error handler, entity resolver omitted
+
     ImportContext *pCtx = new ImportContext( *this );
 
     uno::Reference< xml::input::XRoot > xRoot( pCtx );
@@ -103,17 +174,31 @@ void SAL_CALL LayoutRoot::initialize( co
     aArgs[0] <<= xRoot;
     uno::Reference< xml::sax::XDocumentHandler > xDocHandler
         (mxFactory->createInstanceWithArguments
-         ( OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.xml.input.SaxDocumentHandler" ) ),
+         ( OUString::createFromAscii( "com.sun.star.xml.input.SaxDocumentHandler" ),
           aArgs ), uno::UNO_QUERY );
 
+    if (! xDocHandler.is() )
+        error( OUString::createFromAscii( "cannot find SAx handler for document type of:") + aXMLName );
+        
     xParser->setDocumentHandler( xDocHandler );
 
     xml::sax::InputSource source;
     source.aInputStream = xStream;
-    source.sSystemId = OUString( RTL_CONSTASCII_USTRINGPARAM( "virtual file" ) );
+    source.sSystemId = OUString::createFromAscii( "virtual file" );
 
+    try
+    {
     xParser->parseStream( source );
 }
+    catch ( xml::sax::SAXParseException& e )
+    {
+        OUString c = OUString::createFromAscii( ":" );
+        error( aXMLName
+               + c + OUString::valueOf( e.LineNumber )
+               + c + OUString::valueOf( e.ColumnNumber )
+               + c + OUString::createFromAscii( "Sax parse error" ) );
+    }
+}
 
 // XLayoutContainer
 uno::Reference< awt::XLayoutContainer > LayoutRoot::getLayoutContainer() throw (uno::RuntimeException)
@@ -249,7 +334,7 @@ LayoutWidget *LayoutRoot::create( OUStri
     return pWidget;
 }
 
-/*
+#if 0
   uno::Reference< awt::XLayoutConstrains > LayoutRoot::getToplevel()
   {
   if ( mpToplevel )
@@ -265,7 +350,7 @@ LayoutWidget *LayoutRoot::create( OUStri
   rRef = i->second;
   return rRef;
   }
-*/
+#endif
 
 LayoutWidget::LayoutWidget( uno::Reference< awt::XToolkit > xToolkit,
                             uno::Reference< awt::XLayoutContainer > xParent,
Index: toolkit/source/layout/root.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/root.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.5
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.5
--- toolkit/source/layout/root.hxx	6 Mar 2008 11:47:56 -0000	1.2
+++ toolkit/source/layout/root.hxx	30 Jul 2008 11:15:59 -0000	1.2.6.5
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_ROOT_HXX
 #define CORE_ROOT_HXX
 
@@ -11,6 +42,7 @@
 #include <com/sun/star/lang/XInitialization.hpp>
 #include <cppuhelper/implbase3.hxx>
 #include <cppuhelper/interfacecontainer.h>
+#include <toolkit/dllapi.h>
 
 #include "proplist.hxx"
 
@@ -19,9 +51,7 @@ namespace layoutimpl
 
 namespace css = ::com::sun::star;
 
-css::uno::Reference< css::io::XInputStream >
-getFileAsStream( const css::uno::Reference< css::lang::XMultiServiceFactory > &xFactory,
-                 const rtl::OUString &rName );
+css::uno::Reference< css::io::XInputStream > getFileAsStream( const rtl::OUString &rName );
 
 /* Interface generation code -- to hook to a parser. */
 
@@ -37,7 +67,7 @@ getFileAsStream( const css::uno::Referen
 
 class LayoutWidget;
 
-class LayoutRoot : public ::cppu::WeakImplHelper3<
+class TOOLKIT_DLLPUBLIC LayoutRoot : public ::cppu::WeakImplHelper3<
     css::awt::XLayoutRoot,
     css::lang::XInitialization,
     css::lang::XComponent>
@@ -61,6 +91,8 @@ protected:
     LayoutWidget *mpToplevel;
     css::uno::Reference< css::awt::XLayoutUnit > mxLayoutUnit;
 
+    void error( rtl::OUString const& message );
+
 public:
     LayoutRoot( const css::uno::Reference< css::lang::XMultiServiceFactory >& xFactory );
     virtual ~LayoutRoot();
@@ -74,7 +106,7 @@ public:
     }
 
     // get XLayoutContainer
-    virtual css::uno::Reference< css::awt::XLayoutContainer > getLayoutContainer() throw (css::uno::RuntimeException);
+    virtual css::uno::Reference< css::awt::XLayoutContainer > SAL_CALL getLayoutContainer() throw (css::uno::RuntimeException);
 
     // XInitialization
     virtual void SAL_CALL initialize( const css::uno::Sequence< css::uno::Any >& aArguments ) throw (css::uno::Exception, css::uno::RuntimeException);
@@ -95,7 +127,7 @@ public:
     virtual LayoutWidget *create( rtl::OUString id, const rtl::OUString unoName, long attrbs, css::uno::Reference< css::awt::XLayoutContainer > xParent );
 };
 
-class LayoutWidget
+class TOOLKIT_DLLPUBLIC LayoutWidget
 {
     friend class LayoutRoot;
 
Index: toolkit/source/layout/table.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/table.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/table.cxx	6 Mar 2008 11:48:10 -0000	1.2
+++ toolkit/source/layout/table.cxx	30 Jul 2008 11:16:05 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include <table.hxx>
 
 #include <sal/macros.h>
@@ -15,117 +46,73 @@ namespace layoutimpl
 
 using namespace com::sun::star;
 
-class TableChildProps : public PropHelper
-{
-public:
-    TableChildProps( Table::ChildData *pData )
+Table::ChildProps::ChildProps( Table::ChildData *pData )
     {
         addProp( RTL_CONSTASCII_USTRINGPARAM( "XExpand" ),
                  ::getCppuType( static_cast< const sal_Bool* >( NULL ) ),
-                 &( pData->bExpand[ 0 ] ) );
+             &( pData->mbExpand[ 0 ] ) );
         addProp( RTL_CONSTASCII_USTRINGPARAM( "YExpand" ),
                  ::getCppuType( static_cast< const sal_Bool* >( NULL ) ),
-                 &( pData->bExpand[ 1 ] ) );
+             &( pData->mbExpand[ 1 ] ) );
         addProp( RTL_CONSTASCII_USTRINGPARAM( "ColSpan" ),
                  ::getCppuType( static_cast< const sal_Int32* >( NULL ) ),
-                 &( pData->nColSpan ) );
+             &( pData->mnColSpan ) );
         addProp( RTL_CONSTASCII_USTRINGPARAM( "RowSpan" ),
                  ::getCppuType( static_cast< const sal_Int32* >( NULL ) ),
-                 &( pData->nRowSpan ) );
+             &( pData->mnRowSpan ) );
     }
-    PROPHELPER_SET_INFO
-};
 
 bool Table::ChildData::isVisible()
 {
-    if ( !xChild.is() || nColSpan < 1 || nRowSpan < 1 )
-        return false;
-    return xChild.is();
+    return Box_Base::ChildData::isVisible()
+        && ( mnColSpan > 0 ) && ( mnRowSpan > 0 );
 }
 
 Table::Table()
-    : Container()
+    : Box_Base()
+    , mnColsLen( 1 )// another default value could be 0xffff for infinite columns( = 1 row )
 {
-    // another default value could be 0xffff for infinite columns( = 1 row )
-    mnColsLen = 1;
     addProp( RTL_CONSTASCII_USTRINGPARAM( "Columns" ),
              ::getCppuType( static_cast< const sal_Int32* >( NULL ) ),
              &mnColsLen );
 }
 
-void SAL_CALL
-Table::addChild( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw( uno::RuntimeException, awt::MaxChildrenException )
-{
-    if ( xChild.is() )
+Table::ChildData::ChildData( uno::Reference< awt::XLayoutConstrains > const& xChild )
+    : Box_Base::ChildData( xChild )
+//    , mbExpand( { 0, 1 } )
+    , mnColSpan( 1 )
+    , mnRowSpan( 1 )
+    , mnLeftCol( 0 )
+    , mnRightCol( 0 )
+    , mnTopRow( 0 )
+    , mnBottomRow( 0 )
     {
-        ChildData *pData = new ChildData();
-        pData->bExpand[ 0 ] = pData->bExpand[ 1 ] = true;
-        pData->nColSpan = pData->nRowSpan = 1;
-        pData->xChild = xChild;
-        maChildren.push_back( pData );
-
-        setChildParent( xChild );
-        queueResize();
-
-        // cause of flicker
-        allocateChildAt( xChild, awt::Rectangle( 0,0,0,0 ) );
-    }
+    mbExpand[ 0 ] = 0;
+    mbExpand[ 1 ] = 1;
 }
 
-void SAL_CALL
-Table::removeChild( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw( uno::RuntimeException )
-{
-    for( std::list< ChildData * >::iterator it = maChildren.begin();
-         it != maChildren.end(); it++ )
-    {
-        if ( ( *it )->xChild == xChild )
+Table::ChildData*
+Table::createChild( uno::Reference< awt::XLayoutConstrains > const& xChild )
         {
-            delete *it;
-            maChildren.erase( it );
-
-            unsetChildParent( xChild );
-            queueResize();
-            break;
-        }
-    }
-    DBG_ERROR( "Table error: trying to remove child that doesn't exist" );
+    return new ChildData( xChild );
 }
 
-uno::Sequence< uno::Reference < awt::XLayoutConstrains > > SAL_CALL
-Table::getChildren()
-    throw( uno::RuntimeException )
+Table::ChildProps*
+Table::createChildProps( Box_Base::ChildData *pData )
 {
-    uno::Sequence< uno::Reference< awt::XLayoutConstrains > > children( maChildren.size() );
-    unsigned int i = 0;
-    for( std::list< ChildData * >::iterator it = maChildren.begin();
-         it != maChildren.end(); it++, i++ )
-        children[i] =( *it )->xChild;
-
-    return children;
+    return new ChildProps( static_cast<Table::ChildData*> ( pData ) );
 }
 
-uno::Reference< beans::XPropertySet > SAL_CALL
-Table::getChildProperties( const uno::Reference< awt::XLayoutConstrains >& xChild )
-    throw( uno::RuntimeException )
-{
-    std::list< ChildData * >::iterator iter;
-    for( iter = maChildren.begin(); iter != maChildren.end(); iter++ )
-    {
-        if ( ( *iter )->xChild == xChild )
+void SAL_CALL
+Table::addChild( const uno::Reference< awt::XLayoutConstrains >& xChild )
+    throw( uno::RuntimeException, awt::MaxChildrenException )
         {
-            if ( !( *iter )->xProps.is() )
+    if ( xChild.is() )
             {
-                // FIXME: make me safe !
-                PropHelper *pProps = new TableChildProps( *iter );
-                pProps->setChangeListener( this );
-( *iter )->xProps = pProps;
-            }
-            return( *iter )->xProps;
-        }
+        Box_Base::addChild( xChild );
+        // cause of flicker
+        allocateChildAt( xChild, awt::Rectangle( 0,0,0,0 ) );
     }
-    return uno::Reference< beans::XPropertySet >();
 }
 
 awt::Size SAL_CALL
@@ -138,15 +125,16 @@ Table::getMinimumSize() throw( uno::Runt
         // temporary 1D representation of the table
         std::vector< ChildData *> aTable;
 
-        int col = 0, row = 0;
-        for( std::list<ChildData *>::iterator it = maChildren.begin();
-             it != maChildren.end(); it++ )
+        int col = 0;
+        int row = 0;
+        for ( std::list<Box_Base::ChildData *>::iterator it
+                  = maChildren.begin(); it != maChildren.end(); it++ )
         {
-            ChildData *child = *it;
+            ChildData *child = static_cast<Table::ChildData*> ( *it );
             if ( !child->isVisible() )
                 continue;
 
-            while ( col + SAL_MIN( child->nColSpan, mnColsLen ) > mnColsLen )
+            while ( col + SAL_MIN( child->mnColSpan, mnColsLen ) > mnColsLen )
             {
                 col = 0;
                 row++;
@@ -159,21 +147,21 @@ Table::getMinimumSize() throw( uno::Runt
                 row = i / mnColsLen;
             }
 
-            child->nLeftCol = col;
-            child->nRightCol = SAL_MIN( col + child->nColSpan, mnColsLen );
-            child->nTopRow = row;
-            child->nBottomRow = row + child->nRowSpan;
+            child->mnLeftCol = col;
+            child->mnRightCol = SAL_MIN( col + child->mnColSpan, mnColsLen );
+            child->mnTopRow = row;
+            child->mnBottomRow = row + child->mnRowSpan;
 
-            col += child->nColSpan;
+            col += child->mnColSpan;
 
-            unsigned int start = child->nLeftCol +( child->nTopRow*mnColsLen );
-            unsigned int end =( child->nRightCol-1 ) +( ( child->nBottomRow-1 )*mnColsLen );
+            unsigned int start = child->mnLeftCol +( child->mnTopRow*mnColsLen );
+            unsigned int end =( child->mnRightCol-1 ) +( ( child->mnBottomRow-1 )*mnColsLen );
             if ( aTable.size() < end+1 )
                 aTable.resize( end+1, NULL );
             for( unsigned int i = start; i < end; i++ )
                 aTable[ i ] = child;
 
-            nRowsLen = SAL_MAX( nRowsLen, child->nBottomRow );
+            nRowsLen = SAL_MAX( nRowsLen, child->mnBottomRow );
         }
     }
 
@@ -186,51 +174,52 @@ Table::getMinimumSize() throw( uno::Runt
         aGroup.resize( g == 0 ? mnColsLen : nRowsLen );
 
         // 2.1 base sizes on one-column/row children
-        for( std::list<ChildData *>::iterator it = maChildren.begin();
-             it != maChildren.end(); it++ )
+        for ( std::list<Box_Base::ChildData *>::iterator it
+                  = maChildren.begin(); it != maChildren.end(); it++ )
         {
-            ChildData *child = *it;
+            ChildData *child = static_cast<Table::ChildData*> ( *it );
             if ( !child->isVisible() )
                 continue;
-            const int nFirstAttach = g == 0 ? child->nLeftCol : child->nTopRow;
-            const int nLastAttach  = g == 0 ? child->nRightCol : child->nBottomRow;
+            const int nFirstAttach = g == 0 ? child->mnLeftCol : child->mnTopRow;
+            const int nLastAttach  = g == 0 ? child->mnRightCol : child->mnBottomRow;
 
             if ( nFirstAttach == nLastAttach-1 )
             {
-                child->aRequisition = child->xChild->getMinimumSize();
+                child->maRequisition = child->mxChild->getMinimumSize();
                 int attach = nFirstAttach;
-                int child_size = g == 0 ? child->aRequisition.Width
-                    : child->aRequisition.Height;
-                aGroup[ attach ].nSize = SAL_MAX( aGroup[ attach ].nSize, child_size );
-                if ( child->bExpand[ g ] )
-                    aGroup[ attach ].bExpand = true;
+                int child_size = g == 0 ? child->maRequisition.Width
+                    : child->maRequisition.Height;
+                aGroup[ attach ].mnSize = SAL_MAX( aGroup[ attach ].mnSize,
+                                                   child_size );
+                if ( child->mbExpand[ g ] )
+                    aGroup[ attach ].mbExpand = true;
             }
         }
 
         // 2.2 make sure multiple-columns/rows children fit
-        for( std::list<ChildData *>::iterator it = maChildren.begin();
-             it != maChildren.end(); it++ )
+        for ( std::list<Box_Base::ChildData *>::iterator it
+                  = maChildren.begin(); it != maChildren.end(); it++ )
         {
-            ChildData *child = *it;
+            ChildData *child = static_cast<Table::ChildData*> ( *it );
             if ( !child->isVisible() )
                 continue;
-            const int nFirstAttach = g == 0 ? child->nLeftCol : child->nTopRow;
-            const int nLastAttach  = g == 0 ? child->nRightCol : child->nBottomRow;
+            const int nFirstAttach = g == 0 ? child->mnLeftCol : child->mnTopRow;
+            const int nLastAttach  = g == 0 ? child->mnRightCol : child->mnBottomRow;
 
             if ( nFirstAttach != nLastAttach-1 )
             {
-                child->aRequisition = child->xChild->getMinimumSize();
+                child->maRequisition = child->mxChild->getMinimumSize();
                 int size = 0;
                 int expandables = 0;
                 for( int i = nFirstAttach; i < nLastAttach; i++ )
                 {
-                    size += aGroup[ i ].nSize;
-                    if ( aGroup[ i ].bExpand )
+                    size += aGroup[ i ].mnSize;
+                    if ( aGroup[ i ].mbExpand )
                         expandables++;
                 }
 
-                int child_size = g == 0 ? child->aRequisition.Width
-                    : child->aRequisition.Height;
+                int child_size = g == 0 ? child->maRequisition.Width
+                    : child->maRequisition.Height;
                 int extra = child_size - size;
                 if ( extra > 0 )
                 {
@@ -240,8 +229,8 @@ Table::getMinimumSize() throw( uno::Runt
                         extra /= nLastAttach - nFirstAttach;
 
                     for( int i = nFirstAttach; i < nLastAttach; i++ )
-                        if ( expandables == 0 || aGroup[ i ].bExpand )
-                            aGroup[ i ].nSize += extra;
+                        if ( expandables == 0 || aGroup[ i ].mbExpand )
+                            aGroup[ i ].mnSize += extra;
                 }
             }
         }
@@ -253,15 +242,15 @@ Table::getMinimumSize() throw( uno::Runt
     for( std::vector<GroupData>::iterator it = maCols.begin();
          it != maCols.end(); it++ )
     {
-        maRequisition.Width += it->nSize;
-        if ( it->bExpand )
+        maRequisition.Width += it->mnSize;
+        if ( it->mbExpand )
             mnColExpandables++;
     }
     for( std::vector<GroupData>::iterator it = maRows.begin();
          it != maRows.end(); it++ )
     {
-        maRequisition.Height += it->nSize;
-        if ( it->bExpand )
+        maRequisition.Height += it->mnSize;
+        if ( it->mbExpand )
             mnRowExpandables++;
     }
 
@@ -282,10 +271,10 @@ Table::allocateArea( const awt::Rectangl
     nExtraSize[ 0 ] /= mnColExpandables ? mnColExpandables : mnColsLen;
     nExtraSize[ 1 ] /= mnRowExpandables ? mnRowExpandables : maRows.size();
 
-    for( std::list<ChildData *>::const_iterator it = maChildren.begin();
-         it != maChildren.end(); it++ )
+    for ( std::list<Box_Base::ChildData *>::const_iterator it
+              = maChildren.begin(); it != maChildren.end(); it++ )
     {
-        ChildData *child = *it;
+        ChildData *child = static_cast<Table::ChildData*> ( *it );
         if ( !child->isVisible() )
             continue;
 
@@ -294,13 +283,13 @@ Table::allocateArea( const awt::Rectangl
         for( int g = 0; g < 2; g++ )
         {
             std::vector< GroupData > &aGroup = g == 0 ? maCols : maRows;
-            const int nFirstAttach = g == 0 ? child->nLeftCol : child->nTopRow;
-            const int nLastAttach  = g == 0 ? child->nRightCol : child->nBottomRow;
+            const int nFirstAttach = g == 0 ? child->mnLeftCol : child->mnTopRow;
+            const int nLastAttach  = g == 0 ? child->mnRightCol : child->mnBottomRow;
 
             for( int i = 0; i < nFirstAttach; i++ )
             {
-                int gSize = aGroup[ i ].nSize;
-                if ( aGroup[ i ].bExpand )
+                int gSize = aGroup[ i ].mnSize;
+                if ( aGroup[ i ].mbExpand )
                     gSize += nExtraSize[ g ];
                 if ( g == 0 )
                     rChildArea.X += gSize;
@@ -309,8 +298,8 @@ Table::allocateArea( const awt::Rectangl
             }
             for( int i = nFirstAttach; i < nLastAttach; i++ )
             {
-                int gSize = aGroup[ i ].nSize;
-                if ( aGroup[ i ].bExpand )
+                int gSize = aGroup[ i ].mnSize;
+                if ( aGroup[ i ].mbExpand )
                     gSize += nExtraSize[ g ];
                 if ( g == 0 )
                     rChildArea.Width  += gSize;
@@ -319,7 +308,7 @@ Table::allocateArea( const awt::Rectangl
             }
         }
 
-        allocateChildAt( child->xChild, rChildArea );
+        allocateChildAt( child->mxChild, rChildArea );
     }
 }
 
Index: toolkit/source/layout/table.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/table.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/layout/table.hxx	6 Mar 2008 11:48:23 -0000	1.2
+++ toolkit/source/layout/table.hxx	30 Jul 2008 11:16:10 -0000	1.2.6.3
@@ -1,61 +1,90 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef TABLE_HXX
 #define TABLE_HXX
 
-#include "container.hxx"
-
-#include <list>
+#include "box-base.hxx"
 
 namespace layoutimpl
 {
 
-class Table : public Container
+class Table : public Box_Base
 {
-    friend class TableChildProps;
-protected:
-    // Table properties
-    sal_Int32 mnColsLen;
-
+public:
     // Children properties
-    struct ChildData
+    struct ChildData : public Box_Base::ChildData
     {
-        sal_Bool  bExpand[ 2 ];
-        sal_Int32 nColSpan, nRowSpan;
-        css::awt::Size aRequisition;
-        css::uno::Reference< css::awt::XLayoutConstrains > xChild;
-        css::uno::Reference< css::beans::XPropertySet >    xProps;
+        sal_Bool mbExpand[ 2 ];
+        sal_Int32 mnColSpan;
+        sal_Int32 mnRowSpan;
+        int mnLeftCol;
+        int mnRightCol;
+        int mnTopRow;
+        int mnBottomRow;
+
+        ChildData( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
         bool isVisible();
+    };
 
-        // automatically calculated
-        int nLeftCol, nRightCol, nTopRow, nBottomRow;
+    struct ChildProps : public Box_Base::ChildProps
+    {
+        ChildProps( ChildData *pData );
     };
-    std::list< ChildData * > maChildren;
+
+protected:
 
     // a group of children; either a column or a row
     struct GroupData
     {
-        sal_Bool bExpand;
-        int nSize;  // request size (width or height)
-        GroupData() : bExpand( false ), nSize( 0 ) {}
+        sal_Bool mbExpand;
+        int mnSize;  // request size (width or height)
+        GroupData() : mbExpand( false ), mnSize( 0 ) {}
     };
-    std::vector< GroupData > maCols, maRows;
+
+    // Table properties
+    sal_Int32 mnColsLen;
+    std::vector< GroupData > maCols;
+    std::vector< GroupData > maRows;
     int mnColExpandables, mnRowExpandables;
 
+    ChildData *createChild( css::uno::Reference< css::awt::XLayoutConstrains > const& xChild );
+    ChildProps *createChildProps( Box_Base::ChildData* pData );
+
 public:
     Table();
 
     // css::awt::XLayoutContainer
     virtual void SAL_CALL addChild( const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
         throw (css::uno::RuntimeException, css::awt::MaxChildrenException);
-    virtual void SAL_CALL removeChild( const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
-        throw (css::uno::RuntimeException);
-
-    virtual css::uno::Sequence< css::uno::Reference
-                                < css::awt::XLayoutConstrains > > SAL_CALL getChildren()
-        throw (css::uno::RuntimeException);
-
-    virtual css::uno::Reference< css::beans::XPropertySet > SAL_CALL getChildProperties(
-        const css::uno::Reference< css::awt::XLayoutConstrains >& Child )
-        throw (css::uno::RuntimeException);
 
     virtual void SAL_CALL allocateArea( const css::awt::Rectangle &rArea )
         throw (css::uno::RuntimeException);
Index: toolkit/source/layout/timer.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/timer.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/timer.cxx	6 Mar 2008 11:48:36 -0000	1.2
+++ toolkit/source/layout/timer.cxx	30 Jul 2008 11:16:16 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "timer.hxx"
 
 #include <vector>
Index: toolkit/source/layout/timer.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/timer.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/timer.hxx	6 Mar 2008 11:48:47 -0000	1.2
+++ toolkit/source/layout/timer.hxx	30 Jul 2008 11:16:22 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_TIMER_HXX
 #define CORE_TIMER_HXX
 
Index: toolkit/source/layout/translate.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/translate.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.3
--- toolkit/source/layout/translate.cxx	9 Jun 2008 12:22:15 -0000	1.3
+++ toolkit/source/layout/translate.cxx	30 Jul 2008 12:36:19 -0000	1.2.6.3
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "translate.hxx"
 
 #include <list>
Index: toolkit/source/layout/translate.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/layout/translate.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/layout/translate.hxx	6 Mar 2008 11:49:12 -0000	1.2
+++ toolkit/source/layout/translate.hxx	30 Jul 2008 11:16:33 -0000	1.2.6.2
@@ -1,12 +1,44 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef CORE_TRANSLATE_HXX
 #define CORE_TRANSLATE_HXX
 
 namespace rtl {
 class OUString;
-}; // rtl
+} // namespace rtl
+
 namespace layoutimpl
 {
 ::rtl::OUString readRightTranslation( ::rtl::OUString const& aXMLName );
-}; // layoutimpl
+} // namespace layoutimpl
 
 #endif /* CORE_TRANSLATE_HXX */
Index: toolkit/source/vclcompat/makefile.mk
===================================================================
RCS file: /cvs/gsl/toolkit/source/vclcompat/makefile.mk,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/vclcompat/makefile.mk	6 Mar 2008 11:49:25 -0000	1.2
+++ toolkit/source/vclcompat/makefile.mk	30 Jul 2008 11:16:38 -0000	1.2.6.3
@@ -1,25 +1,48 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile$
+#
+# $Revision$
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
 PRJ=..$/..
 PRJNAME=toolkit
 TARGET=vclcompat
 ENABLE_EXCEPTIONS=true
-TARGETTYPE=GUI
+
+# --- Settings -----------------------------------------------------
 
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
-.IF "$(ENABLE_LAYOUT)" == "TRUE"
+# --- Files --------------------------------------------------------
 
-.IF "$(COMNAME)" == "gcc3"
-CFLAGS+=-Wall -Wno-non-virtual-dtor
-.ENDIF
-
-##CFLAGS += -DENABLE_LAYOUT
-
-CXXFILES= \
-	wrapper.cxx \
-	wbutton.cxx \
-	wcontainer.cxx \
-	wfield.cxx
+# FIXME: This is bad, hmkay
+CFLAGS+= -I$(PRJ)/source
 
 SLOFILES= \
 	$(SLO)$/wrapper.obj \
@@ -27,6 +50,6 @@ SLOFILES= \
 	$(SLO)$/wcontainer.obj \
 	$(SLO)$/wfield.obj
 
-.ENDIF # ENABLE_LAYOUT == "TRUE"
+# --- Targets ------------------------------------------------------
 
 .INCLUDE : target.mk
Index: toolkit/source/vclcompat/wbutton.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/vclcompat/wbutton.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.4
--- toolkit/source/vclcompat/wbutton.cxx	6 Mar 2008 11:49:41 -0000	1.2
+++ toolkit/source/vclcompat/wbutton.cxx	30 Jul 2008 11:16:45 -0000	1.2.6.4
@@ -1,11 +1,46 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "wrapper.hxx"
 
+#include <com/sun/star/awt/PosSize.hpp>
 #include <com/sun/star/awt/XActionListener.hpp>
 #include <com/sun/star/awt/XButton.hpp>
 #include <com/sun/star/awt/XCheckBox.hpp>
 #include <com/sun/star/awt/XRadioButton.hpp>
+#include <com/sun/star/graphic/XGraphic.hpp>
 #include <cppuhelper/implbase1.hxx>
 #include <toolkit/awt/vclxwindow.hxx>
+#include <toolkit/helper/convert.hxx>
+#include <vcl/button.hxx>
 #include <vcl/event.hxx>
 #include <vcl/msgbox.hxx>
 #include <vcl/svapp.hxx>
@@ -13,18 +48,40 @@
 
 #include <list>
 
-#include "layoutcore.hxx"
+#include "layout/layoutcore.hxx"
 
 using namespace ::com::sun::star;
 
 namespace layout
 {
 
-// Window/Control/Button
-//class TOOLKIT_DLLPUBLIC ButtonImpl : public ControlImpl,
-class ButtonImpl : public ControlImpl,
-                   public ::cppu::WeakImplHelper1< awt::XActionListener >,
-                   public ::cppu::WeakImplHelper1< awt::XItemListener >
+class ImageImpl
+{
+  public:
+    css::uno::Reference< css::graphic::XGraphic > mxGraphic;
+    ImageImpl( const char *pName )
+        : mxGraphic( layoutimpl::loadGraphic( pName ) )
+    {
+        if ( !mxGraphic.is() )
+        {
+            DBG_ERROR1( "ERROR: failed to load image: `%s'\n", pName );
+        }
+    }
+};
+
+Image::Image( const char *pName )
+    : pImpl( new ImageImpl( pName ) )
+{
+}
+
+Image::~Image()
+{
+    delete pImpl;
+}
+
+class ButtonImpl : public ControlImpl
+                 , public ::cppu::WeakImplHelper1< awt::XActionListener >
+                 , public ::cppu::WeakImplHelper1< awt::XItemListener >
 {
     Link maClickHdl;
   protected:
@@ -107,10 +164,9 @@ void Button::Click()
 {
 }
 
-DECL_GET_IMPL_IMPL( Button )
+DECL_GET_IMPL_IMPL( Button );
 DECL_CONSTRUCTOR_IMPLS( Button, Control, "button" );
 
-// Window/Control/Button/PushButton
 class PushButtonImpl : public ButtonImpl
 {
   public:
@@ -163,13 +219,12 @@ void PushButton::SetToggleHdl( const Lin
     getImpl().SetToggleHdl( rLink );
 }
 
-DECL_GET_IMPL_IMPL( PushButton )
+DECL_GET_IMPL_IMPL( PushButton );
 DECL_CONSTRUCTOR_IMPLS( PushButton, Button, "pushbutton" );
 
  // HACK: put every radio button into a group :/
 static std::list< RadioButtonImpl*> mpRadioGroup;
 
-// Window/Control/Button/RadioButton
 class RadioButtonImpl : public ButtonImpl
 {
 public:
@@ -210,19 +265,11 @@ public:
     static void unsetOthersGroup( RadioButtonImpl* current )
     {
         // set all others to false
-        for( std::list< RadioButtonImpl*>::iterator it = mpRadioGroup.begin();
-                 it != mpRadioGroup.end(); it++ )
-        {
-#if 0 // BREAKS in OOo
-            if ( *it != current )
-                (*it)->Check( false );
-#else
-            if ( *it != current && (*it)->IsChecked() )
+        for ( std::list< RadioButtonImpl*>::iterator i = mpRadioGroup.begin();
+              i != mpRadioGroup.end(); i++ )
             {
-                (*it)->Check( false );
-                return;
-            }
-#endif
+            if ( *i != current )
+                ( *i )->Check( false );
         }
     }
 
@@ -269,10 +316,22 @@ void RadioButton::SetToggleHdl( const Li
     getImpl().SetToggleHdl( rLink );
 }
 
-DECL_GET_IMPL_IMPL( RadioButton )
+DECL_GET_IMPL_IMPL( RadioButton );
+#if 1
 DECL_CONSTRUCTOR_IMPLS( RadioButton, Button, "radiobutton" );
+#else //debugging aid
+RadioButton::RadioButton( Context *pCtx, const char *pId, sal_uInt32 nId )
+    : Button( new RadioButtonImpl( pCtx, pCtx->GetPeerHandle( pId, nId ), this ) )
+{
+    printf( "%s: name=%s\n", __PRETTY_FUNCTION__, pId );
+}
+
+RadioButton::RadioButton( Window *pParent, WinBits nBits )
+    : Button( new RadioButtonImpl( pParent->getContext(), Window::CreatePeer( pParent, nBits, "radiobutton" ), this ) )
+{
+}
+#endif
 
-// Window/Control/Button/CheckBox
 class CheckBoxImpl : public ButtonImpl
 {
   public:
@@ -302,7 +361,7 @@ BOOL CheckBox::IsChecked() const
 {
     if ( !getImpl().mxCheckBox.is() )
         return FALSE;
-    return getImpl().mxCheckBox->getState();
+    return getImpl().mxCheckBox->getState() != 0;
 }
 
 void CheckBox::SetToggleHdl( const Link& rLink )
@@ -310,10 +369,9 @@ void CheckBox::SetToggleHdl( const Link&
     getImpl().SetToggleHdl( rLink );
 }
 
-DECL_GET_IMPL_IMPL( CheckBox )
+DECL_GET_IMPL_IMPL( CheckBox );
 DECL_CONSTRUCTOR_IMPLS( CheckBox, Button, "checkbox" );
 
-// Window/Control/Button/PushButton/etc
 #define BUTTON_IMPL(t, parent, response) \
     class t##Impl : public parent##Impl \
     { \
@@ -358,25 +416,167 @@ DECL_CONSTRUCTOR_IMPLS( ResetButton, Pus
 DECL_CONSTRUCTOR_IMPLS( ApplyButton, PushButton, "applybutton" );  /* Deprecated? */
 DECL_CONSTRUCTOR_IMPLS( HelpButton, PushButton, "helpbutton" );
 
+class AdvancedButtonImpl : public PushButtonImpl
+{
+protected:
+    bool bAdvancedMode;
+    std::list< Window*> maAdvanced;
+    std::list< Window*> maSimple;
+    rtl::OUString mSimpleLabel;
+    rtl::OUString mAdvancedLabel;
 
-ImageImpl::ImageImpl( const char *pName )
-    : mxGraphic( layoutimpl::loadGraphic( pName ) )
+    Window* Remove( std::list< Window*> lst, Window* w )
 {
-    if ( !mxGraphic.is() )
+        for ( std::list< Window*>::iterator it = maAdvanced.begin();
+              it != maAdvanced.end(); it++ )
+            if ( *it == w )
     {
-        DBG_ERROR1( "ERROR: failed to load image: `%s'", pName );
+                lst.erase( it );
+                return *it;
+            }
+        return 0;
     }
+    void redraw()
+    {
+        uno::Reference <awt::XWindow> ref( mxWindow, uno::UNO_QUERY );
+        ::Window* window = VCLXWindow::GetImplementation( ref )->GetWindow();
+        ::Window* parent = window->GetParent();
+
+        ::Rectangle r = Rectangle( parent->GetPosPixel(),
+                                   parent->GetSizePixel() );
 
+        parent->Invalidate( r, INVALIDATE_CHILDREN | INVALIDATE_NOCHILDREN );
+        parent->SetPosSizePixel( 0, 0, r.nRight - r.nLeft, r.nBottom - r.nTop,
+                                 awt::PosSize::SIZE );
 }
 
-Image::Image( const char *pName )
-    : pImpl( new ImageImpl( pName ) )
+public:
+    AdvancedButtonImpl( Context *pCtx, PeerHandle const& xPeer, Window *pWindow )
+        : PushButtonImpl( pCtx, xPeer, pWindow )
+        , bAdvancedMode( false )
+          // TODO: i18n
+          // Button::GetStandardText( BUTTON_ADVANCED );
+          // Button::GetStandardText( BUTTON_SIMPLE );
+        , mSimpleLabel( rtl::OUString::createFromAscii( "Advanced..." ) )
+        , mAdvancedLabel( rtl::OUString::createFromAscii( "Simple..." ) )
 {
 }
+    void Click()
+    {
+        bAdvancedMode = !bAdvancedMode;
+        if ( bAdvancedMode )
+            advancedMode();
+        else
+            simpleMode();
+    }
+    void advancedMode()
+    {
+        // TODO: set symbol/image?
+        // SYMBOL_PAGEUP, SYMBOL_PAGEDOWN
+#if 0
+        // How to set images from here?
+        // XImageConsumer looks like a disaster
+        // Should move all this switching functionality to VCLXAdvancedButton?
+        /biek/home/janneke/vc/layout-cws/default_images/res/commandimagelist/
+            sc_arrowshapes_down.png
+            sch_flowchartshapes.flowchart-extract.png
+            sch_flowchartshapes.flowchart-merge.png
+#endif        
+        mxButton->setLabel( mAdvancedLabel );
+        for ( std::list< Window*>::iterator it = maAdvanced.begin();
+              it != maAdvanced.end(); it++ )
+            ( *it )->Show();
+        for ( std::list< Window*>::iterator it = maSimple.begin();
+              it != maSimple.end(); it++ )
+            ( *it )->Hide();
 
-Image::~Image()
+        redraw();
+    }
+
+    void simpleMode()
 {
-    delete pImpl;
+        mxButton->setLabel( mSimpleLabel );
+        for ( std::list< Window*>::iterator it = maAdvanced.begin();
+              it != maAdvanced.end(); it++ )
+            ( *it )->Hide();
+        for ( std::list< Window*>::iterator it = maSimple.begin();
+              it != maSimple.end(); it++ )
+            ( *it )->Show();
+
+        redraw();
+    }
+    void AddAdvanced( Window* w )
+    {
+        maAdvanced.push_back( w );
+        if ( !bAdvancedMode )
+            w->Hide();
+    }
+    void AddSimple( Window* w )
+    {
+        maSimple.push_back( w );
+        if ( bAdvancedMode )
+            w->Hide();
+    }
+    void RemoveAdvanced( Window* w )
+    {
+        Remove( maAdvanced, w );
+    }
+    void RemoveSimple( Window* w )
+    {
+        Remove( maSimple, w );
+    }
+};
+
+void AdvancedButton::AddAdvanced( Window* w )
+{
+    getImpl().AddAdvanced( w );
+}
+
+void AdvancedButton::AddSimple( Window* w )
+{
+    getImpl().AddSimple( w );
+}
+
+void AdvancedButton::RemoveAdvanced( Window* w )
+{
+    getImpl().RemoveAdvanced( w );
+}
+
+void AdvancedButton::RemoveSimple( Window* w )
+{
+    getImpl().RemoveSimple( w );
+}
+
+DECL_CONSTRUCTOR_IMPLS( AdvancedButton, PushButton, "advancedbutton" );
+DECL_GET_IMPL_IMPL( AdvancedButton );
+
+
+class MoreButtonImpl : public AdvancedButtonImpl
+{
+public:
+    MoreButtonImpl( Context *pCtx, PeerHandle const& xPeer, Window *pWindow )
+        : AdvancedButtonImpl( pCtx, xPeer, pWindow)
+    {
+        mAdvancedLabel = ::Button::GetStandardText( BUTTON_LESS );
+        mSimpleLabel = ::Button::GetStandardText( BUTTON_MORE );
+    }
+    void AddWindow( Window* w ) { AddAdvanced( w ); }
+    void RemoveWindow( Window* w ) { RemoveAdvanced( w ); }
+};
+
+// TODO
+//BUTTON_IMPL( MoreButton, PushButton, 0 );
+DECL_CONSTRUCTOR_IMPLS( MoreButton, AdvancedButton, "morebutton" );
+DECL_GET_IMPL_IMPL( MoreButton );
+
+void MoreButton::AddWindow( Window* w )
+{
+    getImpl().AddWindow( w );
+}
+
+void MoreButton::RemoveWindow( Window* w )
+{
+    getImpl().RemoveWindow( w );
 }
 
-}; // namespace layout
+} // namespace layout
Index: toolkit/source/vclcompat/wcontainer.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/vclcompat/wcontainer.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/source/vclcompat/wcontainer.cxx	6 Mar 2008 11:49:54 -0000	1.2
+++ toolkit/source/vclcompat/wcontainer.cxx	30 Jul 2008 11:16:51 -0000	1.2.6.3
@@ -1,6 +1,37 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "wrapper.hxx"
 
-#include "layoutcore.hxx"
+#include "layout/layoutcore.hxx"
 #include <com/sun/star/awt/XLayoutRoot.hpp>
 #include <com/sun/star/awt/XLayoutContainer.hpp>
 
@@ -13,8 +44,7 @@ using namespace ::com::sun::star;
 namespace layout
 {
 
-// Container
-Container::Container( const Context *pCtx, const char *pId )
+Container::Container( Context const* pCtx, char const* pId )
     : mxContainer( pCtx->GetPeerHandle( pId ), uno::UNO_QUERY )
 {
     if ( !mxContainer.is() )
@@ -23,7 +53,7 @@ Container::Container( const Context *pCt
     }
 }
 
-Container::Container( const rtl::OUString &rName, sal_Int32 nBorder )
+Container::Container( rtl::OUString const& rName, sal_Int32 nBorder )
 {
     mxContainer = layoutimpl::createContainer( rName );
 
@@ -106,7 +136,16 @@ void Container::ShowAll( bool bShow )
     inner::setChildrenVisible( mxContainer, bShow );
 }
 
-// Container/Table
+void Container::Show()
+{
+    ShowAll( true );
+}
+
+void Container::Hide()
+{
+    ShowAll( false );
+}
+
 Table::Table( sal_Int32 nBorder, sal_Int32 nColumns )
     : Container( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "table" ) ), nBorder )
 {
@@ -153,8 +192,7 @@ void Table::setProps( uno::Reference< aw
                               uno::Any( nYSpan ) );
 }
 
-// Container/Box
-Box::Box( const rtl::OUString &rName, sal_Int32 nBorder, bool bHomogeneous )
+Box::Box( rtl::OUString const& rName, sal_Int32 nBorder, bool bHomogeneous )
     : Container( rName, nBorder )
 {
     uno::Reference< beans::XPropertySet > xProps( mxContainer, uno::UNO_QUERY_THROW );
@@ -199,4 +237,36 @@ void Box::setProps( uno::Reference< awt:
                               uno::Any( nPadding ) );
 }
 
-}; // end namespace layout
+Table::Table( Context const* pCtx, char const* pId )
+    : Container( pCtx, pId )
+{
+}
+
+Box::Box( Context const* pCtx, char const* pId )
+    : Container( pCtx, pId )
+{
+}
+
+HBox::HBox( sal_Int32 nBorder, bool bHomogeneous )
+    : Box( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "hbox" ) ),
+           nBorder, bHomogeneous )
+{
+}
+
+HBox::HBox( Context const* pCtx, char const* pId )
+    : Box( pCtx, pId )
+{
+}
+
+VBox::VBox( sal_Int32 nBorder, bool bHomogeneous )
+    : Box( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "vbox" ) ),
+           nBorder, bHomogeneous )
+{
+}
+
+VBox::VBox( Context const* pCtx, char const* pId )
+    : Box( pCtx, pId )
+{
+}
+
+} // namespace layout
Index: toolkit/source/vclcompat/wfield.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/vclcompat/wfield.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.4
--- toolkit/source/vclcompat/wfield.cxx	6 Mar 2008 11:50:09 -0000	1.2
+++ toolkit/source/vclcompat/wfield.cxx	30 Jul 2008 11:16:57 -0000	1.2.6.4
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "wrapper.hxx"
 
 #include <comphelper/processfactory.hxx>
@@ -72,7 +103,7 @@ void Edit::SetModifyHdl( const Link& rLi
 }
 
 DECL_CONSTRUCTOR_IMPLS( Edit, Control, "edit" );
-DECL_GET_IMPL_IMPL( Edit )
+DECL_GET_IMPL_IMPL( Edit );
 
 // Window/Control/Edit/MultiLineEdit
 class MultiLineEditImpl : public EditImpl
@@ -85,14 +116,16 @@ public:
 };
 
 DECL_CONSTRUCTOR_IMPLS( MultiLineEdit, Edit, "multilineedit" );
-DECL_GET_IMPL_IMPL( MultiLineEdit )
+DECL_GET_IMPL_IMPL( MultiLineEdit );
 
 // Window/Control/Edit/SpinField
 class SpinFieldImpl : public EditImpl
 {
   public:
     SpinFieldImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow )
-        : EditImpl( pCtx, xPeer, pWindow ) {}
+        : EditImpl( pCtx, xPeer, pWindow )
+    {
+    }
 };
 
 DECL_CONSTRUCTOR_IMPLS( SpinField, Edit, "spinfield" );
@@ -102,7 +135,9 @@ class NumericFieldImpl : public SpinFiel
 {
   public:
     NumericFieldImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow )
-        : SpinFieldImpl( pCtx, xPeer, pWindow ) {}
+        : SpinFieldImpl( pCtx, xPeer, pWindow )
+    {
+    }
 };
 
 // Window/Control/Edit/SpinField/MetricField
@@ -110,12 +145,14 @@ class MetricFieldImpl : public SpinField
 {
   public:
     MetricFieldImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow )
-        : SpinFieldImpl( pCtx, xPeer, pWindow ) {}
+        : SpinFieldImpl( pCtx, xPeer, pWindow )
+    {
+    }
 };
 
-DECL_GET_IMPL_IMPL( SpinField )
-DECL_GET_IMPL_IMPL( NumericField )
-DECL_GET_IMPL_IMPL( MetricField )
+DECL_GET_IMPL_IMPL( SpinField );
+DECL_GET_IMPL_IMPL( NumericField );
+DECL_GET_IMPL_IMPL( MetricField );
 
 // FormatterBase
 class FormatterBaseImpl
@@ -124,7 +161,9 @@ class FormatterBaseImpl
     PeerHandle mxPeer;
   public:
     explicit FormatterBaseImpl( const PeerHandle &xPeer )
-        : mxPeer( xPeer ) {};
+        : mxPeer( xPeer )
+    {
+    };
 };
 
 class NumericFormatterImpl : public FormatterBaseImpl
@@ -133,13 +172,15 @@ class NumericFormatterImpl : public Form
     uno::Reference< awt::XCurrencyField > mxField;
     explicit NumericFormatterImpl( const PeerHandle &xPeer )
         : FormatterBaseImpl( xPeer )
-        , mxField( xPeer, uno::UNO_QUERY ) {}
+        , mxField( xPeer, uno::UNO_QUERY )
+    {
+    }
 
     // FIXME: burn that CPU ! cut/paste from vclxwindows.cxx
     double valueToDouble( sal_Int64 nValue )
     {
         sal_Int16 nDigits = mxField->getDecimalDigits();
-        double n = nValue;
+        double n = (double)nValue;
         for ( sal_uInt16 d = 0; d < nDigits; d++ )
             n /= 10;
         return n;
@@ -160,7 +201,9 @@ class MetricFormatterImpl : public Forma
     uno::Reference< awt::XMetricField > mxField;
     explicit MetricFormatterImpl( const PeerHandle &xPeer )
         : FormatterBaseImpl( xPeer )
-        , mxField( xPeer, uno::UNO_QUERY ) {}
+        , mxField( xPeer, uno::UNO_QUERY )
+    {
+    }
 };
 
 // NumericFormatter
@@ -204,7 +247,9 @@ DECL_CONSTRUCTOR_IMPLS_2( NumericField, 
 // MetricFormatter
 
 MetricFormatter::MetricFormatter( FormatterBaseImpl *pImpl )
-    : FormatterBase( pImpl ) {}
+    : FormatterBase( pImpl )
+{
+}
 MetricFormatterImpl& MetricFormatter::getFormatImpl() const
 {    return *( static_cast<MetricFormatterImpl *>( mpFormatImpl ) );   }
 
@@ -276,7 +321,7 @@ public:
         for( unsigned int i = 0; aItems.getLength(); i++ )
         {
             if ( aItems[ i ] == rKey )
-                return i;
+                return sal::static_int_cast< USHORT >( i );
         }
         return COMBOBOX_ENTRY_NOTFOUND;
     }
@@ -382,7 +427,7 @@ void ComboBox::SetSelectHdl( const Link&
 }
 
 DECL_CONSTRUCTOR_IMPLS( ComboBox, Edit, "combobox" );
-DECL_GET_IMPL_IMPL( ComboBox )
+DECL_GET_IMPL_IMPL( ComboBox );
 
 // Window/Control/ListBox
 class ListBoxImpl : public ControlImpl,
@@ -426,7 +471,7 @@ public:
         for( unsigned int i = 0; aItems.getLength(); i++ )
         {
             if ( aItems[ i ] == rKey )
-                return i;
+                return sal::static_int_cast< USHORT >( i );
         }
         return LISTBOX_ENTRY_NOTFOUND;
     }
@@ -448,7 +493,7 @@ public:
 
     USHORT GetSelectEntryCount() const
     {
-        return mxListBox->getSelectedItems().getLength();
+        return sal::static_int_cast< USHORT >( mxListBox->getSelectedItems().getLength() );
     }
 
     USHORT GetSelectEntryPos( USHORT nSelIndex ) const
@@ -577,6 +622,6 @@ void ListBox::SetClickHdl( const Link& r
 }
 
 DECL_CONSTRUCTOR_IMPLS( ListBox, Control, "listbox" );
-DECL_GET_IMPL_IMPL( ListBox )
+DECL_GET_IMPL_IMPL( ListBox );
 
-}; // end namespace layout
+} // namespace layout
Index: toolkit/source/vclcompat/wrapper.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/vclcompat/wrapper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.4
--- toolkit/source/vclcompat/wrapper.cxx	6 Mar 2008 11:50:23 -0000	1.2
+++ toolkit/source/vclcompat/wrapper.cxx	30 Jul 2008 11:17:03 -0000	1.2.6.4
@@ -1,16 +1,50 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "wrapper.hxx"
 
+#include <com/sun/star/graphic/XGraphic.hpp>
 #include <com/sun/star/awt/XFixedText.hpp>
 #include <com/sun/star/awt/XDialog2.hpp>
+#include <com/sun/star/awt/XProgressBar.hpp>
 #include <com/sun/star/awt/WindowAttribute.hpp>
 #include <com/sun/star/awt/VclWindowPeerAttribute.hpp>
 #include <comphelper/processfactory.hxx>
 #include <vcl/window.hxx>
 #include <toolkit/awt/vclxwindow.hxx>
 
-#include "layoutcore.hxx"
-#include "../layout/factory.hxx"
-#include "../layout/root.hxx"
+#include <layout/layoutcore.hxx>
+#include <layout/factory.hxx>
+#include <layout/root.hxx>
+#include <vcl/image.hxx>
 
 using namespace ::com::sun::star;
 
@@ -239,10 +273,10 @@ WinBits Window::GetStyle()
     {
         if ( toolkitVclPropsMap[ i ].propName )
         {
-            short nValue;
+            short nValue = 0;
             if ( toolkitVclPropsMap[ i ].isBoolean )
             {
-                bool bValue;
+                bool bValue = false;
                 mpImpl->getProperty( toolkitVclPropsMap[ i ].propName ) >>= bValue;
                 nValue = bValue ? 1 : 0;
             }
@@ -284,55 +318,6 @@ PeerHandle Window::CreatePeer( Window *p
 
     return layoutimpl::createWidget( getToolkit(), pParent->GetPeer(),
                                      rtl::OUString::createFromAscii( pName ), nWinAttrbs );
-
-
-#if 0
-    awt::WindowDescriptor desc;
-
-    // debugging help ...
-    desc.Bounds.X = 0;
-    desc.Bounds.Y = 0;
-    desc.Bounds.Width = 300;
-    desc.Bounds.Height = 200;
-
-    desc.ParentIndex = 0;
-    // FIXME: this code should be shared with
-    // toolkit/source/awt/vclxtoolkit.cxx (ImplGetWinBits)
-    desc.WindowAttributes = 0;
-    for( int i = 0; i < toolkitVclPropsMapLen; i++ )
-        if ( nStyle & toolkitVclPropsMap[ i ].vclStyle )
-            desc.WindowAttributes |= toolkitVclPropsMap[ i ].initAttr;
-    desc.WindowServiceName = rtl::OUString( pName, strlen( pName ),
-                                            RTL_TEXTENCODING_ASCII_US );
-
-    // FIXME: we really want to walk up the peer hierarchy
-    // and get the top-level that this requires.
-    if ( pParent != NULL )
-    {
-        PeerHandle hdl = pParent->GetPeer();
-        desc.Parent = uno::Reference< awt::XWindowPeer >( hdl, uno::UNO_QUERY );
-    }
-
-    PeerHandle xPeer = getToolkit()->createWindow( desc );
-
-    // not all WinBits have an equivalent attribute, some are available through
-    // properties though
-    for( int i = 0; i < toolkitVclPropsMapLen; i++ )
-        if ( nStyle & toolkitVclPropsMap[ i ].vclStyle &&
-            !toolkitVclPropsMap[ i ].initAttr &&
-            toolkitVclPropsMap[ i ].propName )
-        {
-            uno::Any aValue;
-            if ( toolkitVclPropsMap[ i ].isBoolean )
-                aValue = uno::makeAny( (bool) toolkitVclPropsMap[ i ].enableProp );
-            else
-                aValue = uno::makeAny( (short) toolkitVclPropsMap[ i ].enableProp );
-            layoutimpl::prophlp::setProperty( xPeer,
-                                              rtl::OUString::createFromAscii( toolkitVclPropsMap[ i ].propName ), aValue );
-        }
-
-    return xPeer;
-#endif
 }
 
 void Window::Enable( bool bEnable )
@@ -419,6 +404,12 @@ public:
 DECL_CONSTRUCTOR_IMPLS( FixedLine, Control, "hfixedline" );
 DECL_GET_IMPL_IMPL( FixedLine )
 
+bool FixedLine::IsEnabled()
+{
+    //FIXME
+    return true;
+}
+
 class FixedTextImpl : public ControlImpl
 {
 public:
@@ -456,6 +447,123 @@ public:
 };
 
 DECL_CONSTRUCTOR_IMPLS( FixedInfo, FixedText, "fixedinfo" );
-DECL_GET_IMPL_IMPL( FixedInfo )
+DECL_GET_IMPL_IMPL( FixedInfo );
+
+class ProgressBarImpl : public ControlImpl
+{
+public:
+    uno::Reference< awt::XProgressBar > mxProgressBar;
+    ProgressBarImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow )
+        : ControlImpl( pCtx, xPeer, pWindow )
+        , mxProgressBar( xPeer, uno::UNO_QUERY )
+    {
+    }
+
+    virtual void SAL_CALL disposing( const css::lang::EventObject& /* Source */ )
+        throw (css::uno::RuntimeException)
+    {
+        mxProgressBar.clear();
+    }
+};
+
+
+class FixedImageImpl: public ControlImpl
+{
+public:
+    uno::Reference< graphic::XGraphic > mxGraphic;
+    FixedImageImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow)
+//                    const char *pName )
+        : ControlImpl( pCtx, xPeer, pWindow )
+          //, mxGraphic( layoutimpl::loadGraphic( pName ) )
+        , mxGraphic( xPeer, uno::UNO_QUERY )
+    {
+        if ( !mxGraphic.is() )
+        {
+            DBG_ERROR( "ERROR: failed to load image: `%s'" /*, pName*/ );
+        }
+#if 0
+        else
+            getImpl().mxGraphic->...();
+#endif
+    }
+};
+
+DECL_CONSTRUCTOR_IMPLS( FixedImage, Control, "fixedimage" );
+DECL_GET_IMPL_IMPL( FixedImage )
+
+void FixedImage::setImage( ::Image const& i )
+{
+    (void) i;
+    if ( !getImpl().mxGraphic.is() )
+        return;
+    //FIXME: hack moved to proplist
+    //getImpl().mxGraphic = 
+}
+
+#if 0
+
+    FixedImage::FixedImage( const char *pName )
+    : pImpl( new FixedImageImpl( pName ) )
+{
+}
+
+FixedImage::~FixedImage()
+{
+    delete pImpl;
+}
+
+#endif
+
+    
+DECL_CONSTRUCTOR_IMPLS( ProgressBar, Control, "ProgressBar" );
+#if 0
+ProgressBar::ProgressBar( Context *pCtx, const char *pId, sal_uInt32 nId )
+    : Control( new ProgressBarImpl( pCtx, pCtx->GetPeerHandle( pId, nId ), this ) )
+{
+}
+ProgressBar::ProgressBar( Window *pParent, WinBits nBits)
+//    : Control( new ProgressBarImpl( pParent->getContext(), Window::CreatePeer( pParent, nBits, "ProgressBar" ), this ) )
+    : Control( new ProgressBarImpl( pParent->getContext(), Window::CreatePeer( pParent, nBits, "progressbar" ), this ) )
+{
+}
+#endif
+
+DECL_GET_IMPL_IMPL( ProgressBar )
+
+
+void ProgressBar::SetForegroundColor( css::util::Color color )
+{
+    if ( !getImpl().mxProgressBar.is() )
+        return;
+    getImpl().mxProgressBar->setForegroundColor( color );
+}
+
+void ProgressBar::SetBackgroundColor( css::util::Color color )
+{
+    if ( !getImpl().mxProgressBar.is() )
+        return;
+    getImpl().mxProgressBar->setBackgroundColor( color );
+}
+
+void ProgressBar::SetValue( sal_Int32 i )
+{
+    if ( !getImpl().mxProgressBar.is() )
+        return;
+    getImpl().mxProgressBar->setValue( i );
+}
+
+void ProgressBar::SetRange( sal_Int32 min, sal_Int32 max )
+{
+    if ( !getImpl().mxProgressBar.is() )
+        return;
+    getImpl().mxProgressBar->setRange( min, max );
+}
+
+sal_Int32 ProgressBar::GetValue()
+{
+    if ( !getImpl().mxProgressBar.is() )
+        return 0;
+    return getImpl().mxProgressBar->getValue();
+}
 
-}; // end namespace layout
+} // namespace layout
Index: toolkit/source/vclcompat/wrapper.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/vclcompat/wrapper.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/source/vclcompat/wrapper.hxx	6 Mar 2008 11:50:35 -0000	1.2
+++ toolkit/source/vclcompat/wrapper.hxx	30 Jul 2008 11:17:08 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef WRAPPER_HXX
 #define WRAPPER_HXX
 
@@ -5,7 +36,6 @@
 #include <com/sun/star/uno/Reference.hxx>
 #include <com/sun/star/awt/XWindow.hpp>
 #include <com/sun/star/awt/XVclWindowPeer.hpp>
-#include <com/sun/star/graphic/XGraphic.hpp>
 
 #include <cstring>
 
@@ -13,7 +43,7 @@ namespace css = com::sun::star;
 
 namespace layout
 {
-// Window
+
 class WindowImpl
 {
   public:
@@ -63,7 +93,6 @@ class WindowImpl
     }
 };
 
-// Window/Control
 class ControlImpl : public WindowImpl
 {
   public:
@@ -71,14 +100,6 @@ class ControlImpl : public WindowImpl
         : WindowImpl( pCtx, xPeer, pWindow ) {}
 };
 
-class ImageImpl
-{
-  public:
-    css::uno::Reference< css::graphic::XGraphic > mxGraphic;
-    ImageImpl( const char *pName );
-};
-
-// Window/Control/Edit
 inline WindowImpl &Window::getImpl() const
 { return *(static_cast< WindowImpl * >( mpImpl )); }
 
@@ -110,6 +131,6 @@ inline WindowImpl &Window::getImpl() con
     { \
     }
 
-}; // end namespace layout
+} // namespace layout
 
 #endif // WRAPPER_HXX
Index: toolkit/src2xml/source/src2xml.py
===================================================================
RCS file: /cvs/gsl/toolkit/src2xml/source/src2xml.py,v
retrieving revision 1.2
retrieving revision 1.2.6.1
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.1
--- toolkit/src2xml/source/src2xml.py	6 Mar 2008 11:54:56 -0000	1.2
+++ toolkit/src2xml/source/src2xml.py	4 Apr 2008 09:13:34 -0000	1.2.6.1
@@ -183,7 +183,11 @@ def post_process (s):
     s = s.replace (' def-button="true"', ' default="true"')
     return s
 
-XML_HEADER = '<?xml version="1.0" encoding="UTF-8"?>\n'
+XML_HEADER = '''<?xml version="1.0" encoding="UTF-8"?>
+<!-- This is a template.  i18n translation is not performed in-place;
+     i18n translated XML files are generated from this template by
+     transex3/layout/tralay.  !-->
+'''
 
 def do_one_file (file_name, options):
     str = XML_HEADER
Index: toolkit/util/makefile.mk
===================================================================
RCS file: /cvs/gsl/toolkit/util/makefile.mk,v
retrieving revision 1.25
retrieving revision 1.23.6.4
diff -p -u -u -p -b -w -B -r1.25 -r1.23.6.4
--- toolkit/util/makefile.mk	11 Apr 2008 09:39:56 -0000	1.25
+++ toolkit/util/makefile.mk	30 Jul 2008 12:36:02 -0000	1.23.6.4
@@ -53,7 +53,10 @@ LIB1TARGET= $(SLB)$/$(TARGET).lib
 LIB1FILES=	$(SLB)$/awt.lib \
 			$(SLB)$/tree.lib \
 			$(SLB)$/controls.lib \
-			$(SLB)$/helper.lib
+			$(SLB)$/helper.lib\
+			$(SLB)$/layoutcore.lib \
+			$(SLB)$/vclcompat.lib
+
 SHL1TARGET= tk$(DLLPOSTFIX)
 SHL1IMPLIB= itk
 SHL1USE_EXPORTS=name
@@ -99,31 +102,5 @@ RES1FILELIST=$(SRS)$/awt.srs
 RESLIB1NAME=$(TARGET)
 RESLIB1SRSFILES=$(RES1FILELIST)
 
-.IF "$(ENABLE_LAYOUT)" == "TRUE"
-
-TARGET2 = tklayout
-LIB2FILES= \
-	$(SLB)$/layout_awt.lib \
-	$(SLB)$/layoutcore.lib \
-	$(SLB)$/vclcompat.lib
-
-LIB2TARGET= $(SLB)$/$(TARGET2).lib
-SHL2TARGET= $(TARGET2)$(UPD)$(DLLPOSTFIX)
-SHL2IMPLIB= $(TARGET2)
-
-SHL2LIBS= $(LIB2TARGET)
-
-SHL2STDLIBS=  \
-	$(UNOTOOLSLIB) \
-	$(TKLIB) \
-	$(TOOLSLIB) \
-	$(COMPHELPERLIB) \
-	$(VCLLIB) \
-	$(CPPULIB) \
-	$(CPPUHELPERLIB) \
-	$(SALLIB) \
-
-.ENDIF # ENABLE_LAYOUT == "TRUE"
-
 # --- Footer -------------------------------------------------------------
 .INCLUDE :	target.mk
Index: toolkit/util/makefile.pmk
===================================================================
RCS file: /cvs/gsl/toolkit/util/makefile.pmk,v
retrieving revision 1.6
retrieving revision 1.4.6.3
diff -p -u -u -p -b -w -B -r1.6 -r1.4.6.3
--- toolkit/util/makefile.pmk	11 Apr 2008 09:40:17 -0000	1.6
+++ toolkit/util/makefile.pmk	30 Jul 2008 12:35:59 -0000	1.4.6.3
@@ -39,8 +39,8 @@ CFLAGS += -xldscope=hidden
 
 # FIXME: sprinkle some TOOLKIT_DLLPUBLIC
 
-.IF "$(ENABLE_LAYOUT)" == "TRUE"
 CFLAGS+=-I$(PRJ)/inc/layout
+.IF "$(ENABLE_LAYOUT)" == "TRUE"
 CFLAGS+=-DENABLE_LAYOUT=1 -DTEST_LAYOUT=1
 .ELSE
 CFLAGS+=-DENABLE_LAYOUT=0
Index: toolkit/workben/layout/editor.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/editor.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.5
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.5
--- toolkit/workben/layout/editor.cxx	6 Mar 2008 11:58:21 -0000	1.2
+++ toolkit/workben/layout/editor.cxx	30 Jul 2008 11:17:14 -0000	1.2.6.5
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include "editor.hxx"
 
 #undef NDEBUG
@@ -29,7 +60,7 @@ using rtl::OUString;
 //#define FILEDLG
 
 // somewhat of a hack unfortunately ...
-#include "layoutcore.hxx"
+#include "layout/layoutcore.hxx"
 #include "root.hxx"
 #include "helper.hxx"
 
@@ -73,7 +104,7 @@ namespace layoutimpl {
                       const rtl::OUString &rName, long nProps, bool bToplevel );
 
     uno::Any anyFromString (const rtl::OUString &value, const uno::Type &type);
-};
+}
 
 using namespace layout;
 using namespace layoutimpl;
@@ -117,7 +148,7 @@ static rtl::OUString anyToString (uno::A
 }
 
 static inline long anyToNatural (uno::Any value)
-{ return anyToString( value ).toInt64(); }
+{ return sal::static_int_cast<long>(anyToString( value ).toInt64()); }
 static inline double anyToDecimal (uno::Any value)
 { return anyToString( value ).toDouble(); }
 
@@ -211,7 +242,9 @@ public:
                 beans::Property prop = it.next();
                 rtl::OUString name( prop.Name );
                 rtl::OUString value( getProperty( name, WINDOW_PROPERTY ) );
+#if DEBUG_PRINT
 fprintf(stderr, "original property: %s = %s\n", OUSTRING_CSTR(name), OUSTRING_CSTR(value));
+#endif
                 std::pair< rtl::OUString, rtl::OUString > pair( name, value );
                 maOriProps.push_back( pair );
             }
@@ -439,7 +472,9 @@ fprintf(stderr, "original property: %s =
         for ( PropList::const_iterator it = props.begin(); it != props.end(); it++ )
             if ( it->first.equalsIgnoreAsciiCase( propName ) )
                 return it->second;
+#if DEBUG_PRINT
 fprintf(stderr, "Serious error: property '%s' not found\n", OUSTRING_CSTR(propName));
+#endif
         return rtl::OUString();
     }
 
@@ -486,10 +521,14 @@ fprintf(stderr, "Serious error: property
         rtl::OUString oriValue = getOriginalProperty( propName, rKind );
         rtl::OUString newValue = getProperty( propName, rKind );
         bool isTouched = oriValue != newValue;
+#if DEBUG_PRINT
 fprintf(stderr, "is property '%s' touched? %s  (%s vs %s)\n", OUSTRING_CSTR(propName), isTouched ? "yes" : "no", OUSTRING_CSTR(oriValue), OUSTRING_CSTR(newValue));
+#endif
         return isTouched;
     }
 
+    using LayoutWidget::setProperty;
+    
     void setProperty( rtl::OUString rPropName, PropertyKind rKind, uno::Any rValue )
     {
         switch ( rKind ) {
@@ -717,7 +756,7 @@ namespace FlatLayout
             nRet++;
         return nRet;
     }
-};
+}
 
 //** PropertiesList widget
 
@@ -743,7 +782,9 @@ class PropertiesList : public layout::Ta
 
             virtual ~AnyWidget()
             {
+#if DEBUG_PRINT
                 fprintf(stderr, "~AnyWidget\n");
+#endif
             }
 
             void save( uno::Any aValue )
@@ -756,7 +797,7 @@ void checkProperty()
 {
                 bool flag = mpWidget->isPropertyTouched( maPropName, maPropKind );
 
-                if ( mpFlag && mpFlag->IsChecked() != flag )
+                if ( mpFlag && mpFlag->IsChecked() != (BOOL)flag )
                 {
                     CheckFlag( flag, true );
                 }
@@ -950,7 +991,9 @@ printf("Remove mpEdit and expand\n");
 
             virtual void store()
             {
+#if DEBUG_PRINT
 fprintf(stderr, "store number: %ld\n", rtl::OUString( GetText() ).toInt64());
+#endif
                 save( uno::makeAny( rtl::OUString( GetText() ).toInt64() ) );
             }
         };
@@ -982,7 +1025,9 @@ fprintf(stderr, "store number: %ld\n", r
 
             virtual ~AnyCheckBox()
             {
+#if DEBUG_PRINT
                 fprintf(stderr, "~AnyCheckBox\n");
+#endif
             }
 
             virtual layout::Window *getWindow()
@@ -990,8 +1035,10 @@ fprintf(stderr, "store number: %ld\n", r
 
             virtual void load()
             {
+#if DEBUG_PRINT
 fprintf(stderr, "loading boolean value\n");
-                Check( getValue().toInt64() );
+#endif
+                Check( getValue().toInt64() != 0 );
                 setLabel();
                 checkProperty();
             }
@@ -1022,7 +1069,7 @@ fprintf(stderr, "loading boolean value\n
 
             virtual void load()
             {
-                SelectEntryPos( getValue().toInt32() );
+                SelectEntryPos( sal::static_int_cast< USHORT >( getValue().toInt32() ) );
                 checkProperty();
             }
 
@@ -1108,7 +1155,9 @@ fprintf(stderr, "loading boolean value\n
 
             ~PropertyEntry()
             {
+#if DEBUG_PRINT
             fprintf(stderr, "REMOVING label, flag and value\n");
+#endif
                 delete mpLabel;
                 delete mpFlag;
                 delete mpValue;
@@ -1224,7 +1273,7 @@ private:
             rtl::OUString name( prop.Name );
             if ( toIgnore( name ) )
                 continue;
-            sal_uInt16 type = prop.Type.getTypeClass();
+            sal_uInt16 type = static_cast< sal_uInt16 >( prop.Type.getTypeClass() );
 
             PropertyEntry *propEntry = PropertyEntry::construct(
                 pWidget, name, rKind, type, mpParentWindow );
@@ -1262,6 +1313,7 @@ public:
 
     void clear()
     {
+        ///FIXME: crash
         Container::Clear();        
 
         for ( std::list< PropertyEntry* >::iterator it = maPropertiesList.begin();
@@ -1283,26 +1335,34 @@ IMPL_LINK( PropertiesList::PropertyEntry
 
 IMPL_LINK( PropertiesList::PropertyEntry::AnyWidget, FlagToggledHdl, layout::CheckBox *, pCheck )
 {
+#if DEBUG_PRINT
 fprintf(stderr, "Property flag pressed -- is: %d\n", pCheck->IsChecked());
+#endif
     if ( !mbBlockFlagCallback )
     {
         bool checked = pCheck->IsChecked();
         if ( !checked )  // revert
 {
+#if DEBUG_PRINT
 fprintf(stderr, "revert\n");
+#endif
             load();
 }
         else
         {
+#if DEBUG_PRINT
 fprintf(stderr, "user can't dirty the flag!\n");
+#endif
             // User can't flag the property as dirty
             // Actually, we may want to allow the designer to force a property to be stored.
             // Could be useful when the default value of some new property wasn't yet decided...
             CheckFlag( false, true );
         }
     }
+#if DEBUG_PRINT
 else
 fprintf(stderr, "Property flag pressed -- BLOCKED\n");
+#endif
     return 0;
 }
 
@@ -1392,14 +1452,16 @@ public:
         itemSelected( LISTBOX_ENTRY_NOTFOUND );
     }
 
-    ~SortListBox()
+    virtual ~SortListBox();
+};
+
+SortListBox::~SortListBox()
     {
         delete mpListBox;
         delete mpUpButton;
         delete mpDownButton;
         delete mpRemoveButton;
     }
-};
 
 IMPL_LINK( SortListBox, UpPressedHdl, layout::Button *, pBtn )
 {
@@ -1463,10 +1525,7 @@ public:
         mpRootWidget = new Widget( xWidget, "root" );
     }
 
-    ~LayoutTree()
-    {
-        delete mpRootWidget;
-    }
+    virtual ~LayoutTree();
 
     Widget *getWidget( int nPos )
     {
@@ -1489,7 +1548,7 @@ public:
         if ( pos == -1 )
             // if asked to select hidden root, select visible root
             pos = 0;
-        mpListBox->SelectEntryPos( pos );
+        mpListBox->SelectEntryPos( sal::static_int_cast< USHORT >( pos ) );
     }
 
     void rebuild()
@@ -1622,6 +1681,11 @@ protected:
     }
 };
 
+LayoutTree::~LayoutTree()
+{
+    delete mpRootWidget;
+}
+
 //** EditorImpl
 
 class EditorImpl : public LayoutTree::Listener
@@ -1656,7 +1720,7 @@ public:
     EditorImpl( layout::Dialog *dialog,
         // we should probable open this channel (or whatever its called) ourselves
                 uno::Reference< lang::XMultiServiceFactory > xMSF );
-    ~EditorImpl();
+    virtual ~EditorImpl();
 
     void loadFile( const rtl::OUString &aTestFile );
 };
@@ -1669,7 +1733,9 @@ EditorImpl::EditorImpl( layout::Dialog *
     //dialog->getContext()->getRoot(), uno::UNO_QUERY )
     // dialog->GetPeer(), uno::UNO_QUERY )
 {
+#if DEBUG_PRINT
 fprintf (stderr, "EditorImpl()\n");
+#endif
     // framework
     mxToolkit = uno::Reference< awt::XToolkit >(
         mxFactory->createInstance(
@@ -1678,7 +1744,9 @@ fprintf (stderr, "EditorImpl()\n");
     assert( mxToolkit.is() );
 
     // custom widgets
+#if DEBUG_PRINT
 fprintf (stderr, "custom widgets\n");
+#endif
     mpPropertiesList = new PropertiesList( dialog );
 
     mpLayoutTree = new LayoutTree( dialog );
@@ -1755,7 +1823,10 @@ mxMSF->createInstance
             uno::Reference< uno::XInterface >() );
     }
 
+#if DEBUG_PRINT
 fprintf( stderr, "TEST: initing root\n" );
+#endif
+
     uno::Reference< lang::XInitialization > xInit( xRoot, uno::UNO_QUERY );
     if ( !xInit.is() )
     {
@@ -1764,12 +1835,18 @@ fprintf( stderr, "TEST: initing root\n" 
             uno::Reference< uno::XInterface >() );
     }
 
+#if DEBUG_PRINT
 fprintf( stderr, "TEST: running parser\n" );
+#endif
     uno::Sequence< uno::Any > aParams( 1 );
     aParams[0] <<= aTestFile;
+#if DEBUG_PRINT
 fprintf( stderr, "TEST: do it\n" );
+#endif
     xInit->initialize( aParams );
+#if DEBUG_PRINT
 fprintf( stderr, "TEST: file loaded\n" );
+#endif
 
     mpLayoutTree->rebuild();
 }
@@ -1829,7 +1906,9 @@ IMPL_LINK( EditorImpl, CreateWidgetHdl, 
 IMPL_LINK( EditorImpl, ImportButtonHdl, layout::PushButton *, pBtn )
 {
     (void) pBtn;
+#if DEBUG_PRINT
 fprintf(stderr, "IMPORT!\n");
+#endif
 #ifdef FILEDLG
     pImportDialog->Execute();
 #endif
@@ -1840,10 +1919,12 @@ fprintf(stderr, "IMPORT!\n");
 #ifdef FILEDLG
 IMPL_LINK( EditorImpl, ImportDialogHdl, FileDialog *, pDialog )
 {
+    UniString path = pDialog->GetPath();
 //fprintf(stderr, "Executing import dialog!\n");
 
-    UniString path = pDialog->GetPath();
+#if DEBUG_PRINT
 fprintf(stderr, "got import file: %s\n",rtl::OUStringToOString( path, RTL_TEXTENCODING_ASCII_US ).getStr() );
+#endif
 
     return 0;
 }
Index: toolkit/workben/layout/editor.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/editor.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/workben/layout/editor.hxx	6 Mar 2008 11:58:33 -0000	1.2
+++ toolkit/workben/layout/editor.hxx	30 Jul 2008 11:17:20 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef EDITOR_HXX
 #define EDITOR_HXX
 
Index: toolkit/workben/layout/makefile.mk
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/makefile.mk,v
retrieving revision 1.2
retrieving revision 1.2.6.5
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.5
--- toolkit/workben/layout/makefile.mk	6 Mar 2008 12:00:06 -0000	1.2
+++ toolkit/workben/layout/makefile.mk	30 Jul 2008 11:17:25 -0000	1.2.6.5
@@ -1,3 +1,34 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile$
+#
+# $Revision$
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
 PRJ=../..
 PRJNAME=toolkit
 TARGET=test
@@ -24,12 +55,14 @@ CFLAGS+=-Wall -Wno-non-virtual-dtor
 
 CXXFILES=\
 	editor.cxx \
+	recover.cxx \
 	wordcountdialog.cxx \
 	test.cxx \
 	zoom.cxx
 
 OBJFILES=\
 	$(OBJ)$/editor.obj \
+	$(OBJ)$/recover.obj \
 	$(OBJ)$/test.obj \
 	$(OBJ)$/wordcountdialog.obj \
 	$(OBJ)$/zoom.obj
@@ -44,41 +77,36 @@ APP1STDLIBS= \
 		$(CPPUHELPERLIB)		\
 		$(SALLIB)			\
 		$(XMLSCRIPTLIB)			\
-		$(LAYOUTLIB)\
 		$(TKLIB)
 
-all: svtools ALLTAR
+svtools = $(INCCOM)/svtools
+all: $(svtools) ALLTAR
 
 .INCLUDE :  target.mk
 
-# FIXME: move this rule and .xml files into sw/svx trees,
-#        install into xml directory instead of lib.
-ALLTAR: \
-    $(DLLDEST)$/wordcount.xml\
-    $(DLLDEST)$/zoom.xml\
-    $(DLLDEST)$/de/wordcount.xml\
-    $(DLLDEST)$/de/zoom.xml\
-    $(DLLDEST)$/nl/wordcount.xml\
-    $(DLLDEST)$/nl/zoom.xml
+XML_FILES=\
+	recover.xml\
+	wordcount.xml\
+	zoom.xml\
 
 TRALAY=tralay
-$(WITH_LANG:f:t"/%.xml ")/%.xml: %.xml
-	$(TRALAY) -m localize.sdf -o . -l $(WITH_LANG:f:t" -l ") $<
-	rm -rf en-US
+XML_LANGS=$(alllangiso)
 
-$(DLLDEST)$/%.xml: %.xml
-# modes, INSTALL?
-	-$(MKDIR) $(@:d)
-	$(COPY) $< $@
+#ALL_XMLS=$(foreach,i,$(XML_LANGS) $(foreach,j,$(XML_FILES) $i/$j))
+ALLTAR: $(foreach,i,$(XML_FILES) en-US/$i)
+
+$(XML_LANGS:f:t"/%.xml ")/%.xml: %.xml
+	$(TRALAY) -m localize.sdf -o . -l $(XML_LANGS:f:t" -l ") $<
+	rm -rf en-US
 
-svtools:
+$(svtools):
 	# FIXME: there's a bug in svtools layout or usage
 	# Include files are in svtools/inc, but are referenced as <svtools/..>
 	# They probably should be in svtools/inc/svtools
 	# This means that include files can only be included after svtools
 	# is built, which would mean a circular dependency,
 	# because svtools depends on toolkit.
-	ln -sf ../$(PRJ)/svtools/inc svtools
+	ln -sf ..$/$(PRJ)$/svtools$/inc $(INCCOM)$/svtools
 
 dist .PHONY :
 	$(SHELL) ./un-test.sh zoom.cxx > ../$(PRJ)/svx/source/dialog/zoom.cxx
Index: toolkit/workben/layout/more.xml
===================================================================
RCS file: toolkit/workben/layout/more.xml
diff -N toolkit/workben/layout/more.xml
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ toolkit/workben/layout/more.xml	20 Mar 2008 11:56:31 -0000	1.1.2.1
@@ -0,0 +1,19 @@
+<?xml version="1.0" encoding="UTF-8"?>
+
+<modaldialog xmlns="http://openoffice.org/2007/layout"
+             xmlns:cnt="http://openoffice.org/2007/layout/container"
+             id="RID_SVXDLG_MORE" _title="Test More" optimumsize="true"
+	     help-id="SID_ATTR_RESTORE"
+             has_border="true" sizeable="true" moveable="true">
+    <vbox spacing="5" border="5" width="640">
+	<fixedtext id="FT_ONE" _label="One"/>
+	<fixedtext id="FT_TWO" _label="Two"/>
+	<hbox border="5">
+	    <flow/>
+	    <morebutton id="PB_MORE" cnt:expand="false" _label="More..."/>
+	</hbox>
+	<fixedtext id="FT_THREE" _label="Three"/>
+	<fixedtext id="FT_FOUR" _label="Four"/>
+    </vbox>
+</modaldialog>
+
Index: toolkit/workben/layout/recover.cxx
===================================================================
RCS file: toolkit/workben/layout/recover.cxx
diff -N toolkit/workben/layout/recover.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ toolkit/workben/layout/recover.cxx	30 Jul 2008 11:17:31 -0000	1.1.2.2
@@ -0,0 +1,107 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifdef SVX_DLLIMPLEMENTATION
+#undef SVX_DLLIMPLEMENTATION
+#endif
+
+#if TEST_LAYOUT
+#include <cstdio>
+#endif /* TEST_LAYOUT */
+#include <com/sun/star/awt/XDialog2.hpp>
+#include <tools/shl.hxx>
+#include <svtools/itemset.hxx>
+#include <svtools/itempool.hxx>
+#include <sfx2/objsh.hxx>
+#include <vcl/msgbox.hxx>
+#include <toolkit/awt/vclxwindow.hxx>
+
+
+#include <com/sun/star/awt/PosSize.hpp> //redrawAlready
+
+using namespace com::sun::star;
+
+#define _SVX_RECOVER_CXX
+
+#include "recover.hxx"
+
+#include <layout/layout-pre.hxx>
+
+#if TEST_LAYOUT
+SvxRecoverDialog::SvxRecoverDialog( Window* pParent )
+#else /* !TEST_LAYOUT */
+SvxRecoverDialog::SvxRecoverDialog( Window* pParent, const SfxItemSet& rCoreSet )
+#endif /* !TEST_LAYOUT */
+: SfxModalDialog( pParent, SVX_RES( RID_SVXDLG_RECOVER ) )
+
+    , aHeaderImage( this, SVX_RES( FI_HEADER ) )
+    , aHeaderText( this, SVX_RES( FT_HEADER ) )
+    , aHeaderLine( this, SVX_RES( FL_HEADER ) )
+    , aRecoverText( this, SVX_RES( FT_RECOVER ) )
+    , aTextAdvanced( this, SVX_RES( FT_ADVANCED ) )
+
+	, aCheckBoxDoc( this, SVX_RES( CB_DOC ) )
+	, aImageDoc( this, SVX_RES( FI_DOC ) )
+	, aTextDoc( this, SVX_RES( FT_DOC ) )
+
+	, aCheckBoxSheet( this, SVX_RES( CB_SHEET ) )
+	, aImageSheet( this, SVX_RES( FI_SHEET ) )
+	, aTextSheet( this, SVX_RES( FT_SHEET ) )
+
+	, aCheckBoxDraw( this, SVX_RES( CB_DRAW ) )
+	, aImageDraw( this, SVX_RES( FI_DRAW ) )
+	, aTextDraw( this, SVX_RES( FT_DRAW ) )
+
+	, aCheckBoxPresent( this, SVX_RES( CB_PRESENT ) )
+	, aImagePresent( this, SVX_RES( FI_PRESENT ) )
+	, aTextPresent( this, SVX_RES( FT_PRESENT ) )
+
+	, aButtonAdvanced( this, SVX_RES( PB_ADVANCED ) )
+
+    , aProgressText( this, SVX_RES( FT_PROGRESS ) )
+    , aProgressBar( this, SVX_RES( PB_RECOVER ) )
+	, aCheckBoxLogFile( this, SVX_RES( CH_LOGFILE ) )
+    , aOKBtn( this, SVX_RES( BTN_OK ) )
+	, aCancelBtn( this, SVX_RES( BTN_CANCEL ) )
+	, aHelpBtn( this, SVX_RES( BTN_HELP ) )
+{
+    aButtonAdvanced.AddAdvanced( &aTextAdvanced );
+    aButtonAdvanced.AddAdvanced( &aCheckBoxDoc );
+    aButtonAdvanced.AddAdvanced( &aCheckBoxSheet );
+    aButtonAdvanced.AddAdvanced( &aCheckBoxDraw );
+    aButtonAdvanced.AddAdvanced( &aCheckBoxPresent );
+    aButtonAdvanced.AddAdvanced( &aCheckBoxLogFile );
+}
+
+
+SvxRecoverDialog::~SvxRecoverDialog()
+{
+}
Index: toolkit/workben/layout/recover.hxx
===================================================================
RCS file: toolkit/workben/layout/recover.hxx
diff -N toolkit/workben/layout/recover.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ toolkit/workben/layout/recover.hxx	30 Jul 2008 11:17:36 -0000	1.1.2.2
@@ -0,0 +1,83 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef _SVX_RECOVER_HXX
+#define _SVX_RECOVER_HXX
+
+#include <layout/layout.hxx>
+#include <vcl/button.hxx>
+#include <vcl/field.hxx>
+#include <vcl/fixed.hxx>
+#include <box.hxx>
+#include <layout/layout-pre.hxx>
+
+class SvxRecoverDialog : public SfxModalDialog
+{
+private:
+    FixedImage aHeaderImage;
+    FixedText aHeaderText;
+    FixedLine aHeaderLine;
+    FixedText aRecoverText;
+    FixedText aTextAdvanced;
+
+	CheckBox aCheckBoxDoc;
+    FixedImage aImageDoc;
+    FixedText aTextDoc;
+	CheckBox aCheckBoxSheet;
+    FixedImage aImageSheet;
+    FixedText aTextSheet;
+	CheckBox aCheckBoxDraw;
+    FixedImage aImageDraw;
+    FixedText aTextDraw;
+	CheckBox aCheckBoxPresent;
+    FixedImage aImagePresent;
+    FixedText aTextPresent;
+	AdvancedButton aButtonAdvanced;
+
+    FixedText aProgressText;
+    ProgressBar aProgressBar;
+	CheckBox aCheckBoxLogFile;
+	OKButton aOKBtn;
+	CancelButton aCancelBtn;
+	HelpButton aHelpBtn;
+
+public:
+#if TEST_LAYOUT
+	SvxRecoverDialog( Window* pParent );
+#else /* !TEST_LAYOUT */
+	SvxRecoverDialog( Window* pParent, const SfxItemSet& rCoreSet );
+#endif /* !TEST_LAYOUT */
+	~SvxRecoverDialog();
+};
+
+#include <layout/layout-post.hxx>
+
+#endif
+
Index: toolkit/workben/layout/recover.xml
===================================================================
RCS file: toolkit/workben/layout/recover.xml
diff -N toolkit/workben/layout/recover.xml
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ toolkit/workben/layout/recover.xml	4 Apr 2008 09:13:34 -0000	1.1.2.2
@@ -0,0 +1,67 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!-- This is a template.  i18n translation is not performed in-place;
+     i18n translated xml files are generated from this template by
+     transex3/layout/tralay.  !-->
+
+<modaldialog xmlns="http://openoffice.org/2007/layout"
+             xmlns:cnt="http://openoffice.org/2007/layout/container"
+             id="RID_SVXDLG_RECOVER" _title="OpenOffice.org Document Restore -- questions to sigi(at)novell.com--" optimumsize="true"
+	     help-id="SID_ATTR_RESTORE"
+             has_border="true" sizeable="true" moveable="true">
+    <vbox spacing="5" border="5" width="640">
+        <hbox spacing="5" cnt:expand="false">
+	    <fixedimage id="FI_HEADER" cnt:expand="false" graphic="res/commandimagelist/sc_apply.png" />
+	    <fixedtext id="FT_HEADER" _label="OpenOffice.org Document Restore"/>
+	</hbox>
+	<fixedline id="FL_HEADER"/>
+	<!-- mockup: fixedtext multiline=true" does not work? 
+	<multilineedit id="MLE_RECOVER" has_border="false" foobar="x" _text="At least one document was found that was not stored safely to the media.  Uncheck any documents you do not want to restore (information may be lost)."/>
+	<fixedtext id="FT_RECOVER" has_border="false" multi-line="true" font-word-line-mode="true" word-break="true"  _label="At least one document was found that was not stored safely to the media.  Uncheck any documents you do not want to restore (information may be lost).
+LINE TEST"/>
+	!-->
+	<fixedtext id="FT_RECOVER" has_border="false" multi-line="true" font-word-line-mode="true" _label="At least one document was not stored safely and must be recovered."/>
+	<fixedtext id="FT_ADVANCED" has_border="false" multi-line="true" font-word-line-mode="true" word-break="true"  _label="Uncheck any documents you do not want to restore (information may be lost)."/>
+	<vbox cnt:fill="true" cnt:expand="true" cnt:padding="20" border="20" spacing="20">
+	    <hbox>
+		<checkbox id="CB_DOC" state="1" cnt:expand="false" scale="false"/>
+		<fixedimage id="FI_DOC" cnt:v-align="0.5" image-align="0.5" cnt:expand="false" scale="false" graphic="res/commandimagelist/lc_insertdoc.png"/>
+		<fixedtext id="FT_DOC" _label="My document"/>
+	    </hbox>
+	    <hbox>
+		<checkbox id="CB_SHEET" state="1" cnt:expand="false" scale="false" /> 
+		<fixedimage id="FI_SHEET" cnt:expand="false" scale="false" graphic="res/commandimagelist/lc_inserttable.png" />
+		<fixedtext id="FT_SHEET" _label="My spreadsheet"/>
+	    </hbox>
+	    <hbox>
+		<checkbox id="CB_DRAW" state="1" cnt:expand="false" scale="false"/>
+		<fixedimage id="FI_DRAW" cnt:expand="false" scale="false" graphic="res/commandimagelist/lc_insertdraw.png" />
+		<fixedtext id="FT_DRAW" _label="My drawing"/>
+	    </hbox>
+	    <hbox>
+		<checkbox id="CB_PRESENT" state="1" cnt:expand="false" scale="false" />
+		<fixedimage id="FI_PRESENT" cnt:expand="false" scale="false" graphic="res/commandimagelist/lc_insertvideo.png" />
+		<fixedtext id="FT_PRESENT" _label="My presentation"/>
+	    </hbox>
+	    <hbox border="5">
+		<flow/>
+		<advancedbutton id="PB_ADVANCED" cnt:expand="false" _label="Advanced..."/>
+	    </hbox>
+	</vbox>
+	<vbox>
+	    <fixedtext id="FT_PROGRESS" _label="Restore progress (idle)"/>
+	    <hbox height="40" cnt:expand="true">
+		<progressbar cnt:expand="true" cnt:fill="true" id="PB_RECOVER" has_border="true" border="10" fill-color="#ccccff" background-color="#ffffff" progress-value-min="0" progress-value-max="100" progress-value="50" />
+		<!-- FIXME: cannot set progress bar's height, use space as strut... !--> 
+		<fixedtext label="" height="10" cnt:expand="false" cnt:fill="false"/>
+	    </hbox>
+	</vbox>
+	<checkbox id="CH_LOGFILE" _label="Open additional text document to display the restore logfile"/>
+	<dialogbuttonhbox border="5" spacing="5">
+	    <flow/>
+	    <okbutton id="BTN_OK" _label="Restore"/>
+	    <cancelbutton id="BTN_CANCEL" />
+	    <helpbutton id="BTN_HELP"/>
+	</dialogbuttonhbox>
+    </vbox>
+</modaldialog>
+
Index: toolkit/workben/layout/simple-paragraph.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/simple-paragraph.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.3
--- toolkit/workben/layout/simple-paragraph.cxx	11 Apr 2008 09:42:58 -0000	1.3
+++ toolkit/workben/layout/simple-paragraph.cxx	30 Jul 2008 12:36:28 -0000	1.2.6.3
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifdef SVX_DLLIMPLEMENTATION
 #undef SVX_DLLIMPLEMENTATION
 #endif
Index: toolkit/workben/layout/simple-paragraph.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/simple-paragraph.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/workben/layout/simple-paragraph.hxx	6 Mar 2008 12:04:48 -0000	1.2
+++ toolkit/workben/layout/simple-paragraph.hxx	30 Jul 2008 11:17:47 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef _SVX_SIMPLE_PARAGRAPH_HXX
 #define _SVX_SIMPLE_PARAGRAPH_HXX
 
Index: toolkit/workben/layout/tabcontrol.xml
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/tabcontrol.xml,v
retrieving revision 1.2
retrieving revision 1.2.6.1
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.1
--- toolkit/workben/layout/tabcontrol.xml	6 Mar 2008 12:05:35 -0000	1.2
+++ toolkit/workben/layout/tabcontrol.xml	14 Apr 2008 13:01:03 -0000	1.2.6.1
@@ -6,7 +6,7 @@
         has_border="true" sizeable="true" moveable="true">
 	<vbox>
 		<tabcontrol>
--			<pushbutton label="Child 1" cnt:title="Page 1" />
+			<pushbutton label="Child 1" cnt:title="Page 1" />
 			<edit has_border="true" text="Child 2" cnt:title="Page 2" />
 			<vbox cnt:title="Page 3">
 				<pushbutton label="Child 3"/>
Index: toolkit/workben/layout/test.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/test.cxx,v
retrieving revision 1.2
retrieving revision 1.2.6.3
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.3
--- toolkit/workben/layout/test.cxx	6 Mar 2008 12:06:00 -0000	1.2
+++ toolkit/workben/layout/test.cxx	30 Jul 2008 11:17:52 -0000	1.2.6.3
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #include <vcl/svapp.hxx>
 //#include <transex3/vosapp.hxx>
 
@@ -25,6 +57,9 @@
 #include "zoom.hxx"
 #undef _LAYOUT_POST_HXX
 
+#include "recover.hxx"
+#undef _LAYOUT_POST_HXX
+
 //#undef SW_WORDCOUNTDIALOG_HXX
 #include <layout/layout-pre.hxx>
 
@@ -161,7 +196,7 @@ void LayoutTest::IInit()
 
 void LayoutTest::ParseCommandLine()
 {
-    for ( int i = 0; i < GetCommandLineParamCount(); i++ )
+    for ( sal_uInt16 i = 0; i < GetCommandLineParamCount(); i++ )
     {
         OUString aParam = OUString( GetCommandLineParam( i ) );
         if ( aParam.equalsAscii( "-h" ) || aParam.equalsAscii( "--help" ) )
@@ -220,6 +255,11 @@ void TestDialog( OUString const& name )
         SwWordCountDialog words ( 0 );
         RunDialog( words );
     }
+    else if ( name.equalsAscii( "recover" ) )
+    {
+        SvxRecoverDialog recover ( 0 );
+        RunDialog( recover );
+    }
 }
 
 void LayoutTest::RunFiles()
Index: toolkit/workben/layout/uno.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/uno.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/workben/layout/uno.hxx	6 Mar 2008 12:06:47 -0000	1.2
+++ toolkit/workben/layout/uno.hxx	30 Jul 2008 11:17:58 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef _LAYOUT_UNO_HXX
 #define _LAYOUT_UNO_HXX
 
Index: toolkit/workben/layout/wordcount.xml
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/wordcount.xml,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/workben/layout/wordcount.xml	6 Mar 2008 12:07:20 -0000	1.2
+++ toolkit/workben/layout/wordcount.xml	4 Apr 2008 09:13:34 -0000	1.2.6.2
@@ -1,9 +1,12 @@
 <?xml version="1.0" encoding="UTF-8"?>
+<!-- This is a template.  i18n translation is not performed in-place;
+     i18n translated xml files are generated from this template by
+     transex3/layout/tralay.  !-->
 
 <modaldialog xmlns="http://openoffice.org/2007/layout"
              xmlns:cnt="http://openoffice.org/2007/layout/container"
              help-id="HID_DLG_WORDCOUNT"
-             id="dialog"
+             id="DLG_WORDCOUNT"
              sizeable="true" moveable="true" optimumsize="true"
              has_border="true" sv-look="true" _title="Word Count">
     <vbox border="5" spacing="5">
Index: toolkit/workben/layout/wordcountdialog.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/wordcountdialog.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.4
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.4
--- toolkit/workben/layout/wordcountdialog.cxx	11 Apr 2008 09:43:15 -0000	1.3
+++ toolkit/workben/layout/wordcountdialog.cxx	30 Jul 2008 12:36:25 -0000	1.2.6.4
@@ -84,7 +84,15 @@ SwWordCountDialog::~SwWordCountDialog()
 /*-- 06.04.2004 16:05:57---------------------------------------------------
 
   -----------------------------------------------------------------------*/
-void  SwWordCountDialog::SetValues(const SwDocStat& rCurrent, const SwDocStat& rDoc)
+void  SwWordCountDialog::SetValues(const SwDocStat& 
+#if !TEST_LAYOUT
+                                   rCurrent,
+#endif
+                                   , const SwDocStat&
+#if !TEST_LAYOUT
+                                   rDoc
+#endif
+                                   )
 {
 #if !TEST_LAYOUT
     aCurrentWordFI.SetText(     String::CreateFromInt32(rCurrent.nWord ));
Index: toolkit/workben/layout/zoom.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/zoom.cxx,v
retrieving revision 1.3
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.2
--- toolkit/workben/layout/zoom.cxx	11 Apr 2008 09:43:47 -0000	1.3
+++ toolkit/workben/layout/zoom.cxx	30 Jul 2008 12:36:22 -0000	1.2.6.2
@@ -72,8 +72,42 @@ struct SvxZoomItem
         fprintf( stderr, "Zoom factor: %d\n", int( n ) );
     }
 };
+#define SfxPoolItem LAYOUT_SfxPoolItem
+class LAYOUT_SfxPoolItem
+{
+};
+struct SvxViewLayoutItem : public LAYOUT_SfxPoolItem
+{
+    bool IsBookMode()
+    {
+        return false;
+    }
+    USHORT GetValue()
+    {
+        return 0;
+    }
+
+    void SetValue( int n )
+    {
+        fprintf( stderr, "Zoom factor: %d\n", int( n ) );
+    }
+    void SetBookMode( bool )
+    {
+    }
+#if 0 // needed for real SfxPoolItem
+    int operator==( const SfxPoolItem& ) const
+    {
+        return 0;
+    }
+    SfxPoolItem* Clone( SfxItemPool* ) const
+    {
+        return 0;
+    }
+#endif
+};
 #else /* !TEST_LAYOUT */
 #include <svx/zoomitem.hxx>
+#include <svx/viewlayoutitem.hxx>
 #include <svx/dialmgr.hxx>
 #endif /* !TEST_LAYOUT */
 #include "zoom_def.hxx"
@@ -95,16 +129,8 @@ static USHORT pRanges[] =
 
 USHORT SvxZoomDialog::GetFactor() const
 {
-	if ( a200Btn.IsChecked() )
-		return 200;
-	if ( a150Btn.IsChecked() )
-		return 150;
 	if ( a100Btn.IsChecked() )
 		return 100;
-	if ( a75Btn.IsChecked() )
-		return 75;
-	if ( a50Btn.IsChecked() )
-		return 50;
 	if ( aUserBtn.IsChecked() )
 		return (USHORT)aUserEdit.GetValue();
 	else
@@ -122,31 +148,11 @@ void SvxZoomDialog::SetFactor( USHORT nN
 
 	if ( !nBtnId )
 	{
-		if ( nNewFactor == 200 )
-		{
-			a200Btn.Check();
-			a200Btn.GrabFocus();
-		}
-		else if ( nNewFactor == 150 )
-		{
-			a150Btn.Check();
-			a150Btn.GrabFocus();
-		}
-		else if ( nNewFactor == 100 )
+        if ( nNewFactor == 100 )
 		{
 			a100Btn.Check();
 			a100Btn.GrabFocus();
 		}
-		else if ( nNewFactor == 75 )
-		{
-			a75Btn.Check();
-			a75Btn.GrabFocus();
-		}
-		else if ( nNewFactor == 50 )
-		{
-			a50Btn.Check();
-			a50Btn.GrabFocus();
-		}
 		else
 		{
 			aUserBtn.Check();
@@ -252,16 +258,21 @@ SvxZoomDialog::SvxZoomDialog( Window* pP
 	SfxModalDialog( pParent, SVX_RES( RID_SVXDLG_ZOOM ) ),
 
     aZoomFl         ( this, SVX_RES( FL_ZOOM ) ),
+    aOptimalBtn     ( this, SVX_RES( BTN_OPTIMAL ) ),
     aWholePageBtn   ( this, SVX_RES( BTN_WHOLE_PAGE ) ),
     aPageWidthBtn   ( this, SVX_RES( BTN_PAGE_WIDTH ) ),
-    aOptimalBtn     ( this, SVX_RES( BTN_OPTIMAL ) ),
-    a200Btn         ( this, SVX_RES( BTN_200 ) ),
-	a150Btn         ( this, SVX_RES( BTN_150 ) ),
 	a100Btn         ( this, SVX_RES( BTN_100 ) ),
-	a75Btn          ( this, SVX_RES( BTN_75 ) ),
-	a50Btn          ( this, SVX_RES( BTN_50 ) ),
     aUserBtn        ( this, SVX_RES( BTN_USER ) ),
 	aUserEdit       ( this, SVX_RES( ED_USER ) ),
+
+    aViewLayoutFl   ( this, SVX_RES( FL_VIEWLAYOUT ) ),
+    aAutomaticBtn   ( this, SVX_RES( BTN_AUTOMATIC ) ),
+    aSingleBtn      ( this, SVX_RES( BTN_SINGLE ) ),
+    aColumnsBtn     ( this, SVX_RES( BTN_COLUMNS ) ),
+    aColumnsEdit    ( this, SVX_RES( ED_COLUMNS ) ),
+    aBookModeChk    ( this, SVX_RES( CHK_BOOK ) ),
+
+    aBottomFl       ( this, SVX_RES( FL_BOTTOM ) ),
     aOKBtn          ( this, SVX_RES( BTN_ZOOM_OK ) ),
 	aCancelBtn      ( this, SVX_RES( BTN_ZOOM_CANCEL ) ),
 	aHelpBtn	    ( this, SVX_RES( BTN_ZOOM_HELP ) ),
@@ -274,15 +285,23 @@ SvxZoomDialog::SvxZoomDialog( Window* pP
 
 {
 	Link aLink = LINK( this, SvxZoomDialog, UserHdl );
-	a200Btn.SetClickHdl( aLink );
-	a150Btn.SetClickHdl( aLink );
 	a100Btn.SetClickHdl( aLink );
-	a75Btn.SetClickHdl( aLink );
-	a50Btn.SetClickHdl( aLink );
 	aOptimalBtn.SetClickHdl( aLink );
 	aPageWidthBtn.SetClickHdl( aLink );
 	aWholePageBtn.SetClickHdl( aLink );
 	aUserBtn.SetClickHdl( aLink );
+
+    Link aViewLayoutLink = LINK( this, SvxZoomDialog, ViewLayoutUserHdl );
+    aAutomaticBtn.SetClickHdl( aViewLayoutLink );
+    aSingleBtn.SetClickHdl( aViewLayoutLink );
+    aColumnsBtn.SetClickHdl( aViewLayoutLink );
+
+    Link aViewLayoutSpinLink = LINK( this, SvxZoomDialog, ViewLayoutSpinHdl );
+    aColumnsEdit.SetModifyHdl( aViewLayoutSpinLink );
+
+    Link aViewLayoutCheckLink = LINK( this, SvxZoomDialog, ViewLayoutCheckHdl );
+    aBookModeChk.SetClickHdl( aViewLayoutCheckLink );
+
 	aOKBtn.SetClickHdl( LINK( this, SvxZoomDialog, OKHdl ) );
 	aUserEdit.SetModifyHdl( LINK( this, SvxZoomDialog, SpinHdl ) );
 
@@ -323,9 +342,9 @@ SvxZoomDialog::SvxZoomDialog( Window* pP
 	if ( rItem.ISA(SvxZoomItem) )
 	{
 		const SvxZoomItem& rZoomItem = (const SvxZoomItem&)rItem;
-        USHORT nZoom = rZoomItem.GetValue();
-		SvxZoomType eType = rZoomItem.GetType();
-		USHORT nValSet = rZoomItem.GetValueSet();
+        const USHORT nZoom = rZoomItem.GetValue();
+        const SvxZoomType eType = rZoomItem.GetType();
+        const USHORT nValSet = rZoomItem.GetValueSet();
 		USHORT nBtnId = 0;
 
 		switch ( eType )
@@ -345,17 +364,8 @@ SvxZoomDialog::SvxZoomDialog( Window* pP
                 break;
 		}
 
-		// ggf. Buttons disablen
-		if ( !(SVX_ZOOM_ENABLE_50 & nValSet) )
-			a50Btn.Disable();
-		if ( !(SVX_ZOOM_ENABLE_75 & nValSet) )
-			a75Btn.Disable();
 		if ( !(SVX_ZOOM_ENABLE_100 & nValSet) )
 			a100Btn.Disable();
-		if ( !(SVX_ZOOM_ENABLE_150 & nValSet) )
-			a150Btn.Disable();
-		if ( !(SVX_ZOOM_ENABLE_200 & nValSet) )
-			a200Btn.Disable();
 		if ( !(SVX_ZOOM_ENABLE_OPTIMAL & nValSet) )
 			aOptimalBtn.Disable();
 		if ( !(SVX_ZOOM_ENABLE_PAGEWIDTH & nValSet) )
@@ -366,9 +376,56 @@ SvxZoomDialog::SvxZoomDialog( Window* pP
 	}
 	else
 	{
-        USHORT nZoom = ( (const SfxUInt16Item&)rItem ).GetValue();
+        const USHORT nZoom = ( (const SfxUInt16Item&)rItem ).GetValue();
         SetFactor( nZoom );
 	}
+
+    const SfxPoolItem* pViewLayoutItem = 0;
+    if ( SFX_ITEM_SET == rSet.GetItemState( SID_ATTR_VIEWLAYOUT, FALSE, &pViewLayoutItem ) )
+    {
+        const USHORT nColumns = static_cast<const SvxViewLayoutItem*>(pViewLayoutItem)->GetValue();
+        const bool bBookMode  = static_cast<const SvxViewLayoutItem*>(pViewLayoutItem)->IsBookMode();
+
+        if ( 0 == nColumns )
+        {
+            aAutomaticBtn.Check();
+            aColumnsEdit.SetValue( 2 );
+            aColumnsEdit.Disable();
+            aBookModeChk.Disable();
+        }
+        else if ( 1 == nColumns)
+        {
+            aSingleBtn.Check();
+            aColumnsEdit.SetValue( 2 );
+            aColumnsEdit.Disable();
+            aBookModeChk.Disable();
+        }
+        else
+        {
+            aColumnsBtn.Check();
+            if ( !bBookMode )
+            {
+                aColumnsEdit.SetValue( nColumns );
+                if ( 0 != nColumns % 2 )
+                    aBookModeChk.Disable();
+            }
+            else
+            {
+                aColumnsEdit.SetValue( nColumns );
+                aBookModeChk.Check();
+            }
+        }
+    }
+    else
+    {
+        // hide view layout related controls:
+        aViewLayoutFl.Disable();
+        aAutomaticBtn.Disable();
+        aSingleBtn.Disable();
+        aColumnsBtn.Disable();
+        aColumnsEdit.Disable();
+        aBookModeChk.Disable();
+    }
 #endif /* !TEST_LAYOUT */
 
 	FreeResource();
@@ -420,17 +477,82 @@ IMPL_LINK( SvxZoomDialog, SpinHdl, Metri
 
 // -----------------------------------------------------------------------
 
+IMPL_LINK( SvxZoomDialog, ViewLayoutUserHdl, RadioButton *, pBtn )
+{
+    bModified |= TRUE;
+
+    if ( pBtn == &aAutomaticBtn )
+    {
+        aColumnsEdit.Disable();
+        aBookModeChk.Disable();
+    }
+    else if ( pBtn == &aSingleBtn )
+    {
+        aColumnsEdit.Disable();
+        aBookModeChk.Disable();
+    }
+    else if ( pBtn == &aColumnsBtn )
+    {
+        aColumnsEdit.Enable();
+        aColumnsEdit.GrabFocus();
+        if ( 0 == aColumnsEdit.GetValue() % 2 )
+            aBookModeChk.Enable();
+    }
+    else
+    {
+        DBG_ERROR( "Wrong Button" );
+        return 0;
+    }
+
+    return 0;
+}
+
+// -----------------------------------------------------------------------
+
+IMPL_LINK( SvxZoomDialog, ViewLayoutSpinHdl, MetricField *, pEdt )
+{
+    if ( pEdt == &aColumnsEdit && !aColumnsBtn.IsChecked() )
+        return 0;
+
+    if ( 0 == aColumnsEdit.GetValue() % 2 )
+        aBookModeChk.Enable();
+    else
+    {
+        aBookModeChk.Check( sal_False );
+        aBookModeChk.Disable();
+    }
+
+    bModified |= TRUE;
+
+    return 0;
+}
+
+// -----------------------------------------------------------------------
+
+IMPL_LINK( SvxZoomDialog, ViewLayoutCheckHdl, CheckBox *, pChk )
+{
+    if ( pChk == &aBookModeChk && !aColumnsBtn.IsChecked() )
+        return 0;
+
+    bModified |= TRUE;
+
+    return 0;
+}
+
+// -----------------------------------------------------------------------
+
 IMPL_LINK( SvxZoomDialog, OKHdl, Button *, pBtn )
 {
 	if ( bModified || &aOKBtn != pBtn )
 	{
 #if TEST_LAYOUT
-		SvxZoomItem aItem;
+		SvxZoomItem aZoomItem;
+		SvxViewLayoutItem aViewLayoutItem;
 #else /* !TEST_LAYOUT */
-		SvxZoomItem aItem( SVX_ZOOM_PERCENT, 0,
-						   rSet.GetPool()->GetWhich( SID_ATTR_ZOOM ) );
-
+        SvxZoomItem aZoomItem( SVX_ZOOM_PERCENT, 0, rSet.GetPool()->GetWhich( SID_ATTR_ZOOM ) );
+        SvxViewLayoutItem aViewLayoutItem( 0, false, rSet.GetPool()->GetWhich( SID_ATTR_VIEWLAYOUT ) );
 #endif /* !TEST_LAYOUT */
+
 		if ( &aOKBtn == pBtn )
 		{
 			USHORT nFactor = GetFactor();
@@ -438,14 +560,30 @@ IMPL_LINK( SvxZoomDialog, OKHdl, Button 
 			if ( SPECIAL_FACTOR == nFactor )
 			{
 				if ( aOptimalBtn.IsChecked() )
-					aItem.SetType( SVX_ZOOM_OPTIMAL );
+                    aZoomItem.SetType( SVX_ZOOM_OPTIMAL );
 				else if ( aPageWidthBtn.IsChecked() )
-					aItem.SetType( SVX_ZOOM_PAGEWIDTH );
+                    aZoomItem.SetType( SVX_ZOOM_PAGEWIDTH );
 				else if ( aWholePageBtn.IsChecked() )
-					aItem.SetType( SVX_ZOOM_WHOLEPAGE );
+                    aZoomItem.SetType( SVX_ZOOM_WHOLEPAGE );
 			}
 			else
-				aItem.SetValue( nFactor );
+                aZoomItem.SetValue( nFactor );
+
+            if ( aAutomaticBtn.IsChecked() )
+            {
+                aViewLayoutItem.SetValue( 0 );
+                aViewLayoutItem.SetBookMode( false );
+            }
+            if ( aSingleBtn.IsChecked() )
+            {
+                aViewLayoutItem.SetValue( 1 );
+                aViewLayoutItem.SetBookMode( false );
+            }
+            else if ( aColumnsBtn.IsChecked() )
+            {
+                aViewLayoutItem.SetValue( static_cast<USHORT>(aColumnsEdit.GetValue()) );
+                aViewLayoutItem.SetBookMode( aBookModeChk.IsChecked() );
+            }
 		}
 		else
 		{
@@ -454,7 +592,11 @@ IMPL_LINK( SvxZoomDialog, OKHdl, Button 
 		}
 #if !TEST_LAYOUT
 		pOutSet = new SfxItemSet( rSet );
-		pOutSet->Put( aItem );
+        pOutSet->Put( aZoomItem );
+
+        // don't set attribute in case the whole viewlayout stuff is disabled:
+        if ( aViewLayoutFl.IsEnabled() )
+            pOutSet->Put( aViewLayoutItem );
 
 		// Wert aus dem UserEdit "uber den Dialog hinaus merken
 		SfxObjectShell* pSh = SfxObjectShell::Current();
Index: toolkit/workben/layout/zoom.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/zoom.hxx,v
retrieving revision 1.3
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.3 -r1.2.6.2
--- toolkit/workben/layout/zoom.hxx	11 Apr 2008 09:44:04 -0000	1.3
+++ toolkit/workben/layout/zoom.hxx	30 Jul 2008 12:36:31 -0000	1.2.6.2
@@ -66,16 +66,21 @@ class SvxZoomDialog : public SfxModalDia
 {
 private:
     FixedLine           aZoomFl;
+    RadioButton         aOptimalBtn;
 	RadioButton 		aWholePageBtn;
 	RadioButton 		aPageWidthBtn;
-	RadioButton 		aOptimalBtn;
-    RadioButton         a200Btn;
-	RadioButton 		a150Btn;
 	RadioButton 		a100Btn;
-	RadioButton 		a75Btn;
-	RadioButton 		a50Btn;
     RadioButton         aUserBtn;
 	MetricField 		aUserEdit;
+
+    FixedLine           aViewLayoutFl;
+    RadioButton         aAutomaticBtn;
+    RadioButton         aSingleBtn;
+    RadioButton         aColumnsBtn;
+    MetricField         aColumnsEdit;
+    CheckBox            aBookModeChk;
+
+    FixedLine           aBottomFl;
 	OKButton  			aOKBtn;
 	CancelButton		aCancelBtn;
 	HelpButton			aHelpBtn;
@@ -89,6 +94,9 @@ private:
 #ifdef _SVX_ZOOM_CXX
 	DECL_LINK( UserHdl, RadioButton* );
 	DECL_LINK( SpinHdl, MetricField* );
+    DECL_LINK( ViewLayoutUserHdl, RadioButton* );
+    DECL_LINK( ViewLayoutSpinHdl, MetricField* );
+    DECL_LINK( ViewLayoutCheckHdl, CheckBox* );
 	DECL_LINK( OKHdl, Button* );
 #endif
 
Index: toolkit/workben/layout/zoom.xml
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/zoom.xml,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/workben/layout/zoom.xml	6 Mar 2008 12:09:26 -0000	1.2
+++ toolkit/workben/layout/zoom.xml	4 Apr 2008 09:13:34 -0000	1.2.6.2
@@ -1,20 +1,21 @@
 <?xml version="1.0" encoding="UTF-8"?>
+<!-- This is a template.  i18n translation is not performed in-place;
+     i18n translated xml files are generated from this template by
+     transex3/layout/tralay.  !-->
 
 <modaldialog xmlns="http://openoffice.org/2007/layout"
              xmlns:cnt="http://openoffice.org/2007/layout/container"
-             id="dialog" _title="Set Zoom" optimumsize="true"
+             id="RID_SVXDLG_ZOOM" _title="Zoom &amp; View Layout" optimumsize="true"
 	     help-id="SID_ATTR_ZOOM"
              has_border="true" sizeable="true" moveable="true">
     <vbox spacing="5" border="5">
+	<hbox spacing="0" border="0">
+	    <vbox spacing="5" border="5">
 	<fixedline id="FL_ZOOM" _text="Zoom factor" cnt:expand="true"/>
+		<radiobutton radiogroup="zoom" id="BTN_OPTIMAL"   _label="Optimal"/>
 	<radiobutton radiogroup="zoom" id="BTN_WHOLE_PAGE" _label="Whole Page"/>
 	<radiobutton radiogroup="zoom" id="BTN_PAGE_WIDTH" _label="Page Width"/>
-	<radiobutton radiogroup="zoom" id="BTN_OPTIMAL"   _label="Optimal"/>
-	<radiobutton radiogroup="zoom" id="BTN_200"   _label="200 %"/>
-	<radiobutton radiogroup="zoom" id="BTN_150"   _label="15~0 %"/>
 	<radiobutton radiogroup="zoom" id="BTN_100"   _label="100 %"/>
-	<radiobutton radiogroup="zoom" id="BTN_75"    _label="75 %"/>
-	<radiobutton radiogroup="zoom" id="BTN_50"    _label="50 %"/>
 	<hbox cnt:expand="false" cnt:fill="true">
 	    <align cnt:expand="false" cnt:fill="true">
 		<radiobutton cnt:v-align="0.5" cnt:v-fill="0" radiogroup="zoom" id="BTN_USER" _label="Variable"/>
@@ -26,6 +27,27 @@
 			 right="true"
 			 cnt:expand="false"/>
 	</hbox>
+	    </vbox>
+	    <vbox spacing="5" border="5">
+		<fixedline id="FL_VIEWLAYOUT" _text="View layout" cnt:expand="true"/>
+		<radiobutton radiogroup="zoom" id="BTN_AUTOMATIC" _label="~Automatic"/>
+		<radiobutton radiogroup="zoom" id="BTN_SINGLE"    _label="~Single page"/>
+		<hbox cnt:expand="false" cnt:fill="true">
+		    <align cnt:expand="false" cnt:fill="true">
+			<radiobutton cnt:v-align="0.5" cnt:v-fill="0" radiogroup="zoom" id="BTN_COLUMNS" _label="~Columns"/>
+		    </align>
+		    <flow cnt:padding="10" cnt:expand="false"/>
+		    <metricfield id="ED_COLUMNS" value-step="1"
+				 repeat="true" has_border="true" spin="true"
+				 _text="100%"
+				 right="true"
+				 spin-value-min="1"
+				 spin-value="1"
+				 cnt:expand="false"/>
+		</hbox>
+		<hbox><flow cnt:expand="false" cnt:padding="10"/><checkbox id="CHK_BOOK" _label="~Book mode"/></hbox>
+	    </vbox>
+	</hbox>
         <fixedline cnt:padding="1" id="FL_BOTTOM"/>
 	<dialogbuttonhbox border="5" spacing="5">
 	    <flow/>
Index: toolkit/workben/layout/zoom_def.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/workben/layout/zoom_def.hxx,v
retrieving revision 1.2
retrieving revision 1.2.6.2
diff -p -u -u -p -b -w -B -r1.2 -r1.2.6.2
--- toolkit/workben/layout/zoom_def.hxx	6 Mar 2008 12:09:37 -0000	1.2
+++ toolkit/workben/layout/zoom_def.hxx	30 Jul 2008 11:18:03 -0000	1.2.6.2
@@ -1,3 +1,34 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile$
+ *
+ * $Revision$
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
 #ifndef _SVX_ZOOM_DEF_HXX
 #define _SVX_ZOOM_DEF_HXX
 
