Index: connectivity/inc/connectivity/dbtools.hxx
===================================================================
RCS file: /cvs/dba/connectivity/inc/connectivity/dbtools.hxx,v
retrieving revision 1.26
retrieving revision 1.26.12.1
diff -u -p -u -p -r1.26 -r1.26.12.1
--- connectivity/inc/connectivity/dbtools.hxx	5 Jan 2005 11:58:57 -0000	1.26
+++ connectivity/inc/connectivity/dbtools.hxx	17 Jan 2005 14:57:39 -0000	1.26.12.1
@@ -102,6 +102,7 @@ namespace awt {
 namespace lang {
 	struct Locale;
 	class XMultiServiceFactory;
+    class WrappedTargetException;
 }
 namespace container {
 	class XNameAccess;
@@ -151,39 +152,45 @@ namespace dbtools
 
 //=========================================================================
 
-	/** calculates the connection the given RowSet works - or should work - with.
-		<p>If the set has an active connection (ActiveConnection property), this one is returned.
-		Else the parent hierarchy is searched for an object with an XConnection interface. If found, this
-		one is returned.</p>
-		<p>If we still haven't a connection, a new one is calculated from the current RowSet settings (such as
-		DataSource, URL, User, Password) and returned.</p>
-		<p>In any of these cases the calculated connection is <b>forwarded</b> to the RowSet, that means before
-		returning from the function the connection is set as ActiveConnection property on the RowSet !<p>
-		<p>This function  is deprecated, please use connectRowset.</p>
-	@deprecated
-	@see connectRowset
-	*/
-	::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> calcConnection(
-		const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
-		const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory)
-			throw (::com::sun::star::sdbc::SQLException, ::com::sun::star::uno::RuntimeException);
-
 	/** creates a connection which can be used for the rowset given
-		<p>If the rowset already has an ActiveConnection (means a value vor this property), this connection is returned.</p>
-		<p>The connection is calculated from the settings in the row set (data source name, URL, user, pwd).</p>
+
+        The function tries to obtain a connection for the row set with the following
+        steps (in this order):
+        <nl>
+            <li>If the rowset already has an ActiveConnection (means a non-<NULL/> value vor this property),
+                this one is used.</li>
+            <li>If in the parent hierarchy of the row set, there is an object supporting
+                the XConnection interface, this one is returned.</li>
+            <li>If the DataSourceName property of the row set is not empty, a connection for this
+                data source is retrieved.</li>
+            <li>If the URL property of the row set is not empty, an connection for this URL is
+                retrieved from the driver manager.
+        </nl>
+
 		@param _rxRowSet
 			the row set
-		@param _rxFactory
+
+        @param _rxFactory
 			a service factory, which can be used to create data sources, interaction handler etc (the usual stuff)
-		@param _bSetAsActiveConnection
+
+        @param _bSetAsActiveConnection
 			If <TRUE/>, the calculated connection is set as ActiveConnection property on the rowset.
-			In this case, the method behaves exactly like calcConnection.
+
+            If the connection was newly created by the method, and this parameter is <TRUE/>, then
+            the ownership of the conneciton is delivered to a temporary object, which observes the
+            row set: As soon as a connection-relevant property of the row set changes, or as soon
+            as if somebody else sets another ActiveConnection at the row set, the original
+            connection (the one which this function calculated) is disposed and discarded. At this
+            very moment, also the temporary observer object dies. This way, it is ensured that
+            there's no resource leak from an un-owned connection object.
 	*/
 	::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> connectRowset(
 		const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
 		const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory,
 		sal_Bool _bSetAsActiveConnection
-	)	SAL_THROW ( (::com::sun::star::sdbc::SQLException, ::com::sun::star::uno::RuntimeException) );
+	)	SAL_THROW ( ( ::com::sun::star::sdbc::SQLException
+                    , ::com::sun::star::lang::WrappedTargetException
+                    , ::com::sun::star::uno::RuntimeException ) );
 
 	/** returns the connection the RowSet is currently working with (which is the ActiveConnection property)
 	*/
@@ -386,7 +393,7 @@ namespace dbtools
         the current settings (Command/CommandType/Filter/Order) of the given rowset.
 
         As such an instance can be obtained from a <type scope="com::sun::star::sdb">Connection</type>
-        only the function searches for the connection the RowSet is using via calcConnection.
+        only the function searches for the connection the RowSet is using via connectRowset.
         This implies that a connection will be set on the RowSet if needed.
         (need to changes this sometimes ...)
 	*/
Index: connectivity/inc/connectivity/virtualdbtools.hxx
===================================================================
RCS file: /cvs/dba/connectivity/inc/connectivity/virtualdbtools.hxx,v
retrieving revision 1.9
retrieving revision 1.9.26.1
diff -u -p -u -p -r1.9 -r1.9.26.1
--- connectivity/inc/connectivity/virtualdbtools.hxx	22 Oct 2004 11:31:17 -0000	1.9
+++ connectivity/inc/connectivity/virtualdbtools.hxx	17 Jan 2005 14:57:39 -0000	1.9.26.1
@@ -99,6 +99,7 @@ namespace com {
 			namespace lang {
 				class XMultiServiceFactory;
 				class XComponent;
+                class WrappedTargetException;
 				struct Locale;
 			}
 			namespace sdbc {
@@ -165,16 +166,13 @@ namespace connectivity
 				const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory
 			) const SAL_THROW ( (::com::sun::star::sdbc::SQLException) ) = 0;
 
-			virtual ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> calcConnection(
-				const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
-				const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory
-			) const SAL_THROW ( (::com::sun::star::sdbc::SQLException, ::com::sun::star::uno::RuntimeException) ) = 0;
-
 			virtual ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> connectRowset(
 				const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
 				const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory,
 				sal_Bool _bSetAsActiveConnection
-			) const SAL_THROW ( (::com::sun::star::sdbc::SQLException, ::com::sun::star::uno::RuntimeException) ) = 0;
+			) const SAL_THROW ( ( ::com::sun::star::sdbc::SQLException
+                                , ::com::sun::star::lang::WrappedTargetException
+                                , ::com::sun::star::uno::RuntimeException ) ) = 0;
 
 			virtual ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> getRowSetConnection(
 				const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet) 
Index: connectivity/source/commontools/DateConversion.cxx
===================================================================
RCS file: /cvs/dba/connectivity/source/commontools/DateConversion.cxx,v
retrieving revision 1.11
retrieving revision 1.11.78.1
diff -u -p -u -p -r1.11 -r1.11.78.1
--- connectivity/source/commontools/DateConversion.cxx	17 Mar 2004 11:54:46 -0000	1.11
+++ connectivity/source/commontools/DateConversion.cxx	20 Jan 2005 16:49:12 -0000	1.11.78.1
@@ -124,6 +124,7 @@ using namespace ::com::sun::star::beans;
 			{
 				case DataType::INTEGER:
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 				case DataType::TINYINT:
 				case DataType::SMALLINT:
 					if (_rVal.getValueType().getTypeClass() == ::com::sun::star::uno::TypeClass_BOOLEAN)
Index: connectivity/source/commontools/FValue.cxx
===================================================================
RCS file: /cvs/dba/connectivity/source/commontools/FValue.cxx,v
retrieving revision 1.24
retrieving revision 1.24.62.1
diff -u -p -u -p -r1.24 -r1.24.62.1
--- connectivity/source/commontools/FValue.cxx	1 Jun 2004 10:06:14 -0000	1.24
+++ connectivity/source/commontools/FValue.cxx	20 Jan 2005 16:49:13 -0000	1.24.62.1
@@ -119,14 +119,17 @@ namespace {
 				case DataType::INTEGER:
 					bIsCompatible = (DataType::SMALLINT	== _eType2)
 								||	(DataType::TINYINT	== _eType2)
-								||	(DataType::BIT		== _eType2);
+								||	(DataType::BIT		== _eType2)
+								||	(DataType::BOOLEAN	== _eType2);
 					break;
 				case DataType::SMALLINT:
 					bIsCompatible = (DataType::TINYINT	== _eType2)
-								||	(DataType::BIT		== _eType2);
+								||	(DataType::BIT		== _eType2)
+								||	(DataType::BOOLEAN	== _eType2);
 					break;
 				case DataType::TINYINT:
-					bIsCompatible = (DataType::BIT		== _eType2);
+					bIsCompatible = (DataType::BIT		== _eType2)
+								||	(DataType::BOOLEAN	== _eType2);
 					break;
 
 				case DataType::BLOB:
@@ -263,6 +266,7 @@ void ORowSetValue::setTypeKind(sal_Int32
 					(*this) = getInt32();
 					break;
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 					(*this) = getBool();
 					break;
 				case DataType::DATE:
@@ -440,6 +444,7 @@ ORowSetValue& ORowSetValue::operator=(co
 				TRACE_ALLOC( Sequence_sal_Int8 )
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				m_aValue.m_bBool	= _rRH.m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -507,6 +512,7 @@ ORowSetValue& ORowSetValue::operator=(co
 				(*this) = *(Sequence<sal_Int8>*)_rRH.m_aValue.m_pValue;
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				m_aValue.m_bBool	= _rRH.m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -699,7 +705,7 @@ ORowSetValue& ORowSetValue::operator=(co
 
 ORowSetValue& ORowSetValue::operator=(const sal_Bool _rRH)
 {
-	if(m_eTypeKind != DataType::BIT)
+	if(m_eTypeKind != DataType::BIT && DataType::BOOLEAN != m_eTypeKind )
 		free();
 
 	m_aValue.m_bBool = _rRH;
@@ -849,6 +855,7 @@ bool ORowSetValue::operator==(const ORow
 			}
 			break;
 		case DataType::BIT:
+		case DataType::BOOLEAN:
 			bRet = m_aValue.m_bBool == _rRH.m_aValue.m_bBool;
 			break;
 		case DataType::DATE:
@@ -936,6 +943,7 @@ Any ORowSetValue::makeAny() const
 				rValue = getAny();
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				rValue.setValue( &m_aValue.m_bBool, ::getCppuBooleanType() );
 				break;
 			case DataType::TINYINT:
@@ -1015,6 +1023,7 @@ Any ORowSetValue::makeAny() const
 				}
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				aRet = ::rtl::OUString::valueOf((sal_Int32)(sal_Bool)*this);
 				break;
 			case DataType::TINYINT:
@@ -1073,6 +1082,7 @@ sal_Bool ORowSetValue::getBool()	const
 				OSL_ASSERT(!"getBool() for this type is not allowed!");
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				bRet = m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -1124,6 +1134,7 @@ sal_Int8 ORowSetValue::getInt8()	const
 				OSL_ASSERT(!"getInt8() for this type is not allowed!");
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				nRet = m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -1184,6 +1195,7 @@ sal_Int16 ORowSetValue::getInt16()	const
 				OSL_ASSERT(!"getInt16() for this type is not allowed!");
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				nRet = m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -1247,6 +1259,7 @@ sal_Int32 ORowSetValue::getInt32()	const
 				OSL_ASSERT(!"getInt32() for this type is not allowed!");
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				nRet = m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -1310,6 +1323,7 @@ sal_Int64 ORowSetValue::getLong()	const
 				OSL_ASSERT(!"getInt32() for this type is not allowed!");
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				nRet = m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -1377,6 +1391,7 @@ float ORowSetValue::getFloat()	const
 				OSL_ASSERT(!"getDouble() for this type is not allowed!");
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				nRet = m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -1446,6 +1461,7 @@ double ORowSetValue::getDouble()	const
 				OSL_ASSERT(!"getDouble() for this type is not allowed!");
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				nRet = m_aValue.m_bBool;
 				break;
 			case DataType::TINYINT:
@@ -1529,6 +1545,7 @@ void ORowSetValue::setFromDouble(const d
 			OSL_ASSERT(!"setFromDouble() for this type is not allowed!");
 			break;
 		case DataType::BIT:
+		case DataType::BOOLEAN:
 			m_aValue.m_bBool = _rVal != 0.0;
 			break;
 		case DataType::TINYINT:
Index: connectivity/source/commontools/dbtools.cxx
===================================================================
RCS file: /cvs/dba/connectivity/source/commontools/dbtools.cxx,v
retrieving revision 1.53
retrieving revision 1.53.12.2
diff -u -p -u -p -r1.53 -r1.53.12.2
--- connectivity/source/commontools/dbtools.cxx	5 Jan 2005 11:59:23 -0000	1.53
+++ connectivity/source/commontools/dbtools.cxx	20 Jan 2005 16:49:13 -0000	1.53.12.2
@@ -285,6 +285,7 @@ sal_Int32 getDefaultNumberFormat(sal_Int
 	switch (_nDataType)
 	{
 		case DataType::BIT:
+		case DataType::BOOLEAN:
 			nFormat = _xTypes->getStandardFormat(NumberFormat::LOGICAL, _rLocale);
 			break;
 		case DataType::TINYINT:
@@ -364,30 +365,35 @@ Reference< XConnection> findConnection(c
 }
 
 //------------------------------------------------------------------------------
-Reference< XDataSource> getDataSource(
+Reference< XDataSource> getDataSource_allowException(
 			const ::rtl::OUString& _rsTitleOrPath,
-			const Reference< XMultiServiceFactory>& _rxFactory)
+			const Reference< XMultiServiceFactory >& _rxFactory )
 {
-	OSL_ENSURE(_rsTitleOrPath.getLength(), "::getDataSource : invalid arg !");
-
-	Reference< XDataSource>  xDatasource;
+	OSL_ENSURE( _rsTitleOrPath.getLength(), "getDataSource_allowException: invalid arg !" );
 
-	// is it a favorite title ?
 	Reference< XNameAccess> xDatabaseContext(
 		_rxFactory->createInstance(
-			::rtl::OUString::createFromAscii("com.sun.star.sdb.DatabaseContext")),UNO_QUERY);
+			::rtl::OUString::createFromAscii( "com.sun.star.sdb.DatabaseContext" ) ),UNO_QUERY );
+    OSL_ENSURE( xDatabaseContext.is(), "getDataSource_allowException: could not obtain the database context!" );
+
+	return Reference< XDataSource >( xDatabaseContext->getByName( _rsTitleOrPath ), UNO_QUERY );
+}
 
-	if ( xDatabaseContext.is() )
+//------------------------------------------------------------------------------
+Reference< XDataSource > getDataSource(
+			const ::rtl::OUString& _rsTitleOrPath,
+			const Reference< XMultiServiceFactory >& _rxFactory )
+{
+    Reference< XDataSource > xDS;
+	try
 	{
-		try
-		{
-			xDatabaseContext->getByName(_rsTitleOrPath) >>= xDatasource;
-		}
-		catch(Exception)
-		{} // no assertion needed
+        xDS = getDataSource_allowException( _rsTitleOrPath, _rxFactory );
 	}
+	catch(Exception)
+	{
+    }
 
-	return xDatasource;
+    return xDS;
 }
 
 //------------------------------------------------------------------------------
@@ -397,7 +403,7 @@ Reference< XConnection > getConnection_a
 			const ::rtl::OUString& _rsPwd,
 			const Reference< XMultiServiceFactory>& _rxFactory)
 {
-	Reference< XDataSource> xDataSource( getDataSource(_rsTitleOrPath, _rxFactory) );
+	Reference< XDataSource> xDataSource( getDataSource_allowException(_rsTitleOrPath, _rxFactory) );
 	Reference<XConnection> xConnection;
 	if (xDataSource.is())
 	{
@@ -494,17 +500,8 @@ Reference< XConnection> getConnection(co
 }
 
 //------------------------------------------------------------------------------
-Reference< XConnection> calcConnection(
-			const Reference< XRowSet>& _rxRowSet,
-			const Reference< XMultiServiceFactory>& _rxFactory)
-			throw (SQLException, RuntimeException)
-{
-	return connectRowset( _rxRowSet, _rxFactory, sal_True );
-}
-
-//------------------------------------------------------------------------------
 Reference< XConnection> connectRowset(const Reference< XRowSet>& _rxRowSet, const Reference< XMultiServiceFactory>& _rxFactory,
-	sal_Bool _bSetAsActiveConnection )	SAL_THROW ( (SQLException, RuntimeException) )
+	sal_Bool _bSetAsActiveConnection )	SAL_THROW ( ( SQLException, WrappedTargetException, RuntimeException ) )
 {
 	Reference< XConnection> xReturn;
 	Reference< XPropertySet> xRowSetProps(_rxRowSet, UNO_QUERY);
@@ -540,7 +537,7 @@ Reference< XConnection> connectRowset(co
 				{	// the row set has no data source, but a connection url set
 					// -> try to connection with that url
 					Reference< XDriverManager > xDriverManager(
-						_rxFactory->createInstance( ::rtl::OUString::createFromAscii("com.sun.star.sdbc.DriverManager")), UNO_QUERY);
+						_rxFactory->createInstance( ::rtl::OUString::createFromAscii("com.sun.star.sdbc.ConnectionPool")), UNO_QUERY);
 					if (xDriverManager.is())
 					{
 						::rtl::OUString sUser, sPwd;
@@ -565,10 +562,6 @@ Reference< XConnection> connectRowset(co
 			}
 
 			// now if we got a connection, forward it to the row set
-			// (The row set will take ownership of that conn and use it for the next execute.
-			// If one of the properties affecting the connection (DataSource, URL) is set afterwards,
-			// it will free our connection and build a new one with the new parameters on the next execute.
-			// At least the service descriptions says so :)
 			if (xReturn.is() && _bSetAsActiveConnection)
 			{
 				try
@@ -1215,7 +1208,7 @@ Reference< XDataSource> findDataSource(c
     ::rtl::OUString sStatement;
 	try
 	{
-		Reference< XConnection> xConn( calcConnection( Reference< XRowSet >( _rxRowSet, UNO_QUERY ), _rxFactory ) );
+		Reference< XConnection> xConn( connectRowset( Reference< XRowSet >( _rxRowSet, UNO_QUERY ), _rxFactory, sal_True ) );
 		if ( xConn.is() )		// implies _rxRowSet.is()
 		{
 			// build the statement the row set is based on (can't use the ActiveCommand property of the set
@@ -1229,106 +1222,96 @@ Reference< XDataSource> findDataSource(c
             const ::rtl::OUString sPropCommand      = OMetaConnection::getPropMap().getNameByIndex( PROPERTY_ID_COMMAND          );
             const ::rtl::OUString sPropEspaceProc   = OMetaConnection::getPropMap().getNameByIndex( PROPERTY_ID_ESCAPEPROCESSING );
 
-			// first ensure we have all properties needed
-			if  (   hasProperty( sPropCommand,      _rxRowSet )
-                &&  hasProperty( sPropCommandType,  _rxRowSet )
-                &&  hasProperty( sPropFilter,       _rxRowSet )
-                &&  hasProperty( sPropOrder,        _rxRowSet )
-				&&  hasProperty( sPropEspaceProc,   _rxRowSet )
-                &&  hasProperty( sPropApplyFilter,  _rxRowSet )
-                )
-			{
-                sal_Int32 nCommandType = CommandType::COMMAND;
-                ::rtl::OUString sCommand;
-                sal_Bool bEscapeProcessing = sal_False;
-
-                _rxRowSet->getPropertyValue( sPropCommandType ) >>= nCommandType     ;
-				_rxRowSet->getPropertyValue( sPropCommand     ) >>= sCommand         ;
-				_rxRowSet->getPropertyValue( sPropEspaceProc  ) >>= bEscapeProcessing;
+            sal_Int32 nCommandType = CommandType::COMMAND;
+            ::rtl::OUString sCommand;
+            sal_Bool bEscapeProcessing = sal_False;
+
+            _rxRowSet->getPropertyValue( sPropCommandType ) >>= nCommandType     ;
+			_rxRowSet->getPropertyValue( sPropCommand     ) >>= sCommand         ;
+			_rxRowSet->getPropertyValue( sPropEspaceProc  ) >>= bEscapeProcessing;
+
+            switch ( nCommandType )
+			{
+				case CommandType::COMMAND:
+					if ( bEscapeProcessing )
+						sStatement = sCommand;
+					// (in case of no escape processing  we assume a not parseable statement)
+					break;
 
-                switch ( nCommandType )
+                case CommandType::TABLE:
 				{
-					case CommandType::COMMAND:
-						if ( bEscapeProcessing )
-							sStatement = sCommand;
-						// (in case of no escape processing  we assume a not parseable statement)
+					if ( !sCommand.getLength() )
 						break;
 
-                    case CommandType::TABLE:
-					{
-						if ( !sCommand.getLength() )
-							break;
+					sal_Bool bUseCatalogInSelect = isDataSourcePropertyEnabled(xConn,::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("UseCatalogInSelect")),sal_True);
+					sal_Bool bUseSchemaInSelect = isDataSourcePropertyEnabled(xConn,::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("UseSchemaInSelect")),sal_True);
+					sStatement = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("SELECT * FROM "));
+					sStatement += quoteTableName(xConn->getMetaData(), sCommand,eInDataManipulation,bUseCatalogInSelect,bUseSchemaInSelect);
+				}
+				break;
 
-						sal_Bool bUseCatalogInSelect = isDataSourcePropertyEnabled(xConn,::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("UseCatalogInSelect")),sal_True);
-						sal_Bool bUseSchemaInSelect = isDataSourcePropertyEnabled(xConn,::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("UseSchemaInSelect")),sal_True);
-						sStatement = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("SELECT * FROM "));
-						sStatement += quoteTableName(xConn->getMetaData(), sCommand,eInDataManipulation,bUseCatalogInSelect,bUseSchemaInSelect);
-					}
-					break;
+				case CommandType::QUERY:
+				{
+					// ask the connection for the query
+					Reference< XQueriesSupplier > xSupplyQueries( xConn, UNO_QUERY );
+					Reference< XNameAccess >      xQueries;
+                    if ( xSupplyQueries.is() )
+                        xQueries = xQueries.query( xSupplyQueries->getQueries() );
+                    OSL_ENSURE( xQueries.is(), "getComposedRowSetStatement: a connection which cannot supply queries?" );
+					if ( !xQueries.is() )
+						break;
 
-					case CommandType::QUERY:
-					{
-						// ask the connection for the query
-						Reference< XQueriesSupplier > xSupplyQueries( xConn, UNO_QUERY );
-						Reference< XNameAccess >      xQueries;
-                        if ( xSupplyQueries.is() )
-                            xQueries = xQueries.query( xSupplyQueries->getQueries() );
-                        OSL_ENSURE( xQueries.is(), "getComposedRowSetStatement: a connection which cannot supply queries?" );
-						if ( !xQueries.is() )
-							break;
+					if ( !xQueries->hasByName( sCommand ) )
+						break;
 
-						if ( !xQueries->hasByName( sCommand ) )
-							break;
+					Reference< XPropertySet > xQuery;
+					xQueries->getByName( sCommand ) >>= xQuery;
+                    OSL_ENSURE( xQuery.is(), "getComposedRowSetStatement: invalid query!" );
+					if ( !xQuery.is() )
+						break;
 
-						Reference< XPropertySet > xQuery;
-						xQueries->getByName( sCommand ) >>= xQuery;
-                        OSL_ENSURE( xQuery.is(), "getComposedRowSetStatement: invalid query!" );
-						if ( !xQuery.is() )
-							break;
+					//  a native query ?
+                    sal_Bool bQueryEscapeProcessing = sal_False;
+                    xQuery->getPropertyValue( sPropEspaceProc ) >>= bQueryEscapeProcessing;
+					if ( !bQueryEscapeProcessing )
+						break;
 
-						//  a native query ?
-                        sal_Bool bQueryEscapeProcessing = sal_False;
-                        xQuery->getPropertyValue( sPropEspaceProc ) >>= bQueryEscapeProcessing;
-						if ( !bQueryEscapeProcessing )
-							break;
+					// the command used by the query
+					xQuery->getPropertyValue( sPropCommand ) >>= sStatement;
+                    if ( !sStatement.getLength() )
+                        break;
+
+					// use a composer to build a statement from the query filter/order props
+                    Reference< XMultiServiceFactory > xFactory( xConn, UNO_QUERY );
+                    Reference< XSingleSelectQueryComposer > xComposer;
+                    if ( xFactory.is() )
+                        xComposer.set( xFactory->createInstance( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.sdb.SingleSelectQueryComposer" ) ) ), UNO_QUERY );
+                    if ( !xComposer.is() )
+						break;
 
-						// the command used by the query
-						xQuery->getPropertyValue( sPropCommand ) >>= sStatement;
-                        if ( !sStatement.getLength() )
-                            break;
-
-						// use a composer to build a statement from the query filter/order props
-                        Reference< XMultiServiceFactory > xFactory( xConn, UNO_QUERY );
-                        Reference< XSingleSelectQueryComposer > xComposer;
-                        if ( xFactory.is() )
-                            xComposer.set( xFactory->createInstance( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.sdb.SingleSelectQueryComposer" ) ) ), UNO_QUERY );
-                        if ( !xComposer.is() )
-							break;
+                    // the "basic" statement
+					xComposer->setQuery( sStatement );
 
-                        // the "basic" statement
-						xComposer->setQuery( sStatement );
+                    // the sort order
+					if ( hasProperty( sPropOrder, xQuery ) )
+						xComposer->setOrder( getString( xQuery->getPropertyValue( sPropOrder ) ) );
+
+                    // the filter
+					sal_Bool bApplyFilter = sal_True;
+					if ( hasProperty( sPropApplyFilter, xQuery ) )
+						bApplyFilter = getBOOL( xQuery->getPropertyValue( sPropApplyFilter ) );
 
-                        // the sort order
-						if ( hasProperty( sPropOrder, xQuery ) )
-							xComposer->setOrder( getString( xQuery->getPropertyValue( sPropOrder ) ) );
-
-                        // the filter
-						sal_Bool bApplyFilter = sal_True;
-						if ( hasProperty( sPropApplyFilter, xQuery ) )
-							bApplyFilter = getBOOL( xQuery->getPropertyValue( sPropApplyFilter ) );
+					if ( bApplyFilter )
+                        xComposer->setFilter( getString( xQuery->getPropertyValue( sPropFilter ) ) );
 
-						if ( bApplyFilter )
-                            xComposer->setFilter( getString( xQuery->getPropertyValue( sPropFilter ) ) );
+                    // the composed statement
+                    sStatement = xComposer->getQuery();
+				}
+				break;
 
-                        // the composed statement
-                        sStatement = xComposer->getQuery();
-					}
+                default:
+					OSL_ENSURE(sal_False, "getComposedRowSetStatement: no table, no query, no statement - what else ?!");
 					break;
-
-                    default:
-						OSL_ENSURE(sal_False, "getComposedRowSetStatement: no table, no query, no statement - what else ?!");
-						break;
-				}
 			}
 
 			if ( sStatement.getLength() && ( _bUseRowSetFilter || _bUseRowSetOrder ) )
@@ -1968,6 +1951,7 @@ void setObjectWithInfo(const Reference<X
 				}
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				_xParams->setBoolean(parameterIndex,::cppu::any2bool(x));
 				break;
 			case DataType::TINYINT:
Index: connectivity/source/drivers/hsqldb/HDriver.cxx
===================================================================
RCS file: /cvs/dba/connectivity/source/drivers/hsqldb/HDriver.cxx,v
retrieving revision 1.3
retrieving revision 1.2.22.2
diff -u -p -u -p -r1.3 -r1.2.22.2
--- connectivity/source/drivers/hsqldb/HDriver.cxx	21 Jan 2005 16:39:43 -0000	1.3
+++ connectivity/source/drivers/hsqldb/HDriver.cxx	3 Feb 2005 07:31:13 -0000	1.2.22.2
@@ -80,6 +80,9 @@
 #include "TConnection.hxx"
 #endif
 #include "hsqldb/HStorageMap.hxx"
+#ifndef INCLUDED_JVMFWK_FRAMEWORK_H
+#include <jvmfwk/framework.h>
+#endif
 #ifndef _COM_SUN_STAR_REFLECTION_XPROXYFACTORY_HPP_
 #include <com/sun/star/reflection/XProxyFactory.hpp>
 #endif
@@ -283,12 +286,10 @@ namespace connectivity
 	//--------------------------------------------------------------------
 	sal_Bool SAL_CALL ODriverDelegator::acceptsURL( const ::rtl::OUString& url ) throw (SQLException, RuntimeException)
 	{
-        { // initialize the java vm
-		    ::rtl::Reference< jvmaccess::VirtualMachine > xTest = ::connectivity::getJavaVM(m_xFactory);
-		    if ( !xTest.is() )
-			    return sal_False;
-	    }
-		return url.compareToAscii("sdbc:embedded:hsqldb",sizeof("sdbc:embedded:hsqldb")) == 0;
+		sal_Bool bEnabled = sal_False;
+		javaFrameworkError eErr = jfw_getEnabled( &bEnabled );
+		OSL_ENSURE( JFW_E_NONE == eErr,"error in jfw_getEnabled" );
+		return bEnabled  && url.compareToAscii("sdbc:embedded:hsqldb",sizeof("sdbc:embedded:hsqldb")) == 0;
 	}
 
 	//--------------------------------------------------------------------
Index: connectivity/source/drivers/hsqldb/makefile.mk
===================================================================
RCS file: /cvs/dba/connectivity/source/drivers/hsqldb/makefile.mk,v
retrieving revision 1.3
retrieving revision 1.2.22.2
diff -u -p -u -p -r1.3 -r1.2.22.2
--- connectivity/source/drivers/hsqldb/makefile.mk	21 Jan 2005 16:40:57 -0000	1.3
+++ connectivity/source/drivers/hsqldb/makefile.mk	3 Feb 2005 07:32:03 -0000	1.2.22.2
@@ -110,6 +110,7 @@ SHL1STDLIBS=\
 	$(SALHELPERLIB)				\
 	$(JVMACCESSLIB)				\
 	$(DBTOOLSLIB)				\
+	$(JVMFWKLIB)				\
 	$(COMPHELPERLIB)
 
 
Index: connectivity/source/drivers/jdbc/JDriver.cxx
===================================================================
RCS file: /cvs/dba/connectivity/source/drivers/jdbc/JDriver.cxx,v
retrieving revision 1.30
retrieving revision 1.30.50.1
diff -u -p -u -p -r1.30 -r1.30.50.1
--- connectivity/source/drivers/jdbc/JDriver.cxx	2 Aug 2004 17:05:00 -0000	1.30
+++ connectivity/source/drivers/jdbc/JDriver.cxx	20 Jan 2005 16:31:43 -0000	1.30.50.1
@@ -84,6 +84,9 @@
 #ifndef _DBHELPER_DBEXCEPTION_HXX_ 
 #include "connectivity/dbexception.hxx"
 #endif
+#ifndef INCLUDED_JVMFWK_FRAMEWORK_H
+#include <jvmfwk/framework.h>
+#endif
 
 using namespace connectivity;
 using namespace ::com::sun::star::uno;
@@ -163,8 +166,11 @@ sal_Bool SAL_CALL java_sql_Driver::accep
 {
 	// don't ask the real driver for the url
 	// I feel responsible for all jdbc url's
+	sal_Bool bEnabled = sal_False;
+	javaFrameworkError eErr = jfw_getEnabled( &bEnabled );
+	OSL_ENSURE( JFW_E_NONE == eErr,"error in jfw_getEnabled" );
 	static const ::rtl::OUString s_sJdbcPrefix = ::rtl::OUString::createFromAscii("jdbc:");
-	return 0 == url.compareTo(s_sJdbcPrefix, 5);
+	return bEnabled && 0 == url.compareTo(s_sJdbcPrefix, 5);
 }
 // -------------------------------------------------------------------------
 Sequence< DriverPropertyInfo > SAL_CALL java_sql_Driver::getPropertyInfo( const ::rtl::OUString& url, 
Index: connectivity/source/drivers/jdbc/makefile.mk
===================================================================
RCS file: /cvs/dba/connectivity/source/drivers/jdbc/makefile.mk,v
retrieving revision 1.13
retrieving revision 1.13.186.1
diff -u -p -u -p -r1.13 -r1.13.186.1
--- connectivity/source/drivers/jdbc/makefile.mk	24 Apr 2003 13:23:10 -0000	1.13
+++ connectivity/source/drivers/jdbc/makefile.mk	20 Jan 2005 16:31:43 -0000	1.13.186.1
@@ -129,6 +129,7 @@ SHL1STDLIBS=\
 	$(SALLIB)					\
 	$(JVMACCESSLIB)				\
 	$(DBTOOLSLIB)				\
+	$(JVMFWKLIB)				\
 	$(COMPHELPERLIB)
 
 SHL1DEPN=
Index: connectivity/source/parse/sqlbison.y
===================================================================
RCS file: /cvs/dba/connectivity/source/parse/sqlbison.y,v
retrieving revision 1.49
retrieving revision 1.49.42.1
diff -u -p -u -p -r1.49 -r1.49.42.1
--- connectivity/source/parse/sqlbison.y	9 Sep 2004 09:04:02 -0000	1.49
+++ connectivity/source/parse/sqlbison.y	20 Jan 2005 16:36:23 -0000	1.49.42.1
@@ -242,12 +242,12 @@ using namespace connectivity;
 %type <pParseNode> char_value_exp concatenation char_factor char_primary string_value_fct char_substring_fct fold
 %type <pParseNode> form_conversion char_translation trim_fct trim_operands trim_spec bit_value_fct bit_substring_fct op_column_commalist
 %type <pParseNode> /*bit_concatenation*/ bit_value_exp bit_factor bit_primary collate_clause char_value_fct unique_spec value_exp_commalist in_predicate_value unique_test update_source 
-%type <pParseNode> value_exp_commalist3 string_function_3Argument value_exp_commalist4 string_function_4Argument value_exp_commalist2 string_function_1Argument string_function_2Argument
+%type <pParseNode> function_arg_commalist3 string_function_3Argument function_arg_commalist4 string_function_4Argument function_arg_commalist2 string_function_1Argument string_function_2Argument
 %type <pParseNode> date_function_0Argument date_function_1Argument function_name12 function_name23 function_name1 function_name2 function_name3 function_name0 numeric_function_0Argument numeric_function_1Argument numeric_function_2Argument
 %type <pParseNode> all query_primary as sql_not for_length upper_lower comparison column_val  cross_union /*opt_schema_element_list*/
 %type <pParseNode> /*op_authorization op_schema*/ nil_fkt schema_element base_table_def base_table_element base_table_element_commalist
 %type <pParseNode> column_def odbc_fct_spec	odbc_call_spec odbc_fct_type op_parameter union_statement
-%type <pParseNode> op_odbc_call_parameter odbc_parameter_commalist odbc_parameter
+%type <pParseNode> op_odbc_call_parameter odbc_parameter_commalist odbc_parameter function_args_commalist function_arg
 %type <pParseNode> catalog_name schema_name table_node numeric_function string_function function_name date_function
 %%
 
@@ -1731,7 +1731,7 @@ set_fct_spec:
 			$$->append($2 = newNode("(", SQL_NODE_PUNCTUATION));
 			$$->append($3 = newNode(")", SQL_NODE_PUNCTUATION));
 		}
-	|	function_name1 '(' value_exp ')'
+	|	function_name1 '(' function_arg ')'
 		{
 			$$ = SQL_NEW_RULE;
 			$$->append($1);
@@ -1739,7 +1739,7 @@ set_fct_spec:
 			$$->append($3);
 			$$->append($4 = newNode(")", SQL_NODE_PUNCTUATION));
 		}
-	|	function_name2 '(' value_exp_commalist2 ')'
+	|	function_name2 '(' function_arg_commalist2 ')'
 		{
 			$$ = SQL_NEW_RULE;
 			$$->append($1);
@@ -1747,7 +1747,7 @@ set_fct_spec:
 			$$->append($3);
 			$$->append($4 = newNode(")", SQL_NODE_PUNCTUATION));
 		}
-	|	function_name3 '(' value_exp_commalist3 ')'
+	|	function_name3 '(' function_arg_commalist3 ')'
 		{
 			$$ = SQL_NEW_RULE;
 			$$->append($1);
@@ -1755,7 +1755,7 @@ set_fct_spec:
 			$$->append($3);
 			$$->append($4 = newNode(")", SQL_NODE_PUNCTUATION));
 		}
-	|	string_function_4Argument '(' value_exp_commalist4 ')'
+	|	string_function_4Argument '(' function_arg_commalist4 ')'
 		{
 			$$ = SQL_NEW_RULE;
 			$$->append($1);
@@ -1763,7 +1763,7 @@ set_fct_spec:
 			$$->append($3);
 			$$->append($4 = newNode(")", SQL_NODE_PUNCTUATION));
 		}
-	|	function_name '(' value_exp_commalist ')'
+	|	function_name '(' function_args_commalist ')'
 		{
 			$$ = SQL_NEW_RULE;
 			$$->append($1);
@@ -1771,7 +1771,7 @@ set_fct_spec:
 			$$->append($3);
 			$$->append($4 = newNode(")", SQL_NODE_PUNCTUATION));
 		}
-	|	function_name12 '(' value_exp_commalist ')'
+	|	function_name12 '(' function_args_commalist ')'
 		{
 			if ( $3->count() == 1 || $3->count() == 2 )
 			{
@@ -1784,7 +1784,7 @@ set_fct_spec:
 			else
 				YYERROR;
 		}
-	|	function_name23 '(' value_exp_commalist ')'
+	|	function_name23 '(' function_args_commalist ')'
 		{
 			if ( $3->count() == 2 || $3->count() == 3)
 			{
@@ -2507,14 +2507,14 @@ interval_qualifier:
 		}
 	;
 */
-value_exp_commalist2:
-	    value_exp ',' value_exp
+function_arg_commalist2:
+	    function_arg ',' function_arg
 			{$$ = SQL_NEW_COMMALISTRULE;
 			$$->append($1);
 			$$->append($3);}
 	;
-value_exp_commalist3:
-	    value_exp ',' value_exp ',' value_exp
+function_arg_commalist3:
+	    function_arg ',' function_arg ',' function_arg
 		{
 			$$ = SQL_NEW_COMMALISTRULE;
 			$$->append($1);
@@ -2522,8 +2522,8 @@ value_exp_commalist3:
 			$$->append($5);
 		}
 	;
-value_exp_commalist4:
-	    value_exp ',' value_exp ',' value_exp ',' value_exp
+function_arg_commalist4:
+	    function_arg ',' function_arg ',' function_arg ',' function_arg
 		{
 			$$ = SQL_NEW_COMMALISTRULE;
 			$$->append($1);
@@ -2551,6 +2551,36 @@ value_exp_commalist:
 				YYERROR;
 		}
 	;
+function_arg:
+		value_exp 
+	|	value_exp comparison value_exp
+		{
+			$$ = SQL_NEW_RULE;
+			$$->append($1);
+			$$->append($2);
+			$$->append($3);
+		}
+	;
+function_args_commalist:
+		function_arg
+			{$$ = SQL_NEW_COMMALISTRULE;
+			$$->append($1);}
+	|   function_args_commalist ',' function_arg
+			{$1->append($3);
+			$$ = $1;}
+	/*	this rule is only valid if we check predicates */
+	|   function_args_commalist ';' function_arg
+		{
+			if (xxx_pGLOBAL_SQLPARSER->inPredicateCheck())
+			{
+				$1->append($3);
+				$$ = $1;
+			}
+			else
+				YYERROR;
+		}
+	;
+	
 value_exp:
 		num_value_exp /*[^')']*/
 	  | string_value_exp
Index: connectivity/source/simpledbt/staticdbtools_s.cxx
===================================================================
RCS file: /cvs/dba/connectivity/source/simpledbt/staticdbtools_s.cxx,v
retrieving revision 1.7
retrieving revision 1.7.26.1
diff -u -p -u -p -r1.7 -r1.7.26.1
--- connectivity/source/simpledbt/staticdbtools_s.cxx	22 Oct 2004 11:32:24 -0000	1.7
+++ connectivity/source/simpledbt/staticdbtools_s.cxx	17 Jan 2005 14:58:05 -0000	1.7.26.1
@@ -143,18 +143,11 @@ namespace connectivity
 
 	//----------------------------------------------------------------
 	Reference< XConnection> ODataAccessStaticTools::connectRowset(const Reference< XRowSet>& _rxRowSet, const Reference< XMultiServiceFactory>& _rxFactory, sal_Bool _bSetAsActiveConnection) const
-		SAL_THROW ( (SQLException, RuntimeException) )
+		SAL_THROW ( (SQLException, WrappedTargetException, RuntimeException) )
 	{
 		return ::dbtools::connectRowset( _rxRowSet, _rxFactory, _bSetAsActiveConnection);
 	}
 
-	//----------------------------------------------------------------
-	Reference< XConnection> ODataAccessStaticTools::calcConnection(const Reference< XRowSet>& _rxRowSet, const Reference< XMultiServiceFactory>& _rxFactory) const
-		SAL_THROW ( (SQLException, RuntimeException) )
-	{
-		return ::dbtools::calcConnection(_rxRowSet, _rxFactory);
-	}
-
 	// ------------------------------------------------
 	Reference< XConnection> ODataAccessStaticTools::getRowSetConnection(
 				const Reference< XRowSet>& _rxRowSet) 
Index: connectivity/source/simpledbt/staticdbtools_s.hxx
===================================================================
RCS file: /cvs/dba/connectivity/source/simpledbt/staticdbtools_s.hxx,v
retrieving revision 1.7
retrieving revision 1.7.26.1
diff -u -p -u -p -r1.7 -r1.7.26.1
--- connectivity/source/simpledbt/staticdbtools_s.hxx	22 Oct 2004 11:32:39 -0000	1.7
+++ connectivity/source/simpledbt/staticdbtools_s.hxx	17 Jan 2005 14:58:05 -0000	1.7.26.1
@@ -121,17 +121,13 @@ namespace connectivity
 		) const SAL_THROW ( (::com::sun::star::sdbc::SQLException) );
 
 		// ------------------------------------------------
-		virtual ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> calcConnection(
-			const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
-			const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory
-		) const SAL_THROW ( (::com::sun::star::sdbc::SQLException, ::com::sun::star::uno::RuntimeException) );
-
-		// ------------------------------------------------
 		virtual ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> connectRowset(
 			const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
 			const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory,
 			sal_Bool _bSetAsActiveConnection
-		) const SAL_THROW ( (::com::sun::star::sdbc::SQLException, ::com::sun::star::uno::RuntimeException) );
+		) const SAL_THROW ( ( ::com::sun::star::sdbc::SQLException
+                            , ::com::sun::star::lang::WrappedTargetException
+                            , ::com::sun::star::uno::RuntimeException ) );
 
 		// ------------------------------------------------
 		virtual ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> getRowSetConnection(
Index: officecfg/registry/data/org/openoffice/Setup.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Setup.xcu,v
retrieving revision 1.15
retrieving revision 1.14.44.2
diff -u -p -u -p -r1.15 -r1.14.44.2
--- officecfg/registry/data/org/openoffice/Setup.xcu	27 Jan 2005 14:23:39 -0000	1.15
+++ officecfg/registry/data/org/openoffice/Setup.xcu	11 Feb 2005 10:16:24 -0000	1.14.44.2
@@ -455,7 +455,7 @@
 					<value >GenericCategories</value>
 				</prop>
 			</node>
-			<node oor:name="com.sun.star.sdb.DatabaseDocument" oor:op="replace">
+			<node oor:name="com.sun.star.sdb.OfficeDatabaseDocument" oor:op="replace">
 				<prop oor:name="ooSetupFactoryCommandConfigRef">
 					<value >DbuCommands</value>
 				</prop>
Index: officecfg/registry/data/org/openoffice/Office/Common.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/Common.xcu,v
retrieving revision 1.29
retrieving revision 1.28.8.2
diff -u -p -u -p -r1.29 -r1.28.8.2
--- officecfg/registry/data/org/openoffice/Office/Common.xcu	7 Jan 2005 10:02:13 -0000	1.29
+++ officecfg/registry/data/org/openoffice/Office/Common.xcu	21 Jan 2005 08:16:06 -0000	1.28.8.2
@@ -239,14 +239,14 @@
       </node>
       <node oor:name="m4" oor:op="replace">
         <prop oor:name="URL"  oor:type="xs:string">
-          <value >service:com.sun.star.sdb.DatabaseWizardDialog</value>
+          <value >private:factory/sdatabase?Interactive</value>
         </prop>
         <prop oor:name="Title">
           <value xml:lang="de">Datenbank</value>
           <value xml:lang="en-US">Database</value>
         </prop>
         <prop oor:name="TargetName"  oor:type="xs:string">
-          <value >_self</value>
+          <value >_default</value>
         </prop>
         <prop oor:name="ImageIdentifier"  oor:type="xs:string">
           <value >private:image/3245</value>
Index: officecfg/registry/data/org/openoffice/Office/UI.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI.xcu,v
retrieving revision 1.30
retrieving revision 1.30.56.1
diff -u -p -u -p -r1.30 -r1.30.56.1
--- officecfg/registry/data/org/openoffice/Office/UI.xcu	17 Nov 2004 08:17:07 -0000	1.30
+++ officecfg/registry/data/org/openoffice/Office/UI.xcu	19 Jan 2005 09:34:22 -0000	1.30.56.1
@@ -127,7 +127,7 @@
                                                 <value oor:separator=";">MathML XML (Math);MathType 3.x;StarMath 2.0;StarMath 3.0;StarMath 4.0;StarMath 5.0;StarOffice XML (Math);math8</value>
 					</prop>
 				</node>
-				<node oor:name="com.sun.star.sdb.DatabaseDocument" oor:op="replace">
+				<node oor:name="com.sun.star.sdb.OfficeDatabaseDocument" oor:op="replace">
 					<prop oor:name="DisplayName">
 						<value xml:lang="de">Datenbankdokumente</value>
 						<value xml:lang="en">Database Documents</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu,v
retrieving revision 1.14
retrieving revision 1.11.22.3
diff -u -p -u -p -r1.14 -r1.11.22.3
--- officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu	27 Jan 2005 15:20:13 -0000	1.14
+++ officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu	11 Feb 2005 10:17:11 -0000	1.11.22.3
@@ -209,8 +209,8 @@
 			</node>
 			<node oor:name="private:resource/toolbar/formcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Controls</value>
-					<value xml:lang="de">Steuerelemente</value>
+					<value xml:lang="en-US">Form Controls</value>
+					<value xml:lang="de">Formular Steuerelemente</value>
 				</prop>
 				<prop oor:name="Docked" oor:type="xs:boolean">
 					<value>false</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/Controller.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/Controller.xcu,v
retrieving revision 1.8
retrieving revision 1.8.56.1
diff -u -p -u -p -r1.8 -r1.8.56.1
--- officecfg/registry/data/org/openoffice/Office/UI/Controller.xcu	17 Nov 2004 14:07:29 -0000	1.8
+++ officecfg/registry/data/org/openoffice/Office/UI/Controller.xcu	19 Jan 2005 09:34:23 -0000	1.8.56.1
@@ -169,7 +169,7 @@
           <value>.uno:DBNewForm</value>
         </prop>
         <prop oor:name="Module">
-          <value>com.sun.star.sdb.DatabaseDocument</value>
+          <value>com.sun.star.sdb.OfficeDatabaseDocument</value>
         </prop>
         <prop oor:name="Controller">
           <value>com.sun.star.sdb.ApplicationToolboxController</value>
@@ -180,7 +180,7 @@
           <value>.uno:Refresh</value>
         </prop>
         <prop oor:name="Module">
-          <value>com.sun.star.sdb.DatabaseDocument</value>
+          <value>com.sun.star.sdb.OfficeDatabaseDocument</value>
         </prop>
         <prop oor:name="Controller">
           <value>com.sun.star.sdb.ApplicationToolboxController</value>
@@ -193,7 +193,7 @@
           <value>.uno:DBStatusType</value>
         </prop>
         <prop oor:name="Module">
-          <value>com.sun.star.sdb.DatabaseDocument</value>
+          <value>com.sun.star.sdb.OfficeDatabaseDocument</value>
         </prop>
         <prop oor:name="Controller">
           <value>com.sun.star.sdb.ApplicationStatusbarController</value>
@@ -204,7 +204,7 @@
           <value>.uno:DBStatusDBName</value>
         </prop>
         <prop oor:name="Module">
-          <value>com.sun.star.sdb.DatabaseDocument</value>
+          <value>com.sun.star.sdb.OfficeDatabaseDocument</value>
         </prop>
         <prop oor:name="Controller">
           <value>com.sun.star.sdb.ApplicationStatusbarController</value>
@@ -215,7 +215,7 @@
           <value>.uno:DBStatusUserName</value>
         </prop>
         <prop oor:name="Module">
-          <value>com.sun.star.sdb.DatabaseDocument</value>
+          <value>com.sun.star.sdb.OfficeDatabaseDocument</value>
         </prop>
         <prop oor:name="Controller">
           <value>com.sun.star.sdb.ApplicationStatusbarController</value>
@@ -226,7 +226,7 @@
           <value>.uno:DBStatusHostName</value>
         </prop>
         <prop oor:name="Module">
-          <value>com.sun.star.sdb.DatabaseDocument</value>
+          <value>com.sun.star.sdb.OfficeDatabaseDocument</value>
         </prop>
         <prop oor:name="Controller">
           <value>com.sun.star.sdb.ApplicationStatusbarController</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/DbRelationWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/DbRelationWindowState.xcu,v
retrieving revision 1.2
retrieving revision 1.2.56.1
diff -u -p -u -p -r1.2 -r1.2.56.1
--- officecfg/registry/data/org/openoffice/Office/UI/DbRelationWindowState.xcu	17 Nov 2004 14:08:09 -0000	1.2
+++ officecfg/registry/data/org/openoffice/Office/UI/DbRelationWindowState.xcu	13 Jan 2005 12:08:11 -0000	1.2.56.1
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE oor:component-data SYSTEM "../../../../../component-update.dtd">
-<oor:component-data xmlns:oor="http://openoffice.org/2001/registry" xmlns:xs="http://www.w3.org/2001/XMLSchema" oor:name="DbQueryWindowState" oor:package="org.openoffice.Office.UI">
+<oor:component-data xmlns:oor="http://openoffice.org/2001/registry" xmlns:xs="http://www.w3.org/2001/XMLSchema" oor:name="DbRelationWindowState" oor:package="org.openoffice.Office.UI">
  <node oor:name="UIElements">
   <node oor:name="States">
    <node oor:name="private:resource/toolbar/toolbar" oor:op="replace">
Index: officecfg/registry/data/org/openoffice/Office/UI/DbTableWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/DbTableWindowState.xcu,v
retrieving revision 1.2
retrieving revision 1.2.56.1
diff -u -p -u -p -r1.2 -r1.2.56.1
--- officecfg/registry/data/org/openoffice/Office/UI/DbTableWindowState.xcu	17 Nov 2004 14:08:20 -0000	1.2
+++ officecfg/registry/data/org/openoffice/Office/UI/DbTableWindowState.xcu	13 Jan 2005 12:08:11 -0000	1.2.56.1
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE oor:component-data SYSTEM "../../../../../component-update.dtd">
-<oor:component-data xmlns:oor="http://openoffice.org/2001/registry" xmlns:xs="http://www.w3.org/2001/XMLSchema" oor:name="DbQueryWindowState" oor:package="org.openoffice.Office.UI">
+<oor:component-data xmlns:oor="http://openoffice.org/2001/registry" xmlns:xs="http://www.w3.org/2001/XMLSchema" oor:name="DbTableWindowState" oor:package="org.openoffice.Office.UI">
  <node oor:name="UIElements">
   <node oor:name="States">
    <node oor:name="private:resource/toolbar/toolbar" oor:op="replace">
Index: officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu,v
retrieving revision 1.17
retrieving revision 1.12.52.3
diff -u -p -u -p -r1.17 -r1.12.52.3
--- officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu	31 Jan 2005 14:45:16 -0000	1.17
+++ officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu	11 Feb 2005 10:17:43 -0000	1.12.52.3
@@ -332,8 +332,8 @@
 			</node>
 			<node oor:name="private:resource/toolbar/formcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Controls</value>
-					<value xml:lang="de">Steuerelemente</value>
+					<value xml:lang="en-US">Form Controls</value>
+					<value xml:lang="de">Formular Steuerelemente</value>
 				</prop>
 				<prop oor:name="Docked" oor:type="xs:boolean">
 					<value>false</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu,v
retrieving revision 1.38
retrieving revision 1.36.12.3
diff -u -p -u -p -r1.38 -r1.36.12.3
--- officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu	27 Jan 2005 16:11:53 -0000	1.38
+++ officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu	11 Feb 2005 10:18:04 -0000	1.36.12.3
@@ -5362,8 +5362,8 @@
 			</node>
 			<node oor:name=".uno:UseWizards" oor:op="replace">
 				<prop oor:name="Label" oor:type="xs:string">
-					<value xml:lang="de">Autopiloten an/aus</value>
-					<value xml:lang="en-US">AutoPilots On/Off</value>
+					<value xml:lang="de">Assistenten an/aus</value>
+					<value xml:lang="en-US">Wizards On/Off</value>
 				</prop>
 				<prop oor:name="Properties" oor:type="xs:int">
 					<value>1</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/ImpressWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/ImpressWindowState.xcu,v
retrieving revision 1.16
retrieving revision 1.12.52.3
diff -u -p -u -p -r1.16 -r1.12.52.3
--- officecfg/registry/data/org/openoffice/Office/UI/ImpressWindowState.xcu	31 Jan 2005 14:45:31 -0000	1.16
+++ officecfg/registry/data/org/openoffice/Office/UI/ImpressWindowState.xcu	11 Feb 2005 10:18:15 -0000	1.12.52.3
@@ -263,8 +263,8 @@
 			</node>
 			<node oor:name="private:resource/toolbar/formcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Controls</value>
-					<value xml:lang="de">Steuerelemente</value>
+					<value xml:lang="en-US">Form Controls</value>
+					<value xml:lang="de">Formular Steuerelemente</value>
 				</prop>
 				<prop oor:name="Docked" oor:type="xs:boolean">
 					<value>false</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/WriterGlobalWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/WriterGlobalWindowState.xcu,v
retrieving revision 1.16
retrieving revision 1.10.6.5
diff -u -p -u -p -r1.16 -r1.10.6.5
--- officecfg/registry/data/org/openoffice/Office/UI/WriterGlobalWindowState.xcu	31 Jan 2005 08:57:18 -0000	1.16
+++ officecfg/registry/data/org/openoffice/Office/UI/WriterGlobalWindowState.xcu	11 Feb 2005 10:18:45 -0000	1.10.6.5
@@ -255,22 +255,10 @@
 					<value>false</value>
 				</prop>
 			</node>
-			<node oor:name="private:resource/toolbar/xformcontrols" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">XML Form Controls</value>
-					<value xml:lang="de">XML Formular-Steuerelemente</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-			</node>
 			<node oor:name="private:resource/toolbar/formcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Controls</value>
-					<value xml:lang="de">Steuerelemente</value>
+					<value xml:lang="en-US">Form Controls</value>
+					<value xml:lang="de">Formular Steuerelemente</value>
 				</prop>
 				<prop oor:name="Docked" oor:type="xs:boolean">
 					<value>false</value>
@@ -279,36 +267,6 @@
 					<value>false</value>
 				</prop>
 			</node>
-			<node oor:name="private:resource/toolbar/moredatabasecontrols" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">More Database Controls</value>
-					<value xml:lang="de">Weitere Datenbank-Steuerelemente</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-				<prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-			</node>
-			<node oor:name="private:resource/toolbar/morexformcontrols" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">More XML Form Controls</value>
-					<value xml:lang="de">Weitere XML Formular-Steuerelemente</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-				<prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-			</node>
 			<node oor:name="private:resource/toolbar/moreformcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
 					<value xml:lang="en-US">More Controls</value>
@@ -324,30 +282,6 @@
 					<value>true</value>
 				</prop>
 			</node>
-			<node oor:name="private:resource/toolbar/databaseformdesign" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Database Form Design</value>
-					<value xml:lang="de">Datenbank Formularentwurf</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-			</node>
-			<node oor:name="private:resource/toolbar/xformdesign" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">XML Form Design</value>
-					<value xml:lang="de">XML Formularentwurf</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-			</node>
 			<node oor:name="private:resource/toolbar/formdesign" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
 					<value xml:lang="en-US">Form Design</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/WriterWebWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/WriterWebWindowState.xcu,v
retrieving revision 1.15
retrieving revision 1.9.6.4
diff -u -p -u -p -r1.15 -r1.9.6.4
--- officecfg/registry/data/org/openoffice/Office/UI/WriterWebWindowState.xcu	31 Jan 2005 08:57:34 -0000	1.15
+++ officecfg/registry/data/org/openoffice/Office/UI/WriterWebWindowState.xcu	11 Feb 2005 10:18:55 -0000	1.9.6.4
@@ -299,8 +299,8 @@
 			</node>
             <node oor:name="private:resource/toolbar/formcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Controls</value>
-					<value xml:lang="de">Steuerelemente</value>
+					<value xml:lang="en-US">Form Controls</value>
+					<value xml:lang="de">Formular Steuerelemente</value>
 				</prop>
 				<prop oor:name="Docked" oor:type="xs:boolean">
 					<value>false</value>
Index: officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu
===================================================================
RCS file: /cvs/util/officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu,v
retrieving revision 1.15
retrieving revision 1.9.6.5
diff -u -p -u -p -r1.15 -r1.9.6.5
--- officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu	31 Jan 2005 08:57:49 -0000	1.15
+++ officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu	11 Feb 2005 10:19:04 -0000	1.9.6.5
@@ -243,34 +243,10 @@
 					<value>true</value>
 				</prop>
 			</node>
-			<node oor:name="private:resource/toolbar/databasecontrols" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Database Controls</value>
-					<value xml:lang="de">Datenbank-Steuerelemente</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-			</node>
-			<node oor:name="private:resource/toolbar/xformcontrols" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">XML Form Controls</value>
-					<value xml:lang="de">XML Formular-Steuerelemente</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-			</node>
 			<node oor:name="private:resource/toolbar/formcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Controls</value>
-					<value xml:lang="de">Steuerelemente</value>
+					<value xml:lang="en-US">Form Controls</value>
+					<value xml:lang="de">Formular Steuerelemente</value>
 				</prop>
 				<prop oor:name="Docked" oor:type="xs:boolean">
 					<value>false</value>
@@ -279,36 +255,6 @@
 					<value>false</value>
 				</prop>
 			</node>
-			<node oor:name="private:resource/toolbar/moredatabasecontrols" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">More Database Controls</value>
-					<value xml:lang="de">Weitere Datenbank-Steuerelemente</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-				<prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-			</node>
-			<node oor:name="private:resource/toolbar/morexformcontrols" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">More XML Form Controls</value>
-					<value xml:lang="de">Weitere XML Formular-Steuerelemente</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-				<prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
-					<value>true</value>
-				</prop>
-			</node>
 			<node oor:name="private:resource/toolbar/moreformcontrols" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
 					<value xml:lang="en-US">More Controls</value>
@@ -324,30 +270,6 @@
 					<value>true</value>
 				</prop>
 			</node>
-			<node oor:name="private:resource/toolbar/databaseformdesign" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">Database Form Design</value>
-					<value xml:lang="de">Datenbank Formularentwurf</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-			</node>
-			<node oor:name="private:resource/toolbar/xformdesign" oor:op="replace">
-				<prop oor:name="UIName" oor:type="xs:string">
-					<value xml:lang="en-US">XML Form Design</value>
-					<value xml:lang="de">XML Formularentwurf</value>
-				</prop>
-				<prop oor:name="Docked" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-				<prop oor:name="Visible" oor:type="xs:boolean">
-					<value>false</value>
-				</prop>
-			</node>
 			<node oor:name="private:resource/toolbar/formdesign" oor:op="replace">
 				<prop oor:name="UIName" oor:type="xs:string">
 					<value xml:lang="en-US">Form Design</value>
Index: officecfg/registry/schema/org/openoffice/Office/UI.xcs
===================================================================
RCS file: /cvs/util/officecfg/registry/schema/org/openoffice/Office/UI.xcs,v
retrieving revision 1.25
retrieving revision 1.25.108.1
diff -u -p -u -p -r1.25 -r1.25.108.1
--- officecfg/registry/schema/org/openoffice/Office/UI.xcs	25 Oct 2004 10:36:43 -0000	1.25
+++ officecfg/registry/schema/org/openoffice/Office/UI.xcs	19 Jan 2005 09:34:23 -0000	1.25.108.1
@@ -569,7 +569,7 @@
 					<info>
 						<desc>List specifying the order of the global filters within their group.</desc>
 					</info>
-					<value oor:separator=";">com.sun.star.text.TextDocument;com.sun.star.sheet.SpreadsheetDocument;com.sun.star.presentation.PresentationDocument;com.sun.star.drawing.DrawingDocument;com.sun.star.text.WebDocument;com.sun.star.text.GlobalDocument;com.sun.star.formula.FormularProperties;com.sun.star.sdb.DatabaseDocument</value>
+					<value oor:separator=";">com.sun.star.text.TextDocument;com.sun.star.sheet.SpreadsheetDocument;com.sun.star.presentation.PresentationDocument;com.sun.star.drawing.DrawingDocument;com.sun.star.text.WebDocument;com.sun.star.text.GlobalDocument;com.sun.star.formula.FormularProperties;com.sun.star.sdb.OfficeDatabaseDocument</value>
 				</prop>
 				<set oor:name="Classes" oor:node-type="FilterClass">
 					<info>
Index: toolkit/inc/toolkit/awt/vclxwindow.hxx
===================================================================
RCS file: /cvs/gsl/toolkit/inc/toolkit/awt/vclxwindow.hxx,v
retrieving revision 1.22
retrieving revision 1.21.38.3
diff -u -p -u -p -r1.22 -r1.21.38.3
--- toolkit/inc/toolkit/awt/vclxwindow.hxx	11 Jan 2005 14:04:05 -0000	1.22
+++ toolkit/inc/toolkit/awt/vclxwindow.hxx	21 Jan 2005 08:28:25 -0000	1.21.38.3
@@ -128,6 +128,7 @@ struct SystemParentData;
 //	class VCLXWINDOW
 //	----------------------------------------------------
 
+class VCLXWindowImpl;
 class TOOLKIT_DLLPUBLIC VCLXWindow :	public ::com::sun::star::awt::XWindow2,
 					public ::com::sun::star::awt::XVclWindowPeer,
 					public ::com::sun::star::awt::XLayoutConstrains,
@@ -156,13 +157,13 @@ private:
 
 	ULONG                           mnListenerLockLevel;
 	ULONG                           nDummy2;
-	void*                           pDummy1;
+    VCLXWindowImpl*                 mpImpl;
 	void*                           pDummy2;
 
 	sal_Bool						mbDisposing;
 	sal_Bool						mbDesignMode;
 	sal_Bool						mbSynthesizingVCLEvent;
-	sal_Bool						mbDummy2;
+	sal_Bool						mbDrawingOntoParent;
 
 
 protected:
Index: toolkit/source/awt/vclxwindow.cxx
===================================================================
RCS file: /cvs/gsl/toolkit/source/awt/vclxwindow.cxx,v
retrieving revision 1.51
retrieving revision 1.49.28.4
diff -u -p -u -p -r1.51 -r1.49.28.4
--- toolkit/source/awt/vclxwindow.cxx	31 Jan 2005 08:58:15 -0000	1.51
+++ toolkit/source/awt/vclxwindow.cxx	11 Feb 2005 12:41:04 -0000	1.49.28.4
@@ -152,12 +152,127 @@
 #include <vcl/dockwin.hxx>
 #endif
 
+#ifndef COMPHELPER_ASYNCNOTIFICATION_HXX
+#include <comphelper/asyncnotification.hxx>
+#endif
+
 using ::com::sun::star::style::VerticalAlignment;
 using ::com::sun::star::style::VerticalAlignment_TOP;
 using ::com::sun::star::style::VerticalAlignment_MIDDLE;
 using ::com::sun::star::style::VerticalAlignment_BOTTOM;
 using ::com::sun::star::style::VerticalAlignment_MAKE_FIXED_SIZE;
 
+//====================================================================
+//= VCLXWindowImpl
+//====================================================================
+#define EVENT_MOUSE_PRESSED     0
+#define EVENT_MOUSE_RELEASED    1
+#define EVENT_MOUSE_ENTERED     2
+#define EVENT_MOUSE_EXITED      3
+
+class SAL_DLLPRIVATE VCLXWindowImpl : public ::comphelper::IEventProcessor
+{
+private:
+    typedef ::comphelper::EventObjectHolder< ::com::sun::star::awt::MouseEvent >
+        MouseEventType;
+    typedef ::com::sun::star::uno::Reference< ::com::sun::star::lang::XComponent >
+        ComponentReference;
+
+private:
+    VCLXWindow&                         mrAntiImpl;
+    ::vos::IMutex&                      mrMutex;
+    ::comphelper::AsyncEventNotifier*   mpAsyncNotifier;
+
+public:
+    /** ctor
+    @param _pAntiImpl
+        the <type>VCLXWindow</type> instance which the object belongs to. Must
+        live longer then the object just being constructed.
+    */
+    VCLXWindowImpl( VCLXWindow& _rAntiImpl, ::vos::IMutex& _rMutex );
+
+    /** asynchronously notifies a mousePressed event to the VCLXWindow's XMouseListeners
+    */
+    void    notifyMouseEvent( const ::com::sun::star::awt::MouseEvent& _rMouseEvent, sal_uInt16 _nType );
+
+    /** notifies the object that its VCLXWindow is being disposed
+    */
+    void    disposing();
+
+protected:
+    // IEventProcessor
+    virtual void processEvent( const ::comphelper::EventDescription& _rEvent );
+    virtual ComponentReference getComponent();
+};
+
+//--------------------------------------------------------------------
+VCLXWindowImpl::VCLXWindowImpl( VCLXWindow& _rAntiImpl, ::vos::IMutex& _rMutex )
+    :mrAntiImpl( _rAntiImpl )
+    ,mrMutex( _rMutex )
+    ,mpAsyncNotifier( NULL )
+{
+}
+
+//--------------------------------------------------------------------
+void VCLXWindowImpl::disposing()
+{
+	::vos::OGuard aGuard( mrMutex );
+    if ( mpAsyncNotifier )
+    {
+        mpAsyncNotifier->release();
+        mpAsyncNotifier = NULL;
+    }
+}
+
+//--------------------------------------------------------------------
+void VCLXWindowImpl::notifyMouseEvent( const ::com::sun::star::awt::MouseEvent& _rMouseEvent, sal_uInt16 _nType )
+{
+	::vos::OGuard aGuard( mrMutex );
+    if ( mrAntiImpl.GetMouseListeners().getLength() )
+    {
+        if ( !mpAsyncNotifier )
+        {
+            mpAsyncNotifier = new ::comphelper::AsyncEventNotifier( this );
+            mpAsyncNotifier->acquire();
+            mpAsyncNotifier->create();
+        }
+		mpAsyncNotifier->addEvent( new MouseEventType( _rMouseEvent, _nType ) );
+    }
+}
+
+//--------------------------------------------------------------------
+void VCLXWindowImpl::processEvent( const ::comphelper::EventDescription& _rEvent )
+{
+    const MouseEventType aEventDescriptor( static_cast< const MouseEventType& >( _rEvent ) );
+    const ::com::sun::star::awt::MouseEvent& rEvent( aEventDescriptor.getEventObject() );
+    switch ( aEventDescriptor.getEventType() )
+    {
+    case EVENT_MOUSE_PRESSED:
+        mrAntiImpl.GetMouseListeners().mousePressed( rEvent );
+        break;
+    case EVENT_MOUSE_RELEASED:
+        mrAntiImpl.GetMouseListeners().mouseReleased( rEvent );
+        break;
+    case EVENT_MOUSE_ENTERED:
+        mrAntiImpl.GetMouseListeners().mouseEntered( rEvent );
+        break;
+    case EVENT_MOUSE_EXITED:
+        mrAntiImpl.GetMouseListeners().mouseExited( rEvent );
+        break;
+    default:
+        DBG_ERROR( "VCLXWindowImpl::processEvent: what kind of event *is* this?" );
+    }
+}
+
+//--------------------------------------------------------------------
+VCLXWindowImpl::ComponentReference VCLXWindowImpl::getComponent()
+{
+    return static_cast< ::com::sun::star::awt::XWindow* >( &mrAntiImpl );
+}
+
+//====================================================================
+//====================================================================
+
 // Mit Out-Parameter besser als Rueckgabewert, wegen Ref-Objekt...
 
 void ImplInitWindowEvent( ::com::sun::star::awt::WindowEvent& rEvent, Window* pWindow )
@@ -229,11 +344,15 @@ VCLXWindow::VCLXWindow()
 	  maPaintListeners( *this ),
 	  maContainerListeners( *this ),
 	  maTopWindowListeners( *this ),
-      mnListenerLockLevel( 0 )
+      mnListenerLockLevel( 0 ),
+      mpImpl( NULL ),
+      mbDrawingOntoParent( false )
 {
 	DBG_CTOR( VCLXWindow, 0 );
 
-	mbDisposing = sal_False;
+    mpImpl = new VCLXWindowImpl( *this, GetMutex() );
+
+    mbDisposing = sal_False;
 	mbDesignMode = sal_False;
     mbSynthesizingVCLEvent = sal_False;
 }
@@ -248,6 +367,8 @@ VCLXWindow::~VCLXWindow()
 		GetWindow()->SetWindowPeer( NULL, NULL );
 		GetWindow()->SetAccessible( NULL );
     }
+
+    DELETEZ( mpImpl );
 }
 
 void VCLXWindow::SetWindow( Window* pWindow )
@@ -524,7 +645,7 @@ void VCLXWindow::ProcessWindowEvent( con
         		aEvent.Source = (::cppu::OWeakObject*)this;
         		ImplInitMouseEvent( aEvent, aMEvt );
         		aEvent.PopupTrigger = sal_True;
-        		GetMouseListeners().mousePressed( aEvent );
+                mpImpl->notifyMouseEvent( aEvent, EVENT_MOUSE_PRESSED );
         	}
         }
         break;
@@ -537,10 +658,10 @@ void VCLXWindow::ProcessWindowEvent( con
     			aEvent.Source = (::cppu::OWeakObject*)this;
     			ImplInitMouseEvent( aEvent, *pMouseEvt );
 
-    			if ( pMouseEvt->IsEnterWindow() )
-    				GetMouseListeners().mouseEntered( aEvent );
-    			else
-    				GetMouseListeners().mouseExited( aEvent );
+                mpImpl->notifyMouseEvent(
+                    aEvent,
+                    pMouseEvt->IsEnterWindow() ? EVENT_MOUSE_ENTERED : EVENT_MOUSE_EXITED
+                );
     		}
 
     		if ( GetMouseMotionListeners().getLength() && !pMouseEvt->IsEnterWindow() && !pMouseEvt->IsLeaveWindow() )
@@ -564,7 +685,7 @@ void VCLXWindow::ProcessWindowEvent( con
         		::com::sun::star::awt::MouseEvent aEvent;
         		aEvent.Source = (::cppu::OWeakObject*)this;
         		ImplInitMouseEvent( aEvent, *(MouseEvent*)rVclWindowEvent.GetData() );
-        		GetMouseListeners().mousePressed( aEvent );
+                mpImpl->notifyMouseEvent( aEvent, EVENT_MOUSE_PRESSED );
         	}
         }
         break;
@@ -575,7 +696,7 @@ void VCLXWindow::ProcessWindowEvent( con
         		::com::sun::star::awt::MouseEvent aEvent;
         		aEvent.Source = (::cppu::OWeakObject*)this;
         		ImplInitMouseEvent( aEvent, *(MouseEvent*)rVclWindowEvent.GetData() );
-        		GetMouseListeners().mouseReleased( aEvent );
+                mpImpl->notifyMouseEvent( aEvent, EVENT_MOUSE_RELEASED );
         	}
         }
         break;
@@ -797,6 +918,8 @@ void VCLXWindow::dispose(  ) throw(::com
 	{
 		mbDisposing = sal_True;
 
+        mpImpl->disposing();
+
 		::com::sun::star::lang::EventObject aObj;
 		aObj.Source = static_cast< ::cppu::OWeakObject* >( this );
 
@@ -1857,32 +1980,44 @@ void VCLXWindow::draw( sal_Int32 nX, sal
 
 		if ( pWindow->GetParent() && !pWindow->IsSystemWindow() && ( pWindow->GetParent() == pDev ) )
 		{
-            BOOL bWasVisible = pWindow->IsVisible();
-            Point aOldPos( pWindow->GetPosPixel() );
+			// #i40647# don't draw here if this is a recursive call
+			// sometimes this is called recursively, because the Update call on the parent
+			// (strangely) triggers another paint. Prevent a stack overflow here
+			// Yes, this is only fixing symptoms for the moment ....
+			// #i40647# / 2005-01-18 / frank.schoenheit@sun.com
+			if ( !mbDrawingOntoParent )
+			{
+				mbDrawingOntoParent = true;
 
-            if ( bWasVisible && aOldPos == aPos )
-            {
-                pWindow->Update();
-                return;
-            }
+                BOOL bWasVisible = pWindow->IsVisible();
+                Point aOldPos( pWindow->GetPosPixel() );
 
-			pWindow->SetPosPixel( aPos );
+                if ( bWasVisible && aOldPos == aPos )
+                {
+                    pWindow->Update();
+                    return;
+                }
+
+				pWindow->SetPosPixel( aPos );
 
-			// Erstmal ein Update auf den Parent, damit nicht beim Update
-			// auf dieses Fenster noch ein Paint vom Parent abgearbeitet wird,
-			// wo dann ggf. dieses Fenster sofort wieder gehidet wird.
-			if( pWindow->GetParent() )
-				pWindow->GetParent()->Update();
-
-			pWindow->Show();
-			pWindow->Update();
-			pWindow->SetParentUpdateMode( sal_False );
-			pWindow->Hide();
-			pWindow->SetParentUpdateMode( sal_True );
-
-			pWindow->SetPosPixel( aOldPos );
-            if ( bWasVisible )
-                pWindow->Show( TRUE );
+				// Erstmal ein Update auf den Parent, damit nicht beim Update
+				// auf dieses Fenster noch ein Paint vom Parent abgearbeitet wird,
+				// wo dann ggf. dieses Fenster sofort wieder gehidet wird.
+				if( pWindow->GetParent() )
+					pWindow->GetParent()->Update();
+
+				pWindow->Show();
+				pWindow->Update();
+				pWindow->SetParentUpdateMode( sal_False );
+				pWindow->Hide();
+				pWindow->SetParentUpdateMode( sal_True );
+
+				pWindow->SetPosPixel( aOldPos );
+                if ( bWasVisible )
+                    pWindow->Show( TRUE );
+
+				mbDrawingOntoParent = false;
+			}
 		}
 		else if ( pDev )
 		{
Index: toolkit/util/makefile.mk
===================================================================
RCS file: /cvs/gsl/toolkit/util/makefile.mk,v
retrieving revision 1.16
retrieving revision 1.15.78.2
diff -u -p -u -p -r1.16 -r1.15.78.2
--- toolkit/util/makefile.mk	11 Jan 2005 14:08:31 -0000	1.16
+++ toolkit/util/makefile.mk	21 Jan 2005 08:32:46 -0000	1.15.78.2
@@ -86,6 +86,7 @@ SHL1IMPLIB= itk
 SHL1USE_EXPORTS=ordinal
 
 SHL1STDLIBS=\
+		$(VOSLIB)           \
 		$(VCLLIB)			\
 		$(SOTLIB)			\
 		$(UNOTOOLSLIB)		\
Index: sw/source/ui/dbui/dbinsdlg.cxx
===================================================================
RCS file: /cvs/sw/sw/source/ui/dbui/dbinsdlg.cxx,v
retrieving revision 1.49
retrieving revision 1.49.232.1
diff -u -p -u -p -r1.49 -r1.49.232.1
--- sw/source/ui/dbui/dbinsdlg.cxx	24 Sep 2004 16:16:57 -0000	1.49
+++ sw/source/ui/dbui/dbinsdlg.cxx	21 Jan 2005 06:28:46 -0000	1.49.232.1
@@ -504,6 +504,7 @@ SwInsertDBColAutoPilot::SwInsertDBColAut
 			switch(eDataType)
 			{
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 				case DataType::TINYINT:
 				case DataType::SMALLINT:
 				case DataType::INTEGER:
Index: sw/source/ui/dbui/dbmgr.cxx
===================================================================
RCS file: /cvs/sw/sw/source/ui/dbui/dbmgr.cxx,v
retrieving revision 1.88
retrieving revision 1.84.52.3
diff -u -p -u -p -r1.88 -r1.84.52.3
--- sw/source/ui/dbui/dbmgr.cxx	28 Jan 2005 15:47:46 -0000	1.88
+++ sw/source/ui/dbui/dbmgr.cxx	11 Feb 2005 10:22:16 -0000	1.84.52.3
@@ -2014,6 +2014,7 @@ String SwNewDBMgr::GetDBField(uno::Refer
 			sRet = xColumn->getString();
 		break;
 		case DataType::BIT:
+		case DataType::BOOLEAN:
 		case DataType::TINYINT:
 		case DataType::SMALLINT:
 		case DataType::INTEGER:
Index: sw/source/ui/fldui/xfldui.cxx
===================================================================
RCS file: /cvs/sw/sw/source/ui/fldui/xfldui.cxx,v
retrieving revision 1.5
retrieving revision 1.5.894.1
diff -u -p -u -p -r1.5 -r1.5.894.1
--- sw/source/ui/fldui/xfldui.cxx	17 Apr 2003 15:29:06 -0000	1.5
+++ sw/source/ui/fldui/xfldui.cxx	21 Jan 2005 06:28:45 -0000	1.5.894.1
@@ -204,6 +204,7 @@ BOOL SwFldMgr::IsDBNumeric( const String
 			switch(eDataType)
 			{
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 				case DataType::TINYINT:
 				case DataType::SMALLINT:
 				case DataType::INTEGER:
Index: sw/source/ui/inc/shells.hrc
===================================================================
RCS file: /cvs/sw/sw/source/ui/inc/shells.hrc,v
retrieving revision 1.7
retrieving revision 1.7.252.1
diff -u -p -u -p -r1.7 -r1.7.252.1
--- sw/source/ui/inc/shells.hrc	12 Aug 2004 10:14:00 -0000	1.7
+++ sw/source/ui/inc/shells.hrc	19 Jan 2005 10:46:45 -0000	1.7.252.1
@@ -116,7 +116,7 @@
 #define MSG_NO_RULER               (RC_SHELLS_BEGIN +  47)
 
 #define STR_SHELLNAME_DRAWFORM     (RC_SHELLS_BEGIN +  48)
-#define RID_DRAWFORM_TOOLBOX	   (RC_SHELLS_BEGIN +  49)
+    // FREE
 
 #define STR_REDLINE_FORMATED	   (RC_SHELLS_BEGIN + 50)
 #define STR_REDLINE_TABLECHG	   (RC_SHELLS_BEGIN + 51)
Index: sw/source/ui/shells/basesh.cxx
===================================================================
RCS file: /cvs/sw/sw/source/ui/shells/basesh.cxx,v
retrieving revision 1.64
retrieving revision 1.64.2.1
diff -u -p -u -p -r1.64 -r1.64.2.1
--- sw/source/ui/shells/basesh.cxx	18 Jan 2005 14:30:21 -0000	1.64
+++ sw/source/ui/shells/basesh.cxx	21 Jan 2005 16:51:00 -0000	1.64.2.1
@@ -102,6 +102,9 @@
 #ifndef _SFX_WHITER_HXX //autogen
 #include <svtools/whiter.hxx>
 #endif
+#ifndef _SFXVISIBILITYITEM_HXX
+#include <svtools/visitem.hxx>
+#endif
 #ifndef _SFX_OBJITEM_HXX //autogen
 #include <sfx2/objitem.hxx>
 #endif
@@ -1911,7 +1914,7 @@ void SwBaseShell::GetState( SfxItemSet &
                     rSet.Put( SfxBoolItem( nWhich, bValue ) );
                 }
                 else
-                    rSet.DisableItem( nWhich );
+                    rSet.Put( SfxVisibilityItem( nWhich, sal_False ) );
                 break;
 		}
 		nWhich = aIter.NextWhich();
Index: sw/source/ui/shells/drformsh.cxx
===================================================================
RCS file: /cvs/sw/sw/source/ui/shells/drformsh.cxx,v
retrieving revision 1.9
retrieving revision 1.8.126.2
diff -u -p -u -p -r1.9 -r1.8.126.2
--- sw/source/ui/shells/drformsh.cxx	11 Jan 2005 12:43:20 -0000	1.9
+++ sw/source/ui/shells/drformsh.cxx	21 Jan 2005 08:59:50 -0000	1.8.126.2
@@ -141,7 +141,7 @@ using namespace ::rtl;
 SFX_IMPL_INTERFACE(SwDrawFormShell, SwDrawBaseShell, SW_RES(STR_SHELLNAME_DRAWFORM))
 {
 	SFX_POPUPMENU_REGISTRATION(SW_RES(MN_DRAWFORM_POPUPMENU));
-	SFX_OBJECTBAR_REGISTRATION(SFX_OBJECTBAR_OBJECT, SW_RES(RID_DRAWFORM_TOOLBOX));
+	SFX_OBJECTBAR_REGISTRATION(SFX_OBJECTBAR_OBJECT, SW_RES(RID_TEXT_TOOLBOX));
 }
 
 
Index: sw/source/ui/shells/shells.src
===================================================================
RCS file: /cvs/sw/sw/source/ui/shells/shells.src,v
retrieving revision 1.45
retrieving revision 1.45.234.1
diff -u -p -u -p -r1.45 -r1.45.234.1
--- sw/source/ui/shells/shells.src	9 Sep 2004 09:06:06 -0000	1.45
+++ sw/source/ui/shells/shells.src	19 Jan 2005 10:47:08 -0000	1.45.234.1
@@ -767,117 +767,6 @@ ToolBox RID_DRAW_TOOLBOX
 	};
 	Scroll = TRUE ;
 };
-String RID_DRAWFORM_TOOLBOX
-{
-	Text [ de ] = "Kontrollfeldleiste" ;
-	Text [ en-US ] = "Control Bar" ;
-	Text [ x-comment ] = " ";
-};
-ToolBox RID_DRAWFORM_TOOLBOX
-{
-	HelpID = HID_DRAWFORM_TOOLBOX ;
-	Border = TRUE ;
-	SVLook = TRUE ;
-	Dockable = TRUE ;
-	Moveable = TRUE ;
-	Sizeable = TRUE ;
-	Closeable = TRUE ;
-	Zoomable = TRUE ;
-	LineSpacing = TRUE ;
-	HideWhenDeactivate = TRUE ;
-	Customize = TRUE ;
-	MenuStrings = TRUE ;
-	Hide = TRUE ;
-	Scroll = TRUE ;
-	ItemList =
-	{
-		ToolBoxItem
-		{
-			Identifier = FN_TOOL_ANKER ;
-			HelpID = FN_TOOL_ANKER ;
-			DropDown = TRUE ;
-		};
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_ATTR_TRANSFORM ;
-			HelpID = SID_ATTR_TRANSFORM ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_CTL_PROPERTIES ;
-			HelpID = SID_FM_CTL_PROPERTIES ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_PROPERTIES ;
-			HelpID = SID_FM_PROPERTIES ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_SHOW_FMEXPLORER ;
-			HelpID = SID_FM_SHOW_FMEXPLORER ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_TAB_DIALOG ;
-			HelpID = SID_FM_TAB_DIALOG ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_ADD_FIELD ;
-			HelpID = SID_FM_ADD_FIELD ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_DESIGN_MODE ;
-			HelpID = SID_FM_DESIGN_MODE ;
-		};
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		MN_LAYER
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_GROUP ;
-			HelpID = SID_GROUP ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_UNGROUP ;
-			HelpID = SID_UNGROUP ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_ENTER_GROUP ;
-			HelpID = SID_ENTER_GROUP ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_LEAVE_GROUP ;
-			HelpID = SID_LEAVE_GROUP ;
-		};
-		MN_GRID( HIDE=FALSE )
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_OBJECT_ALIGN ;
-			HelpID = SID_OBJECT_ALIGN ;
-			DropDown = TRUE ;
-		};
-	};
-};
 String RID_BEZIER_TOOLBOX
 {
 	Text [ de ] = "Bezierobjektleiste" ;
Index: sw/source/ui/web/wformsh.cxx
===================================================================
RCS file: /cvs/sw/sw/source/ui/web/wformsh.cxx,v
retrieving revision 1.4
retrieving revision 1.4.282.1
diff -u -p -u -p -r1.4 -r1.4.282.1
--- sw/source/ui/web/wformsh.cxx	2 Aug 2004 13:11:37 -0000	1.4
+++ sw/source/ui/web/wformsh.cxx	19 Jan 2005 10:47:52 -0000	1.4.282.1
@@ -96,7 +96,7 @@
 SFX_IMPL_INTERFACE(SwWebDrawFormShell, SwDrawFormShell, SW_RES(0))
 {
 	SFX_POPUPMENU_REGISTRATION(SW_RES(MN_DRAWFORM_POPUPMENU));
-	SFX_OBJECTBAR_REGISTRATION(SFX_OBJECTBAR_OBJECT, SW_RES(RID_DRAWFORM_TOOLBOX));
+	SFX_OBJECTBAR_REGISTRATION(SFX_OBJECTBAR_OBJECT, SW_RES(RID_TEXT_TOOLBOX));
 }
 
 TYPEINIT1(SwWebDrawFormShell, SwDrawFormShell)
Index: sw/uiconfig/swriter/toolbar/databaseformdesign.xml
===================================================================
RCS file: sw/uiconfig/swriter/toolbar/databaseformdesign.xml
diff -N sw/uiconfig/swriter/toolbar/databaseformdesign.xml
--- sw/uiconfig/swriter/toolbar/databaseformdesign.xml	9 Sep 2004 10:16:17 -0000	1.2
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,31 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
- <toolbar:toolbaritem xlink:href=".uno:SelectObject" toolbar:helpid="helpid:10128" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ControlProperties" toolbar:helpid="helpid:10613" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:FormProperties" toolbar:helpid="helpid:10614" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:TransformDialog" toolbar:helpid="helpid:10087" toolbar:text="" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ShowFmExplorer" toolbar:helpid="helpid:10633" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:TabDialog" toolbar:helpid="helpid:10615" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:AddField" toolbar:helpid="helpid:10623" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:AutoControlFocus" toolbar:helpid="helpid:10763" toolbar:text="" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ToggleAnchorType" toolbar:helpid="helpid:20349" toolbar:text="" toolbar:style="dropdown" toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:BringToFront" toolbar:helpid="helpid:10286" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:SendToBack" toolbar:helpid="helpid:10287" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:FormatGroup" toolbar:helpid="helpid:10454" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:FormatUngroup" toolbar:helpid="helpid:10455" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:EnterGroup" toolbar:helpid="helpid:27096" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:LeaveGroup" toolbar:helpid="helpid:27097" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ObjectAlign" toolbar:helpid="helpid:10130" toolbar:text="" toolbar:style="dropdown" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:OpenReadOnly" toolbar:helpid="helpid:10709" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:GridVisible" toolbar:helpid="helpid:27322" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:GridUse" toolbar:helpid="helpid:27154" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:HelplinesMove" toolbar:helpid="helpid:27153" toolbar:text="" />
-</toolbar:toolbar>
\ No newline at end of file
Index: sw/uiconfig/swriter/toolbar/formdesign.xml
===================================================================
RCS file: /cvs/sw/sw/uiconfig/swriter/toolbar/formdesign.xml,v
retrieving revision 1.2
retrieving revision 1.2.234.1
diff -u -p -u -p -r1.2 -r1.2.234.1
--- sw/uiconfig/swriter/toolbar/formdesign.xml	9 Sep 2004 10:16:37 -0000	1.2
+++ sw/uiconfig/swriter/toolbar/formdesign.xml	21 Jan 2005 16:53:35 -0000	1.2.234.1
@@ -2,16 +2,21 @@
 <!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
 <toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
  <toolbar:toolbaritem xlink:href=".uno:SelectObject" toolbar:helpid="helpid:10128" toolbar:text="" toolbar:style="radio auto" />
+ <toolbar:toolbaritem xlink:href=".uno:SwitchControlDesignMode" toolbar:helpid="helpid:10629" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SwitchXFormsDesignMode" toolbar:helpid="helpid:10629" toolbar:text="" />
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:ControlProperties" toolbar:helpid="helpid:10613" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:FormProperties" toolbar:helpid="helpid:10614" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:TransformDialog" toolbar:helpid="helpid:10087" toolbar:text="" />
  <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ShowDataNavigator" toolbar:helpid="helpid:10773" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:ShowFmExplorer" toolbar:helpid="helpid:10633" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:TabDialog" toolbar:helpid="helpid:10615" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:AddField" toolbar:helpid="helpid:10623" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:TabDialog" toolbar:helpid="helpid:10615" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:OpenReadOnly" toolbar:helpid="helpid:10709" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:AutoControlFocus" toolbar:helpid="helpid:10763" toolbar:text="" />
  <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:TransformDialog" toolbar:helpid="helpid:10087" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:ToggleAnchorType" toolbar:helpid="helpid:20349" toolbar:text="" toolbar:style="dropdown" />
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:BringToFront" toolbar:helpid="helpid:10286" toolbar:text="" toolbar:visible="false" />
@@ -24,7 +29,6 @@
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:ObjectAlign" toolbar:helpid="helpid:10130" toolbar:text="" toolbar:style="dropdown" />
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:OpenReadOnly" toolbar:helpid="helpid:10709" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:GridVisible" toolbar:helpid="helpid:27322" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:GridUse" toolbar:helpid="helpid:27154" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:HelplinesMove" toolbar:helpid="helpid:27153" toolbar:text="" />
Index: sw/uiconfig/swriter/toolbar/moredatabasecontrols.xml
===================================================================
RCS file: sw/uiconfig/swriter/toolbar/moredatabasecontrols.xml
diff -N sw/uiconfig/swriter/toolbar/moredatabasecontrols.xml
--- sw/uiconfig/swriter/toolbar/moredatabasecontrols.xml	9 Sep 2004 10:17:00 -0000	1.2
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,18 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
- <toolbar:toolbaritem xlink:href=".uno:SpinButton" toolbar:helpid="helpid:10769" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:ScrollBar" toolbar:helpid="helpid:10768" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:Imagebutton" toolbar:helpid="helpid:10604" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:ImageControl" toolbar:helpid="helpid:10710" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:FileControl" toolbar:helpid="helpid:10605" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:DateField" toolbar:helpid="helpid:10704" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:TimeField" toolbar:helpid="helpid:10705" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:NumericField" toolbar:helpid="helpid:10706" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:CurrencyField" toolbar:helpid="helpid:10707" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:PatternField" toolbar:helpid="helpid:10708" toolbar:text="" toolbar:style="radio auto" />
-</toolbar:toolbar>
\ No newline at end of file
Index: sw/uiconfig/swriter/toolbar/moreformcontrols.xml
===================================================================
RCS file: /cvs/sw/sw/uiconfig/swriter/toolbar/moreformcontrols.xml,v
retrieving revision 1.2
retrieving revision 1.2.234.2
diff -u -p -u -p -r1.2 -r1.2.234.2
--- sw/uiconfig/swriter/toolbar/moreformcontrols.xml	9 Sep 2004 10:17:11 -0000	1.2
+++ sw/uiconfig/swriter/toolbar/moreformcontrols.xml	24 Jan 2005 13:02:10 -0000	1.2.234.2
@@ -7,10 +7,10 @@
  <toolbar:toolbaritem xlink:href=".uno:Imagebutton" toolbar:helpid="helpid:10604" toolbar:text="" toolbar:style="radio auto" />
  <toolbar:toolbaritem xlink:href=".uno:ImageControl" toolbar:helpid="helpid:10710" toolbar:text="" toolbar:style="radio auto" />
  <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:FileControl" toolbar:helpid="helpid:10605" toolbar:text="" toolbar:style="radio auto" />
  <toolbar:toolbaritem xlink:href=".uno:DateField" toolbar:helpid="helpid:10704" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
  <toolbar:toolbaritem xlink:href=".uno:TimeField" toolbar:helpid="helpid:10705" toolbar:text="" toolbar:style="radio auto" />
+ <toolbar:toolbarbreak/>
+ <toolbar:toolbaritem xlink:href=".uno:FileControl" toolbar:helpid="helpid:10605" toolbar:text="" toolbar:style="radio auto" />
  <toolbar:toolbaritem xlink:href=".uno:NumericField" toolbar:helpid="helpid:10706" toolbar:text="" toolbar:style="radio auto" />
  <toolbar:toolbarbreak/>
  <toolbar:toolbaritem xlink:href=".uno:CurrencyField" toolbar:helpid="helpid:10707" toolbar:text="" toolbar:style="radio auto" />
Index: sw/uiconfig/swriter/toolbar/morexformcontrols.xml
===================================================================
RCS file: sw/uiconfig/swriter/toolbar/morexformcontrols.xml
diff -N sw/uiconfig/swriter/toolbar/morexformcontrols.xml
--- sw/uiconfig/swriter/toolbar/morexformcontrols.xml	16 Nov 2004 10:28:00 -0000	1.3
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,12 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
- <toolbar:toolbaritem xlink:href=".uno:DateField" toolbar:helpid="helpid:10704" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:TimeField" toolbar:helpid="helpid:10705" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:NumericField" toolbar:helpid="helpid:10706" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:GroupBox" toolbar:helpid="helpid:10598" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:SpinButton" toolbar:helpid="helpid:10769" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:Imagebutton" toolbar:helpid="helpid:10604" toolbar:text="" toolbar:style="radio auto" />
-</toolbar:toolbar>
\ No newline at end of file
Index: sw/uiconfig/swriter/toolbar/xformcontrols.xml
===================================================================
RCS file: sw/uiconfig/swriter/toolbar/xformcontrols.xml
diff -N sw/uiconfig/swriter/toolbar/xformcontrols.xml
--- sw/uiconfig/swriter/toolbar/xformcontrols.xml	26 Nov 2004 20:11:59 -0000	1.5
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,24 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
- <toolbar:toolbaritem xlink:href=".uno:SelectObject" toolbar:helpid="helpid:10128" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:SwitchXFormsDesignMode" toolbar:helpid="helpid:10629" toolbar:text="" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:ControlProperties" toolbar:helpid="helpid:10613" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:ShowDataNavigator" toolbar:helpid="helpid:10773" toolbar:text="" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:Edit" toolbar:helpid="helpid:10599" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:FormattedField" toolbar:helpid="helpid:10728" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:CheckBox" toolbar:helpid="helpid:10596" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:RadioButton" toolbar:helpid="helpid:10595" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:ListBox" toolbar:helpid="helpid:10600" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:ComboBox" toolbar:helpid="helpid:10601" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:Pushbutton" toolbar:helpid="helpid:10594" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:Label" toolbar:helpid="helpid:10597" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarbreak/>
- <toolbar:toolbaritem xlink:href=".uno:FormDesignTools" toolbar:helpid="helpid:11046" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:MoreControls" toolbar:helpid="helpid:11045" toolbar:text="" />
-</toolbar:toolbar>
Index: sw/uiconfig/swriter/toolbar/xformdesign.xml
===================================================================
RCS file: sw/uiconfig/swriter/toolbar/xformdesign.xml
diff -N sw/uiconfig/swriter/toolbar/xformdesign.xml
--- sw/uiconfig/swriter/toolbar/xformdesign.xml	16 Nov 2004 10:28:22 -0000	1.3
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,30 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
- <toolbar:toolbaritem xlink:href=".uno:SelectObject" toolbar:helpid="helpid:10128" toolbar:text="" toolbar:style="radio auto" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ControlProperties" toolbar:helpid="helpid:10613" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:TransformDialog" toolbar:helpid="helpid:10087" toolbar:text="" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ShowDataNavigator" toolbar:helpid="helpid:10773" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:ShowFmExplorer" toolbar:helpid="helpid:10633" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:TabDialog" toolbar:helpid="helpid:10615" toolbar:text="" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ToggleAnchorType" toolbar:helpid="helpid:20349" toolbar:text="" toolbar:style="dropdown" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:BringToFront" toolbar:helpid="helpid:10286" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:SendToBack" toolbar:helpid="helpid:10287" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:FormatGroup" toolbar:helpid="helpid:10454" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:FormatUngroup" toolbar:helpid="helpid:10455" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:EnterGroup" toolbar:helpid="helpid:27096" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:LeaveGroup" toolbar:helpid="helpid:27097" toolbar:text="" toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ObjectAlign" toolbar:helpid="helpid:10130" toolbar:text="" toolbar:style="dropdown" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:OpenReadOnly" toolbar:helpid="helpid:10709" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:AutoControlFocus" toolbar:helpid="helpid:10763" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:GridVisible" toolbar:helpid="helpid:27322" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:GridUse" toolbar:helpid="helpid:27154" toolbar:text="" />
- <toolbar:toolbaritem xlink:href=".uno:HelplinesMove" toolbar:helpid="helpid:27153" toolbar:text="" />
-</toolbar:toolbar>
\ No newline at end of file
Index: forms/source/component/DatabaseForm.cxx
===================================================================
RCS file: /cvs/gsl/forms/source/component/DatabaseForm.cxx,v
retrieving revision 1.66
retrieving revision 1.66.4.1
diff -u -p -u -p -r1.66 -r1.66.4.1
--- forms/source/component/DatabaseForm.cxx	5 Jan 2005 12:02:29 -0000	1.66
+++ forms/source/component/DatabaseForm.cxx	17 Jan 2005 14:44:10 -0000	1.66.4.1
@@ -2839,10 +2839,11 @@ sal_Bool ODatabaseForm::implEnsureConnec
 		{
 			// do we have a connection in the hierarchy than take that connection
 			// this overwrites all the other connnections
-			Reference< XConnection >  xConnection = calcConnection(
+			Reference< XConnection >  xConnection = connectRowset(
 				Reference<XRowSet> (m_xAggregate, UNO_QUERY),
-				m_xServiceFactory
-			);		// will set a calculated connection implicitly
+				m_xServiceFactory,
+                sal_True    // set a calculated connection as ActiveConnection
+			);
 			return xConnection.is();
 		}
 	}
@@ -2850,6 +2851,10 @@ sal_Bool ODatabaseForm::implEnsureConnec
 	{
 		onError(eDB, FRM_RES_STRING(RID_STR_CONNECTERROR));
 	}
+	catch( Exception )
+	{
+        DBG_ERROR( "ODatabaseForm::implEnsureConnection: caught an exception which I cannot handle!" );
+    }
 
 	return sal_False;
 }
Index: forms/source/component/Edit.cxx
===================================================================
RCS file: /cvs/gsl/forms/source/component/Edit.cxx,v
retrieving revision 1.26
retrieving revision 1.26.8.1
diff -u -p -u -p -r1.26 -r1.26.8.1
--- forms/source/component/Edit.cxx	5 Jan 2005 12:02:58 -0000	1.26
+++ forms/source/component/Edit.cxx	21 Jan 2005 06:32:02 -0000	1.26.8.1
@@ -698,6 +698,7 @@ void OEditModel::onConnectedDbColumn( co
 			case ::com::sun::star::sdbc::DataType::TIME:
 			case ::com::sun::star::sdbc::DataType::TIMESTAMP:
 			case ::com::sun::star::sdbc::DataType::BIT:
+			case ::com::sun::star::sdbc::DataType::BOOLEAN:
 			case ::com::sun::star::sdbc::DataType::TINYINT:
 			case ::com::sun::star::sdbc::DataType::SMALLINT:
 			case ::com::sun::star::sdbc::DataType::INTEGER:
Index: forms/source/component/FormattedField.cxx
===================================================================
RCS file: /cvs/gsl/forms/source/component/FormattedField.cxx,v
retrieving revision 1.34
retrieving revision 1.34.16.1
diff -u -p -u -p -r1.34 -r1.34.16.1
--- forms/source/component/FormattedField.cxx	16 Nov 2004 10:37:51 -0000	1.34
+++ forms/source/component/FormattedField.cxx	21 Jan 2005 06:31:32 -0000	1.34.16.1
@@ -867,6 +867,7 @@ void OFormattedModel::onConnectedDbColum
 					switch (nType)
 					{
 						case DataType::BIT:
+						case DataType::BOOLEAN:
 						case DataType::TINYINT:
 						case DataType::SMALLINT:
 						case DataType::INTEGER:
Index: forms/source/component/ListBox.cxx
===================================================================
RCS file: /cvs/gsl/forms/source/component/ListBox.cxx,v
retrieving revision 1.36
retrieving revision 1.36.16.1
diff -u -p -u -p -r1.36 -r1.36.16.1
--- forms/source/component/ListBox.cxx	16 Nov 2004 10:39:57 -0000	1.36
+++ forms/source/component/ListBox.cxx	13 Jan 2005 16:00:51 -0000	1.36.16.1
@@ -252,16 +252,7 @@ namespace frm
     //==================================================================
     //= ItemEvent
     //==================================================================
-    class ItemEventDescription : public EventDescription
-    {
-    private:
-        ItemEvent   m_aEvent;
-
-    public:
-        ItemEventDescription( const ItemEvent& _rUnoEvent ) : m_aEvent( _rUnoEvent ) { }
-
-        const ItemEvent& getEvent() const { return m_aEvent; }
-    };
+    typedef ::comphelper::EventObjectHolder< ItemEvent >    ItemEventDescription;
 
     //==================================================================
     //= OListBoxModel
@@ -1712,11 +1703,11 @@ namespace frm
             {
                 if ( !m_pItemBroadcaster )
                 {
-                    m_pItemBroadcaster = new AsyncEventNotifier( this );
+                    m_pItemBroadcaster = new ::comphelper::AsyncEventNotifier( this );
                     m_pItemBroadcaster->acquire();
                     m_pItemBroadcaster->create();
                 }
-		        m_pItemBroadcaster->addEvent( new ItemEventDescription( _rEvent ) );
+		        m_pItemBroadcaster->addEvent( new ItemEventDescription( _rEvent, 0 ) );
             }
         }
 
@@ -1810,16 +1801,16 @@ namespace frm
     }
 
     //------------------------------------------------------------------------------
-    void OListBoxControl::processEvent( const EventReference& _rEvent )
+    void OListBoxControl::processEvent( const EventDescription& _rEvent )
     {
-        const ItemEventDescription* pItemEvent = static_cast< const ItemEventDescription* >( _rEvent.get() );
-        m_pItemListeners->itemStateChanged( pItemEvent->getEvent() );
+        const ItemEventDescription& rItemEvent = static_cast< const ItemEventDescription& >( _rEvent );
+        m_pItemListeners->itemStateChanged( rItemEvent.getEventObject() );
     }
 
     //------------------------------------------------------------------------------
-    XComponentRef OListBoxControl::getComponent()
+    Reference< XComponent > OListBoxControl::getComponent()
     {
-        return XComponentRef( queryInterface( XComponent::static_type() ), UNO_QUERY );
+        return Reference< XComponent >( queryInterface( XComponent::static_type() ), UNO_QUERY );
     }
 
     //------------------------------------------------------------------------------
Index: forms/source/component/ListBox.hxx
===================================================================
RCS file: /cvs/gsl/forms/source/component/ListBox.hxx,v
retrieving revision 1.10
retrieving revision 1.10.24.1
diff -u -p -u -p -r1.10 -r1.10.24.1
--- forms/source/component/ListBox.hxx	22 Oct 2004 11:39:24 -0000	1.10
+++ forms/source/component/ListBox.hxx	13 Jan 2005 16:00:52 -0000	1.10.24.1
@@ -114,8 +114,8 @@
 #ifndef FORMS_ENTRYLISTHELPER_HXX
 #include "entrylisthelper.hxx"
 #endif
-#ifndef FORMS_SOURCE_INC_ASYNCNOTIFICATION_HXX
-#include "asyncnotification.hxx"
+#ifndef COMPHELPER_ASYNCNOTIFICATION_HXX
+#include <comphelper/asyncnotification.hxx>
 #endif
 
 #include <memory>
@@ -282,7 +282,7 @@ private:
     ::com::sun::star::uno::Reference< ::com::sun::star::awt::XListBox >
                                             m_xAggregateListBox;
 
-    AsyncEventNotifier*                     m_pItemBroadcaster;
+    ::comphelper::AsyncEventNotifier*       m_pItemBroadcaster;
 
 protected:
 	// UNO Anbindung
@@ -343,8 +343,8 @@ public:
 
 protected:
     // IEventProcessor
-    virtual void processEvent( const EventReference& _rEvent );
-    virtual XComponentRef getComponent();
+    virtual void processEvent( const ::comphelper::EventDescription& _rEvent );
+    virtual ::com::sun::star::uno::Reference< ::com::sun::star::lang::XComponent > getComponent();
 
 private:
 	DECL_LINK( OnTimeout, void* );
Index: forms/source/misc/makefile.mk
===================================================================
RCS file: /cvs/gsl/forms/source/misc/makefile.mk,v
retrieving revision 1.7
retrieving revision 1.7.22.1
diff -u -p -u -p -r1.7 -r1.7.22.1
--- forms/source/misc/makefile.mk	22 Oct 2004 11:41:40 -0000	1.7
+++ forms/source/misc/makefile.mk	13 Jan 2005 16:00:24 -0000	1.7.22.1
@@ -87,7 +87,6 @@ SLOFILES=	$(SLO)$/limitedformats.obj \
 			$(SLO)$/frm_strings.obj \
 			$(SLO)$/listenercontainers.obj \
 			$(SLO)$/componenttools.obj \
-			$(SLO)$/asyncnotification.obj
 
 # --- Targets ----------------------------------
 
Index: offapi/com/sun/star/awt/MouseEvent.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/awt/MouseEvent.idl,v
retrieving revision 1.9
retrieving revision 1.9.158.1
diff -u -p -u -p -r1.9 -r1.9.158.1
--- offapi/com/sun/star/awt/MouseEvent.idl	3 Jun 2004 17:12:06 -0000	1.9
+++ offapi/com/sun/star/awt/MouseEvent.idl	13 Jan 2005 10:55:13 -0000	1.9.158.1
@@ -74,6 +74,11 @@
  
 /** specifies an event from the mouse.
 
+    <p>This event is also used for popup menu requests on objects.
+    See <member>PopupTrigger</member> for details.</p>
+
+    @see XMouseListener
+    @see XMouseMotionListener
     @see InputEvent
  */
 published struct MouseEvent: com::sun::star::awt::InputEvent
@@ -108,7 +113,17 @@ published struct MouseEvent: com::sun::s
 	//------------------------------------------------------------------------- 
 	 
 	/** specifies if this event is a popup-menu trigger event.
-	 */
+
+        <p>If this member is <TRUE/>, the event describes a request for a popup menu,
+        also known as context menu, on an object.</p>
+
+        <p>In this case, <member>X</member> and <member>Y</member> describe the position
+        where the request was issued. If those members are <code>-1</code>, then the
+        request was issued using the keyboard, by pressing the operating-system dependent
+        key combination for this purpose.</p>
+
+        @see XMouseListener::mousePressed
+    */
 	boolean PopupTrigger; 
  
 }; 
Index: offapi/com/sun/star/awt/UnoControlCheckBoxModel.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/awt/UnoControlCheckBoxModel.idl,v
retrieving revision 1.8
retrieving revision 1.8.140.1
diff -u -p -u -p -r1.8 -r1.8.140.1
--- offapi/com/sun/star/awt/UnoControlCheckBoxModel.idl	5 Jul 2004 16:00:00 -0000	1.8
+++ offapi/com/sun/star/awt/UnoControlCheckBoxModel.idl	11 Jan 2005 09:05:28 -0000	1.8.140.1
@@ -58,142 +58,145 @@
  *
  *
  ************************************************************************/
-#ifndef __com_sun_star_awt_UnoControlCheckBoxModel_idl__ 
-#define __com_sun_star_awt_UnoControlCheckBoxModel_idl__ 
- 
-#ifndef __com_sun_star_awt_UnoControlModel_idl__ 
-#include <com/sun/star/awt/UnoControlModel.idl> 
-#endif 
- 
+#ifndef __com_sun_star_awt_UnoControlCheckBoxModel_idl__
+#define __com_sun_star_awt_UnoControlCheckBoxModel_idl__
+
+#ifndef __com_sun_star_awt_UnoControlModel_idl__
+#include <com/sun/star/awt/UnoControlModel.idl>
+#endif
+
 #ifndef __com_sun_star_util_Color_idl__
 #include <com/sun/star/util/Color.idl>
 #endif
 
-#ifndef __com_sun_star_awt_FontDescriptor_idl__ 
-#include <com/sun/star/awt/FontDescriptor.idl> 
-#endif 
- 
- 
-//============================================================================= 
- 
- module com {  module sun {  module star {  module awt {  
- 
-//============================================================================= 
- 
+#ifndef __com_sun_star_awt_FontDescriptor_idl__
+#include <com/sun/star/awt/FontDescriptor.idl>
+#endif
+
+#ifndef __com_sun_star_style_VerticalAlignment_idl__
+#include <com/sun/star/style/VerticalAlignment.idl>
+#endif
+
+//=============================================================================
+
+ module com {  module sun {  module star {  module awt {
+
+//=============================================================================
+
 /** specifies the standard model of an <type>UnoControlCheckBox</type>.
  */
 published service UnoControlCheckBoxModel
-{ 
-	service com::sun::star::awt::UnoControlModel; 
- 
-	//------------------------------------------------------------------------- 
-	 
+{
+	service com::sun::star::awt::UnoControlModel;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the background color (RGB) of the control.
 	 */
-	[optional, property] long BackgroundColor; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[optional, property] long BackgroundColor;
+
+	//-------------------------------------------------------------------------
+
 	/** determines whether the control is enabled or disabled.
 	 */
-	[property] boolean Enabled; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] boolean Enabled;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the font attributes of the text in the control.
 	 */
-	[property] com::sun::star::awt::FontDescriptor FontDescriptor; 
- 
+	[property] com::sun::star::awt::FontDescriptor FontDescriptor;
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the <type scope="com::sun::star::text">FontEmphasis</type>
         value of the text in the control.
 	 */
 	[property] short FontEmphasisMark;
- 
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the <type scope="com::sun::star::text">FontRelief</type>
         value of the text in the control.
 	 */
 	[property] short FontRelief;
- 
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the help text of the control.
 	 */
 	[property] string HelpText;
- 
-	//------------------------------------------------------------------------- 
-	 
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the help URL of the control.
 	 */
 	[property] string HelpURL;
- 
+
 	//-------------------------------------------------------------------------
-	 
+
     /** specifies the position of the image, if any, relative to the text, if any
 
         <p>Valid values of this property are specified with <type>ImagePosition</type>.</p>
     */
     [optional, property] short ImagePosition;
-    
+
 	//-------------------------------------------------------------------------
-	 
+
 	/** specifies an URL to an image to display besides the label of the control
 	 */
 	[optional, property] string ImageURL;
- 
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the label of the control.
 	 */
-	[property] string Label; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] string Label;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies that the control will be printed with the document.
 	 */
-	[property] boolean Printable; 
- 
-	//------------------------------------------------------------------------- 
-	 
-	/** specifies the state of the control. 
-				
+	[property] boolean Printable;
+
+	//-------------------------------------------------------------------------
+
+	/** specifies the state of the control.
+
 		<pre>
 		0: not checked
 		1: checked
 		2: don't know
 		</pre>
 	 */
-	[property] short State; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] short State;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies that the control can be reached with the TAB key.
 	 */
-	[property] boolean Tabstop; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] boolean Tabstop;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the text color (RGB) of the control.
 	 */
 	[property] com::sun::star::util::Color TextColor;
-    
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the text line color (RGB) of the control.
 	 */
 	[property] com::sun::star::util::Color TextLineColor;
-    
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies that the control may have the state "don't know".
 	 */
 	[property] boolean TriState;
 
 	//-------------------------------------------------------------------------
-    
+
     /** specifies a visual effect to apply to the check box control
 
         <p>Possible values for this property are <type>VisualEffect</type>::FLAT and
@@ -202,10 +205,16 @@ published service UnoControlCheckBoxMode
         @see com::sun::star::awt::VisualEffect
     */
     [optional, property] short VisualEffect;
-}; 
- 
-//============================================================================= 
- 
-}; }; }; };  
- 
-#endif 
+
+    //-------------------------------------------------------------------------
+
+    /** specifies the vertical alignment of the text in the control
+    */
+    [optional, property] com::sun::star::style::VerticalAlignment VerticalAlign;
+};
+
+//=============================================================================
+
+}; }; }; };
+
+#endif
Index: offapi/com/sun/star/awt/UnoControlFixedTextModel.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/awt/UnoControlFixedTextModel.idl,v
retrieving revision 1.11
retrieving revision 1.11.92.1
diff -u -p -u -p -r1.11 -r1.11.92.1
--- offapi/com/sun/star/awt/UnoControlFixedTextModel.idl	9 Sep 2004 15:45:41 -0000	1.11
+++ offapi/com/sun/star/awt/UnoControlFixedTextModel.idl	11 Jan 2005 09:05:29 -0000	1.11.92.1
@@ -58,65 +58,68 @@
  *
  *
  ************************************************************************/
-#ifndef __com_sun_star_awt_UnoControlFixedTextModel_idl__ 
-#define __com_sun_star_awt_UnoControlFixedTextModel_idl__ 
- 
-#ifndef __com_sun_star_awt_UnoControlModel_idl__ 
-#include <com/sun/star/awt/UnoControlModel.idl> 
-#endif 
- 
+#ifndef __com_sun_star_awt_UnoControlFixedTextModel_idl__
+#define __com_sun_star_awt_UnoControlFixedTextModel_idl__
+
+#ifndef __com_sun_star_awt_UnoControlModel_idl__
+#include <com/sun/star/awt/UnoControlModel.idl>
+#endif
+
 #ifndef __com_sun_star_util_Color_idl__
 #include <com/sun/star/util/Color.idl>
 #endif
 
-#ifndef __com_sun_star_awt_FontDescriptor_idl__ 
-#include <com/sun/star/awt/FontDescriptor.idl> 
-#endif 
- 
- 
-//============================================================================= 
- 
- module com {  module sun {  module star {  module awt {  
- 
-//============================================================================= 
- 
+#ifndef __com_sun_star_awt_FontDescriptor_idl__
+#include <com/sun/star/awt/FontDescriptor.idl>
+#endif
+
+#ifndef __com_sun_star_style_VerticalAlignment_idl__
+#include <com/sun/star/style/VerticalAlignment.idl>
+#endif
+
+//=============================================================================
+
+ module com {  module sun {  module star {  module awt {
+
+//=============================================================================
+
 /** specifies the standard model of an <type>UnoControlFixedText</type>.
  */
 published service UnoControlFixedTextModel
-{ 
-	service com::sun::star::awt::UnoControlModel; 
- 
-	//------------------------------------------------------------------------- 
-	 
-	/** specifies the alignment of the text in the control. 
-				
+{
+	service com::sun::star::awt::UnoControlModel;
+
+	//-------------------------------------------------------------------------
+
+	/** specifies the alignment of the text in the control.
+
 		<pre>
 		0: left
 		1: center
 		2: right
 		</pre>
 	 */
-	[property] short Align; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] short Align;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the background color (RGB) of the control.
 	 */
-	[property] com::sun::star::util::Color BackgroundColor; 
- 
-	//------------------------------------------------------------------------- 
-	 
-	/** specifies the border style of the control. 
-				
+	[property] com::sun::star::util::Color BackgroundColor;
+
+	//-------------------------------------------------------------------------
+
+	/** specifies the border style of the control.
+
 		<pre>
 		0: No border
 		1: 3D border
 		2: simple border
 		</pre>
 	 */
-	[property] short Border; 
- 
-	//------------------------------------------------------------------------- 
+	[property] short Border;
+
+	//-------------------------------------------------------------------------
 
 	/** specifies the color of the border, if present
 
@@ -126,79 +129,84 @@ published service UnoControlFixedTextMod
         @since OOo 2.0.0
 	 */
 	[optional, property] long BorderColor;
- 
-	//------------------------------------------------------------------------- 
-	 
+
+	//-------------------------------------------------------------------------
+
 	/** determines whether the control is enabled or disabled.
 	 */
-	[property] boolean Enabled; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] boolean Enabled;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the font attributes of the text in the control.
 	 */
-	[property] com::sun::star::awt::FontDescriptor FontDescriptor; 
- 
-	//------------------------------------------------------------------------- 
+	[property] com::sun::star::awt::FontDescriptor FontDescriptor;
+
+	//-------------------------------------------------------------------------
 
 	/** specifies the <type scope="com::sun::star::text">FontEmphasis</type>
         value of the text in the control.
 	 */
 	[property] short FontEmphasisMark;
- 
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the <type scope="com::sun::star::text">FontRelief</type>
         value of the text in the control.
 	 */
 	[property] short FontRelief;
-    
-	//------------------------------------------------------------------------- 
+
+	//-------------------------------------------------------------------------
 
 	/** specifies the help text of the control.
 	 */
 	[property] string HelpText;
- 
-	//------------------------------------------------------------------------- 
-	 
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the help URL of the control.
 	 */
 	[property] string HelpURL;
-    
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the label of the control.
 	 */
-	[property] string Label; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] string Label;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies that the text may be displayed on more than one line.
 	 */
-	[property] boolean MultiLine; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] boolean MultiLine;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies that the control will be printed with the document.
 	 */
-	[property] boolean Printable; 
- 
+	[property] boolean Printable;
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the text color (RGB) of the control.
 	 */
-	[property] com::sun::star::util::Color TextColor; 
+	[property] com::sun::star::util::Color TextColor;
 
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the text line color (RGB) of the control.
 	 */
 	[property] com::sun::star::util::Color TextLineColor;
-    
-}; 
- 
-//============================================================================= 
- 
-}; }; }; };  
- 
-#endif 
+
+    //-------------------------------------------------------------------------
+
+    /** specifies the vertical alignment of the text in the control
+    */
+    [optional, property] com::sun::star::style::VerticalAlignment VerticalAlign;
+};
+
+//=============================================================================
+
+}; }; }; };
+
+#endif
Index: offapi/com/sun/star/awt/UnoControlRadioButtonModel.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/awt/UnoControlRadioButtonModel.idl,v
retrieving revision 1.9
retrieving revision 1.9.140.1
diff -u -p -u -p -r1.9 -r1.9.140.1
--- offapi/com/sun/star/awt/UnoControlRadioButtonModel.idl	5 Jul 2004 16:03:16 -0000	1.9
+++ offapi/com/sun/star/awt/UnoControlRadioButtonModel.idl	11 Jan 2005 09:05:30 -0000	1.9.140.1
@@ -58,135 +58,139 @@
  *
  *
  ************************************************************************/
-#ifndef __com_sun_star_awt_UnoControlRadioButtonModel_idl__ 
-#define __com_sun_star_awt_UnoControlRadioButtonModel_idl__ 
- 
-#ifndef __com_sun_star_awt_UnoControlModel_idl__ 
-#include <com/sun/star/awt/UnoControlModel.idl> 
-#endif 
- 
+#ifndef __com_sun_star_awt_UnoControlRadioButtonModel_idl__
+#define __com_sun_star_awt_UnoControlRadioButtonModel_idl__
+
+#ifndef __com_sun_star_awt_UnoControlModel_idl__
+#include <com/sun/star/awt/UnoControlModel.idl>
+#endif
+
 #ifndef __com_sun_star_util_Color_idl__
 #include <com/sun/star/util/Color.idl>
 #endif
 
-#ifndef __com_sun_star_awt_FontDescriptor_idl__ 
-#include <com/sun/star/awt/FontDescriptor.idl> 
-#endif 
- 
- 
-//============================================================================= 
- 
- module com {  module sun {  module star {  module awt {  
- 
-//============================================================================= 
- 
+#ifndef __com_sun_star_awt_FontDescriptor_idl__
+#include <com/sun/star/awt/FontDescriptor.idl>
+#endif
+
+#ifndef __com_sun_star_style_VerticalAlignment_idl__
+#include <com/sun/star/style/VerticalAlignment.idl>
+#endif
+
+
+//=============================================================================
+
+ module com {  module sun {  module star {  module awt {
+
+//=============================================================================
+
 /** specifies the standard model of an <type>UnoControlRadioButton</type>.
  */
 published service UnoControlRadioButtonModel
-{ 
-	service com::sun::star::awt::UnoControlModel; 
- 
-	//------------------------------------------------------------------------- 
-	 
+{
+	service com::sun::star::awt::UnoControlModel;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the background color (RGB) of the control.
 	 */
-	[optional, property] long BackgroundColor; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[optional, property] long BackgroundColor;
+
+	//-------------------------------------------------------------------------
+
 	/** determines whether the control is enabled or disabled.
 	 */
-	[property] boolean Enabled; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] boolean Enabled;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the font attributes of the text in the control.
 	 */
 	[property] com::sun::star::awt::FontDescriptor FontDescriptor;
-    
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the <type scope="com::sun::star::text">FontEmphasis</type>
         value of the text in the control.
 	 */
 	[property] short FontEmphasisMark;
- 
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the <type scope="com::sun::star::text">FontRelief</type>
         value of the text in the control.
 	 */
 	[property] short FontRelief;
- 
+
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the help text of the control.
 	 */
 	[property] string HelpText;
- 
-	//------------------------------------------------------------------------- 
-	 
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the help URL of the control.
 	 */
 	[property] string HelpURL;
-    
+
 	//-------------------------------------------------------------------------
-	 
+
     /** specifies the position of the image, if any, relative to the text, if any
 
         <p>Valid values of this property are specified with <type>ImagePosition</type>.</p>
     */
     [optional, property] short ImagePosition;
-    
+
 	//-------------------------------------------------------------------------
-	 
+
 	/** specifies an URL to an image to display besides the label of the control
 	 */
 	[optional, property] string ImageURL;
- 
-	//------------------------------------------------------------------------- 
-	 
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the label of the control.
 	 */
-	[property] string Label; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] string Label;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies that the control will be printed with the document.
 	 */
-	[property] boolean Printable; 
- 
-	//------------------------------------------------------------------------- 
-	 
-	/** specifies the state of the control. 
-				
+	[property] boolean Printable;
+
+	//-------------------------------------------------------------------------
+
+	/** specifies the state of the control.
+
 		<pre>
 		0: not checked
 		1: checked
 		</pre>
 	 */
-	[property] short State; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] short State;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies that the control can be reached with the TAB key.
 	 */
-	[property] boolean Tabstop; 
- 
-	//------------------------------------------------------------------------- 
-	 
+	[property] boolean Tabstop;
+
+	//-------------------------------------------------------------------------
+
 	/** specifies the text color (RGB) of the control.
 	 */
 	[property] com::sun::star::util::Color TextColor;
 
 	//-------------------------------------------------------------------------
-    
+
 	/** specifies the text line color (RGB) of the control.
 	 */
 	[property] com::sun::star::util::Color TextLineColor;
-    
+
 	//-------------------------------------------------------------------------
-    
+
     /** specifies a visual effect to apply to the check box control
 
         <p>Possible values for this property are <type>VisualEffect</type>::FLAT and
@@ -195,10 +199,16 @@ published service UnoControlRadioButtonM
         @see com::sun::star::awt::VisualEffect
     */
     [optional, property] short VisualEffect;
-}; 
- 
-//============================================================================= 
- 
-}; }; }; };  
- 
-#endif 
+
+    //-------------------------------------------------------------------------
+
+    /** specifies the vertical alignment of the text in the control
+    */
+    [optional, property] com::sun::star::style::VerticalAlignment VerticalAlign;
+};
+
+//=============================================================================
+
+}; }; }; };
+
+#endif
Index: offapi/com/sun/star/awt/XDockableWindow.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/awt/XDockableWindow.idl,v
retrieving revision 1.2
retrieving revision 1.2.140.1
diff -u -p -u -p -r1.2 -r1.2.140.1
--- offapi/com/sun/star/awt/XDockableWindow.idl	6 Jul 2004 11:19:37 -0000	1.2
+++ offapi/com/sun/star/awt/XDockableWindow.idl	13 Jan 2005 10:54:52 -0000	1.2.140.1
@@ -107,7 +107,7 @@ interface XDockableWindow : com::sun::st
         @param bEnable
             <TRUE/> specifies that docking is enabled 
             <FALSE/> specifies that docking is disabled and no
-                <type scope="com::sun::star::awt">XDockableWindowListeners</type> will be called
+                <type scope="com::sun::star::awt">XDockableWindowListener</type> will be called
 	 */
     void enableDocking( [in] boolean bEnable ); 
 
@@ -156,7 +156,7 @@ interface XDockableWindow : com::sun::st
 
     /** shows the window in a menu like style, i.e. without decoration
         a special indicator will allow for tearing off the window
-        see <type scope="com::sun::star::awt">XDockableWindowListeners</type> for
+        see <type scope="com::sun::star::awt">XDockableWindowListener</type> for
         the corresponding events
         @param WindowRect
             specifies the position and size of the popup window in frame coordinates
Index: offapi/com/sun/star/awt/XMouseListener.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/awt/XMouseListener.idl,v
retrieving revision 1.10
retrieving revision 1.10.156.1
diff -u -p -u -p -r1.10 -r1.10.156.1
--- offapi/com/sun/star/awt/XMouseListener.idl	3 Jun 2004 17:39:51 -0000	1.10
+++ offapi/com/sun/star/awt/XMouseListener.idl	13 Jan 2005 10:55:13 -0000	1.10.156.1
@@ -83,7 +83,16 @@ published interface XMouseListener: com:
 	//------------------------------------------------------------------------- 
 	 
 	/** is invoked when a mouse button has been pressed on a window.
-	 */
+
+        <p>Since mouse presses are usually also used to indicate requests for popup menus
+        (also known as context menus) on objects, you might receive two events
+        for a single mouse press: For example, if, on your operating system,
+        pressing the right mouse button indicates the request for a context menu,
+        then you will receive one call to <member>mousePressed</member> indicating
+        the mouse click, and another one indicating the context menu request. For
+        the latter, the <member>MouseEvent::PopupTrigger</member> member of the
+        event will be set to <TRUE/>.</p>
+	*/
 	[oneway] void mousePressed( [in] com::sun::star::awt::MouseEvent e ); 
  
 	//------------------------------------------------------------------------- 
Index: offapi/com/sun/star/document/OfficeDocument.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/document/OfficeDocument.idl,v
retrieving revision 1.13
retrieving revision 1.13.92.1
diff -u -p -u -p -r1.13 -r1.13.92.1
--- offapi/com/sun/star/document/OfficeDocument.idl	9 Sep 2004 16:05:59 -0000	1.13
+++ offapi/com/sun/star/document/OfficeDocument.idl	13 Jan 2005 10:59:39 -0000	1.13.92.1
@@ -207,10 +207,8 @@ published service OfficeDocument
     //-------------------------------------------------------------------------
 	/** controls the initial (on-load) behavior of the form controls in the document
 
-        <p>
-        If set to <TRUE/>, upon loading the document, the form controls will be in design mode.<br>
-		If set to <FALSE/>, they will be alive (i.e., connected to the data source specified for the form
-        they belong to).<br>
+        <p>If set to <TRUE/>, upon loading the document, the form controls will be in design mode.<br/>
+		If set to <FALSE/>, they will be alive, i.e. operational.<br/>
         With this, you may control if your document works primarily as a form document.
         </p>
 	*/
Index: offapi/com/sun/star/sdb/DatabaseAccess.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/DatabaseAccess.idl,v
retrieving revision 1.9
retrieving revision 1.9.156.1
diff -u -p -u -p -r1.9 -r1.9.156.1
--- offapi/com/sun/star/sdb/DatabaseAccess.idl	3 Jun 2004 21:35:40 -0000	1.9
+++ offapi/com/sun/star/sdb/DatabaseAccess.idl	13 Jan 2005 10:58:01 -0000	1.9.156.1
@@ -80,88 +80,66 @@
  published interface XCompletedConnection; 
  
  
-// DocMerge from xml: service com::sun::star::sdb::DatabaseAccess
 /** specifies a component, which controls DatabaseAccessConnections and acts like a
 	shared DataSource.
+
+    @deprecated
  */
 published service DatabaseAccess
 { 
 	// gives access to the properties.
 	interface com::sun::star::beans::XPropertySet; 
  
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccess: interface com::sun::star::sdb::XDatabaseAccess
 	/** controls the establishing of the connections.
 	 */
 	interface XDatabaseAccess; 
- 
 	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccess: interface com::sun::star::sdb::XCompletedConnection
 	/** establishing a connection with user interaction, the implementation 
 			 is optional.
 	 */
 	[optional] interface XCompletedConnection; 
  
-	 
-	// DocMerge from xml: property com::sun::star::sdb::DatabaseAccess::URL
 	/** is the URL of the bean.
 	 */
 	[readonly, property] string URL; 
  
-	 
-	// DocMerge from xml: property com::sun::star::sdb::DatabaseAccess::Title
 	/** is the title of the bean.
 	 */
 	[property] string Title; 
  
-	 
-	// DocMerge from xml: property com::sun::star::sdb::DatabaseAccess::ConnectURL
 	/** indicates a database url of the form <br>
 		<code> jdbc:<em>subprotocol</em>:<em>subname</em></code> or
 		<code> sdbc:<em>subprotocol</em>:<em>subname</em></code>
 	 */
 	[property] string ConnectURL; 
  
-	 
-	// DocMerge from idl: property com::sun::star::sdb::DatabaseAccess::ConnectInfo
 	/** is a list of arbitrary string tag/value pairs as 
 		     connection arguments; normally at least a "user" and 
 		     "password" property should be included.
 	 */
 	[property] sequence<com::sun::star::beans::PropertyValue> ConnectInfo; 
  
-	 
-	// DocMerge from xml: property com::sun::star::sdb::DatabaseAccess::IsReadOnly
 	/** determines whether modifications on the data access bean are allowed
 		or not.
 	 */
 	[readonly, property] boolean IsReadOnly; 
  
-	 
-	// DocMerge from xml: property com::sun::star::sdb::DatabaseAccess::NumberFormatsSupplier
 	/** provides an object for formatting numbers.
 	 */
 	[property] com::sun::star::util::XNumberFormatsSupplier 
 						NumberFormatsSupplier; 
  
-	 
-	// DocMerge from xml: property com::sun::star::sdb::DatabaseAccess::IsPasswordRequired
 	/** indicates that a password is always necessary. 
 	 */
 	[optional, property] boolean IsPasswordRequired; 
  
-	 
-	// DocMerge from idl: property com::sun::star::sdb::DatabaseAccess::TableFilter
 	/** defines a list of tables, on which the bean should have it's focus. 
 		If empty, all tables are rejected.
 	*/	 
 	[optional, property] sequence<string> TableFilter; 
  
-	 
-	// DocMerge from idl: property com::sun::star::sdb::DatabaseAccess::TableTypeFilter
 	/** defines a list of table types, on which the bean should have it's focus. 
 		 If empty, all tables types are rejected.
-
 	 */
 	[optional, property] sequence<string> TableTypeFilter; 
 }; 
Index: offapi/com/sun/star/sdb/DatabaseAccessConnection.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/DatabaseAccessConnection.idl,v
retrieving revision 1.7
retrieving revision 1.7.156.1
diff -u -p -u -p -r1.7 -r1.7.156.1
--- offapi/com/sun/star/sdb/DatabaseAccessConnection.idl	3 Jun 2004 21:35:54 -0000	1.7
+++ offapi/com/sun/star/sdb/DatabaseAccessConnection.idl	13 Jan 2005 10:58:01 -0000	1.7.156.1
@@ -81,7 +81,6 @@
  published interface XSQLQueryComposerFactory; 
  
  
-// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessConnection
 /** specifies a component, which supplies and stores additional information related
 	to a certain database connection, such as, DatabaseQueries, FormDocuments, and ReportDocuments.
 	Objects for data definition are supplied as well, for instance, Tables, Views, etc.
@@ -95,11 +94,11 @@
 	will close only one of these connections. You have to close all connections in order 
 	to close the connection to the database.
 	</p>
+
+    @deprecated
 */
 published service DatabaseAccessConnection
 { 
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessConnection: service com::sun::star::sdbc::Connection
 	/** supporting of the base connection service. 
 			 <p><B>Note:</B><br/> 
 				 Don't use the "dispose" method of the XComponent interface, as the DataAccess 
@@ -109,20 +108,14 @@ published service DatabaseAccessConnecti
 	 */
 	service com::sun::star::sdbc::Connection; 
  
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessConnection: service com::sun::star::sdbcx::DatabaseDefinition
 	/** access to the DatabaseDefinition beans of the connection.
 	 */
 	service com::sun::star::sdbcx::DatabaseDefinition; 
  
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessConnection: interface com::sun::star::container::XChild
 	/** access to the owning data access bean.
 	 */
 	interface com::sun::star::container::XChild; 
  
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessConnection: interface com::sun::star::sdb::XSQLQueryComposerFactory
 	/** returns a tool for composing queries.
 	 */
 	interface XSQLQueryComposerFactory; 
Index: offapi/com/sun/star/sdb/DatabaseAccessContext.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/DatabaseAccessContext.idl,v
retrieving revision 1.7
retrieving revision 1.7.156.1
diff -u -p -u -p -r1.7 -r1.7.156.1
--- offapi/com/sun/star/sdb/DatabaseAccessContext.idl	3 Jun 2004 21:36:07 -0000	1.7
+++ offapi/com/sun/star/sdb/DatabaseAccessContext.idl	13 Jan 2005 10:58:02 -0000	1.7.156.1
@@ -96,29 +96,23 @@
 	becomes the default for all other known locales.
 	
 	</p>@see com::sun::star::util::XLocalizedAliases
+
+    @deprecated
  */
 published service DatabaseAccessContext
 { 
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessContext: interface com::sun::star::container::XEnumerationAccess
 	/** Enumeration on all registered data sources for a default locale.
 	 */
 	interface com::sun::star::container::XEnumerationAccess; 
  
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessContext: interface com::sun::star::container::XNameAccess
 	/** NameAccess on all registered data sources for a default locale.
 	 */
 	interface com::sun::star::container::XNameAccess; 
  
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessContext: interface com::sun::star::util::XLocalizedAliases
 	/** Interface for registering aliases for data sources.
 	 */
 	interface com::sun::star::util::XLocalizedAliases; 
  
-	 
-	// DocMerge from xml: service com::sun::star::sdb::DatabaseAccessContext: interface com::sun::star::lang::XLocalizable
 	/** Interface for setting and retrieving the default language.
 	 */
 	interface com::sun::star::lang::XLocalizable; 
Index: offapi/com/sun/star/sdb/DatabaseAccessDataSource.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/DatabaseAccessDataSource.idl,v
retrieving revision 1.8
retrieving revision 1.8.156.1
diff -u -p -u -p -r1.8 -r1.8.156.1
--- offapi/com/sun/star/sdb/DatabaseAccessDataSource.idl	3 Jun 2004 21:36:22 -0000	1.8
+++ offapi/com/sun/star/sdb/DatabaseAccessDataSource.idl	13 Jan 2005 10:58:02 -0000	1.8.156.1
@@ -81,9 +81,10 @@ module com { module sun { module star { 
 
  published interface XCompletedConnection;
 
-/**
- is a factory to create data access beans. Data access beans are shared amoung
- components, so if an already existing bean is requested, the existing one is returned.
+/** is a factory to create data access beans. Data access beans are shared amoung
+    components, so if an already existing bean is requested, the existing one is returned.
+
+    @deprecated
  */
 published service DatabaseAccessDataSource
 {
Index: offapi/com/sun/star/sdb/DocumentContainer.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/DocumentContainer.idl,v
retrieving revision 1.2
retrieving revision 1.2.40.3
diff -u -p -u -p -r1.2 -r1.2.40.3
--- offapi/com/sun/star/sdb/DocumentContainer.idl	17 Nov 2004 14:31:22 -0000	1.2
+++ offapi/com/sun/star/sdb/DocumentContainer.idl	26 Jan 2005 10:54:13 -0000	1.2.40.3
@@ -82,17 +82,24 @@
  module com {  module sun {  module star {  module sdb {
 
 
-/** describes a container which provides access to database related definitions like
-	forms, and reports.
+/** describes a container which provides access to documents embedded into a database document,
+    usually forms and reports.
 
-	<p>
-	The <method scope="com.sun.star.lang">XMultiServiceFactory::createInstanceWithArguments()</method> 
-	should be used to create sub document container or form, or report objects.
-	</p>
+	<p>The <member scope="com::sun::star::lang">XMultiServiceFactory::createInstanceWithArguments()</member>
+	should be used to create sub document container or form, or report objects.</p>
 
-	@see com::sun::star::sdb::DocumentDefinition
+    <p>The embedded documents do not support any particular database related service, instead, they're
+    usual <type scope="com::sun::star::document">OfficeDocument</type>s.<br/>
+    The only thing worth mentioning here is that they support the
+    <type scope="com::sun::star::container">XChild</type> interface, whose
+    <member scope="com::sun::star::container">XChild::getParent</member> method can be used to
+    obtain the database document which the embedded document belongs to.
+    </p>
+
+	@see DocumentDefinition
+    @see OfficeDatabaseDocument
  */
-published service DocumentContainer
+service DocumentContainer
 {
 	service DefinitionContainer;
 
@@ -102,13 +109,15 @@ published service DocumentContainer
 		TargetFrameName: isn't used.
 		SearchFlags: isn't used.
 		Arguments: 
-			1. PropertyValue
+		<ol>
+			<li>PropertyValue</li>
 				Name = ActiveConnection
 				Value = The connection which should be used when opening the text document.
-			2. PropertyValue
+			<li>PropertyValue</li>
 				Name = OpenMode
 				Value = string, "open" if the document should be opened in live mode (editing is not possible), 
 								"openDesign" if the document should be open in design mode (editing is possible)
+		</ol>
 		@see com::sun::star::sdbc::XConnection 
 		</p>
 	*/
Index: offapi/com/sun/star/sdb/DocumentDefinition.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/DocumentDefinition.idl,v
retrieving revision 1.9
retrieving revision 1.9.40.1
diff -u -p -u -p -r1.9 -r1.9.40.1
--- offapi/com/sun/star/sdb/DocumentDefinition.idl	22 Nov 2004 12:28:08 -0000	1.9
+++ offapi/com/sun/star/sdb/DocumentDefinition.idl	26 Jan 2005 10:54:13 -0000	1.9.40.1
@@ -77,7 +77,7 @@ module com { module sun { module star { 
 	</type>
 	could be a form or a report.
 */
-published service DocumentDefinition
+service DocumentDefinition
 {
 	interface com::sun::star::beans::XPropertySet;
 
Index: offapi/com/sun/star/sdb/Forms.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/Forms.idl,v
retrieving revision 1.2
retrieving revision 1.2.40.1
diff -u -p -u -p -r1.2 -r1.2.40.1
--- offapi/com/sun/star/sdb/Forms.idl	17 Nov 2004 14:31:48 -0000	1.2
+++ offapi/com/sun/star/sdb/Forms.idl	19 Jan 2005 09:02:15 -0000	1.2.40.1
@@ -75,7 +75,7 @@
 
 	@see com::sun::star::sdb::DocumentDefinition
  */
-published service Forms
+service Forms
 {
 	service DocumentContainer;
 };
Index: offapi/com/sun/star/sdb/OfficeDatabaseDocument.idl
===================================================================
RCS file: offapi/com/sun/star/sdb/OfficeDatabaseDocument.idl
diff -N offapi/com/sun/star/sdb/OfficeDatabaseDocument.idl
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ offapi/com/sun/star/sdb/OfficeDatabaseDocument.idl	18 Feb 2005 12:23:52 -0000	1.1.2.2
@@ -0,0 +1,116 @@
+/*************************************************************************
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to the terms of
+ *  either of the following licenses
+ *
+ *         - GNU Lesser General Public License Version 2.1
+ *         - Sun Industry Standards Source License Version 1.1
+ *
+ *  Sun Microsystems Inc., October, 2000
+ *
+ *  GNU Lesser General Public License Version 2.1
+ *  =============================================
+ *  Copyright 2000 by Sun Microsystems, Inc.
+ *  901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *  This library is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU Lesser General Public
+ *  License version 2.1, as published by the Free Software Foundation.
+ *
+ *  This library is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *  Lesser General Public License for more details.
+ *
+ *  You should have received a copy of the GNU Lesser General Public
+ *  License along with this library; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *  MA  02111-1307  USA
+ *
+ *
+ *  Sun Industry Standards Source License Version 1.1
+ *  =================================================
+ *  The contents of this file are subject to the Sun Industry Standards
+ *  Source License Version 1.1 (the "License"); You may not use this file
+ *  except in compliance with the License. You may obtain a copy of the
+ *  License at http://www.openoffice.org/license.html.
+ *
+ *  Software provided under this License is provided on an "AS IS" basis,
+ *  WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
+ *  WITHOUT LIMITATION, WARRANTIES THAT THE SOFTWARE IS FREE OF DEFECTS,
+ *  MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE, OR NON-INFRINGING.
+ *  See the License for the specific provisions governing your rights and
+ *  obligations concerning the Software.
+ *
+ *  The Initial Developer of the Original Code is: Sun Microsystems, Inc.
+ *
+ *  Copyright: 2000 by Sun Microsystems, Inc.
+ *
+ *  All Rights Reserved.
+ *
+ *  Contributor(s): _______________________________________
+ *
+ *
+ ************************************************************************/
+#ifndef __com_sun_star_sdb_OfficeDatabaseDocument_idl__ 
+#define __com_sun_star_sdb_OfficeDatabaseDocument_idl__ 
+ 
+#ifndef __com_sun_star_sdb_XOfficeDatabaseDocument_idl__
+#include <com/sun/star/sdb/XOfficeDatabaseDocument.idl> 
+#endif
+
+module com {  module sun {  module star {  module sdb { 
+ 
+/** specifies a office database document which is a storable document.
+	
+	<p>
+	These documents contain information about forms, and reports, and the properties of a data source.
+	</p>
+	<p>
+	The database document contains no data per default. The following is stored inside the document:
+		<li>
+		Forms
+		</li>
+		<li>
+		Reports
+		</li>
+		<li>
+		The table settings defined in <type>DataSettings</type>
+		</li>
+		<li>
+		The query settings defined in <type>DataSettings</type>
+		</li>
+		<li>
+		All properties of the service <type>DataSource</type>
+		</li>
+	</p>
+	<p>
+	That the interface <type scope="com::sun::star::view">XPrintable</type> is not optional at the 
+	<type scope="com::sun::star::document">OfficeDocument</type> service is a documenation problem.
+	The service <type>OfficeDatabaseDocument</type> doesn't support any printing.
+	</p>
+
+	@see com::sun::star::sdb::XOfficeDatabaseDocument
+	@see com::sun::star::document::OfficeDocument
+	@since OOo 2.0.0
+ */
+service OfficeDatabaseDocument 
+{ 
+	service com::sun::star::document::OfficeDocument;
+
+	interface XOfficeDatabaseDocument;
+}; 
+ 
+//============================================================================= 
+ 
+}; }; }; }; 
+ 
+/*=========================================================================== 
+===========================================================================*/ 
+#endif 
Index: offapi/com/sun/star/sdb/Reports.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/Reports.idl,v
retrieving revision 1.2
retrieving revision 1.2.40.1
diff -u -p -u -p -r1.2 -r1.2.40.1
--- offapi/com/sun/star/sdb/Reports.idl	17 Nov 2004 14:31:59 -0000	1.2
+++ offapi/com/sun/star/sdb/Reports.idl	19 Jan 2005 09:02:16 -0000	1.2.40.1
@@ -75,7 +75,7 @@
 
 	@see com::sun::star::sdb::DocumentDefinition
  */
-published service Reports
+service Reports
 {
 	service DocumentContainer;
 };
Index: offapi/com/sun/star/sdb/XFormDocumentsSupplier.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/XFormDocumentsSupplier.idl,v
retrieving revision 1.7
retrieving revision 1.7.156.1
diff -u -p -u -p -r1.7 -r1.7.156.1
--- offapi/com/sun/star/sdb/XFormDocumentsSupplier.idl	3 Jun 2004 21:45:30 -0000	1.7
+++ offapi/com/sun/star/sdb/XFormDocumentsSupplier.idl	26 Jan 2005 10:54:13 -0000	1.7.156.1
@@ -74,14 +74,16 @@
  
 // DocMerge from xml: interface com::sun::star::sdb::XFormDocumentsSupplier
 /** provides the access to a container of database forms.
+	@see Forms
  */
-published interface XFormDocumentsSupplier: com::sun::star::uno::XInterface
+interface XFormDocumentsSupplier: com::sun::star::uno::XInterface
 { 
 	 
 	// DocMerge from xml: method com::sun::star::sdb::XFormDocumentsSupplier::getFormDocuments
 	/** returns the container of forms.
 		@returns
 			the form documents
+		@see Forms
 	 */
 	com::sun::star::container::XNameAccess getFormDocuments(); 
 }; 
Index: offapi/com/sun/star/sdb/XReportDocumentsSupplier.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/XReportDocumentsSupplier.idl,v
retrieving revision 1.7
retrieving revision 1.7.156.1
diff -u -p -u -p -r1.7 -r1.7.156.1
--- offapi/com/sun/star/sdb/XReportDocumentsSupplier.idl	3 Jun 2004 21:46:41 -0000	1.7
+++ offapi/com/sun/star/sdb/XReportDocumentsSupplier.idl	26 Jan 2005 10:54:13 -0000	1.7.156.1
@@ -74,14 +74,16 @@
  
 // DocMerge from xml: interface com::sun::star::sdb::XReportDocumentsSupplier
 /** provides the access to a container of database reports.
+	@see Reports
  */
-published interface XReportDocumentsSupplier: com::sun::star::uno::XInterface
+interface XReportDocumentsSupplier: com::sun::star::uno::XInterface
 { 
 	 
 	// DocMerge from xml: method com::sun::star::sdb::XReportDocumentsSupplier::getReportDocuments
 	/** returns the container of reports.
 		@returns
 			the report documents
+		@see Reports
 	 */
 	com::sun::star::container::XNameAccess getReportDocuments(); 
 }; 
Index: offapi/com/sun/star/sdb/makefile.mk
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdb/makefile.mk,v
retrieving revision 1.15
retrieving revision 1.15.40.1
diff -u -p -u -p -r1.15 -r1.15.40.1
--- offapi/com/sun/star/sdb/makefile.mk	22 Nov 2004 10:40:51 -0000	1.15
+++ offapi/com/sun/star/sdb/makefile.mk	19 Jan 2005 08:56:13 -0000	1.15.40.1
@@ -85,6 +85,7 @@ IDLFILES=\
 	DatabaseAccessDataSource.idl\
 	DatabaseContext.idl \
 	DatabaseDocument.idl \
+	OfficeDatabaseDocument.idl \
 	DatabaseEnvironment.idl \
 	DataColumn.idl \
 	DataSettings.idl \
Index: offapi/com/sun/star/sdbc/DataType.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/sdbc/DataType.idl,v
retrieving revision 1.6
retrieving revision 1.6.156.1
diff -u -p -u -p -r1.6 -r1.6.156.1
--- offapi/com/sun/star/sdbc/DataType.idl	3 Jun 2004 21:52:43 -0000	1.6
+++ offapi/com/sun/star/sdbc/DataType.idl	20 Jan 2005 16:46:00 -0000	1.6.156.1
@@ -66,7 +66,7 @@
  
 // DocMerge from idl: constants com::sun::star::sdbc::DataType
 /** These constants are used to specify database data types which are used 
-		to identify the generic SQL types. The definition is based on JDBC 2.0. 
+		to identify the generic SQL types. The definition is based on JDBC 3.0. 
 	 
 		<p>
 		The actual type constant values are equivalent to those in the X/Open CLI.
@@ -192,6 +192,13 @@ published constants DataType
 	/** indicates a type representing an SQL REF, a referencing type.
 	 */
 	const long REF          = 2006; 
+
+	/** identifies the generic SQL type
+     * <code>BOOLEAN</code>.
+     *
+     * @since OOo 2.0.0
+     */
+    const long BOOLEAN = 16;
 }; 
  
 //============================================================================= 
Index: offapi/prj/d.lst
===================================================================
RCS file: /cvs/api/offapi/prj/d.lst,v
retrieving revision 1.70
retrieving revision 1.69.34.3
diff -u -p -u -p -r1.70 -r1.69.34.3
--- offapi/prj/d.lst	27 Jan 2005 15:33:43 -0000	1.70
+++ offapi/prj/d.lst	11 Feb 2005 10:11:50 -0000	1.69.34.3
@@ -37,6 +37,9 @@ mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\s
 mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\form
 mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\form\component
 mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\form\control
+mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\form\validation
+mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\form\binding
+mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\form\submission
 mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\xforms
 mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\xsd
 mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\star\formula
@@ -129,6 +132,9 @@ mkdir: %COMMON_DEST%\idl%_EXT%\com\sun\s
 ..\com\sun\star\form\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\form
 ..\com\sun\star\form\component\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\form\component
 ..\com\sun\star\form\control\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\form\control
+..\com\sun\star\form\validation\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\form\validation
+..\com\sun\star\form\binding\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\form\binding
+..\com\sun\star\form\submission\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\form\submission
 ..\com\sun\star\xforms\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\xforms
 ..\com\sun\star\xsd\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\xsd
 ..\com\sun\star\formula\*.idl %COMMON_DEST%\idl%_EXT%\com\sun\star\formula
Index: svx/source/dialog/cfg.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/dialog/cfg.cxx,v
retrieving revision 1.13
retrieving revision 1.12.36.2
diff -u -p -u -p -r1.13 -r1.12.36.2
--- svx/source/dialog/cfg.cxx	18 Jan 2005 15:32:28 -0000	1.13
+++ svx/source/dialog/cfg.cxx	21 Jan 2005 15:03:28 -0000	1.12.36.2
@@ -506,7 +506,7 @@ SvxConfigPage::CanConfig( const OUString
 		 aModuleId.equals( OUString::createFromAscii(
 			"com.sun.star.frame.Bibliography" ) ) ||
 		 aModuleId.equals( OUString::createFromAscii(
-			"com.sun.star.sdb.DatabaseDocument" ) ) )
+			"com.sun.star.sdb.OfficeDatabaseDocument" ) ) )
 	{
 		return FALSE;
 	}
Index: svx/source/dialog/connpooloptions.src
===================================================================
RCS file: /cvs/graphics/svx/source/dialog/connpooloptions.src,v
retrieving revision 1.3
retrieving revision 1.3.408.1
diff -u -p -u -p -r1.3 -r1.3.408.1
--- svx/source/dialog/connpooloptions.src	25 Jun 2004 11:51:41 -0000	1.3
+++ svx/source/dialog/connpooloptions.src	18 Jan 2005 11:57:29 -0000	1.3.408.1
@@ -128,13 +128,13 @@ TabPage RID_OFAPAGE_CONNPOOLOPTIONS
 	FixedText FT_TIMEOUT
 	{
 		Pos = MAP_APPFONT( 27, 38 + LIST_SIZE_Y + 4 + 8 + 3 + 8 + 3 + 2 );
-		Size = MAP_APPFONT( 70, 8 );
+		Size = MAP_APPFONT( 100, 8 );
 		Text [ de ] = "Verfallszeit (Sekunden)";
 		Text [ en-US ] = "Timeout (seconds)";
 	};
 	NumericField NF_TIMEOUT
 	{
-		Pos = MAP_APPFONT( 27 + 70 + 3, 38 + LIST_SIZE_Y + 4 + 8 + 3 + 8 + 3 );
+		Pos = MAP_APPFONT( 27 + 100 + 3, 38 + LIST_SIZE_Y + 4 + 8 + 3 + 8 + 3 );
 		Size = MAP_APPFONT( 40, 12 );
 		SvLook = TRUE;
 		Border = TRUE;
Index: svx/source/fmcomp/fmgridcl.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/fmcomp/fmgridcl.cxx,v
retrieving revision 1.45
retrieving revision 1.45.122.1
diff -u -p -u -p -r1.45 -r1.45.122.1
--- svx/source/fmcomp/fmgridcl.cxx	16 Nov 2004 11:20:04 -0000	1.45
+++ svx/source/fmcomp/fmgridcl.cxx	21 Jan 2005 06:36:44 -0000	1.45.122.1
@@ -602,6 +602,7 @@ IMPL_LINK( FmGridHeader, OnAsyncExecuteD
 		switch (nDataType)
 		{
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				aPossibleTypes.Insert(SID_FM_CHECKBOX, aPossibleTypes.Count());
 				break;
 			case DataType::TINYINT:
Index: svx/source/fmcomp/gridcell.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/fmcomp/gridcell.cxx,v
retrieving revision 1.40
retrieving revision 1.40.122.2
diff -u -p -u -p -r1.40 -r1.40.122.2
--- svx/source/fmcomp/gridcell.cxx	16 Nov 2004 11:20:34 -0000	1.40
+++ svx/source/fmcomp/gridcell.cxx	21 Jan 2005 06:36:44 -0000	1.40.122.2
@@ -250,6 +250,7 @@ void DbGridColumn::CreateControl(sal_Int
                 m_bDateTime = sal_True;
 
             case DataType::BIT:
+            case DataType::BOOLEAN:
             case DataType::TINYINT:
             case DataType::SMALLINT:
             case DataType::INTEGER:
@@ -405,6 +406,7 @@ sal_Int16 DbGridColumn::SetAlignment(sal
                     _nAlign = ::com::sun::star::awt::TextAlign::RIGHT;
                     break;
                 case DataType::BIT:
+                case DataType::BOOLEAN:
                     _nAlign = ::com::sun::star::awt::TextAlign::CENTER;
                     break;
                 default:
@@ -930,7 +932,7 @@ void DbCellControl::AlignControl(sal_Int
 //------------------------------------------------------------------------------
 void DbCellControl::Paint( OutputDevice& _rDev, const Rectangle& _rRect )
 {
-	if ( m_pPainter->GetParent() == &_rDev )
+    if ( m_pPainter->GetParent() == &_rDev )
     {
         m_pPainter->SetPaintTransparent( sal_True );
         m_pPainter->SetBackground( );
@@ -943,7 +945,7 @@ void DbCellControl::Paint( OutputDevice&
         aFont.SetTransparent( TRUE );
         m_pPainter->SetFont( aFont );
 
-	    m_pPainter->SetPosSizePixel( _rRect.TopLeft(), _rRect.GetSize() );
+        m_pPainter->SetPosSizePixel( _rRect.TopLeft(), _rRect.GetSize() );
 	    m_pPainter->Show();
 	    m_pPainter->Update();
 	    m_pPainter->SetParentUpdateMode( sal_False );
@@ -1038,6 +1040,8 @@ DbTextField::DbTextField(DbGridColumn& _
             :DbLimitedLengthField(_rColumn)
             ,m_nKeyType(::com::sun::star::util::NumberFormat::TEXT)
             ,m_pEdit( NULL )
+            ,m_pPainterImplementation( NULL )
+            ,m_bIsSimpleEdit( sal_True )
 {
 }
 
@@ -1081,6 +1085,7 @@ void DbTextField::Init(Window* pParent, 
     	OSL_ENSURE( sal_False, "DbTextField::Init: caught an exception while determining the multi-line capabilities!" );
     }
 
+    m_bIsSimpleEdit = !bIsMultiLine;
     if ( bIsMultiLine )
     {
         m_pWindow = new MultiLineTextCell( pParent, nStyle );
@@ -1129,10 +1134,7 @@ void DbTextField::Paint( OutputDevice& _
     if ( m_pPainterImplementation )
         m_pPainterImplementation->SetText( GetFormatText( _rxField, _rxFormatter, NULL ) );
 
-	if ( m_pPainter->GetParent() != &_rDev )
-		m_pPainter->Draw( &_rDev, _rRect.TopLeft(), _rRect.GetSize(), 0 );
-	else
-		DbLimitedLengthField::Paint( _rDev, _rRect, _rxField, _rxFormatter );
+	DbLimitedLengthField::Paint( _rDev, _rRect, _rxField, _rxFormatter );
 }
 
 //------------------------------------------------------------------------------
@@ -2363,7 +2365,6 @@ void DbComboBox::Init(Window* pParent, c
     m_rColumn.SetAlignmentFromModel(::com::sun::star::awt::TextAlign::LEFT);
 
     m_pWindow = new ComboBoxControl(pParent);
-    m_pPainter = new Edit( pParent, WB_NOBORDER );
 
     // selection von rechts nach links
     AllSettings     aSettings = m_pWindow->GetSettings();
@@ -3195,6 +3196,12 @@ void FmXTextCell::Paint(OutputDevice& rD
                         const Reference< ::com::sun::star::sdb::XColumn >& _rxField,
                         const Reference< ::com::sun::star::util::XNumberFormatter >& xFormatter)
 {
+    if ( !m_bFastPaint )
+    {
+        FmXDataCell::Paint( rDev, rRect, _rxField, xFormatter );
+        return;
+    }
+
     sal_uInt16 nStyle = TEXT_DRAW_CLIP | TEXT_DRAW_VCENTER;
     if (!((Window&)rDev).IsEnabled())
         nStyle |= TEXT_DRAW_DISABLE;
@@ -3239,9 +3246,13 @@ FmXEditCell::FmXEditCell(DbGridColumn* p
 {
     DBG_CTOR(FmXEditCell,NULL);
 
-    if ( pControl->ISA( DbTextField ) )
+    DbTextField* pTextField = PTR_CAST( DbTextField, pControl );
+    if ( pTextField )
     {
-        m_pEditImplementation = PTR_CAST( DbTextField, pControl )->GetEditImplementation();
+        
+        m_pEditImplementation = pTextField->GetEditImplementation();
+        if ( !pTextField->IsSimpleEdit() )
+            m_bFastPaint = sal_False;
     }
     else
     {
@@ -3253,12 +3264,6 @@ FmXEditCell::FmXEditCell(DbGridColumn* p
 }
 
 //------------------------------------------------------------------
-void FmXEditCell::Paint( OutputDevice& _rDev, const Rectangle& _rRect, const Reference< XColumn >& _rxField, const Reference< ::com::sun::star::util::XNumberFormatter >& _rxFormatter )
-{
-    m_pCellControl->Paint( _rDev, _rRect, _rxField, _rxFormatter );
-}
-
-//------------------------------------------------------------------
 FmXEditCell::~FmXEditCell()
 {
     if (!OComponentHelper::rBHelper.bDisposed)
Index: svx/source/form/dbtoolsclient.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/dbtoolsclient.cxx,v
retrieving revision 1.13
retrieving revision 1.13.208.1
diff -u -p -u -p -r1.13 -r1.13.208.1
--- svx/source/form/dbtoolsclient.cxx	22 Oct 2004 11:52:49 -0000	1.13
+++ svx/source/form/dbtoolsclient.cxx	17 Jan 2005 14:48:44 -0000	1.13.208.1
@@ -237,12 +237,14 @@ namespace svxform
 	}
 
 	//--------------------------------------------------------------------
-	Reference< XConnection > OStaticDataAccessTools::calcConnection(const Reference< XRowSet >& _rxRowSet, const Reference< XMultiServiceFactory >& _rxFactory) const SAL_THROW ( (SQLException, RuntimeException) )
+	Reference< XConnection > OStaticDataAccessTools::connectRowset( const Reference< XRowSet >& _rxRowSet,
+        const Reference< XMultiServiceFactory >& _rxFactory, sal_Bool _bSetAsActiveConnection ) const
+        SAL_THROW ( ( SQLException, WrappedTargetException, RuntimeException ) )
 	{
 		Reference< XConnection > xReturn;
 		checkIfLoaded();
 		if (m_xDataAccessTools.is())
-			xReturn = m_xDataAccessTools->calcConnection(_rxRowSet, _rxFactory);
+			xReturn = m_xDataAccessTools->connectRowset( _rxRowSet, _rxFactory, _bSetAsActiveConnection );
 		return xReturn;
 	}
 
Index: svx/source/form/fmdocumentclassification.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/fmdocumentclassification.cxx,v
retrieving revision 1.7
retrieving revision 1.7.6.1
diff -u -p -u -p -r1.7 -r1.7.6.1
--- svx/source/form/fmdocumentclassification.cxx	5 Jan 2005 12:20:38 -0000	1.7
+++ svx/source/form/fmdocumentclassification.cxx	14 Jan 2005 15:12:28 -0000	1.7.6.1
@@ -159,15 +159,14 @@ namespace svxform
                     eType = eWebDocument;
                 else if ( xSI->supportsService( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.text.TextDocument" ) ) ) )
                     eType = eTextDocument;
+                else if ( xSI->supportsService( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.text.GlobalDocument" ) ) ) )
+                    eType = eTextDocument;
                 else if ( xSI->supportsService( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.sheet.SpreadsheetDocument" ) ) ) )
                     eType = eSpreadsheetDocument;
+                else if ( xSI->supportsService( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.presentation.PresentationDocument" ) ) ) )
+                    eType = ePresentationDocument;
                 else if ( xSI->supportsService( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.drawing.DrawingDocument" ) ) ) )
-                {
-                    if ( xSI->supportsService( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.presentation.PresentationDocument" ) ) ) )
-                        eType = ePresentationDocument;
-                    else
-                        eType = eDrawingDocument;
-                }
+                    eType = eDrawingDocument;
             }
         }
         catch( const Exception& )
Index: svx/source/form/fmpgeimp.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/fmpgeimp.cxx,v
retrieving revision 1.23
retrieving revision 1.22.162.2
diff -u -p -u -p -r1.23 -r1.22.162.2
--- svx/source/form/fmpgeimp.cxx	21 Jan 2005 16:56:50 -0000	1.23
+++ svx/source/form/fmpgeimp.cxx	11 Jan 2005 14:34:32 -0000	1.22.162.2
@@ -265,6 +265,18 @@ FmFormPageImpl::~FmFormPageImpl()
 }
 
 //------------------------------------------------------------------------------
+void FmFormPageImpl::validateCurForm()
+{
+    if ( !xCurrentForm.is() )
+        return;
+
+    Reference< XChild > xAsChild( xCurrentForm, UNO_QUERY );
+    DBG_ASSERT( xAsChild.is(), "FmFormPageImpl::validateCurForm: a form which is no child??" );
+    if ( !xAsChild.is() || !xAsChild->getParent().is() )
+        xCurrentForm.clear();
+}
+
+//------------------------------------------------------------------------------
 void FmFormPageImpl::setCurForm(Reference< ::com::sun::star::form::XForm >  xForm)
 {
     xCurrentForm = xForm;
@@ -277,6 +289,8 @@ Reference< ::com::sun::star::form::XForm
 
 	try
 	{
+        validateCurForm();
+
 		// wenn noch kein TargetForm gefunden, dann aktuelle oder Default
 		if (!xCurrentForm.is())
 		{
@@ -368,7 +382,7 @@ Reference< ::com::sun::star::form::XForm
                                      const ::rtl::OUString& rCursorSource,
                                      sal_Int32 nCommandType)
 {
-    // Ist das Control bereits einer ::com::sun::star::form zugeordnet
+    // if the control already is child of a form, don't do anything
     if (!rContent.is() || rContent->getParent().is())
         return NULL;
 
@@ -380,6 +394,8 @@ Reference< ::com::sun::star::form::XForm
     // und die StandardForm
     if (rDatabase.is() && rCursorSource.getLength())
     {
+        validateCurForm();
+
         // erst in der aktuellen form suchen
         xForm = FindForm(xCurrentForm, rDatabase, rCursorSource, nCommandType);
 
Index: svx/source/form/fmshell.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/fmshell.cxx,v
retrieving revision 1.58
retrieving revision 1.56.4.3
diff -u -p -u -p -r1.58 -r1.56.4.3
--- svx/source/form/fmshell.cxx	28 Jan 2005 16:32:33 -0000	1.58
+++ svx/source/form/fmshell.cxx	11 Feb 2005 12:13:12 -0000	1.56.4.3
@@ -145,7 +145,9 @@
 #ifndef _SFXINTITEM_HXX //autogen
 #include <svtools/intitem.hxx>
 #endif
-
+#ifndef _SFXVISIBILITYITEM_HXX
+#include <svtools/visitem.hxx>
+#endif
 #ifndef _SFXOBJFACE_HXX //autogen
 #include <sfx2/objface.hxx>
 #endif
@@ -474,16 +476,10 @@ const sal_uInt32 FM_UI_FEATURE_SHOW_EXPL
 const sal_uInt32 FM_UI_FEATURE_SHOW_FILTERBAR           = 0x00000010;
 const sal_uInt32 FM_UI_FEATURE_SHOW_FILTERNAVIGATOR     = 0x00000020;
 const sal_uInt32 FM_UI_FEATURE_SHOW_TEXT_CONTROL_BAR    = 0x00000040;
-const sal_uInt32 FM_UI_FEATURE_TB_CONTROLS_DBFORMS      = 0x00000080;
-const sal_uInt32 FM_UI_FEATURE_TB_CONTROLS_XFORMS       = 0x00000100;
-const sal_uInt32 FM_UI_FEATURE_TB_CONTROLS_GENERIC      = 0x00000200;
-const sal_uInt32 FM_UI_FEATURE_TB_MORECONTROLS_DBFORMS  = 0x00000480;
-const sal_uInt32 FM_UI_FEATURE_TB_MORECONTROLS_XFORMS   = 0x00000800;
-const sal_uInt32 FM_UI_FEATURE_TB_MORECONTROLS_GENERIC  = 0x00001000;
-const sal_uInt32 FM_UI_FEATURE_TB_FORMDESIGN_DBFORMS    = 0x00002000;
-const sal_uInt32 FM_UI_FEATURE_TB_FORMDESIGN_XFORMS     = 0x00004000;
-const sal_uInt32 FM_UI_FEATURE_TB_FORMDESIGN_GENERIC    = 0x00008000;
-const sal_uInt32 FM_UI_FEATURE_SHOW_DATANAVIGATOR 	    = 0x00010000;
+const sal_uInt32 FM_UI_FEATURE_TB_CONTROLS              = 0x00000080;
+const sal_uInt32 FM_UI_FEATURE_TB_MORECONTROLS          = 0x00000100;
+const sal_uInt32 FM_UI_FEATURE_TB_FORMDESIGN            = 0x00000200;
+const sal_uInt32 FM_UI_FEATURE_SHOW_DATANAVIGATOR 	    = 0x00000400;
 
 SFX_IMPL_INTERFACE(FmFormShell, SfxShell, SVX_RES(RID_STR_FORMSHELL))
 {
@@ -505,44 +501,17 @@ SFX_IMPL_INTERFACE(FmFormShell, SfxShell
 	SFX_FEATURED_CHILDWINDOW_REGISTRATION(SID_FM_FILTER_NAVIGATOR, FM_UI_FEATURE_SHOW_FILTERNAVIGATOR);
 	SFX_FEATURED_CHILDWINDOW_REGISTRATION(SID_FM_SHOW_DATANAVIGATOR, FM_UI_FEATURE_SHOW_DATANAVIGATOR);
 
-    // the usual "Controls" toolbars - one for each possible "forms module"
-	SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_CONTROLS_DBFORMS ),
-		FM_UI_FEATURE_TB_CONTROLS_DBFORMS );
-
     SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_CONTROLS_XFORMS ),
-		FM_UI_FEATURE_TB_CONTROLS_XFORMS );
-
-    SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_CONTROLS_GENERIC ),
-		FM_UI_FEATURE_TB_CONTROLS_GENERIC );
-
-    // the "More controls" toolbars - one for each possible "forms module"
-	SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_MORECONTROLS_DBFORMS ),
-		FM_UI_FEATURE_TB_MORECONTROLS_DBFORMS );
-
-    SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_MORECONTROLS_XFORMS ),
-		FM_UI_FEATURE_TB_MORECONTROLS_XFORMS );
-
-    SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_MORECONTROLS_GENERIC ),
-		FM_UI_FEATURE_TB_MORECONTROLS_GENERIC );
-
-    // the usual "Form design" toolbars - one for each possible "forms module"
-	SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_FORMDESIGN_DBFORMS ),
-		FM_UI_FEATURE_TB_FORMDESIGN_DBFORMS );
+		SVX_RES( RID_SVXTBX_CONTROLS ),
+		FM_UI_FEATURE_TB_CONTROLS );
 
     SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_FORMDESIGN_XFORMS ),
-		FM_UI_FEATURE_TB_FORMDESIGN_XFORMS );
+		SVX_RES( RID_SVXTBX_MORECONTROLS ),
+		FM_UI_FEATURE_TB_MORECONTROLS );
 
     SFX_FEATURED_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT | SFX_VISIBILITY_STANDARD,
-		SVX_RES( RID_SVXTBX_FORMDESIGN_GENERIC ),
-		FM_UI_FEATURE_TB_FORMDESIGN_GENERIC );
+		SVX_RES( RID_SVXTBX_FORMDESIGN ),
+		FM_UI_FEATURE_TB_FORMDESIGN );
 }
 
 //========================================================================
@@ -719,26 +688,12 @@ sal_Bool FmFormShell::HasUIFeature( sal_
 	{
         bResult = ( GetImpl()->getDocumentType() == eEnhancedForm );
 	}
-    else if (  ( nFeature & FM_UI_FEATURE_TB_CONTROLS_DBFORMS )
-            || ( nFeature & FM_UI_FEATURE_TB_MORECONTROLS_DBFORMS )
-            || ( nFeature & FM_UI_FEATURE_TB_FORMDESIGN_DBFORMS )
+    else if (  ( ( nFeature & FM_UI_FEATURE_TB_CONTROLS ) == FM_UI_FEATURE_TB_CONTROLS )
+            || ( ( nFeature & FM_UI_FEATURE_TB_MORECONTROLS ) == FM_UI_FEATURE_TB_MORECONTROLS )
+            || ( ( nFeature & FM_UI_FEATURE_TB_FORMDESIGN ) == FM_UI_FEATURE_TB_FORMDESIGN )
             )
     {
-        bResult = ( GetImpl()->getDocumentType() == eDatabaseForm );
-    }
-    else if (  ( nFeature & FM_UI_FEATURE_TB_CONTROLS_XFORMS )
-            || ( nFeature & FM_UI_FEATURE_TB_MORECONTROLS_XFORMS )
-            || ( nFeature & FM_UI_FEATURE_TB_FORMDESIGN_XFORMS )
-            )
-    {
-        bResult = ( GetImpl()->getDocumentType() == eEnhancedForm );
-    }
-    else if (  ( nFeature & FM_UI_FEATURE_TB_CONTROLS_GENERIC )
-            || ( nFeature & FM_UI_FEATURE_TB_MORECONTROLS_GENERIC )
-            || ( nFeature & FM_UI_FEATURE_TB_FORMDESIGN_GENERIC )
-            )
-    {
-        bResult = ( GetImpl()->getDocumentType() != eDatabaseForm ) && ( GetImpl()->getDocumentType() != eEnhancedForm );
+        bResult = sal_True;
     }
 
     return bResult;
@@ -1246,7 +1201,9 @@ void FmFormShell::GetState(SfxItemSet &r
 				break;
 
 			case SID_FM_USE_WIZARDS:
-				if (!m_bDesignMode || !GetFormModel())
+                if ( GetImpl()->getDocumentType() == eEnhancedForm )
+					rSet.Put( SfxVisibilityItem( nWhich, sal_False ) );
+				else if (!m_bDesignMode || !GetFormModel())
 					rSet.DisableItem( nWhich );
 				else
 					rSet.Put( SfxBoolItem(nWhich, GetImpl()->GetWizardUsing() ) );
@@ -1274,7 +1231,7 @@ void FmFormShell::GetState(SfxItemSet &r
                 if ( GetImpl()->getDocumentType() == eEnhancedForm )
                 {
                     // in XForms mode, several controls are disabled:
-                    rSet.DisableItem( nWhich );
+                    rSet.Put( SfxVisibilityItem( nWhich, sal_False ) );
                     break;
                 }
                 // NO break here!
@@ -1346,10 +1303,9 @@ void FmFormShell::GetState(SfxItemSet &r
 				else
 					rSet.DisableItem(nWhich);
 
-                // special case for data navigator: enabled only in XForms
-                if( nWhich == SID_FM_SHOW_DATANAVIGATOR 
-                    && ( GetImpl()->getDocumentType() != eEnhancedForm ) )
-                    rSet.DisableItem( nWhich );
+                // special case for data navigator: hide if not in XML form document
+                if ( nWhich == SID_FM_SHOW_DATANAVIGATOR && ( GetImpl()->getDocumentType() != eEnhancedForm ) )
+                    rSet.Put( SfxVisibilityItem( nWhich, sal_False ) );
 			}	break;
 
 			case SID_FM_SHOW_PROPERTY_BROWSER:
@@ -1386,7 +1342,7 @@ void FmFormShell::GetState(SfxItemSet &r
 
                 if ( GetImpl()->getDocumentType() == eEnhancedForm ) 
                 {
-					rSet.DisableItem( nWhich );
+                    rSet.Put( SfxVisibilityItem( nWhich, sal_False ) );
                     break;
                 }
 
@@ -1411,9 +1367,11 @@ void FmFormShell::GetState(SfxItemSet &r
 				rSet.Put(SfxUInt16Item(nWhich, m_nLastSlot));
 				break;
 			case SID_FM_DESIGN_MODE:
-				if (!m_pFormView || GetImpl()->IsReadonlyDoc() || ( GetImpl()->getDocumentType() == eEnhancedForm ) )
+				if ( GetImpl()->getDocumentType() == eEnhancedForm )
+                    rSet.Put( SfxVisibilityItem( nWhich, sal_False ) );
+                else if (!m_pFormView || GetImpl()->IsReadonlyDoc() )
 					rSet.DisableItem( nWhich );
-				else
+                else
 					rSet.Put( SfxBoolItem(nWhich, m_bDesignMode) );
 				break;
 			case SID_FM_SEARCH:
@@ -1459,7 +1417,7 @@ void FmFormShell::GetState(SfxItemSet &r
             case SID_FM_CONVERTTO_NAVIGATIONBAR :
                 if ( GetImpl()->getDocumentType() == eEnhancedForm )
                 {
-                    rSet.DisableItem( nWhich );
+                    rSet.Put( SfxVisibilityItem( nWhich, sal_False ) );
                     break;
                 }
                 // NO break here!
Index: svx/source/form/fmshimp.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/fmshimp.cxx,v
retrieving revision 1.62
retrieving revision 1.61.4.2
diff -u -p -u -p -r1.62 -r1.61.4.2
--- svx/source/form/fmshimp.cxx	21 Jan 2005 16:57:42 -0000	1.62
+++ svx/source/form/fmshimp.cxx	14 Jan 2005 16:28:30 -0000	1.61.4.2
@@ -1992,9 +1992,11 @@ bool FmXFormShell::setCurrentSelection( 
 		pPage->GetImpl()->setCurForm( m_xCurrentForm );
 
     // ensure some slots are updated
-	InvalidateSlot( SID_FM_CTL_PROPERTIES, sal_False );
+    for ( sal_Int16 i = 0; i < sizeof( DlgSlotMap ) / sizeof( DlgSlotMap[0] ); ++i )
+		InvalidateSlot( DlgSlotMap[i], sal_False );
+
 	for ( sal_Int16 i = 0; i < sizeof( SelObjectSlotMap ) / sizeof( SelObjectSlotMap[0] ); ++i )
-		InvalidateSlot( SelObjectSlotMap[i] ,sal_False);
+		InvalidateSlot( SelObjectSlotMap[i], sal_False);
 
     return true;
 }
Index: svx/source/form/fmvwimp.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/fmvwimp.cxx,v
retrieving revision 1.41
retrieving revision 1.40.4.2
diff -u -p -u -p -r1.41 -r1.40.4.2
--- svx/source/form/fmvwimp.cxx	21 Jan 2005 16:58:27 -0000	1.41
+++ svx/source/form/fmvwimp.cxx	21 Jan 2005 06:36:43 -0000	1.40.4.2
@@ -1435,6 +1435,7 @@ SdrObject* FmXFormView::implCreateFieldC
 				case DataType::VARBINARY:
 					return NULL;
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 					nOBJID = OBJ_FM_CHECKBOX;
 					break;
 				case DataType::TINYINT:
@@ -1708,7 +1709,7 @@ void FmXFormView::createControlLabelPair
 
 	// positionieren
 	::Size szControlSize;
-	if (DataType::BIT == nDataType)
+	if (DataType::BIT == nDataType || nDataType == DataType::BOOLEAN )
 		szControlSize = aDefSize;
 	else if (OBJ_FM_IMAGECONTROL == _nObjID || DataType::LONGVARCHAR == nDataType)
 		szControlSize = aDefImageSize;
Index: svx/source/form/formtoolbars.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/formtoolbars.cxx,v
retrieving revision 1.4
retrieving revision 1.4.4.1
diff -u -p -u -p -r1.4 -r1.4.4.1
--- svx/source/form/formtoolbars.cxx	5 Jan 2005 12:22:16 -0000	1.4
+++ svx/source/form/formtoolbars.cxx	21 Jan 2005 16:53:20 -0000	1.4.4.1
@@ -148,26 +148,11 @@ namespace svxform
         OSL_ENSURE( ( _nSlotId == SID_FM_MORE_CONTROLS ) || ( _nSlotId == SID_FM_FORM_DESIGN_TOOLS ) || ( _nSlotId == SID_FM_CONFIG ),
             "FormToolboxes::getToolboxResourceName: unsupported slot!" );
 
-        const sal_Char* pNames[3][3] = {
-            { "formcontrols", "xformcontrols", "databasecontrols" },
-            { "moreformcontrols", "morexformcontrols", "moredatabasecontrols" },
-            { "formdesign", "xformdesign", "databaseformdesign" }
-        };
-        sal_Int32 nDocIndex = 0, nToolbarIndex = 0;
-        switch ( m_eDocumentType )
-        {
-        case ::svxform::eEnhancedForm:    	nDocIndex = 1; break;
-        case ::svxform::eDatabaseForm:      nDocIndex = 2; break;
-        default:                            nDocIndex = 0; break;
-        }
-        switch ( _nSlotId )
-        {
-        case SID_FM_MORE_CONTROLS:      nToolbarIndex = 1; break;
-        case SID_FM_FORM_DESIGN_TOOLS:  nToolbarIndex = 2; break;
-        default:                        nToolbarIndex = 0; break;
-        }
-
-        const sal_Char* pToolBarName = pNames[nToolbarIndex][nDocIndex];
+        const sal_Char* pToolBarName = "formcontrols";
+        if ( _nSlotId == SID_FM_MORE_CONTROLS )
+            pToolBarName = "moreformcontrols";
+        else if ( _nSlotId == SID_FM_FORM_DESIGN_TOOLS )
+            pToolBarName = "formdesign";
 
         ::rtl::OUString aToolBarResStr( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/" ));
         aToolBarResStr += ::rtl::OUString::createFromAscii( pToolBarName );
Index: svx/source/form/tabwin.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/form/tabwin.cxx,v
retrieving revision 1.18
retrieving revision 1.18.120.2
diff -u -p -u -p -r1.18 -r1.18.120.2
--- svx/source/form/tabwin.cxx	16 Nov 2004 11:27:39 -0000	1.18
+++ svx/source/form/tabwin.cxx	17 Jan 2005 14:49:06 -0000	1.18.120.2
@@ -108,6 +108,9 @@
 #ifndef _SVX_FMSHELL_HXX
 #include "fmshell.hxx"
 #endif
+#ifndef _SVX_FMSHIMP_HXX
+#include "fmshimp.hxx"
+#endif
 
 #ifndef SVX_DBTOOLSCLIENT_HXX
 #include "dbtoolsclient.hxx"
@@ -179,6 +182,7 @@ using namespace ::com::sun::star::uno;
 using namespace ::com::sun::star::datatransfer;
 using namespace ::com::sun::star::beans;
 using namespace ::com::sun::star::lang;
+using namespace ::com::sun::star::form;
 using namespace ::com::sun::star::container;
 using namespace ::svxform;
 using namespace ::svx;
@@ -386,20 +390,14 @@ void FmFieldWin::StateChanged(sal_uInt16
 //-----------------------------------------------------------------------
 sal_Bool FmFieldWin::Update(FmFormShell* pShell)
 {
-	// ::com::sun::star::form::ListBox loeschen
 	pListBox->Clear();
-	::rtl::OUString aTitle(SVX_RES(RID_STR_FIELDSELECTION));
-	SetText(aTitle);
-
-	if (!pShell || !pShell->GetFormView())
-		return sal_False;
+	String aTitle( SVX_RES( RID_STR_FIELDSELECTION ) );
+	SetText( aTitle );
 
-	SdrPageView* pPageView = pShell->GetFormView()->GetPageViewPvNum(0);
-	if( !pPageView )
+	if (!pShell || !pShell->GetImpl())
 		return sal_False;
 
-	FmFormPage* pPage = PTR_CAST( FmFormPage, pPageView->GetPage() );
-	::com::sun::star::uno::Reference< ::com::sun::star::form::XForm >  xForm	  = pPage->GetImpl()->getCurForm();
+	Reference< XForm >  xForm = pShell->GetImpl()->getCurrentForm();
 	if (!xForm.is())
 		return sal_False;
 
@@ -409,69 +407,78 @@ sal_Bool FmFieldWin::Update(FmFormShell*
 //-----------------------------------------------------------------------
 sal_Bool FmFieldWin::Update(const ::com::sun::star::uno::Reference< ::com::sun::star::form::XForm > & xForm)
 {
-	// ListBox loeschen
-	pListBox->Clear();
-	UniString aTitle(SVX_RES(RID_STR_FIELDSELECTION));
-	SetText(aTitle);
-
-	if (!xForm.is())
-		return sal_False;
-
-	Reference< XPreparedStatement >  xStatement;
-	Reference< XPropertySet >  xSet(xForm, UNO_QUERY);
-
-	m_aObjectName	= ::comphelper::getString(xSet->getPropertyValue(FM_PROP_COMMAND));
-	m_aDatabaseName	= ::comphelper::getString(xSet->getPropertyValue(FM_PROP_DATASOURCE));
-	m_nObjectType 	= ::comphelper::getINT32(xSet->getPropertyValue(FM_PROP_COMMANDTYPE));
-
-	// get the connection of the form
-	Reference< XConnection > xConnection = OStaticDataAccessTools().calcConnection(Reference< XRowSet >(xForm, UNO_QUERY), ::comphelper::getProcessServiceFactory());
-	Sequence< ::rtl::OUString> aFieldNames;
-	// get the fields of the object
-	if ( xConnection.is() && m_aObjectName.getLength() )
-		aFieldNames = getFieldNamesByCommandDescriptor( xConnection, m_nObjectType, m_aObjectName );
-
-	// put them into the list
-	const ::rtl::OUString* pFieldNames = aFieldNames.getConstArray();
-	sal_Int32 nFieldsCount = aFieldNames.getLength();
-	for ( sal_Int32 i = 0; i < nFieldsCount; ++i, ++pFieldNames)
-		pListBox->InsertEntry( * pFieldNames);
-
-	// Prefix setzen
-	UniString  aPrefix;
-	UniString  aPrefixes( SVX_RES(RID_STR_TABWIN_PREFIX) );
-
-	switch (m_nObjectType)
-	{
-		case CommandType::TABLE:
-			aPrefix = aPrefixes.GetToken(0);
-			break;
-		case CommandType::QUERY:
-			aPrefix = aPrefixes.GetToken(1);
-			break;
-		default:
-			aPrefix = aPrefixes.GetToken(2);
-			break;
-	}
-
-	// an dem PropertySet nach Aenderungen der ControlSource lauschen
-	if (m_pChangeListener)
-	{
-		m_pChangeListener->dispose();
-		m_pChangeListener->release();
-	}
-	m_pChangeListener = new ::comphelper::OPropertyChangeMultiplexer(this, xSet);
-	m_pChangeListener->acquire();
-	m_pChangeListener->addProperty(FM_PROP_DATASOURCE);
-	m_pChangeListener->addProperty(FM_PROP_COMMAND);
-	m_pChangeListener->addProperty(FM_PROP_COMMANDTYPE);
-
-	// Titel setzen
-	aTitle.AppendAscii(" ");
-	aTitle += aPrefix;
-	aTitle.AppendAscii(" ");
-	aTitle += m_aObjectName.getStr();
-	SetText( aTitle );
+    try
+    {
+        // ListBox loeschen
+	    pListBox->Clear();
+	    UniString aTitle(SVX_RES(RID_STR_FIELDSELECTION));
+	    SetText(aTitle);
+
+	    if (!xForm.is())
+		    return sal_False;
+
+	    Reference< XPreparedStatement >  xStatement;
+	    Reference< XPropertySet >  xSet(xForm, UNO_QUERY);
+
+	    m_aObjectName	= ::comphelper::getString(xSet->getPropertyValue(FM_PROP_COMMAND));
+	    m_aDatabaseName	= ::comphelper::getString(xSet->getPropertyValue(FM_PROP_DATASOURCE));
+	    m_nObjectType 	= ::comphelper::getINT32(xSet->getPropertyValue(FM_PROP_COMMANDTYPE));
+
+	    // get the connection of the form
+        OStaticDataAccessTools aTools;
+        Reference< XConnection > xConnection = aTools.connectRowset(
+            Reference< XRowSet >( xForm, UNO_QUERY ), ::comphelper::getProcessServiceFactory(), sal_True );
+	    Sequence< ::rtl::OUString> aFieldNames;
+	    // get the fields of the object
+	    if ( xConnection.is() && m_aObjectName.getLength() )
+		    aFieldNames = getFieldNamesByCommandDescriptor( xConnection, m_nObjectType, m_aObjectName );
+
+	    // put them into the list
+	    const ::rtl::OUString* pFieldNames = aFieldNames.getConstArray();
+	    sal_Int32 nFieldsCount = aFieldNames.getLength();
+	    for ( sal_Int32 i = 0; i < nFieldsCount; ++i, ++pFieldNames)
+		    pListBox->InsertEntry( * pFieldNames);
+
+	    // Prefix setzen
+	    UniString  aPrefix;
+	    UniString  aPrefixes( SVX_RES(RID_STR_TABWIN_PREFIX) );
+
+	    switch (m_nObjectType)
+	    {
+		    case CommandType::TABLE:
+			    aPrefix = aPrefixes.GetToken(0);
+			    break;
+		    case CommandType::QUERY:
+			    aPrefix = aPrefixes.GetToken(1);
+			    break;
+		    default:
+			    aPrefix = aPrefixes.GetToken(2);
+			    break;
+	    }
+
+	    // an dem PropertySet nach Aenderungen der ControlSource lauschen
+	    if (m_pChangeListener)
+	    {
+		    m_pChangeListener->dispose();
+		    m_pChangeListener->release();
+	    }
+	    m_pChangeListener = new ::comphelper::OPropertyChangeMultiplexer(this, xSet);
+	    m_pChangeListener->acquire();
+	    m_pChangeListener->addProperty(FM_PROP_DATASOURCE);
+	    m_pChangeListener->addProperty(FM_PROP_COMMAND);
+	    m_pChangeListener->addProperty(FM_PROP_COMMANDTYPE);
+
+        // Titel setzen
+	    aTitle.AppendAscii(" ");
+	    aTitle += aPrefix;
+	    aTitle.AppendAscii(" ");
+	    aTitle += m_aObjectName.getStr();
+	    SetText( aTitle );
+    }
+    catch( const Exception& )
+    {
+        DBG_ERROR( "FmTabWin::Update: caught an excepiton!" );
+    }
 
 	return sal_True;
 }
Index: svx/source/inc/dbtoolsclient.hxx
===================================================================
RCS file: /cvs/graphics/svx/source/inc/dbtoolsclient.hxx,v
retrieving revision 1.8
retrieving revision 1.8.208.1
diff -u -p -u -p -r1.8 -r1.8.208.1
--- svx/source/inc/dbtoolsclient.hxx	22 Oct 2004 11:54:05 -0000	1.8
+++ svx/source/inc/dbtoolsclient.hxx	17 Jan 2005 14:48:32 -0000	1.8.208.1
@@ -146,10 +146,13 @@ namespace svxform
 		) const SAL_THROW ( (::com::sun::star::sdbc::SQLException) );
 
 		// ------------------------------------------------
-		::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> calcConnection(
+		::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> connectRowset(
 			const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
-			const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory
-		) const SAL_THROW ( (::com::sun::star::sdbc::SQLException, ::com::sun::star::uno::RuntimeException) );
+			const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory,
+			sal_Bool _bSetAsActiveConnection
+		) const SAL_THROW ( ( ::com::sun::star::sdbc::SQLException
+                            , ::com::sun::star::lang::WrappedTargetException
+                            , ::com::sun::star::uno::RuntimeException) );
 
 		// ------------------------------------------------
 		::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> getRowSetConnection(
Index: svx/source/inc/fmpgeimp.hxx
===================================================================
RCS file: /cvs/graphics/svx/source/inc/fmpgeimp.hxx,v
retrieving revision 1.9
retrieving revision 1.9.162.1
diff -u -p -u -p -r1.9 -r1.9.162.1
--- svx/source/inc/fmpgeimp.hxx	3 Nov 2004 10:45:38 -0000	1.9
+++ svx/source/inc/fmpgeimp.hxx	10 Jan 2005 10:37:18 -0000	1.9.162.1
@@ -135,7 +135,6 @@ protected:
 public:
 	//	nur wichtig fuer den DesignMode
 	void setCurForm(::com::sun::star::uno::Reference< ::com::sun::star::form::XForm> xForm);
-	const ::com::sun::star::uno::Reference< ::com::sun::star::form::XForm>& getCurForm() {return xCurrentForm;}
 	::com::sun::star::uno::Reference< ::com::sun::star::form::XForm> getDefaultForm();
 
 	// Defaults fuer ein Object setzen
@@ -173,6 +172,19 @@ protected:
 						const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XServiceInfo >& _rxObject
 					) const;
 
+private:
+    /** validates whether <member>xCurrentForm</member> is still valid and to be used
+
+        There are situations where our current form becomes invalid, without us noticing this. Thus,
+        every method which accesses <member>xCurrentForm</member> should beforehand validate the current
+        form by calling this method.
+
+        If <member>xCurrentForm</member> is not valid anymore, it is reset to <NULL/>.
+
+        @since #i40086#
+    */
+	void    validateCurForm();
+
 public:
 
 	static UniString getDefaultName(
Index: svx/source/inc/fmresids.hrc
===================================================================
RCS file: /cvs/graphics/svx/source/inc/fmresids.hrc,v
retrieving revision 1.18
retrieving revision 1.18.122.1
diff -u -p -u -p -r1.18 -r1.18.122.1
--- svx/source/inc/fmresids.hrc	16 Nov 2004 11:30:40 -0000	1.18
+++ svx/source/inc/fmresids.hrc	21 Jan 2005 16:51:35 -0000	1.18.122.1
@@ -130,15 +130,9 @@
 #define RID_SVXTBX_FORM_NAVIGATION                  (RID_FORMS_START +  1)
 #define RID_SVXTBX_FORM_FILTER                      (RID_FORMS_START +  2)
 #define RID_SVXTBX_TEXT_CONTROL_ATTRIBUTES          (RID_FORMS_START +  3)
-#define RID_SVXTBX_CONTROLS_DBFORMS                 (RID_FORMS_START +  4)
-#define RID_SVXTBX_CONTROLS_XFORMS                  (RID_FORMS_START +  5)
-#define RID_SVXTBX_CONTROLS_GENERIC                 (RID_FORMS_START +  6)
-#define RID_SVXTBX_MORECONTROLS_DBFORMS             (RID_FORMS_START +  7)
-#define RID_SVXTBX_MORECONTROLS_XFORMS              (RID_FORMS_START +  8)
-#define RID_SVXTBX_MORECONTROLS_GENERIC             (RID_FORMS_START +  9)
-#define RID_SVXTBX_FORMDESIGN_DBFORMS               (RID_FORMS_START + 10)
-#define RID_SVXTBX_FORMDESIGN_XFORMS                (RID_FORMS_START + 11)
-#define RID_SVXTBX_FORMDESIGN_GENERIC               (RID_FORMS_START + 12)
+#define RID_SVXTBX_CONTROLS                         (RID_FORMS_START +  4)
+#define RID_SVXTBX_MORECONTROLS                     (RID_FORMS_START +  5)
+#define RID_SVXTBX_FORMDESIGN                       (RID_FORMS_START +  6)
 
 // Menu-Id's -----------------------------------------------------------
 #define RID_FMEXPLORER_POPUPMENU					(RID_FORMS_START + 0)
Index: svx/source/inc/fmshimp.hxx
===================================================================
RCS file: /cvs/graphics/svx/source/inc/fmshimp.hxx,v
retrieving revision 1.24
retrieving revision 1.23.4.2
diff -u -p -u -p -r1.24 -r1.23.4.2
--- svx/source/inc/fmshimp.hxx	21 Jan 2005 16:59:33 -0000	1.24
+++ svx/source/inc/fmshimp.hxx	11 Jan 2005 14:32:28 -0000	1.23.4.2
@@ -230,7 +230,7 @@ DECLARE_STL_VECTOR( ::com::sun::star::un
 //==============================================================================
 // a class iterating through all fields of a form which are bound to a field
 // sub forms are ignored, grid columns (where the grid is a direct child of the form) are included
-class FmXBoundFormFieldIterator : public ::comphelper::IndexAccessIterator
+class SAL_DLLPRIVATE FmXBoundFormFieldIterator : public ::comphelper::IndexAccessIterator
 {
 public:
 	FmXBoundFormFieldIterator(const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface>& _rStartingPoint) : ::comphelper::IndexAccessIterator(_rStartingPoint) { }
@@ -244,7 +244,7 @@ protected:
 // I would prefer this to be a struct local to FmXFormShell but unfortunately local structs/classes
 // are somewhat difficult with some of our compilers
 class FmCursorActionThread;
-struct CursorActionDescription
+struct SAL_DLLPRIVATE CursorActionDescription
 {
 	FmCursorActionThread*	pThread;
 	sal_uInt32					nFinishedEvent;
@@ -257,7 +257,7 @@ struct CursorActionDescription
 
 class FmFormPage;
 //========================================================================
-struct FmLoadAction
+struct SAL_DLLPRIVATE FmLoadAction
 {
 	FmFormPage*	pPage;
 	sal_uInt32	nEventId;
@@ -279,7 +279,7 @@ typedef ::cppu::WeakComponentImplHelper4
                                         >   FmXFormShell_BD_BASE;
 
 //========================================================================
-class FmXFormShell_Base_Disambiguation : public FmXFormShell_BD_BASE
+class SAL_DLLPRIVATE FmXFormShell_Base_Disambiguation : public FmXFormShell_BD_BASE
 {
 protected:
 	FmXFormShell_Base_Disambiguation( ::osl::Mutex& _rMutex );
@@ -298,10 +298,10 @@ typedef ::utl::ConfigItem					FmXFormShe
 
 struct SdrViewEvent;
 class FmFormShell;
-class FmXFormShell	:public FmXFormShell_BASE
-					,public FmXFormShell_CFGBASE
-					,public ::svxform::OStaticDataAccessTools
-                    ,public ::svx::IControllerFeatureInvalidation
+class SAL_DLLPRIVATE FmXFormShell   :public FmXFormShell_BASE
+                                    ,public FmXFormShell_CFGBASE
+                                    ,public ::svxform::OStaticDataAccessTools
+                                    ,public ::svx::IControllerFeatureInvalidation
 {
 	friend class FmFormView;
     friend class FmXFormView;
@@ -690,7 +690,7 @@ inline sal_Bool FmXFormShell::IsSelectio
 // = der Teil mit dem Container-Test fuer dieses Objekt.
 // =
 
-class SearchableControlIterator : public ::comphelper::IndexAccessIterator
+class SAL_DLLPRIVATE SearchableControlIterator : public ::comphelper::IndexAccessIterator
 {
 	::rtl::OUString			m_sCurrentValue;
 		// der aktuelle Wert der ControlSource-::com::sun::star::beans::Property
@@ -708,7 +708,7 @@ public:
 
 // ========================================================================
 SV_DECL_PTRARR_DEL(StatusForwarderArray, SfxStatusForwarder*, 16, 0)
-class ControlConversionMenuController : public SfxMenuControl
+class SAL_DLLPRIVATE ControlConversionMenuController : public SfxMenuControl
 {
 protected:
 	StatusForwarderArray	m_aStatusForwarders;
@@ -727,7 +727,7 @@ public:
 // FmCursorActionThread
 //==================================================================
 
-class FmCursorActionThread : public ::vos::OThread
+class SAL_DLLPRIVATE FmCursorActionThread : public ::vos::OThread
 {
 	Link					m_aTerminationHandler;		// the handler to be called upon termination
 	::com::sun::star::sdbc::SQLException			m_aRunException;			// the database exception thrown by RunImpl
@@ -821,7 +821,7 @@ protected:
 
 #define DECL_CURSOR_ACTION_THREAD(classname)			\
 														\
-class classname : public FmCursorActionThread			\
+class SAL_DLLPRIVATE classname : public FmCursorActionThread    \
 {														\
 public:													\
 	classname(const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XResultSet>& _xDataSource); \
Index: svx/source/inc/gridcell.hxx
===================================================================
RCS file: /cvs/graphics/svx/source/inc/gridcell.hxx,v
retrieving revision 1.12
retrieving revision 1.12.468.1
diff -u -p -u -p -r1.12 -r1.12.468.1
--- svx/source/inc/gridcell.hxx	10 May 2004 13:15:41 -0000	1.12
+++ svx/source/inc/gridcell.hxx	14 Jan 2005 14:34:31 -0000	1.12.468.1
@@ -442,9 +442,10 @@ protected:
 //==================================================================
 class DbTextField : public DbLimitedLengthField
 {
-	sal_Int16		            m_nKeyType;
     ::svt::IEditImplementation* m_pEdit;
     ::svt::IEditImplementation* m_pPainterImplementation;
+	sal_Int16		            m_nKeyType;
+    sal_Bool                    m_bIsSimpleEdit;
 
 protected:
 	~DbTextField( );
@@ -454,6 +455,7 @@ public:
 	DbTextField(DbGridColumn& _rColumn);
 
     ::svt::IEditImplementation* GetEditImplementation() { return m_pEdit; }
+    sal_Bool                    IsSimpleEdit() const { return m_bIsSimpleEdit; }
 
     virtual void Init(Window* pParent, const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet >& xCursor );
 	virtual XubString GetFormatText(const ::com::sun::star::uno::Reference< ::com::sun::star::sdb::XColumn >& _rxField, const ::com::sun::star::uno::Reference< ::com::sun::star::util::XNumberFormatter >& xFormatter, Color** ppColor = NULL);
@@ -844,9 +846,29 @@ protected:
 //==================================================================
 class FmXTextCell : public FmXDataCell
 {
+protected:
+    /** determines whether the text of this cell can be painted directly, without
+        using the painter control
+
+        If this is <TRUE/>, the <member>Paint</member> method will simply use the text as returned
+        by <member>GetText</member>, and draw it onto the device passed to <member>Paint</member>,
+        while respecting the current alignment settings.
+
+        If this is <FALSE/>, the <member>Paint</member> request will be forwarded to the painter
+        control (<member>m_pPainter</member>). This is more expensive, but the only option
+        if your painting involves more that a simple DrawText.
+
+        This member is <TRUE/> by default, and can be modified by derived classes.
+    */
+    sal_Bool    m_bFastPaint;
+
 public:
 	TYPEINFO();
-	FmXTextCell(DbGridColumn* pColumn, DbCellControl* pControl):FmXDataCell(pColumn, pControl){}
+	FmXTextCell( DbGridColumn* pColumn, DbCellControl* pControl )
+        :FmXDataCell( pColumn, pControl )
+        ,m_bFastPaint( sal_False )
+    {
+    }
 
 	virtual void Paint(OutputDevice& rDev,
 			   const Rectangle& rRect,
@@ -872,12 +894,6 @@ protected:
 public:
 	FmXEditCell(DbGridColumn* pColumn, DbCellControl* pControl);
 	
-	virtual void Paint( OutputDevice& _rDev,
-			   const Rectangle& _rRect,
-			   const ::com::sun::star::uno::Reference< ::com::sun::star::sdb::XColumn >& _rxField,
-			   const ::com::sun::star::uno::Reference< ::com::sun::star::util::XNumberFormatter >& _rxFormatter
-            );
-
 	DECLARE_UNO3_AGG_DEFAULTS(FmXEditCell, FmXTextCell);
 	virtual ::com::sun::star::uno::Any SAL_CALL queryAggregation( const ::com::sun::star::uno::Type& _rType ) throw(::com::sun::star::uno::RuntimeException);
 
Index: svx/source/inc/tabwin.hxx
===================================================================
RCS file: /cvs/graphics/svx/source/inc/tabwin.hxx,v
retrieving revision 1.8
retrieving revision 1.8.1040.1
diff -u -p -u -p -r1.8 -r1.8.1040.1
--- svx/source/inc/tabwin.hxx	27 Mar 2003 15:03:22 -0000	1.8
+++ svx/source/inc/tabwin.hxx	10 Jan 2005 10:39:59 -0000	1.8.1040.1
@@ -101,7 +101,7 @@
 
 //==================================================================
 class FmFieldWin;
-class FmFieldWinListBox
+class SAL_DLLPRIVATE FmFieldWinListBox
 					:public SvTreeListBox
 {
 	FmFieldWin* pTabWin;
@@ -126,7 +126,7 @@ protected:
 
 //========================================================================
 class FmFormShell;
-class FmFieldWinData
+class SAL_DLLPRIVATE FmFieldWinData
 {
 public:
 	FmFieldWinData();
@@ -134,7 +134,7 @@ public:
 };
 
 //========================================================================
-class FmFieldWin	:public SfxFloatingWindow
+class SAL_DLLPRIVATE FmFieldWin	:public SfxFloatingWindow
 					,public SfxControllerItem
 					,public ::comphelper::OPropertyChangeListener
 					,public ::svxform::OStaticDataAccessTools
@@ -182,7 +182,7 @@ protected:
 };
 
 //========================================================================
-class FmFieldWinMgr : public SfxChildWindow
+class SAL_DLLPRIVATE FmFieldWinMgr : public SfxChildWindow
 {
 public:
 	FmFieldWinMgr(Window *pParent, sal_uInt16 nId,
Index: dbaccess/source/core/api/BookmarkSet.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/BookmarkSet.cxx,v
retrieving revision 1.14
retrieving revision 1.14.76.1
diff -u -p -u -p -r1.14 -r1.14.76.1
--- dbaccess/source/core/api/BookmarkSet.cxx	2 Aug 2004 14:58:15 -0000	1.14
+++ dbaccess/source/core/api/BookmarkSet.cxx	20 Jan 2005 16:47:44 -0000	1.14.76.1
@@ -228,6 +228,7 @@ void OBookmarkSet::updateColumn(sal_Int3
 						_xParameter->updateString(nPos,_rValue);
 					break;
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 					_xParameter->updateBoolean(nPos,_rValue);
 					break;
 				case DataType::TINYINT:
Index: dbaccess/source/core/api/CacheSet.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/CacheSet.cxx,v
retrieving revision 1.37
retrieving revision 1.37.76.1
diff -u -p -u -p -r1.37 -r1.37.76.1
--- dbaccess/source/core/api/CacheSet.cxx	2 Aug 2004 14:59:33 -0000	1.37
+++ dbaccess/source/core/api/CacheSet.cxx	20 Jan 2005 16:47:44 -0000	1.37.76.1
@@ -521,6 +521,7 @@ void OCacheSet::setParameter(sal_Int32 n
 					_xParameter->setString(nPos,_rValue);
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				_xParameter->setBoolean(nPos,_rValue);
 				break;
 			case DataType::TINYINT:
@@ -838,6 +839,7 @@ void OCacheSet::fetchValue(sal_Int32 _nP
 		_rValue = _xRow->getBytes(_nPos);
 		break;
 	case DataType::BIT:
+	case DataType::BOOLEAN:
 		_rValue = _xRow->getBoolean(_nPos);
 		break;
 	case DataType::TINYINT:
Index: dbaccess/source/core/api/RowSet.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/RowSet.cxx,v
retrieving revision 1.131
retrieving revision 1.130.6.2
diff -u -p -u -p -r1.131 -r1.130.6.2
--- dbaccess/source/core/api/RowSet.cxx	21 Jan 2005 17:02:14 -0000	1.131
+++ dbaccess/source/core/api/RowSet.cxx	3 Feb 2005 08:06:12 -0000	1.130.6.2
@@ -595,7 +595,7 @@ void SAL_CALL ORowSet::release() throw()
 sal_Int64 SAL_CALL ORowSet::getSomething( const Sequence< sal_Int8 >& rId ) throw(RuntimeException)
 {
 	if (rId.getLength() == 16 && 0 == rtl_compareMemory(getImplementationId().getConstArray(),  rId.getConstArray(), 16 ) )
-		return (sal_Int64)this;
+		return reinterpret_cast<sal_Int64>(this);
 
 	return 0;
 }
@@ -1988,7 +1988,7 @@ void ORowSet::notifyClonesRowDelete(cons
 		Reference< XUnoTunnel > xTunnel(i->get(),UNO_QUERY);
 		if(xTunnel.is())
 		{
-			ORowSetClone* pClone = (ORowSetClone*)xTunnel->getSomething(ORowSetClone::getUnoTunnelImplementationId());
+			ORowSetClone* pClone = reinterpret_cast<ORowSetClone*>(xTunnel->getSomething(ORowSetClone::getUnoTunnelImplementationId()));
 			if(pClone)
 				pClone->rowDelete(_rBookmark);
 		}
@@ -2002,7 +2002,7 @@ void ORowSet::notifyClonesRowDeleted(con
 		Reference< XUnoTunnel > xTunnel(i->get(),UNO_QUERY);
 		if(xTunnel.is())
 		{
-			ORowSetClone* pClone = (ORowSetClone*)xTunnel->getSomething(ORowSetClone::getUnoTunnelImplementationId());
+			ORowSetClone* pClone = reinterpret_cast<ORowSetClone*>(xTunnel->getSomething(ORowSetClone::getUnoTunnelImplementationId()));
 			if(pClone)
 				pClone->rowDeleted(_rBookmark);
 		}
@@ -2684,7 +2684,7 @@ Sequence< sal_Int8 > ORowSetClone::getUn
 sal_Int64 SAL_CALL ORowSetClone::getSomething( const Sequence< sal_Int8 >& rId ) throw(RuntimeException)
 {
 	if (rId.getLength() == 16 && 0 == rtl_compareMemory(getUnoTunnelImplementationId().getConstArray(),  rId.getConstArray(), 16 ) )
-		return (sal_Int64)this;
+		return reinterpret_cast<sal_Int64>(this);
 
 	return 0;
 }
Index: dbaccess/source/core/api/SingleSelectQueryComposer.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/SingleSelectQueryComposer.cxx,v
retrieving revision 1.7
retrieving revision 1.7.8.1
diff -u -p -u -p -r1.7 -r1.7.8.1
--- dbaccess/source/core/api/SingleSelectQueryComposer.cxx	5 Jan 2005 12:27:39 -0000	1.7
+++ dbaccess/source/core/api/SingleSelectQueryComposer.cxx	20 Jan 2005 16:47:45 -0000	1.7.8.1
@@ -1508,6 +1508,7 @@ void OSingleSelectQueryComposer::setCond
 				}
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				{
 					::rtl::OUString sTmpName = aSql;
 
Index: dbaccess/source/core/api/TableDeco.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/TableDeco.cxx,v
retrieving revision 1.23
retrieving revision 1.23.44.1
diff -u -p -u -p -r1.23 -r1.23.44.1
--- dbaccess/source/core/api/TableDeco.cxx	22 Oct 2004 08:55:51 -0000	1.23
+++ dbaccess/source/core/api/TableDeco.cxx	19 Jan 2005 08:45:17 -0000	1.23.44.1
@@ -578,7 +578,7 @@ Reference< XNameAccess> ODBTableDecorato
 sal_Int64 SAL_CALL ODBTableDecorator::getSomething( const Sequence< sal_Int8 >& rId ) throw(RuntimeException)
 {
 	if (rId.getLength() == 16 && 0 == rtl_compareMemory(getUnoTunnelImplementationId().getConstArray(),  rId.getConstArray(), 16 ) )
-		return (sal_Int64)this;
+		return reinterpret_cast<sal_Int64>(this);
 
 	sal_Int64 nRet = 0;
 	Reference<XUnoTunnel> xTunnel(m_xTable,UNO_QUERY);
Index: dbaccess/source/core/api/column.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/column.cxx,v
retrieving revision 1.46
retrieving revision 1.46.44.1
diff -u -p -u -p -r1.46 -r1.46.44.1
--- dbaccess/source/core/api/column.cxx	22 Oct 2004 08:56:12 -0000	1.46
+++ dbaccess/source/core/api/column.cxx	19 Jan 2005 08:45:17 -0000	1.46.44.1
@@ -306,7 +306,7 @@ Sequence< sal_Int8 > OColumn::getUnoTunn
 sal_Int64 OColumn::getSomething( const Sequence< sal_Int8 > & rId ) throw (RuntimeException)
 {
 	if (rId.getLength() == 16 && 0 == rtl_compareMemory(getUnoTunnelImplementationId().getConstArray(),  rId.getConstArray(), 16 ) )
-		return (sal_Int64)this; 
+		return reinterpret_cast<sal_Int64>(this);
 
 	return 0;
 }
Index: dbaccess/source/core/api/querycomposer.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/querycomposer.cxx,v
retrieving revision 1.60
retrieving revision 1.60.8.1
diff -u -p -u -p -r1.60 -r1.60.8.1
--- dbaccess/source/core/api/querycomposer.cxx	5 Jan 2005 12:27:54 -0000	1.60
+++ dbaccess/source/core/api/querycomposer.cxx	19 Jan 2005 08:45:18 -0000	1.60.8.1
@@ -217,7 +217,7 @@ Sequence< sal_Int8 > SAL_CALL OQueryComp
 sal_Int64 SAL_CALL OQueryComposer::getSomething( const Sequence< sal_Int8 >& rId ) throw(RuntimeException)
 {
 	if (rId.getLength() == 16 && 0 == rtl_compareMemory(getImplementationId().getConstArray(),  rId.getConstArray(), 16 ) )
-		return (sal_Int64)this;
+		return reinterpret_cast<sal_Int64>(this);
 
 	return 0;
 }
Index: dbaccess/source/core/api/table.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/api/table.cxx,v
retrieving revision 1.52
retrieving revision 1.52.44.1
diff -u -p -u -p -r1.52 -r1.52.44.1
--- dbaccess/source/core/api/table.cxx	22 Oct 2004 08:57:42 -0000	1.52
+++ dbaccess/source/core/api/table.cxx	19 Jan 2005 08:45:18 -0000	1.52.44.1
@@ -458,7 +458,7 @@ sal_Int64 SAL_CALL ODBTable::getSomethin
 {
 	sal_Int64 nRet(0);
 	if (rId.getLength() == 16 && 0 == rtl_compareMemory(getUnoTunnelImplementationId().getConstArray(),  rId.getConstArray(), 16 ) )
-		nRet = (sal_Int64)this;
+		nRet = reinterpret_cast<sal_Int64>(this);
 	else
 		nRet = OTable_Base::getSomething(rId);
 
Index: dbaccess/source/core/dataaccess/databasecontext.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/dataaccess/databasecontext.cxx,v
retrieving revision 1.27
retrieving revision 1.25.20.4
diff -u -p -u -p -r1.27 -r1.25.20.4
--- dbaccess/source/core/dataaccess/databasecontext.cxx	2 Feb 2005 13:59:09 -0000	1.27
+++ dbaccess/source/core/dataaccess/databasecontext.cxx	11 Feb 2005 10:09:59 -0000	1.25.20.4
@@ -78,7 +78,7 @@
 #include "apitools.hxx"
 #endif
 
-#ifndef _COM_SUN_STAR_REGISTRY_INVALIDREGISTRYEXCEPTION_HPP_ 
+#ifndef _COM_SUN_STAR_REGISTRY_INVALIDREGISTRYEXCEPTION_HPP_
 #include <com/sun/star/registry/InvalidRegistryException.hpp>
 #endif
 #ifndef _COM_SUN_STAR_BEANS_PROPERTYATTRIBUTE_HPP_
@@ -150,6 +150,9 @@
 #ifndef INCLUDED_SVTOOLS_PATHOPTIONS_HXX
 #include <svtools/pathoptions.hxx>
 #endif
+#ifndef SVTOOLS_FILENOTATION_HXX
+#include <svtools/filenotation.hxx>
+#endif
 
 using namespace ::com::sun::star::sdbc;
 using namespace ::com::sun::star::sdb;
@@ -168,6 +171,8 @@ using namespace ::utl;
 using ::com::sun::star::task::InteractionClassification_ERROR;
 using ::com::sun::star::ucb::IOErrorCode_NO_FILE;
 using ::com::sun::star::ucb::InteractiveIOException;
+using ::com::sun::star::ucb::IOErrorCode_NOT_EXISTING;
+using ::com::sun::star::ucb::IOErrorCode_NOT_EXISTING_PATH;
 
 //==========================================================================
 
@@ -181,7 +186,7 @@ namespace dbaccess
 {
 //........................................................................
 
-	namespace 
+	namespace
 	{
 		//--------------------------------------------------------------------
 		const ::rtl::OUString& getDbRegisteredNamesNodeName()
@@ -327,7 +332,7 @@ bool ODatabaseContext::getURLForRegister
 {
 	if ( !_rRegisteredName.getLength() )
 		throw IllegalArgumentException();
-	
+
 	// the config node where all pooling relevant info are stored under
 	OConfigurationTreeRoot aDbRegisteredNamesRoot = OConfigurationTreeRoot::createWithServiceFactory(
 		m_xServiceManager, getDbRegisteredNamesNodeName(), -1, OConfigurationTreeRoot::CM_READONLY);
@@ -356,7 +361,7 @@ Reference< XInterface >  ODatabaseContex
 	if ( !sURL.getLength() )
         // there is a registration for this name, but no URL
 		throw IllegalArgumentException();
-	
+
 	// check if URL is already loaded
 	Reference< XInterface > xExistent = getObject( sURL );
 	if ( xExistent.is() )
@@ -377,45 +382,69 @@ Reference< XInterface > ODatabaseContext
 	}
 	catch(InteractiveIOException e)
 	{
-		throw WrappedTargetException( _sURL, Reference<XNamingService>(this), makeAny( e ) );
+        if  (   ( e.Code == IOErrorCode_NO_FILE )
+            ||  ( e.Code == IOErrorCode_NOT_EXISTING )
+            ||  ( e.Code == IOErrorCode_NOT_EXISTING_PATH )
+            )
+        {
+            // #i40463# #i39187#
+            String sErrorMessage( DBACORE_RESSTRING( RID_STR_FILE_DOES_NOT_EXIST ) );
+            ::svt::OFileNotation aTransformer( _sURL );
+		    sErrorMessage.SearchAndReplaceAscii( "$file$", aTransformer.get( ::svt::OFileNotation::N_SYSTEM ) );
+
+            SQLException aError;
+            aError.Message = sErrorMessage;
+
+            throw WrappedTargetException( _sURL, Reference< XNamingService >( this ), makeAny( aError ) );
+        }
+		throw WrappedTargetException( _sURL, Reference< XNamingService >( this ), makeAny( e ) );
 	}
 	catch(Exception e)
 	{
 		throw WrappedTargetException( _sURL, Reference<XNamingService>(this), makeAny( e ) );
 	}
 
-	Reference< XInterface > xExistent = *(new ODatabaseSource(*this, _rName, m_xServiceManager,this));
-
-	Sequence< PropertyValue > aArgs(1);
-	aArgs[0].Name = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("FileName"));
-	aArgs[0].Value <<= _sURL;
-
-	Reference<XModel> xModel(xExistent,UNO_QUERY);
-	xModel->attachResource(_sURL,aArgs);
-
-	// check if we have any session persistent properties to initialize the new object with
-	if ( m_aDatasourceProperties.end() != m_aDatasourceProperties.find(_sURL) )
-	{	// yes, we do ....
-		Reference< XPropertySet > xDSProps(xExistent, UNO_QUERY);
-		if (xDSProps.is())
-		{
-			const Sequence< PropertyValue >& rSessionPersistentProps = m_aDatasourceProperties[_sURL];
-			const PropertyValue* pSessionPersistentProps = rSessionPersistentProps.getConstArray();
+	Reference< XInterface > xExistent = getObject(_sURL);
+	if ( xExistent.is() ) // we found a object registered under the URL
+	{
+		m_aDatabaseObjects.erase(_sURL);
+		registerPrivate(_rName,xExistent);
+	}
+	else
+	{
+		xExistent = *(new ODatabaseSource(*this, _rName, m_xServiceManager,this));
 
-			for (sal_Int32 i=0; i<rSessionPersistentProps.getLength(); ++i, ++pSessionPersistentProps)
+		Sequence< PropertyValue > aArgs(1);
+		aArgs[0].Name = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("FileName"));
+		aArgs[0].Value <<= _sURL;
+
+		Reference<XModel> xModel(xExistent,UNO_QUERY);
+		xModel->attachResource(_sURL,aArgs);
+
+		// check if we have any session persistent properties to initialize the new object with
+		if ( m_aDatasourceProperties.end() != m_aDatasourceProperties.find(_sURL) )
+		{	// yes, we do ....
+			Reference< XPropertySet > xDSProps(xExistent, UNO_QUERY);
+			if (xDSProps.is())
 			{
-				try
-				{
-					xDSProps->setPropertyValue(pSessionPersistentProps->Name, pSessionPersistentProps->Value);
-				}
-				catch(Exception&)
+				const Sequence< PropertyValue >& rSessionPersistentProps = m_aDatasourceProperties[_sURL];
+				const PropertyValue* pSessionPersistentProps = rSessionPersistentProps.getConstArray();
+
+				for (sal_Int32 i=0; i<rSessionPersistentProps.getLength(); ++i, ++pSessionPersistentProps)
 				{
-					DBG_ERROR("ODatabaseContext::getRegisteredObject: could not set a session-persistent property on the data source!");
+					try
+					{
+						xDSProps->setPropertyValue(pSessionPersistentProps->Name, pSessionPersistentProps->Value);
+					}
+					catch(Exception&)
+					{
+						DBG_ERROR("ODatabaseContext::getRegisteredObject: could not set a session-persistent property on the data source!");
+					}
 				}
 			}
+			else
+				DBG_ERROR("ODatabaseContext::getRegisteredObject: missing an interface!");
 		}
-		else
-			DBG_ERROR("ODatabaseContext::getRegisteredObject: missing an interface!");
 	}
 	return xExistent;
 }
@@ -667,7 +696,7 @@ Sequence< rtl::OUString > ODatabaseConte
 
 	DECLARE_STL_USTRINGACCESS_MAP( bool , TNameMap);
 	TNameMap aRet;
-	
+
 	OConfigurationTreeRoot aDbRegisteredNamesRoot = OConfigurationTreeRoot::createWithServiceFactory(
 		m_xServiceManager, getDbRegisteredNamesNodeName(), -1, OConfigurationTreeRoot::CM_READONLY);
 
Index: dbaccess/source/core/dataaccess/databasedocument.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/dataaccess/databasedocument.cxx,v
retrieving revision 1.9
retrieving revision 1.7.16.3
diff -u -p -u -p -r1.9 -r1.7.16.3
--- dbaccess/source/core/dataaccess/databasedocument.cxx	2 Feb 2005 14:01:30 -0000	1.9
+++ dbaccess/source/core/dataaccess/databasedocument.cxx	11 Feb 2005 10:10:09 -0000	1.7.16.3
@@ -487,14 +487,18 @@ void SAL_CALL ODatabaseSource::storeAsUR
 			if ( sURL != m_sFileURL )
 			{
 				if ( m_pDBContext )
-					m_pDBContext->nameChangePrivate(m_sFileURL,sURL);
+				{
+					if ( m_sFileURL.getLength() )
+						m_pDBContext->nameChangePrivate(m_sFileURL,sURL);
+					else
+						m_pDBContext->registerPrivate(sURL,*this);
+				}
 
-				INetURLObject aURL( m_sName );
+				INetURLObject aURL( sURL );
 				if( aURL.GetProtocol() != INET_PROT_NOT_VALID )
 					m_sName = sURL;
 			}
-			m_sFileURL = sURL;
-			
+			m_sFileURL = sURL;			
 		}
 		m_aArgs = lArguments;
 		store(m_sFileURL,m_aArgs);
Index: dbaccess/source/core/dataaccess/datasource.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/dataaccess/datasource.cxx,v
retrieving revision 1.54
retrieving revision 1.52.16.3
diff -u -p -u -p -r1.54 -r1.52.16.3
--- dbaccess/source/core/dataaccess/datasource.cxx	2 Feb 2005 13:59:34 -0000	1.54
+++ dbaccess/source/core/dataaccess/datasource.cxx	11 Feb 2005 10:10:18 -0000	1.52.16.3
@@ -757,7 +757,7 @@ Sequence< ::rtl::OUString > ODatabaseSou
 {
 	Sequence< ::rtl::OUString > aSNS( 3 );
 	aSNS[0] = SERVICE_SDB_DATASOURCE;
-	aSNS[1] = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.DatabaseDocument"));
+	aSNS[1] = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.OfficeDatabaseDocument"));
 	aSNS[2] = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.document.OfficeDocument"));
 	return aSNS;
 }
Index: dbaccess/source/core/dataaccess/documentdefinition.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/dataaccess/documentdefinition.cxx,v
retrieving revision 1.19
retrieving revision 1.18.6.2
diff -u -p -u -p -r1.19 -r1.18.6.2
--- dbaccess/source/core/dataaccess/documentdefinition.cxx	21 Jan 2005 17:04:28 -0000	1.19
+++ dbaccess/source/core/dataaccess/documentdefinition.cxx	3 Feb 2005 08:07:18 -0000	1.18.6.2
@@ -1070,8 +1070,27 @@ void ODocumentDefinition::loadEmbeddedOb
 			xCommon->reload(aArgs,aEmbeddedObjectDescriptor);
 		m_xEmbeddedObject->changeState(EmbedStates::RUNNING);
 	}
-	Reference<XModel> xModel(getComponent(),UNO_QUERY);
-	if ( xModel.is() )
+
+    Reference<XModel> xModel(getComponent(),UNO_QUERY);
+	// set the OfficeDatabaseDocument instance as parent of the embedded document
+    // #i40358# / 2005-01-19 / frank.schoenheit@sun.com
+    Reference< XChild > xDepdendDocAsChild( xModel, UNO_QUERY );
+    if ( xDepdendDocAsChild.is() )
+    {
+        try
+        {
+            if ( !xDepdendDocAsChild->getParent().is() )
+            {   // first encounter
+                xDepdendDocAsChild->setParent( getDataSource( m_xParentContainer ) );
+            }
+        }
+        catch( const Exception& )
+        {
+            OSL_ENSURE( sal_False, "ODocumentDefinition::loadEmbeddedObject: caught an exception while setting the parent of the embedded object!" );
+        }
+    }
+
+    if ( xModel.is() )
 	{
 		Sequence<PropertyValue> aArgs = xModel->getArgs();
 		::comphelper::MediaDescriptor aHelper(aArgs);
Index: dbaccess/source/core/dataaccess/intercept.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/dataaccess/intercept.cxx,v
retrieving revision 1.2
retrieving revision 1.2.76.1
diff -u -p -u -p -r1.2 -r1.2.76.1
--- dbaccess/source/core/dataaccess/intercept.cxx	2 Aug 2004 15:10:59 -0000	1.2
+++ dbaccess/source/core/dataaccess/intercept.cxx	20 Jan 2005 16:32:07 -0000	1.2.76.1
@@ -100,8 +100,7 @@ using namespace ::cppu;
 #define DISPATCH_CLOSEDOC	2
 #define DISPATCH_CLOSEWIN	3
 #define DISPATCH_CLOSEFRAME	4
-#define DISPATCH_EDITDOC	5
-#define DISPATCH_RELOAD		6
+#define DISPATCH_RELOAD		5
 // the OSL_ENSURE in CTOR has to be changed too, when adding new defines
 
 void OInterceptor::DisconnectContentHolder()
@@ -164,14 +163,13 @@ OInterceptor::OInterceptor( ODocumentDef
 	  ,m_aInterceptedURL(7)
 	  ,m_bAllowEditDoc(_bAllowEditDoc)
 {
-	OSL_ENSURE(DISPATCH_EDITDOC < m_aInterceptedURL.getLength(),"Illegal size.");
+	OSL_ENSURE(DISPATCH_RELOAD < m_aInterceptedURL.getLength(),"Illegal size.");
 
 	m_aInterceptedURL[DISPATCH_SAVEAS]		= rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:SaveAs"));
 	m_aInterceptedURL[DISPATCH_SAVE]		= rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:Save"));
 	m_aInterceptedURL[DISPATCH_CLOSEDOC]	= rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:CloseDoc"));	
 	m_aInterceptedURL[DISPATCH_CLOSEWIN]	= rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:CloseWin"));
 	m_aInterceptedURL[DISPATCH_CLOSEFRAME]	= rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:CloseFrame"));
-	m_aInterceptedURL[DISPATCH_EDITDOC]		= rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:EditDoc"));
 	m_aInterceptedURL[DISPATCH_RELOAD]		= rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:Reload"));
 }
 
@@ -248,13 +246,6 @@ OInterceptor::dispatch( 
 			if ( xDispatch.is() )
 				xDispatch->dispatch( _URL, Arguments );
 		}
-		else if ( _URL.Complete == m_aInterceptedURL[DISPATCH_EDITDOC] )
-		{
-			Reference< XDispatch > xDispatch = m_xSlaveDispatchProvider->queryDispatch(
-				_URL, ::rtl::OUString::createFromAscii( "_self" ), 0 );
-			if ( xDispatch.is() )
-				xDispatch->dispatch( _URL, Arguments );
-		}
 }
 
 void SAL_CALL
@@ -307,23 +298,6 @@ OInterceptor::addStatusListener( 
 		if ( xEvtB.is() )
 			xEvtB->addEventListener(this);
 	}
-	else if ( m_pContentHolder && _URL.Complete == m_aInterceptedURL[DISPATCH_EDITDOC] )
-	{   // EditDoc
-		FeatureStateEvent aStateEvent;
-		aStateEvent.FeatureURL.Complete = m_aInterceptedURL[DISPATCH_EDITDOC];
-		aStateEvent.FeatureDescriptor = rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("Update"));
-		aStateEvent.IsEnabled = m_bAllowEditDoc;
-		aStateEvent.Requery = sal_False;
-		
-		Control->statusChanged(aStateEvent);		
-		{
-			osl::MutexGuard aGuard(m_aMutex);
-			if(!m_pStatCL)
-				m_pStatCL = new PropertyChangeListenerContainer(m_aMutex);
-		}
-		
-		m_pStatCL->addInterface(_URL.Complete,Control);
-	}
 	else
 	{
 		sal_Int32 i = 2;
Index: dbaccess/source/core/inc/core_resource.hrc
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/inc/core_resource.hrc,v
retrieving revision 1.9
retrieving revision 1.9.76.1
diff -u -p -u -p -r1.9 -r1.9.76.1
--- dbaccess/source/core/inc/core_resource.hrc	2 Aug 2004 15:13:50 -0000	1.9
+++ dbaccess/source/core/inc/core_resource.hrc	17 Jan 2005 14:47:24 -0000	1.9.76.1
@@ -106,6 +106,7 @@
 #define RID_STR_FORM							( RID_CORE_STRINGS_START + 32 )
 #define RID_STR_REPORT							( RID_CORE_STRINGS_START + 33 )
 #define RID_STR_DATASOURCE_NOT_STORED			( RID_CORE_STRINGS_START + 34 )
+#define RID_STR_FILE_DOES_NOT_EXIST             ( RID_CORE_STRINGS_START + 35 )
 
 #endif // _DBA_CORE_RESOURCE_HRC_
 
Index: dbaccess/source/core/inc/sdbcoretools.hxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/inc/sdbcoretools.hxx,v
retrieving revision 1.3
retrieving revision 1.3.76.1
diff -u -p -u -p -r1.3 -r1.3.76.1
--- dbaccess/source/core/inc/sdbcoretools.hxx	2 Aug 2004 15:15:00 -0000	1.3
+++ dbaccess/source/core/inc/sdbcoretools.hxx	19 Jan 2005 08:45:48 -0000	1.3.76.1
@@ -75,7 +75,11 @@ namespace dbaccess
 //.........................................................................
 
 	// -----------------------------------------------------------------------------
-	void notifyDataSourceModified(const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _xParent,sal_Bool _bModified);
+	void notifyDataSourceModified(const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _rxObject,sal_Bool _bModified);
+
+	// -----------------------------------------------------------------------------
+    ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >
+        getDataSource( const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _rxDependentObject );
 
 //.........................................................................
 }	// namespace dbaccess
Index: dbaccess/source/core/misc/sdbcoretools.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/misc/sdbcoretools.cxx,v
retrieving revision 1.5
retrieving revision 1.5.22.1
diff -u -p -u -p -r1.5 -r1.5.22.1
--- dbaccess/source/core/misc/sdbcoretools.cxx	16 Nov 2004 09:28:25 -0000	1.5
+++ dbaccess/source/core/misc/sdbcoretools.cxx	19 Jan 2005 08:45:52 -0000	1.5.22.1
@@ -90,20 +90,29 @@ namespace dbaccess
 	using namespace ::com::sun::star::beans;
 	using namespace ::com::sun::star::container;
 
-//=====================================================================
-void notifyDataSourceModified(const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _xParent,sal_Bool _bModified)
-{
-	Reference< XInterface > xParent = _xParent;
-	Reference< XModifiable > xModi;
-	while( xParent.is() )
-	{
-		xModi.set(xParent,UNO_QUERY);
-		Reference<XChild> xChild(xParent,UNO_QUERY);
-		xParent.set(xChild.is() ? xChild->getParent() : Reference< XInterface >(),UNO_QUERY);
-	}
-	if ( xModi.is() )
-		xModi->setModified(_bModified);
-}
+    // =========================================================================
+    // -------------------------------------------------------------------------
+    void notifyDataSourceModified(const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _rxObject,sal_Bool _bModified)
+    {
+        Reference< XModifiable > xModi( getDataSource( _rxObject ), UNO_QUERY );
+	    if ( xModi.is() )
+		    xModi->setModified(_bModified);
+    }
+
+    // -------------------------------------------------------------------------
+    Reference< XInterface > getDataSource( const Reference< XInterface >& _rxDependentObject )
+    {
+	    Reference< XInterface > xParent = _rxDependentObject;
+	    Reference< XInterface > xReturn;
+	    while( xParent.is() )
+	    {
+		    xReturn = xParent;
+		    Reference<XChild> xChild(xParent,UNO_QUERY);
+		    xParent.set(xChild.is() ? xChild->getParent() : Reference< XInterface >(),UNO_QUERY);
+	    }
+        return xReturn;
+    }
+
 // -----------------------------------------------------------------------------
 //.........................................................................
 }	// namespace dbaccess
Index: dbaccess/source/core/resource/strings.src
===================================================================
RCS file: /cvs/dba/dbaccess/source/core/resource/strings.src,v
retrieving revision 1.45
retrieving revision 1.45.8.1
diff -u -p -u -p -r1.45 -r1.45.8.1
--- dbaccess/source/core/resource/strings.src	5 Jan 2005 12:29:52 -0000	1.45
+++ dbaccess/source/core/resource/strings.src	17 Jan 2005 14:47:37 -0000	1.45.8.1
@@ -245,4 +245,8 @@ String RID_STR_COLUMN_ALTER_BY_INDEX
 	Text [ de ] = "Der Treiber untersttzt das Verndern einer Spaltendefinition, anhand des Indexes, nicht.";
 	Text [ en-US ] = "The driver does not support the modification of column descriptions by changing the index.";
 };
-
+String RID_STR_FILE_DOES_NOT_EXIST
+{
+	Text [ de ] ="Die Datei \"$file$\" existiert nicht.";
+	Text[ en-US ] = "The file \"$file$\" does not exist.";
+};
Index: dbaccess/source/filter/migration/cfgimport.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/filter/migration/cfgimport.cxx,v
retrieving revision 1.4
retrieving revision 1.4.22.1
diff -u -p -u -p -r1.4 -r1.4.22.1
--- dbaccess/source/filter/migration/cfgimport.cxx	15 Nov 2004 15:17:53 -0000	1.4
+++ dbaccess/source/filter/migration/cfgimport.cxx	19 Jan 2005 09:09:57 -0000	1.4.22.1
@@ -609,7 +609,7 @@ void OCfgImport::createDataSource(const 
 	::rtl::OUString sFileName;
 	try
 	{
-		m_xCurrentDS.set(m_xORB->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.DatabaseDocument"))),UNO_QUERY);
+		m_xCurrentDS.set(m_xORB->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.OfficeDatabaseDocument"))),UNO_QUERY);
 		Reference< XModel > xModel(m_xCurrentDS,UNO_QUERY);
 		if ( !xModel.is() )
 			return;
Index: dbaccess/source/filter/xml/dbloader2.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/filter/xml/dbloader2.cxx,v
retrieving revision 1.6
retrieving revision 1.5.8.3
diff -u -p -u -p -r1.6 -r1.5.8.3
--- dbaccess/source/filter/xml/dbloader2.cxx	2 Feb 2005 14:00:07 -0000	1.6
+++ dbaccess/source/filter/xml/dbloader2.cxx	3 Feb 2005 13:09:39 -0000	1.5.8.3
@@ -98,6 +98,12 @@
 #ifndef _COM_SUN_STAR_BEANS_NAMEDVALUE_HPP_
 #include <com/sun/star/beans/NamedValue.hpp>
 #endif
+#ifndef _COM_SUN_STAR_BEANS_XPROPERTYSET_HPP_
+#include <com/sun/star/beans/XPropertySet.hpp>
+#endif
+#ifndef _COM_SUN_STAR_UI_DIALOGS_XEXECUTABLEDIALOG_HPP_
+#include <com/sun/star/ui/dialogs/XExecutableDialog.hpp>
+#endif
 #ifndef _COM_SUN_STAR_IO_XINPUTSTREAM_HPP_
 #include <com/sun/star/io/XInputStream.hpp>
 #endif
@@ -127,12 +133,12 @@
 #include <cppuhelper/implbase2.hxx>
 #endif
 #ifndef _FLT_REGHELPER_HXX_
-#include "flt_reghelper.hxx" 
+#include "flt_reghelper.hxx"
 #endif
 #ifndef _COM_SUN_STAR_LANG_XINITIALIZATION_HPP_
 #include <com/sun/star/lang/XInitialization.hpp>
 #endif
-#ifndef _SV_SVAPP_HXX 
+#ifndef _SV_SVAPP_HXX
 #include <vcl/svapp.hxx>
 #endif
 #ifndef _UCBHELPER_CONTENT_HXX
@@ -150,7 +156,7 @@
 #ifndef _OSL_FILE_HXX_
 #include <osl/file.hxx>
 #endif
-#ifndef _UCBHELPER_CONTENTBROKER_HXX 
+#ifndef _UCBHELPER_CONTENTBROKER_HXX
 #include <ucbhelper/contentbroker.hxx>
 #endif
 #ifndef _SFXDOCFILE_HXX //autogen wg. SfxMedium
@@ -165,6 +171,12 @@
 #ifndef _COMPHELPER_STLTYPES_HXX_
 #include <comphelper/stl_types.hxx>
 #endif
+#ifndef _COM_SUN_STAR_TASK_XJOBEXECUTOR_HPP_
+#include <com/sun/star/task/XJobExecutor.hpp>
+#endif
+#ifndef _SV_MSGBOX_HXX
+#include <vcl/msgbox.hxx>
+#endif
 
 using namespace ::ucb;
 using namespace ::com::sun::star::task;
@@ -177,6 +189,7 @@ using namespace ::com::sun::star::contai
 using namespace ::com::sun::star::lang;
 using namespace ::com::sun::star::document;
 using namespace ::com::sun::star::registry;
+using namespace ::com::sun::star::ui::dialogs;
 
 // -------------------------------------------------------------------------
 namespace dbaxml
@@ -191,7 +204,7 @@ public:
 	::rtl::OUString					SAL_CALL getImplementationName() throw(  );
 	sal_Bool 						SAL_CALL supportsService(const ::rtl::OUString& ServiceName) throw(  );
 	Sequence< ::rtl::OUString > 	SAL_CALL getSupportedServiceNames(void) throw(  );
-	
+
 	// static methods
 	static ::rtl::OUString 			getImplementationName_Static() throw(  )
 	{
@@ -275,6 +288,11 @@ private:
 	Reference< XLoadEventListener > 	m_xListener;
 	Reference< XFrame > 				m_xFrame;
 	Reference< XMultiServiceFactory >	m_xServiceFactory;
+	Reference< XFrameLoader >			m_xMySelf;
+	::rtl::OUString						m_sCurrentURL;
+	sal_Int32							m_nStartWizard;
+
+	DECL_LINK( OnStartTableWizard, void* );
 public:
 	DBContentLoader(const Reference< XMultiServiceFactory >&);
 	~DBContentLoader();
@@ -283,7 +301,7 @@ public:
 	::rtl::OUString					SAL_CALL getImplementationName() throw(  );
 	sal_Bool 						SAL_CALL supportsService(const ::rtl::OUString& ServiceName) throw(  );
 	Sequence< ::rtl::OUString > 	SAL_CALL getSupportedServiceNames(void) throw(  );
-	
+
 	// static methods
 	static ::rtl::OUString 			getImplementationName_Static() throw(  )
 	{
@@ -302,6 +320,7 @@ public:
 
 DBContentLoader::DBContentLoader(const Reference< XMultiServiceFactory >& _rxFactory)
 	:m_xServiceFactory(_rxFactory)
+	,m_nStartWizard(0)
 {
 }
 // -------------------------------------------------------------------------
@@ -385,7 +404,7 @@ void SAL_CALL DBContentLoader::load(cons
 	sal_Bool bCreateNew = sal_False;
 	sal_Bool bInteractive = sal_False;
 	if ( xDatabaseContext.is() )
-	{		
+	{
 		bCreateNew = rURL.match(SvtModuleOptions().GetFactoryEmptyDocumentURL(SvtModuleOptions::E_DATABASE));
 		Sequence<Any> aCreationArgs;
 		if ( !bCreateNew )
@@ -407,7 +426,7 @@ void SAL_CALL DBContentLoader::load(cons
 		{
 			// ich benutze nicht maURL, sondern rURL, denn zwischen dem Constructor und diesem Load hier kann sich die ::com::sun::star::util::URL des Objektes
 			// schon geaendert haben (zum Beispiel durch Umbenennen)
-			
+
 			m_aArgs.realloc(m_aArgs.getLength()+1);
 			m_aArgs[m_aArgs.getLength()-1].Name = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("FileName"));
 			m_aArgs[m_aArgs.getLength()-1].Value <<= rURL;
@@ -420,50 +439,94 @@ void SAL_CALL DBContentLoader::load(cons
 		}
 	}
 
-	Reference< XController >	xController(m_xServiceFactory->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("org.openoffice.comp.dbu.OApplicationController"))),UNO_QUERY);
+    sal_Bool bStartTableWizard = sal_False;
 
-	if ( bSuccess && (bSuccess = ( xController.is() && xModel.is() )) )
-	{
-		xController->attachModel(xModel);
-		xModel->connectController( xController );
-		xModel->setCurrentController(xController);
-		
-		::vos::OGuard aGuard(Application::GetSolarMutex());
+    if ( bInteractive )
+    {
+        Sequence< Any > aArgs(2);
+        Reference< ::com::sun::star::awt::XWindow> xWindow;
+	    // get the top most window
+	    if ( rFrame.is() )
+	    {
+		    xWindow = rFrame->getContainerWindow();
+		    Reference<XFrame> xFrame = rFrame;
+		    while ( xFrame.is() && !xFrame->isTop() )
+		    {
+			    xFrame.set(xFrame->getCreator(),UNO_QUERY);
+		    }
+		    if ( xFrame.is() )
+			    xWindow = xFrame->getContainerWindow();
+	    }
+	    // the parent window
+		aArgs[0] <<= PropertyValue( ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("ParentWindow")),
+									0,
+									makeAny(xWindow),
+									PropertyState_DIRECT_VALUE);
+        aArgs[1] <<= PropertyValue( ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("InitialSelection")),
+                                    0,
+                                    makeAny(xModel),
+                                    PropertyState_DIRECT_VALUE);
+
+		// create the dialog
+		Reference< XExecutableDialog > xAdminDialog(
+            m_xServiceFactory->createInstanceWithArguments(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.DatabaseWizardDialog")),aArgs), UNO_QUERY);
 
-		// and initialize
-		try
-		{
-			Reference<XInitialization > xIni(xController,UNO_QUERY);
-			PropertyValue aProp(::rtl::OUString::createFromAscii("Frame"),0,makeAny(rFrame),PropertyState_DIRECT_VALUE);
-			Sequence< Any > aArgs(m_aArgs.getLength() + 2);
-
-			Any* pArgIter = aArgs.getArray();
-			Any* pEnd	= pArgIter + aArgs.getLength();
-			*pArgIter++ <<= aProp;
-
-			aProp.Name = URL_INTERACTIVE;
-			aProp.Value <<= bInteractive;
-			*pArgIter++ <<= aProp;
-			
-			const PropertyValue* pIter		= m_aArgs.getConstArray();
-			for(++pArgIter;pArgIter != pEnd;++pArgIter,++pIter)
-			{
-				*pArgIter <<= *pIter;
-			}
-			
-			xIni->initialize(aArgs);
-		}
-		catch(Exception&)
-		{
-			bSuccess = sal_False;
-		}
-	}
+		// execute it
+		if ( bSuccess = xAdminDialog.is() && RET_OK == xAdminDialog->execute() )
+        {
+            Reference<XPropertySet> xProp(xAdminDialog,UNO_QUERY);
+            xProp->getPropertyValue(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("OpenDatabase"))) >>= bSuccess;
+            xProp->getPropertyValue(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("StartTableWizard"))) >>= bStartTableWizard;
+        }
+    }
+
+    Reference< XController > xController;
+    if ( bSuccess )
+    {
+	    xController.set(m_xServiceFactory->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("org.openoffice.comp.dbu.OApplicationController"))),UNO_QUERY);
+
+	    if ( bSuccess = ( xController.is() && xModel.is() ) )
+	    {
+		    xController->attachModel(xModel);
+		    xModel->connectController( xController );
+		    xModel->setCurrentController(xController);
+
+		    ::vos::OGuard aGuard(Application::GetSolarMutex());
+
+		    // and initialize
+		    try
+		    {
+			    Reference<XInitialization > xIni(xController,UNO_QUERY);
+			    PropertyValue aProp(::rtl::OUString::createFromAscii("Frame"),0,makeAny(rFrame),PropertyState_DIRECT_VALUE);
+			    Sequence< Any > aArgs(m_aArgs.getLength() + 2);
+
+			    Any* pArgIter = aArgs.getArray();
+			    Any* pEnd	= pArgIter + aArgs.getLength();
+			    *pArgIter++ <<= aProp;
+
+			    aProp.Name = URL_INTERACTIVE;
+			    aProp.Value <<= bInteractive;
+			    *pArgIter++ <<= aProp;
+
+			    const PropertyValue* pIter		= m_aArgs.getConstArray();
+			    for(++pArgIter;pArgIter != pEnd;++pArgIter,++pIter)
+			    {
+				    *pArgIter <<= *pIter;
+			    }
+
+			    xIni->initialize(aArgs);
+		    }
+		    catch(Exception&)
+		    {
+			    bSuccess = sal_False;
+		    }
+	    }
+    }
 
 	if (bSuccess && rListener.is())
 	{
 		if ( xController.is() && rFrame.is() )
 			xController->attachFrame(rFrame);
-
         try
         {
             Reference< ::com::sun::star::document::XEventListener > xDocEventBroadcaster(m_xServiceFactory->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.frame.GlobalEventBroadcaster"))),
@@ -478,7 +541,17 @@ void SAL_CALL DBContentLoader::load(cons
         {
             OSL_ENSURE(0,"Could not create GlobalEventBroadcaster!");
         }
-		rListener->loadFinished(this);        
+		rListener->loadFinished(this);
+
+		if ( bStartTableWizard )
+		{
+			// reset the data of the previous async drop (if any)
+			if ( m_nStartWizard )
+				Application::RemoveUserEvent(m_nStartWizard);
+			m_sCurrentURL = xModel->getURL();
+			m_xMySelf = this;
+			m_nStartWizard = Application::PostUserEvent(LINK(this, DBContentLoader, OnStartTableWizard));
+		}
 	}
 	else if (!bSuccess && rListener.is())
 		rListener->loadCancelled(this);
@@ -488,7 +561,31 @@ void SAL_CALL DBContentLoader::load(cons
 void DBContentLoader::cancel(void) throw()
 {
 }
+// -----------------------------------------------------------------------------
+IMPL_LINK( DBContentLoader, OnStartTableWizard, void*, NOTINTERESTEDIN )
+{
+	m_nStartWizard = 0;
+	try
+	{
+        Sequence< Any > aWizArgs(1);
+        PropertyValue aValue;
+        aValue.Name = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("DatabaseLocation"));
+        aValue.Value <<= m_sCurrentURL;
+		aWizArgs[0] <<= aValue;
 
+		::vos::OGuard aGuard(Application::GetSolarMutex());
+		Reference< XJobExecutor > xTableWizard(m_xServiceFactory->createInstanceWithArguments(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.wizards.table.CallTableWizard")),aWizArgs),UNO_QUERY);
+
+        if ( xTableWizard.is() )
+			xTableWizard->trigger(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("start")));
+	}
+	catch(const Exception&)
+	{
+		OSL_ENSURE(sal_False, "caught an exception while starting the table wizard!");
+	}
+	m_xMySelf = NULL;
+	return 0L;
+}
 }
 // -------------------------------------------------------------------------
 extern "C" void SAL_CALL createRegistryInfo_DBContentLoader2()
@@ -498,7 +595,7 @@ extern "C" void SAL_CALL createRegistryI
 // -------------------------------------------------------------------------
 extern "C" void SAL_CALL writeDBLoaderInfo2(void* pRegistryKey)
 {
-	Reference< XRegistryKey> xKey(reinterpret_cast< XRegistryKey*>(pRegistryKey)); 
+	Reference< XRegistryKey> xKey(reinterpret_cast< XRegistryKey*>(pRegistryKey));
 
 	// register content loader for dispatch
 	::rtl::OUString aImpl = ::rtl::OUString::createFromAscii("/");
@@ -513,3 +610,4 @@ extern "C" void SAL_CALL writeDBLoaderIn
 	xNewKey = xLoaderKey->createKey( ::rtl::OUString::createFromAscii("Pattern") );
 	xNewKey->setAsciiValue( ::rtl::OUString::createFromAscii("private:factory/sdatabase") );
 }
+// -----------------------------------------------------------------------------
Index: dbaccess/source/ui/app/AppController.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/app/AppController.cxx,v
retrieving revision 1.12
retrieving revision 1.11.6.2
diff -u -p -u -p -r1.12 -r1.11.6.2
--- dbaccess/source/ui/app/AppController.cxx	21 Jan 2005 17:05:05 -0000	1.12
+++ dbaccess/source/ui/app/AppController.cxx	3 Feb 2005 08:08:06 -0000	1.11.6.2
@@ -563,26 +563,29 @@ sal_Bool SAL_CALL OApplicationController
 {
     ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
     ::osl::MutexGuard aGuard(m_aMutex);
-	m_bSuspended = bSuspend;
-	if ( bSuspend && !suspendDocuments( bSuspend ))
-		return sal_False;
-
-	sal_Bool bCheck = sal_True;
-	Reference<XModifiable> xModi(m_xDataSource,UNO_QUERY);
-	if ( m_bCurrentlyModified || (xModi.is() && xModi->isModified()) )
-	{
-		switch (ExecuteQuerySaveDocument(getView(),getStrippedDatabaseName()))
-		{
-			case RET_YES:
-				Execute(ID_BROWSER_SAVEDOC,Sequence<PropertyValue>());
-				bCheck = !xModi->isModified(); // when we save the table this must be false else some press cancel
-				break;
-			case RET_CANCEL:
-				bCheck = sal_False;
-			default:
-				break;
-		}
-	}
+    sal_Bool bCheck = sal_True;
+    if ( m_bSuspended != bSuspend )
+    {
+	    m_bSuspended = bSuspend;
+	    if ( bSuspend && !suspendDocuments( bSuspend ))
+		    return sal_False;
+	    
+	    Reference<XModifiable> xModi(m_xDataSource,UNO_QUERY);
+	    if ( m_bCurrentlyModified || (xModi.is() && xModi->isModified()) )
+	    {
+		    switch (ExecuteQuerySaveDocument(getView(),getStrippedDatabaseName()))
+		    {
+			    case RET_YES:
+				    Execute(ID_BROWSER_SAVEDOC,Sequence<PropertyValue>());
+				    bCheck = !xModi->isModified(); // when we save the table this must be false else some press cancel
+				    break;
+			    case RET_CANCEL:
+				    bCheck = sal_False;
+			    default:
+				    break;
+		    }
+	    }
+    }
 
 	return bCheck;
 }
Index: dbaccess/source/ui/app/AppDetailView.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/app/AppDetailView.cxx,v
retrieving revision 1.6
retrieving revision 1.5.6.2
diff -u -p -u -p -r1.6 -r1.5.6.2
--- dbaccess/source/ui/app/AppDetailView.cxx	21 Jan 2005 17:06:53 -0000	1.6
+++ dbaccess/source/ui/app/AppDetailView.cxx	3 Feb 2005 08:09:19 -0000	1.5.6.2
@@ -262,7 +262,7 @@ void OTasksWindow::fillCreationNew( cons
 	try
 	{
 		Reference<XModuleUIConfigurationManagerSupplier> xModuleCfgMgrSupplier(getDetailView()->getBorderWin()->getView()->getORB()->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("drafts.com.sun.star.ui.ModuleUIConfigurationManagerSupplier"))),UNO_QUERY);
-		Reference<XUIConfigurationManager> xUIConfigMgr = xModuleCfgMgrSupplier->getUIConfigurationManager(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.DatabaseDocument")));
+		Reference<XUIConfigurationManager> xUIConfigMgr = xModuleCfgMgrSupplier->getUIConfigurationManager(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.OfficeDatabaseDocument")));
 		Reference<XImageManager> xImageMgr(xUIConfigMgr->getImageManager(),UNO_QUERY);
 
 		m_aHelpTextIds.reserve(_rList.size());
Index: dbaccess/source/ui/browser/genericcontroller.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/browser/genericcontroller.cxx,v
retrieving revision 1.60
retrieving revision 1.58.8.2
diff -u -p -u -p -r1.60 -r1.58.8.2
--- dbaccess/source/ui/browser/genericcontroller.cxx	9 Feb 2005 15:18:26 -0000	1.60
+++ dbaccess/source/ui/browser/genericcontroller.cxx	11 Feb 2005 10:10:40 -0000	1.58.8.2
@@ -1115,7 +1115,7 @@ namespace
 
 				// check which service we know ....
 				static const sal_Char* pTransTable[] = {
-					"com.sun.star.sdb.DatabaseDocument","sdatabase",
+					"com.sun.star.sdb.OfficeDatabaseDocument","sdatabase",
 					"com.sun.star.text.TextDocument",	"swriter",
 					"com.sun.star.sheet.SpreadsheetDocument", "scalc",
 					"com.sun.star.presentation.PresentationDocument", "simpress",
Index: dbaccess/source/ui/browser/unodatbr.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/browser/unodatbr.cxx,v
retrieving revision 1.165
retrieving revision 1.164.6.2
diff -u -p -u -p -r1.165 -r1.164.6.2
--- dbaccess/source/ui/browser/unodatbr.cxx	21 Jan 2005 17:09:34 -0000	1.165
+++ dbaccess/source/ui/browser/unodatbr.cxx	3 Feb 2005 08:10:49 -0000	1.164.6.2
@@ -766,6 +766,7 @@ sal_Bool SbaTableQueryBrowser::Initializ
 				switch(nType)
 				{
 					case DataType::BIT:
+                    case DataType::BOOLEAN:
 						aCurrentModelType = ::rtl::OUString::createFromAscii("CheckBox");
 						sPropertyName = PROPERTY_DEFAULTSTATE;
 						break;
@@ -810,7 +811,7 @@ sal_Bool SbaTableQueryBrowser::Initializ
 					aDefault = xColumn->getPropertyValue(PROPERTY_CONTROLDEFAULT);
 
 				// default value
-				if (nType == DataType::BIT)
+				if ( nType == DataType::BIT || nType == DataType::BOOLEAN )
 				{
 					if(bDefault && aDefault.hasValue())
 						aDefault <<= (comphelper::getString(aDefault).toInt32() == 0) ? (sal_Int16)STATE_NOCHECK : (sal_Int16)STATE_CHECK;
Index: dbaccess/source/ui/control/FieldDescControl.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/control/FieldDescControl.cxx,v
retrieving revision 1.37
retrieving revision 1.36.6.2
diff -u -p -u -p -r1.37 -r1.36.6.2
--- dbaccess/source/ui/control/FieldDescControl.cxx	21 Jan 2005 17:09:50 -0000	1.37
+++ dbaccess/source/ui/control/FieldDescControl.cxx	3 Feb 2005 08:10:59 -0000	1.36.6.2
@@ -479,7 +479,7 @@ void OFieldDescControl::CheckScrollBars(
 		nLastVisible = static_cast<sal_uInt16>((szOverallSize.Height() - CONTROL_SPACING_Y - nHScrollHeight) / (CONTROL_SPACING_Y + CONTROL_HEIGHT));
 	else
 		nLastVisible = static_cast<sal_uInt16>((szOverallSize.Height() - CONTROL_SPACING_Y) / (CONTROL_SPACING_Y + CONTROL_HEIGHT));
-	bNeedVScrollBar = nActive>nLastVisible;
+	bNeedVScrollBar = nActive > nLastVisible;
 
 	if (bNeedVScrollBar)
 	{
@@ -1634,6 +1634,7 @@ void OFieldDescControl::DisplayData(OFie
 				ActivateAggregate( tpFormat );
 				break;
 			case DataType::BIT:
+			case DataType::BOOLEAN:
 				DeactivateAggregate( tpTextLen );
 				DeactivateAggregate( tpFormat );
 				DeactivateAggregate( tpDefault );
Index: dbaccess/source/ui/control/toolboxcontroller.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/control/toolboxcontroller.cxx,v
retrieving revision 1.3
retrieving revision 1.3.44.1
diff -u -p -u -p -r1.3 -r1.3.44.1
--- dbaccess/source/ui/control/toolboxcontroller.cxx	22 Oct 2004 12:04:40 -0000	1.3
+++ dbaccess/source/ui/control/toolboxcontroller.cxx	19 Jan 2005 09:09:07 -0000	1.3.44.1
@@ -240,7 +240,7 @@ namespace dbaui
 			try
 			{
 				Reference<XModuleUIConfigurationManagerSupplier> xModuleCfgMgrSupplier(getServiceManager()->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("drafts.com.sun.star.ui.ModuleUIConfigurationManagerSupplier"))),UNO_QUERY);
-				Reference<XUIConfigurationManager> xUIConfigMgr = xModuleCfgMgrSupplier->getUIConfigurationManager(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.DatabaseDocument")));
+				Reference<XUIConfigurationManager> xUIConfigMgr = xModuleCfgMgrSupplier->getUIConfigurationManager(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.OfficeDatabaseDocument")));
 				Reference<XImageManager> xImageMgr(xUIConfigMgr->getImageManager(),UNO_QUERY);
 
 				
Index: dbaccess/source/ui/dlg/AutoControls_tmpl.hrc
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/dlg/AutoControls_tmpl.hrc,v
retrieving revision 1.2
retrieving revision 1.2.8.1
diff -u -p -u -p -r1.2 -r1.2.8.1
--- dbaccess/source/ui/dlg/AutoControls_tmpl.hrc	13 Jan 2005 19:04:48 -0000	1.2
+++ dbaccess/source/ui/dlg/AutoControls_tmpl.hrc	2 Feb 2005 14:02:15 -0000	1.2.8.1
@@ -180,7 +180,7 @@
  		Size = MAP_APPFONT ( BUTTON_WIDTH , BUTTON_HEIGHT ) ;                             	        \
   		HelpId = (AUTO_HID + 1);                                                        	        \
 		TabStop = TRUE ;                                                           		            \
-  		Text [ de ] = "Suchen" ;																    \
+  		Text [ de ] = "Durchsuchen" ;																    \
  		Text[ en-US ]  = "Browse";                                                                  \
 	};
 
Index: dbaccess/source/ui/dlg/dbwizsetup.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/dlg/dbwizsetup.cxx,v
retrieving revision 1.8
retrieving revision 1.7.6.2
diff -u -p -u -p -r1.8 -r1.7.6.2
--- dbaccess/source/ui/dlg/dbwizsetup.cxx	21 Jan 2005 17:15:01 -0000	1.8
+++ dbaccess/source/ui/dlg/dbwizsetup.cxx	3 Feb 2005 08:14:45 -0000	1.7.6.2
@@ -980,18 +980,15 @@ sal_Bool ODbTypeWizDialogSetup::SaveData
 					aArgs[nLen].Value <<= xHandler;
 				}
 				xStore->storeAsURL(sPath,aArgs);
-				xComponent->dispose();
+				
 				if (pFinalPage != NULL)
 				{
 					if (pFinalPage->IsDatabaseDocumentToBeRegistered())
 						RegisterDataSourceByLocation(sPath);
-					if (pFinalPage->IsDatabaseDocumentToBeOpened())
-						OpenDatabaseDocument(sPath);
 				}
 				else
 				{
 					RegisterDataSourceByLocation(sPath);
-					OpenDatabaseDocument(sPath);
 				}
     			return sal_True;
 			}
@@ -1011,8 +1008,16 @@ sal_Bool ODbTypeWizDialogSetup::SaveData
 	}
     return sal_False;
 }
-
-
+// -----------------------------------------------------------------------------
+sal_Bool ODbTypeWizDialogSetup::IsDatabaseDocumentToBeOpened()
+{
+    return (pFinalPage != NULL) ? pFinalPage->IsDatabaseDocumentToBeOpened() : sal_True;
+}
+// -----------------------------------------------------------------------------
+sal_Bool ODbTypeWizDialogSetup::IsTableWizardToBeStarted()
+{
+    return (pFinalPage != NULL) && pFinalPage->IsTableWizardToBeStarted();
+}
 //-------------------------------------------------------------------------
     void ODbTypeWizDialogSetup::CreateDatabase()
     {
@@ -1078,10 +1083,6 @@ sal_Bool ODbTypeWizDialogSetup::SaveData
     short ODbTypeWizDialogSetup::Execute()
     {
         short nResult = ModalDialog::Execute();
-
-        if ( RET_OK == nResult && pFinalPage != NULL && pFinalPage->IsTableWizardToBeStarted() )
-            StartTableWizard();
-
         return nResult;
     }
 
Index: dbaccess/source/ui/dlg/sqlmessage.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/dlg/sqlmessage.cxx,v
retrieving revision 1.17
retrieving revision 1.16.22.2
diff -u -p -u -p -r1.17 -r1.16.22.2
--- dbaccess/source/ui/dlg/sqlmessage.cxx	21 Jan 2005 17:16:05 -0000	1.17
+++ dbaccess/source/ui/dlg/sqlmessage.cxx	3 Feb 2005 08:15:34 -0000	1.16.22.2
@@ -230,7 +230,7 @@ OExceptionChainDialog::OExceptionChainDi
 			if ( pListEntry )
 				pListEntry->SetUserData( pUserData );
             else
-                delete pUserData;
+                delete (SQLExceptionInfo*)pUserData;
 		}
 	}
 
Index: dbaccess/source/ui/inc/dbwizsetup.hxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/inc/dbwizsetup.hxx,v
retrieving revision 1.3
retrieving revision 1.2.42.2
diff -u -p -u -p -r1.3 -r1.2.42.2
--- dbaccess/source/ui/inc/dbwizsetup.hxx	21 Jan 2005 17:18:56 -0000	1.3
+++ dbaccess/source/ui/inc/dbwizsetup.hxx	3 Feb 2005 08:18:27 -0000	1.2.42.2
@@ -171,6 +171,14 @@ public:
     virtual String  getStateDisplayName( WizardState _nState );
     virtual short Execute();
 
+    /** returns <TRUE/> if the database should be opened, otherwise <FALSE/>.
+    */
+    sal_Bool IsDatabaseDocumentToBeOpened();
+
+    /** returns <TRUE/> if the table wizard should be opened, otherwise <FALSE/>.
+    */
+    sal_Bool IsTableWizardToBeStarted();
+
 protected:
 	/// to override to create new pages
 	virtual TabPage*	createPage(WizardState _nState);
Index: dbaccess/source/ui/misc/RowSetDrop.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/misc/RowSetDrop.cxx,v
retrieving revision 1.7
retrieving revision 1.7.76.1
diff -u -p -u -p -r1.7 -r1.7.76.1
--- dbaccess/source/ui/misc/RowSetDrop.cxx	2 Aug 2004 16:05:33 -0000	1.7
+++ dbaccess/source/ui/misc/RowSetDrop.cxx	20 Jan 2005 16:53:46 -0000	1.7.76.1
@@ -254,6 +254,7 @@ sal_Bool ORowSetImportExport::insertNewR
 						aValue <<= m_xRow->getTimestamp(*aIter);
 						break;
 					case DataType::BIT:
+					case DataType::BOOLEAN:
 						aValue <<= m_xRow->getBoolean(*aIter);
 						break;
 					case DataType::TINYINT:
Index: dbaccess/source/ui/misc/UITools.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/misc/UITools.cxx,v
retrieving revision 1.54
retrieving revision 1.53.22.2
diff -u -p -u -p -r1.54 -r1.53.22.2
--- dbaccess/source/ui/misc/UITools.cxx	21 Jan 2005 17:19:59 -0000	1.54
+++ dbaccess/source/ui/misc/UITools.cxx	3 Feb 2005 08:19:00 -0000	1.53.22.2
@@ -760,6 +760,7 @@ void fillTypeInfo(	const Reference< ::co
 					aName = _rsTypeNames.GetToken(TYPE_DATETIME);
 					break;
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 					aName = _rsTypeNames.GetToken(TYPE_BOOL);
 					break;
 				case DataType::TINYINT:
Index: dbaccess/source/ui/querydesign/QueryDesignView.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/querydesign/QueryDesignView.cxx,v
retrieving revision 1.70
retrieving revision 1.70.44.3
diff -u -p -u -p -r1.70 -r1.70.44.3
--- dbaccess/source/ui/querydesign/QueryDesignView.cxx	22 Oct 2004 09:06:51 -0000	1.70
+++ dbaccess/source/ui/querydesign/QueryDesignView.cxx	20 Jan 2005 16:54:41 -0000	1.70.44.3
@@ -333,6 +333,7 @@ namespace
 					rNewValue = rValue;
 					break;
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 					{
 						if(xMetaData.is())
 						{
Index: dbaccess/source/ui/querydesign/TableFieldDescription.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/querydesign/TableFieldDescription.cxx,v
retrieving revision 1.5
retrieving revision 1.5.76.1
diff -u -p -u -p -r1.5 -r1.5.76.1
--- dbaccess/source/ui/querydesign/TableFieldDescription.cxx	2 Aug 2004 16:14:37 -0000	1.5
+++ dbaccess/source/ui/querydesign/TableFieldDescription.cxx	20 Jan 2005 16:54:42 -0000	1.5.76.1
@@ -211,6 +211,7 @@ sal_Bool OTableFieldDesc::IsNumericDataT
 	switch (m_eDataType)
 	{
 		case DataType::BIT:
+		case DataType::BOOLEAN:
 		case DataType::TINYINT:
 		case DataType::SMALLINT:
 		case DataType::INTEGER:
Index: dbaccess/source/ui/relationdesign/RelationController.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/relationdesign/RelationController.cxx,v
retrieving revision 1.37
retrieving revision 1.37.22.1
diff -u -p -u -p -r1.37 -r1.37.22.1
--- dbaccess/source/ui/relationdesign/RelationController.cxx	16 Nov 2004 14:33:02 -0000	1.37
+++ dbaccess/source/ui/relationdesign/RelationController.cxx	20 Jan 2005 16:28:45 -0000	1.37.22.1
@@ -296,7 +296,6 @@ void ORelationController::Execute(sal_uI
 						if ( haveDataSource() && getDataSource()->getPropertySetInfo()->hasPropertyByName(PROPERTY_LAYOUTINFORMATION) )
 						{
 							Sequence<PropertyValue> aWindows;
-							getDataSource()->getPropertyValue(PROPERTY_LAYOUTINFORMATION) >>= aWindows;
 							saveTableWindows(aWindows);
 							getDataSource()->setPropertyValue(PROPERTY_LAYOUTINFORMATION,makeAny(aWindows));
 							setModified(sal_False);
Index: dbaccess/source/ui/tabledesign/TEditControl.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/tabledesign/TEditControl.cxx,v
retrieving revision 1.40
retrieving revision 1.40.8.1
diff -u -p -u -p -r1.40 -r1.40.8.1
--- dbaccess/source/ui/tabledesign/TEditControl.cxx	5 Jan 2005 12:37:31 -0000	1.40
+++ dbaccess/source/ui/tabledesign/TEditControl.cxx	14 Jan 2005 14:47:16 -0000	1.40.8.1
@@ -190,7 +190,7 @@ DBG_NAME(OTableEditorCtrl);
 
 //==================================================================
 //------------------------------------------------------------------
-OTableEditorCtrl::ClipboardInvalidator::ClipboardInvalidator(sal_uInt32 nTimeout,OTableEditorCtrl* _pOwner)
+OTableEditorCtrl::ClipboardInvalidator::ClipboardInvalidator(ULONG nTimeout,OTableEditorCtrl* _pOwner)
 : m_pOwner(_pOwner)
 {
 	m_aInvalidateTimer.SetTimeout(nTimeout);
@@ -1309,7 +1309,7 @@ String OTableEditorCtrl::GetCellText( lo
 }
 
 //------------------------------------------------------------------------------
-sal_uInt32 OTableEditorCtrl::GetTotalCellWidth(long nRow, sal_uInt16 nColId)
+ULONG OTableEditorCtrl::GetTotalCellWidth(long nRow, sal_uInt16 nColId)
 {
 	DBG_CHKTHIS(OTableEditorCtrl,NULL);
 	return GetTextWidth(GetCellText(nRow, nColId)) + 2 * GetTextWidth('0');
Index: dbaccess/source/ui/uno/CallDBTypeWizDlgSetup.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/uno/CallDBTypeWizDlgSetup.cxx,v
retrieving revision 1.2
retrieving revision 1.2.42.1
diff -u -p -u -p -r1.2 -r1.2.42.1
--- dbaccess/source/ui/uno/CallDBTypeWizDlgSetup.cxx	27 Oct 2004 13:08:02 -0000	1.2
+++ dbaccess/source/ui/uno/CallDBTypeWizDlgSetup.cxx	19 Jan 2005 09:01:13 -0000	1.2.42.1
@@ -130,7 +130,7 @@ Reference< XInterface > SAL_CALL OCallDB
 //------------------------------------------------------------------------------
 void SAL_CALL OCallDBTypeWizDialogSetup::trigger( const ::rtl::OUString& _rEvent ) throw (::com::sun::star::uno::RuntimeException)
 {
-    Reference < XInterface > xDBContext = m_xORB->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.DatabaseDocument")));
+    Reference < XInterface > xDBContext = m_xORB->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.OfficeDatabaseDocument")));
    	Sequence<Any> aSequence(1);
 	PropertyValue aPropertyValue;
     Any aTmp;
Index: dbaccess/source/ui/uno/DBTypeWizDlgSetup.cxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/uno/DBTypeWizDlgSetup.cxx,v
retrieving revision 1.3
retrieving revision 1.2.42.3
diff -u -p -u -p -r1.3 -r1.2.42.3
--- dbaccess/source/ui/uno/DBTypeWizDlgSetup.cxx	2 Feb 2005 14:00:23 -0000	1.3
+++ dbaccess/source/ui/uno/DBTypeWizDlgSetup.cxx	3 Feb 2005 13:06:45 -0000	1.2.42.3
@@ -71,6 +71,9 @@
 #ifndef DBAUI_DBWIZSETUP_HXX
 #include "dbwizsetup.hxx"
 #endif
+#ifndef _SV_MSGBOX_HXX
+#include <vcl/msgbox.hxx>
+#endif
 
 using namespace dbaui;
                          
@@ -92,7 +95,14 @@ namespace dbaui
 //-------------------------------------------------------------------------
 ODBTypeWizDialogSetup::ODBTypeWizDialogSetup(const Reference< XMultiServiceFactory >& _rxORB)
 	:ODatabaseAdministrationDialog(_rxORB)
+    ,m_bOpenDatabase(sal_True)
+	,m_bStartTableWizard(sal_False)
 {
+    registerProperty(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("OpenDatabase")), 3, PropertyAttribute::TRANSIENT,
+		&m_bOpenDatabase, getBooleanCppuType());
+
+    registerProperty(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("StartTableWizard")), 4, PropertyAttribute::TRANSIENT,
+		&m_bStartTableWizard, getBooleanCppuType());
 }
 //-------------------------------------------------------------------------
 Sequence<sal_Int8> SAL_CALL ODBTypeWizDialogSetup::getImplementationId(  ) throw(RuntimeException)
@@ -165,8 +175,7 @@ Reference< XInterface > SAL_CALL ODBType
 //-------------------------------------------------------------------------
 Reference<XPropertySetInfo>  SAL_CALL ODBTypeWizDialogSetup::getPropertySetInfo() throw(RuntimeException)
 {
-	Reference<XPropertySetInfo>  xInfo( createPropertySetInfo( getInfoHelper() ) );
-	return xInfo;
+	return createPropertySetInfo( getInfoHelper() );
 }
 
 //-------------------------------------------------------------------------
@@ -185,8 +194,16 @@ Reference<XPropertySetInfo>  SAL_CALL OD
 //------------------------------------------------------------------------------
 Dialog*	ODBTypeWizDialogSetup::createDialog(Window* _pParent)
 {
-	ODbTypeWizDialogSetup* pDlg = new ODbTypeWizDialogSetup(_pParent, m_pDatasourceItems, m_xORB, m_aInitialSelection);
-	return pDlg;
+	return new ODbTypeWizDialogSetup(_pParent, m_pDatasourceItems, m_xORB, m_aInitialSelection);
+}
+// -----------------------------------------------------------------------------
+void ODBTypeWizDialogSetup::executedDialog(sal_Int16 _nExecutionResult)
+{
+    if ( _nExecutionResult == RET_OK )
+    {
+        m_bOpenDatabase = static_cast<ODbTypeWizDialogSetup*>(m_pDialog)->IsDatabaseDocumentToBeOpened();
+        m_bStartTableWizard = static_cast<ODbTypeWizDialogSetup*>(m_pDialog)->IsTableWizardToBeStarted();
+    }
 }
 
 //.........................................................................
Index: dbaccess/source/ui/uno/DBTypeWizDlgSetup.hxx
===================================================================
RCS file: /cvs/dba/dbaccess/source/ui/uno/DBTypeWizDlgSetup.hxx,v
retrieving revision 1.2
retrieving revision 1.2.42.1
diff -u -p -u -p -r1.2 -r1.2.42.1
--- dbaccess/source/ui/uno/DBTypeWizDlgSetup.hxx	27 Oct 2004 13:10:17 -0000	1.2
+++ dbaccess/source/ui/uno/DBTypeWizDlgSetup.hxx	20 Jan 2005 16:55:09 -0000	1.2.42.1
@@ -77,7 +77,8 @@ class ODBTypeWizDialogSetup
 		:public ODatabaseAdministrationDialog
 		,public ::comphelper::OPropertyArrayUsageHelper< ODBTypeWizDialogSetup >
 {
-
+    sal_Bool m_bOpenDatabase;
+    sal_Bool m_bStartTableWizard;
 protected:
 	ODBTypeWizDialogSetup(const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& _rxORB);
 
@@ -104,6 +105,7 @@ public:
 protected:
 // OGenericUnoDialog overridables
 	virtual Dialog*	createDialog(Window* _pParent);
+    virtual void executedDialog(sal_Int16 _nExecutionResult);
 };
 
 //.........................................................................
Index: dbaccess/uiconfig/dbquery/toolbar/toolbar.xml
===================================================================
RCS file: /cvs/dba/dbaccess/uiconfig/dbquery/toolbar/toolbar.xml,v
retrieving revision 1.4
retrieving revision 1.4.18.1
diff -u -p -u -p -r1.4 -r1.4.18.1
--- dbaccess/uiconfig/dbquery/toolbar/toolbar.xml	26 Nov 2004 20:15:18 -0000	1.4
+++ dbaccess/uiconfig/dbquery/toolbar/toolbar.xml	13 Jan 2005 10:14:55 -0000	1.4.18.1
@@ -17,6 +17,4 @@
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:SbaExecuteSql" toolbar:helpid="helpid:10721" toolbar:text="" />
  <toolbar:toolbaritem xlink:href=".uno:DBClearQuery" toolbar:helpid="helpid:12295" toolbar:text="" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:SbaNativeSql" toolbar:helpid="helpid:10720" toolbar:text="" toolbar:style="" />
 </toolbar:toolbar>
\ No newline at end of file
Index: extensions/source/bibliography/datman.cxx
===================================================================
RCS file: /cvs/util/extensions/source/bibliography/datman.cxx,v
retrieving revision 1.36
retrieving revision 1.36.14.1
diff -u -p -u -p -r1.36 -r1.36.14.1
--- extensions/source/bibliography/datman.cxx	5 Jan 2005 12:41:35 -0000	1.36
+++ extensions/source/bibliography/datman.cxx	21 Jan 2005 06:30:31 -0000	1.36.14.1
@@ -1015,6 +1015,7 @@ void BibDataManager::InsertFields(const 
 			switch(nType)
 			{
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 					sCurrentModelType = C2U("CheckBox");
 					break;
 
@@ -1595,6 +1596,7 @@ rtl::OUString BibDataManager::getControl
 	switch (nFormatKey)
 	{
 		case DataType::BIT:
+		case DataType::BOOLEAN:
 			aResStr=C2U("CheckBox");
 			break;
 		case DataType::TINYINT:
Index: extensions/source/dbpilots/controlwizard.cxx
===================================================================
RCS file: /cvs/util/extensions/source/dbpilots/controlwizard.cxx,v
retrieving revision 1.14
retrieving revision 1.14.14.1
diff -u -p -u -p -r1.14 -r1.14.14.1
--- extensions/source/dbpilots/controlwizard.cxx	5 Jan 2005 12:42:27 -0000	1.14
+++ extensions/source/dbpilots/controlwizard.cxx	17 Jan 2005 15:11:09 -0000	1.14.14.1
@@ -645,7 +645,7 @@ namespace dbp
 				// calculate the connection the rowset is working with
 				Reference< XConnection > xConnection;
 				if ( !(m_aContext.bEmbedded = ::dbtools::isEmbeddedInDatabase(m_aContext.xForm,xConnection)) )
-					xConnection = ::dbtools::calcConnection(m_aContext.xRowSet, getServiceFactory());
+                    xConnection = ::dbtools::connectRowset( m_aContext.xRowSet, getServiceFactory(), sal_True );
 
 				// get the fields
 				if (xConnection.is())
Index: extensions/source/dbpilots/gridwizard.cxx
===================================================================
RCS file: /cvs/util/extensions/source/dbpilots/gridwizard.cxx,v
retrieving revision 1.11
retrieving revision 1.11.34.1
diff -u -p -u -p -r1.11 -r1.11.34.1
--- extensions/source/dbpilots/gridwizard.cxx	16 Nov 2004 11:59:04 -0000	1.11
+++ extensions/source/dbpilots/gridwizard.cxx	21 Jan 2005 06:30:31 -0000	1.11.34.1
@@ -191,6 +191,7 @@ namespace dbp
 			switch (nFieldType)
 			{
 				case DataType::BIT:
+				case DataType::BOOLEAN:
 					aColumnServiceNames.push_back(::rtl::OUString::createFromAscii("CheckBox"));
 					aColumnLabelPostfixes.push_back(s_sEmptyString);
 					break;
Index: extensions/source/propctrlr/formcontroller.cxx
===================================================================
RCS file: /cvs/util/extensions/source/propctrlr/formcontroller.cxx,v
retrieving revision 1.82
retrieving revision 1.81.10.5
diff -u -p -u -p -r1.82 -r1.81.10.5
--- extensions/source/propctrlr/formcontroller.cxx	21 Jan 2005 17:25:21 -0000	1.82
+++ extensions/source/propctrlr/formcontroller.cxx	26 Jan 2005 12:04:58 -0000	1.81.10.5
@@ -921,10 +921,10 @@ class EventsNameReplace_Impl:
 	//------------------------------------------------------------------------
 	void OPropertyBrowserController::cleanupRowsetConnection()
 	{
-		Reference< XComponent > xConnComp( m_xRowsetConnection, UNO_QUERY );
+		Reference< XComponent > xConnComp( m_xOwnedRowsetConnection, UNO_QUERY );
 		if ( xConnComp.is() )
 			xConnComp->dispose();
-		m_xRowsetConnection.clear();
+		m_xOwnedRowsetConnection.clear();
 	}
 
 	//------------------------------------------------------------------------
@@ -939,14 +939,10 @@ class EventsNameReplace_Impl:
 			// get it's current active connection
 			xProps->getPropertyValue( PROPERTY_ACTIVE_CONNECTION ) >>= xReturn;
 			// do we need to connect?
-			if ( !xReturn.is() )
+            if ( !xReturn.is() && !::dbtools::isEmbeddedInDatabase( getRowSet(), xReturn ) && connectRowset() )
 			{
-                if ( !::dbtools::isEmbeddedInDatabase( getRowSet(), xReturn ) )
-                {
-				    connectRowset( );
-				    // get the property again
-				    xProps->getPropertyValue( PROPERTY_ACTIVE_CONNECTION ) >>= xReturn;
-                }
+                // get the property again
+                xProps->getPropertyValue( PROPERTY_ACTIVE_CONNECTION ) >>= xReturn;
 			}
 		}
 
@@ -977,12 +973,12 @@ class EventsNameReplace_Impl:
 	}
 
 	//------------------------------------------------------------------------
-	void OPropertyBrowserController::connectRowset()
+	bool OPropertyBrowserController::connectRowset()
 	{
 		// if we have an own previous connection, dispose it
 		cleanupRowsetConnection();
 
-		SQLExceptionInfo aErrorInfo;
+		SQLExceptionInfo aError;
 		try
 		{
 			// the rowset
@@ -1011,16 +1007,17 @@ class EventsNameReplace_Impl:
 
 					// remember for later disposal
 					// (we opened the connection, thus we own it)
-					m_xRowsetConnection = xConnection;
+					m_xOwnedRowsetConnection = xConnection;
 				}
 			}
 		}
-		catch (SQLContext& e) { aErrorInfo = e; }
-		catch (SQLWarning& e) { aErrorInfo = e; }
-		catch (SQLException& e) { aErrorInfo = e; }
+		catch (SQLContext& e) { aError = e; }
+		catch (SQLWarning& e) { aError = e; }
+		catch (SQLException& e) { aError = e; }
+		catch (WrappedTargetException& e ) { aError = SQLExceptionInfo( e.TargetException ); }
 		catch (Exception&) { }
 
-		if (aErrorInfo.isValid() && haveView())
+		if ( aError.isValid() && haveView() )
 		{
 			::rtl::OUString sDataSourceName;
 			try
@@ -1039,9 +1036,11 @@ class EventsNameReplace_Impl:
 
 			SQLContext aContext;
 			aContext.Message = sInfo;
-			aContext.NextException = aErrorInfo.get();
+			aContext.NextException = aError.get();
 			showError( aContext, VCLUnoHelper::GetInterface( m_pView ), m_xORB);
 		}
+
+        return isRowsetConnected();
 	}
 
 	//------------------------------------------------------------------------
@@ -1070,14 +1069,8 @@ class EventsNameReplace_Impl:
 			if ( _bInit )
 				aProperty.sValue = GetPropertyValueStringRep( PROPERTY_COMMAND );
 
-			if ( _bConnect)
-				connectRowset();
-
 			////////////////////////////////////////////////////////////
-			// Enums setzen
-
-			sal_Bool bFailedToConnect = _bConnect && !haveRowsetConnection();
-			if ( !bFailedToConnect )
+            if ( _bConnect ? connectRowset() : isRowsetConnected() )
 			{
                 sal_Int32 nCommandType = CommandType::COMMAND;
                 GetUnoPropertyValue( PROPERTY_COMMANDTYPE ) >>= nCommandType;
@@ -1107,10 +1100,10 @@ class EventsNameReplace_Impl:
 		}
 	}
 	//------------------------------------------------------------------------
-	sal_Bool OPropertyBrowserController::haveRowsetConnection( ) const
+	bool OPropertyBrowserController::isRowsetConnected( ) const
 	{
-		Reference< XConnection > xConnection = m_xRowsetConnection;
-		Reference< XPropertySet > xProps( getRowSet(), UNO_QUERY );
+		Reference< XConnection > xConnection;
+        Reference< XPropertySet > xProps( getRowSet(), UNO_QUERY );
 		if ( xProps.is() )
 			xProps->getPropertyValue( PROPERTY_ACTIVE_CONNECTION ) >>= xConnection;
         if ( !xConnection.is() )
@@ -2970,7 +2963,7 @@ class EventsNameReplace_Impl:
 					::rtl::OUString sDataSource;
 					aValue >>= sDataSource;
 					Reference< XNameAccess > xDatabaseContext(m_xORB->createInstance(SERVICE_DATABASE_CONTEXT), UNO_QUERY);
-					if ( !xDatabaseContext.is() || !xDatabaseContext->hasByName(sDataSource) )
+					if ( sDataSource.getLength() && ( !xDatabaseContext.is() || !xDatabaseContext->hasByName(sDataSource) ) )
 					{
 						::svt::OFileNotation aTransformer(sDataSource);
 						sDataSource = aTransformer.get(::svt::OFileNotation::N_URL);
@@ -2984,11 +2977,7 @@ class EventsNameReplace_Impl:
 					m_xPropStateAccess->setPropertyToDefault(rName);
 				}
 
-				// try to open a connection for the new data source. Needed for filling the table list etc., but the methods doing this
-				// don't display errors, and we want to have an error message.
-				connectRowset();
-
-				SetCursorSource( sal_False, sal_True );
+				SetCursorSource( sal_True, sal_True );
 				SetListSource();
 			}
             break;
@@ -3562,7 +3551,7 @@ class EventsNameReplace_Impl:
 
             bIsEnabled = ( nIntValue == CommandType::COMMAND )
                       && ( bBoolValue )
-                      && (  haveRowsetConnection()
+                      && (  isRowsetConnected()
                          || isValidDataSourceName( GetPropertyValueStringRep( PROPERTY_DATASOURCE ) )
                          );
 
Index: extensions/source/propctrlr/propcontroller.hxx
===================================================================
RCS file: /cvs/util/extensions/source/propctrlr/propcontroller.hxx,v
retrieving revision 1.23
retrieving revision 1.23.30.1
diff -u -p -u -p -r1.23 -r1.23.30.1
--- extensions/source/propctrlr/propcontroller.hxx	26 Nov 2004 18:27:01 -0000	1.23
+++ extensions/source/propctrlr/propcontroller.hxx	17 Jan 2005 15:11:59 -0000	1.23.30.1
@@ -218,8 +218,10 @@ namespace pcr
 		::com::sun::star::uno::Reference< ::com::sun::star::awt::XWindow >
 							m_xView;
 
+        /** if we connect the rowset ourself, we own the connection, and are responsible for it
+        */
 		::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection >
-							m_xRowsetConnection;
+							m_xOwnedRowsetConnection;
 
         // <properties>
 		::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >
@@ -467,9 +469,9 @@ namespace pcr
 		void SetStringSeq(const ::com::sun::star::beans::Property& rProperty, OLineDescriptor& _rUIData);
 
 
-		void		connectRowset();
+		bool        connectRowset();
 		void		cleanupRowsetConnection();
-		sal_Bool	haveRowsetConnection( ) const;
+		bool        isRowsetConnected( ) const;
 
 		::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection >
 					ensureRowsetConnection();
Index: filter/source/config/fragments/filters/StarOffice_XML__Base_.xcu
===================================================================
RCS file: /cvs/framework/filter/source/config/fragments/filters/StarOffice_XML__Base_.xcu,v
retrieving revision 1.4
retrieving revision 1.4.38.1
diff -u -p -u -p -r1.4 -r1.4.38.1
--- filter/source/config/fragments/filters/StarOffice_XML__Base_.xcu	26 Nov 2004 21:33:28 -0000	1.4
+++ filter/source/config/fragments/filters/StarOffice_XML__Base_.xcu	19 Jan 2005 09:53:02 -0000	1.4.38.1
@@ -1,7 +1,7 @@
 	<node oor:name="StarOffice XML (Base)" oor:op="replace">
 		<prop oor:name="FileFormatVersion"><value>6200</value></prop>
 		<prop oor:name="Type"><value>StarBase</value></prop>
-		<prop oor:name="DocumentService"><value>com.sun.star.sdb.DatabaseDocument</value></prop>
+		<prop oor:name="DocumentService"><value>com.sun.star.sdb.OfficeDatabaseDocument</value></prop>
 		<prop oor:name="UIComponent"/>
 		<prop oor:name="UserData"/>
 		<prop oor:name="FilterService"/>
Index: svtools/inc/roadmap.hxx
===================================================================
RCS file: /cvs/util/svtools/inc/roadmap.hxx,v
retrieving revision 1.4
retrieving revision 1.4.50.1
diff -u -p -u -p -r1.4 -r1.4.50.1
--- svtools/inc/roadmap.hxx	26 Nov 2004 20:39:57 -0000	1.4
+++ svtools/inc/roadmap.hxx	10 Jan 2005 11:42:44 -0000	1.4.50.1
@@ -102,7 +102,7 @@ namespace svt
 		virtual void	DataChanged( const DataChangedEvent& rDCEvt );
 	};
 
-	class ORoadmapHyperLabel : public RoadmapTypes, public OutputDevice
+	class ORoadmapHyperLabel : public RoadmapTypes
 	{
 	private:
 		ORoadmapIDHyperLabel* mpIDLabel;
@@ -144,7 +144,6 @@ namespace svt
 
 		HyperLabel*				GetDescriptionHyperLabel() const { return mpDescHyperLabel;};
 		void					SetDescriptionHyperLabel(HyperLabel* _pDescriptionHyperLabel){mpDescHyperLabel = _pDescriptionHyperLabel;};
-
 	};
 
 
@@ -193,6 +192,7 @@ namespace svt
         void            SetItemSelectHdl( const Link& _rHdl );
         Link            GetItemSelectHdl( ) const;
 		virtual void	DataChanged( const DataChangedEvent& rDCEvt );
+        virtual void    GetFocus();
 
 
     protected:
Index: svtools/inc/roadmapwizard.hxx
===================================================================
RCS file: /cvs/util/svtools/inc/roadmapwizard.hxx,v
retrieving revision 1.5
retrieving revision 1.5.50.1
diff -u -p -u -p -r1.5 -r1.5.50.1
--- svtools/inc/roadmapwizard.hxx	26 Nov 2004 20:40:13 -0000	1.5
+++ svtools/inc/roadmapwizard.hxx	7 Jan 2005 15:50:35 -0000	1.5.50.1
@@ -103,9 +103,7 @@ namespace svt
     class RoadmapWizard : public OWizardMachine, public RoadmapWizardTypes
 	{
     private:
-        RoadmapWizardImpl*
-                m_pImpl;
-        void			ResizeFixedLine( );
+        RoadmapWizardImpl*  m_pImpl;
 
     public:
 		RoadmapWizard( Window* _pParent, const ResId& _rRes, sal_uInt32 _nButtonFlags,
@@ -230,6 +228,9 @@ namespace svt
 #endif
 
     private:
+        void ResizeFixedLine();
+
+    private:
         DECL_LINK( OnRoadmapItemSelected, void* );
 
         /** inserts an entry for the given state into the roadmap, at the given index
Index: svtools/source/config/colorcfg.cxx
===================================================================
RCS file: /cvs/util/svtools/source/config/colorcfg.cxx,v
retrieving revision 1.6
retrieving revision 1.6.238.1
diff -u -p -u -p -r1.6 -r1.6.238.1
--- svtools/source/config/colorcfg.cxx	25 Jun 2004 17:24:09 -0000	1.6
+++ svtools/source/config/colorcfg.cxx	19 Jan 2005 08:03:09 -0000	1.6.238.1
@@ -302,17 +302,19 @@ ColorConfig_Impl::~ColorConfig_Impl()
 // -----------------------------------------------------------------------------
 void ColorConfig_Impl::DisableBroadcast()
 {
-	ColorConfig::m_pImpl->m_bIsBroadcastEnabled = sal_False;
+    if ( ColorConfig::m_pImpl )
+	    ColorConfig::m_pImpl->m_bIsBroadcastEnabled = sal_False;
 }
 // -----------------------------------------------------------------------------
 void ColorConfig_Impl::EnableBroadcast()
 {
-	ColorConfig::m_pImpl->m_bIsBroadcastEnabled = sal_True;
+    if ( ColorConfig::m_pImpl )
+	    ColorConfig::m_pImpl->m_bIsBroadcastEnabled = sal_True;
 }
 // -----------------------------------------------------------------------------
 sal_Bool ColorConfig_Impl::IsEnableBroadcast() 
 { 
-	return ColorConfig::m_pImpl->m_bIsBroadcastEnabled; 
+    return ColorConfig::m_pImpl ? ColorConfig::m_pImpl->m_bIsBroadcastEnabled : sal_False;
 }
 /* -----------------------------22.03.2002 14:38------------------------------
 
Index: svtools/source/config/moduleoptions.cxx
===================================================================
RCS file: /cvs/util/svtools/source/config/moduleoptions.cxx,v
retrieving revision 1.22
retrieving revision 1.22.54.1
diff -u -p -u -p -r1.22 -r1.22.54.1
--- svtools/source/config/moduleoptions.cxx	16 Nov 2004 16:08:33 -0000	1.22
+++ svtools/source/config/moduleoptions.cxx	19 Jan 2005 09:11:59 -0000	1.22.54.1
@@ -180,7 +180,7 @@ namespace css = ::com::sun::star;
 #define FACTORYNAME_IMPRESS                 ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.presentation.PresentationDocument"))
 #define FACTORYNAME_MATH                    ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.formula.FormulaProperties"        ))
 #define FACTORYNAME_CHART                   ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.chart.ChartDocument"              ))
-#define FACTORYNAME_DATABASE                ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.DatabaseDocument"             ))
+#define FACTORYNAME_DATABASE                ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.sdb.OfficeDatabaseDocument"       ))
 #define FACTORYNAME_STARTMODULE             ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.frame.StartModule"                ))
 
 #define FACTORYCOUNT                        10
Index: svtools/source/control/hyperlabel.cxx
===================================================================
RCS file: /cvs/util/svtools/source/control/hyperlabel.cxx,v
retrieving revision 1.5
retrieving revision 1.4.50.2
diff -u -p -u -p -r1.5 -r1.4.50.2
--- svtools/source/control/hyperlabel.cxx	31 Jan 2005 09:25:36 -0000	1.5
+++ svtools/source/control/hyperlabel.cxx	11 Feb 2005 13:05:39 -0000	1.4.50.2
@@ -121,14 +121,14 @@ namespace svt
 
 	HyperLabel::HyperLabel( Window* _pParent, const ResId& _rId )
 		:FixedText( _pParent, _rId )
-		,m_pImpl( NULL )
+		,m_pImpl( new HyperLabelImpl )
 	{
 		implInit(_pParent);
 	}
     
     HyperLabel::HyperLabel( Window* _pParent, WinBits _nWinStyle )
 		:FixedText( _pParent, _nWinStyle )
-		,m_pImpl( NULL )
+		,m_pImpl( new HyperLabelImpl )
 	{
 		implInit(_pParent);
 	}
@@ -173,7 +173,6 @@ namespace svt
 	void HyperLabel::implInit(Window* _pParent)
 	{
 		const StyleSettings& rStyleSettings = GetSettings().GetStyleSettings();
-		m_pImpl = new HyperLabelImpl;
         ToggleBackgroundColor( COL_TRANSPARENT );
 
         WinBits nWinStyle = GetStyle();
Index: svtools/source/control/roadmap.cxx
===================================================================
RCS file: /cvs/util/svtools/source/control/roadmap.cxx,v
retrieving revision 1.5
retrieving revision 1.5.50.2
diff -u -p -u -p -r1.5 -r1.5.50.2
--- svtools/source/control/roadmap.cxx	26 Nov 2004 20:40:46 -0000	1.5
+++ svtools/source/control/roadmap.cxx	24 Jan 2005 07:36:17 -0000	1.5.50.2
@@ -82,6 +82,7 @@
 #ifndef _RTL_USTRING_HXX_
 #include <rtl/OUString.hxx>
 #endif
+#include <memory>
 
 #define RMENTRYPOINT_X      4
 #define RMENTRYPOINT_Y      27
@@ -252,6 +253,7 @@ namespace svt
         if ( ! m_pImpl->isComplete() )
             delete m_pImpl->InCompleteHyperLabel;
 		delete m_pImpl;
+        m_pImpl = NULL;
     }
 
 
@@ -292,16 +294,7 @@ namespace svt
 
         if (_RMID != RMINCOMPLETE )
         {
-            if (_Index == 0)
-			{
-                CurHyperLabel = new ORoadmapHyperLabel(this, WB_TABSTOP | WB_WORDBREAK);     //WB_GROUP | 
-                CurHyperLabel->SetZOrder( NULL, WINDOW_ZORDER_FIRST );
-            }
-            else
-            {
-                CurHyperLabel = new ORoadmapHyperLabel(this, WB_TABSTOP | WB_WORDBREAK);
-                CurHyperLabel->SetZOrder( OldHyperLabel, WINDOW_ZORDER_BEHIND );
-            }    
+            CurHyperLabel = new ORoadmapHyperLabel(this, WB_WORDBREAK);
             CurHyperLabel->SetInteractive( m_pImpl->isInteractive() );
             m_pImpl->insertHyperLabel(_Index, CurHyperLabel );
         }
@@ -613,6 +606,14 @@ namespace svt
         CallEventListeners( VCLEVENT_ROADMAP_ITEMSELECTED );
     }
 
+    //---------------------------------------------------------------------
+    void ORoadmap::GetFocus()
+	{        
+        ORoadmapHyperLabel* pCurHyperLabel = GetByID( GetCurrentRoadmapItemID() );
+        if ( pCurHyperLabel != NULL )
+		    pCurHyperLabel->GrabFocus();		
+	}
+
 	//---------------------------------------------------------------------
     sal_Bool ORoadmap::SelectRoadmapItemByID( ItemId _nNewID )
     {
@@ -753,58 +754,67 @@ namespace svt
 
 
 	ORoadmapHyperLabel::ORoadmapHyperLabel( Window* _pParent, const ResId& _rId)
-		:OutputDevice()
 	{
-		mpIDLabel = new ORoadmapIDHyperLabel(_pParent, WB_TABSTOP | WB_WORDBREAK);
-		mpDescHyperLabel = new HyperLabel(_pParent, WB_TABSTOP | WB_WORDBREAK);
+		mpIDLabel = new ORoadmapIDHyperLabel(_pParent, _rId); // WB_TABSTOP |         
+		mpDescHyperLabel = new HyperLabel(_pParent, _rId); // WB_TABSTOP | 
 	}
     
 
     ORoadmapHyperLabel::ORoadmapHyperLabel( Window* _pParent, WinBits _nWinStyle)
-		:OutputDevice()
 	{
-		mpIDLabel = new ORoadmapIDHyperLabel(_pParent, WB_TABSTOP | WB_WORDBREAK);
+		mpIDLabel = new ORoadmapIDHyperLabel(_pParent, _nWinStyle); //WB_TABSTOP | 
 		mpIDLabel->SetTextColor( mpIDLabel->GetSettings().GetStyleSettings().GetFieldTextColor( ) );
-		mpDescHyperLabel = new HyperLabel(_pParent, WB_TABSTOP | WB_WORDBREAK);
+		mpDescHyperLabel = new HyperLabel(_pParent, _nWinStyle); // WB_TABSTOP | 
+	}
+
+    //---------------------------------------------------------------------
+    void ORoadmapHyperLabel::GrabFocus()
+	{
+        if ( mpDescHyperLabel )
+            mpDescHyperLabel->GrabFocus();
 	}
 
 
 	void ORoadmapHyperLabel::SetInteractive( sal_Bool _bInteractive )
 	{
+        if ( mpDescHyperLabel )
 		mpDescHyperLabel->SetInteractive(_bInteractive);
 	}
 
 	void ORoadmapHyperLabel::SetID( sal_Int16 _ID )
 	{
-		mpDescHyperLabel->SetID(_ID);
+        if ( mpDescHyperLabel )
+		    mpDescHyperLabel->SetID(_ID);
 	}
 
 	sal_Int16 ORoadmapHyperLabel::GetID() const
 	{
-		return mpDescHyperLabel->GetID();
+        return mpDescHyperLabel ? mpDescHyperLabel->GetID() : sal_Int16(-1);
 	}
 
 	void ORoadmapHyperLabel::SetIndex( sal_Int32 _Index )
 	{
-		mpDescHyperLabel->SetIndex(_Index);
+        if ( mpDescHyperLabel )
+		    mpDescHyperLabel->SetIndex(_Index);
 	}
 
 
 	sal_Int32 ORoadmapHyperLabel::GetIndex() const
 	{
-		return mpDescHyperLabel->GetIndex();
+        return mpDescHyperLabel ? mpDescHyperLabel->GetIndex() : sal_Int32(-1);
 	}
 
 
 	void ORoadmapHyperLabel::SetLabel( ::rtl::OUString _rText )
 	{
-		mpDescHyperLabel->SetText(_rText);
+        if ( mpDescHyperLabel )
+		    mpDescHyperLabel->SetText(_rText);
 	}
 
 	
 	::rtl::OUString ORoadmapHyperLabel::GetLabel( )
 	{
-		return mpDescHyperLabel->GetText();
+        	return mpDescHyperLabel ? mpDescHyperLabel->GetText() : String();
 	}
 
 	
@@ -851,11 +861,11 @@ namespace svt
 		return mpIDLabel->IsEnabled();
 	}
 
-	void ORoadmapHyperLabel::GrabFocus()
-	{
-		mpDescHyperLabel->GrabFocus();
-		
-	}
+//	void ORoadmapHyperLabel::GrabFocus()
+//	{
+//		mpDescHyperLabel->GrabFocus();
+//		
+//	}
 
 	void ORoadmapHyperLabel::ToggleBackgroundColor( const Color& _rGBColor )
 	{		
@@ -904,15 +914,21 @@ namespace svt
 
 	ORoadmapHyperLabel::~ORoadmapHyperLabel( )
 	{
-		delete mpIDLabel;
-		delete mpDescHyperLabel;
-
+        {
+            ::std::auto_ptr<Control> aTemp(mpIDLabel);
+		    mpIDLabel = NULL;
+        }
+        {
+            ::std::auto_ptr<Control> aTemp(mpDescHyperLabel);
+		    mpDescHyperLabel = NULL;
+        }
 	}
 
 
 	void ORoadmapHyperLabel::SetClickHdl( const Link& rLink ) 
 	{
-		mpDescHyperLabel->SetClickHdl( rLink);
+        if ( mpDescHyperLabel )
+		    mpDescHyperLabel->SetClickHdl( rLink);
 	}
 
 	const Link& ORoadmapHyperLabel::GetClickHdl( ) const
Index: svtools/source/dialogs/roadmapwizard.cxx
===================================================================
RCS file: /cvs/util/svtools/source/dialogs/roadmapwizard.cxx,v
retrieving revision 1.6
retrieving revision 1.6.50.2
diff -u -p -u -p -r1.6 -r1.6.50.2
--- svtools/source/dialogs/roadmapwizard.cxx	26 Nov 2004 20:41:02 -0000	1.6
+++ svtools/source/dialogs/roadmapwizard.cxx	10 Jan 2005 11:42:43 -0000	1.6.50.2
@@ -211,7 +211,7 @@ namespace svt
     {
         DBG_CTOR( RoadmapWizard, CheckInvariants );
 
-        m_pImpl->pRoadmap = new ORoadmap( this, WB_DIALOGCONTROL );
+        m_pImpl->pRoadmap = new ORoadmap( this, WB_TABSTOP );
         m_pImpl->pRoadmap->SetText( String( _rRoadmapTitleResource ) );
         m_pImpl->pRoadmap->SetPosPixel( Point( 0, 0 ) );
         m_pImpl->pRoadmap->SetItemSelectHdl( LINK( this, RoadmapWizard, OnRoadmapItemSelected ) );
@@ -220,6 +220,11 @@ namespace svt
         aRoadmapSize.Height() = GetSizePixel().Height();
         m_pImpl->pRoadmap->SetSizePixel( aRoadmapSize );
 
+        m_pImpl->pFixedLine = new FixedLine( this, WB_VERT );
+        m_pImpl->pFixedLine->Show();
+        m_pImpl->pFixedLine->SetPosPixel( Point( aRoadmapSize.Width() + 1, 0 ) );
+        m_pImpl->pFixedLine->SetSizePixel( Size( LogicToPixel( Size( 2, 0 ) ).Width(), aRoadmapSize.Height() ) );
+
         SetViewWindow( m_pImpl->pRoadmap );
         SetViewAlign( WINDOWALIGN_LEFT );
         m_pImpl->pRoadmap->Show();
@@ -541,27 +546,31 @@ namespace svt
         m_pImpl->pRoadmap->EnableRoadmapItem( (RoadmapTypes::ItemId)_nState, _bEnable );
     }
     
+	//--------------------------------------------------------------------
     void RoadmapWizard::Resize()
     {
         OWizardMachine::Resize();
-		ResizeFixedLine();
+
+        if ( IsReallyShown() && !IsInInitShow() )
+            ResizeFixedLine();
     }
 
 
+	//--------------------------------------------------------------------
 	void RoadmapWizard::StateChanged( StateChangedType nType )
 	{
 		WizardDialog::StateChanged( nType );
+
+        if ( nType == STATE_CHANGE_INITSHOW )
+            ResizeFixedLine();
 	}
 
+	//--------------------------------------------------------------------
     void RoadmapWizard::ResizeFixedLine()
     {
-        if ( !m_pImpl->pFixedLine )
-        {
-            m_pImpl->pFixedLine = new FixedLine( this, WB_VERT );
-            m_pImpl->pFixedLine->Show( sal_True );
-        }
-        m_pImpl->pFixedLine->SetPosSizePixel( m_pImpl->pRoadmap->GetSizePixel().Width(), 0, 0, GetPageSizePixel().Height(),
-                                    WINDOW_POSSIZE_POS | WINDOW_POSSIZE_HEIGHT );
+        Size aSize( m_pImpl->pRoadmap->GetSizePixel() );
+        aSize.Width() = m_pImpl->pFixedLine->GetSizePixel().Width();
+        m_pImpl->pFixedLine->SetSizePixel( aSize );
     }
 
 	//--------------------------------------------------------------------
Index: sc/inc/sc.hrc
===================================================================
RCS file: /cvs/sc/sc/inc/sc.hrc,v
retrieving revision 1.47
retrieving revision 1.47.166.1
diff -u -p -u -p -r1.47 -r1.47.166.1
--- sc/inc/sc.hrc	31 Aug 2004 12:29:04 -0000	1.47
+++ sc/inc/sc.hrc	19 Jan 2005 15:31:16 -0000	1.47.166.1
@@ -1165,7 +1165,7 @@
 #define RID_SC_FUNCTION_DESCRIPTIONS2	(SC_RESOURCE_START+44)
 #define RID_POPUP_CONTROL		(SC_RESOURCE_START+45)
 #define RID_POPUP_PAGEBREAK		(SC_RESOURCE_START+46)
-#define RID_OBJECTBAR_DRAWFORM	(SC_RESOURCE_START+47)
+    // FREE
 #define RID_POPUP_DRAWFORM		(SC_RESOURCE_START+48)
 #define RID_OBJECTMENU_DRAWFORM (SC_RESOURCE_START+49)
 #define RID_SC_ADDIN_ROT13		(SC_RESOURCE_START+50)
Index: sc/source/core/data/dbdocutl.cxx
===================================================================
RCS file: /cvs/sc/sc/source/core/data/dbdocutl.cxx,v
retrieving revision 1.4
retrieving revision 1.4.286.1
diff -u -p -u -p -r1.4 -r1.4.286.1
--- sc/source/core/data/dbdocutl.cxx	4 Jun 2004 10:21:21 -0000	1.4
+++ sc/source/core/data/dbdocutl.cxx	21 Jan 2005 06:24:22 -0000	1.4.286.1
@@ -102,6 +102,7 @@ void ScDatabaseDocUtil::PutData( ScDocum
 		switch ( nType )
 		{
 			case sdbc::DataType::BIT:
+			case sdbc::DataType::BOOLEAN:
 				//!	use language from doc (here, date/time and currency)?
 				nFormatIndex = pDoc->GetFormatTable()->GetStandardFormat(
 									NUMBERFORMAT_LOGICAL, ScGlobal::eLnge );
Index: sc/source/core/data/dpsdbtab.cxx
===================================================================
RCS file: /cvs/sc/sc/source/core/data/dpsdbtab.cxx,v
retrieving revision 1.8
retrieving revision 1.8.286.1
diff -u -p -u -p -r1.8 -r1.8.286.1
--- sc/source/core/data/dpsdbtab.cxx	4 Jun 2004 10:24:44 -0000	1.8
+++ sc/source/core/data/dpsdbtab.cxx	21 Jan 2005 06:24:51 -0000	1.8.286.1
@@ -308,6 +308,7 @@ void lcl_FillItemData( ScDPItemData& rDa
 		switch ( nType )
 		{
 			case sdbc::DataType::BIT:
+			case sdbc::DataType::BOOLEAN:
 				nNumType = NUMBERFORMAT_LOGICAL;
 				rData.fValue = (xRow->getBoolean(nRowPos) ? 1 : 0);
 				bEmptyFlag = ( rData.fValue == 0.0 ) && xRow->wasNull();
Index: sc/source/ui/drawfunc/drformsh.cxx
===================================================================
RCS file: /cvs/sc/sc/source/ui/drawfunc/drformsh.cxx,v
retrieving revision 1.4
retrieving revision 1.4.370.1
diff -u -p -u -p -r1.4 -r1.4.370.1
--- sc/source/ui/drawfunc/drformsh.cxx	3 Feb 2004 20:31:57 -0000	1.4
+++ sc/source/ui/drawfunc/drformsh.cxx	19 Jan 2005 15:31:39 -0000	1.4.370.1
@@ -100,7 +100,7 @@
 SFX_IMPL_INTERFACE(ScDrawFormShell, ScDrawShell, ScResId(SCSTR_DRAWFORMSHELL) )
 {
 	SFX_OBJECTBAR_REGISTRATION( SFX_OBJECTBAR_OBJECT|SFX_VISIBILITY_STANDARD|SFX_VISIBILITY_SERVER,
-								ScResId(RID_OBJECTBAR_DRAWFORM) );
+								ScResId(RID_OBJECTBAR_FORMAT) );
 	SFX_POPUPMENU_REGISTRATION( ScResId(RID_POPUP_DRAWFORM) );
 	SFX_OBJECTMENU_REGISTRATION( SID_OBJECTMENU0, ScResId(RID_OBJECTMENU_DRAWFORM) );
 }
Index: sc/source/ui/drawfunc/drformsh.src
===================================================================
RCS file: /cvs/sc/sc/source/ui/drawfunc/drformsh.src,v
retrieving revision 1.22
retrieving revision 1.22.268.1
diff -u -p -u -p -r1.22 -r1.22.268.1
--- sc/source/ui/drawfunc/drformsh.src	26 Jun 2004 20:00:52 -0000	1.22
+++ sc/source/ui/drawfunc/drformsh.src	19 Jan 2005 15:31:39 -0000	1.22.268.1
@@ -204,134 +204,6 @@
  //
  //		Objekt-Leisten
  //
-String RID_OBJECTBAR_DRAWFORM
-{
-	Text [ de ] = "Kontrollfeldleiste" ;
-	Text [ en-US ] = "Controls Toolbar" ;
-};
-
-ToolBox RID_OBJECTBAR_DRAWFORM
-{
-	HelpID = RID_OBJECTBAR_DRAWFORM;
-	Border = TRUE ;
-	SVLook = TRUE ;
-	Dockable = TRUE ;
-	Moveable = TRUE ;
-	Sizeable = TRUE ;
-	Closeable = TRUE ;
-	Zoomable = TRUE ;
-	LineSpacing = TRUE ;
-	HideWhenDeactivate = TRUE ;
-	Customize = TRUE ;
-	MenuStrings = TRUE ;
-	Hide = TRUE ;
-	Scroll = TRUE ;
-	ItemList =
-	{
-		ToolBoxItem
-		{
-			Identifier = SID_ANCHOR_TOGGLE ;
-			HelpId = SID_ANCHOR_TOGGLE ;
-		};
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_ATTR_TRANSFORM ;
-			HelpID = SID_ATTR_TRANSFORM ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_CTL_PROPERTIES ;
-			HelpID = SID_FM_CTL_PROPERTIES ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_PROPERTIES ;
-			HelpID = SID_FM_PROPERTIES ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_SHOW_FMEXPLORER ;
-			HelpID = SID_FM_SHOW_FMEXPLORER ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_TAB_DIALOG ;
-			HelpID = SID_FM_TAB_DIALOG ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_ADD_FIELD ;
-			HelpID = SID_FM_ADD_FIELD ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_FM_DESIGN_MODE ;
-			HelpID = SID_FM_DESIGN_MODE ;
-		};
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		MN_LAYER
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_GROUP ;
-			HelpID = SID_GROUP ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_UNGROUP ;
-			HelpID = SID_UNGROUP ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_ENTER_GROUP ;
-			HelpID = SID_ENTER_GROUP ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_LEAVE_GROUP ;
-			HelpID = SID_LEAVE_GROUP ;
-		};
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_GRID_VISIBLE;
-			HelpID = SID_GRID_VISIBLE;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_GRID_USE;
-			HelpID = SID_GRID_USE;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_HELPLINES_MOVE;
-			HelpID = SID_HELPLINES_MOVE;
-		};
-		ToolBoxItem
-		{
-			Type = TOOLBOXITEM_SEPARATOR ;
-		};
-		ToolBoxItem
-		{
-			Identifier = SID_OBJECT_ALIGN ;
-			HelpID = SID_OBJECT_ALIGN ;
-			DropDown = TRUE ;
-		};
-	};
-};
  //
  //		Objekt-Menue, Draw
  //
Index: wizards/com/sun/star/wizards/db/DBMetaData.java
===================================================================
RCS file: /cvs/installation/wizards/com/sun/star/wizards/db/DBMetaData.java,v
retrieving revision 1.5
retrieving revision 1.5.16.1
diff -u -p -u -p -r1.5 -r1.5.16.1
--- wizards/com/sun/star/wizards/db/DBMetaData.java	27 Nov 2004 09:05:19 -0000	1.5
+++ wizards/com/sun/star/wizards/db/DBMetaData.java	21 Jan 2005 06:56:49 -0000	1.5.16.1
@@ -318,7 +318,7 @@ public class DBMetaData {
 	}
 
 	void InitializeWidthList() {
-		WidthList = new int[16][2];
+		WidthList = new int[17][2];
 		WidthList[0][0] = DataType.BIT; // ==  -7;
 		WidthList[1][0] = DataType.TINYINT; // ==  -6;
 		WidthList[2][0] = DataType.BIGINT; // ==  -5;
@@ -335,6 +335,7 @@ public class DBMetaData {
 		WidthList[13][0] = DataType.DATE; // ==  91;
 		WidthList[14][0] = DataType.TIME; // ==  92;
 		WidthList[15][0] = DataType.TIMESTAMP; // ==  93;
+		WidthList[16][0] = DataType.BOOLEAN; // ==  16;
 		// NumericTypes are all types where aggregate functions can be performed on.
 		// Similarly to a major competitor date/time/timmestamp fields are not included 
 		NumericTypes = new int[9];
@@ -850,4 +851,4 @@ public class DBMetaData {
 	public void setNullDateCorrection(long dateCorrection) {
 		lDateCorrection = dateCorrection;
 	}
-}
\ No newline at end of file
+}
Index: wizards/com/sun/star/wizards/db/FieldColumn.java
===================================================================
RCS file: /cvs/installation/wizards/com/sun/star/wizards/db/FieldColumn.java,v
retrieving revision 1.3
retrieving revision 1.3.34.1
diff -u -p -u -p -r1.3 -r1.3.34.1
--- wizards/com/sun/star/wizards/db/FieldColumn.java	27 Oct 2004 13:30:20 -0000	1.3
+++ wizards/com/sun/star/wizards/db/FieldColumn.java	21 Jan 2005 06:56:49 -0000	1.3.34.1
@@ -191,6 +191,7 @@ public class FieldColumn {
 			FieldType = AnyConverter.toInt(Helper.getUnoPropertyValue(oField, "Type"));
 			switch (FieldType) {
 				case DataType.BIT : // ==  -7;
+				case DataType.BOOLEAN : // ==  16;
 					// Todo: Look if the defaultvalue has been set in the Datasource
 					StandardFormatKey = iLogicalFormatKey;
 					FieldWidth = 5;
@@ -313,6 +314,7 @@ public class FieldColumn {
 	public Object getDefaultValue() {
 		switch (FieldType) {
 			case DataType.BIT : // ==  -7;
+			case DataType.BOOLEAN : // ==  16;
 				DefaultValue = (Object) Integer.valueOf("1");
 				break;
 
Index: wizards/com/sun/star/wizards/db/RecordParser.java
===================================================================
RCS file: /cvs/installation/wizards/com/sun/star/wizards/db/RecordParser.java,v
retrieving revision 1.3
retrieving revision 1.3.34.1
diff -u -p -u -p -r1.3 -r1.3.34.1
--- wizards/com/sun/star/wizards/db/RecordParser.java	27 Oct 2004 13:30:50 -0000	1.3
+++ wizards/com/sun/star/wizards/db/RecordParser.java	21 Jan 2005 06:56:50 -0000	1.3.34.1
@@ -148,6 +148,7 @@ public class RecordParser extends QueryM
 		Object oAny = null;
 		switch (iType) {
 			case DataType.BIT : // ==  -7;
+			case DataType.BOOLEAN : // ==  16;
 				oAny = getColumnDoubleValue(ColIndex, false);
 				break;
 
Index: wizards/com/sun/star/wizards/document/FormHandler.java
===================================================================
RCS file: /cvs/installation/wizards/com/sun/star/wizards/document/FormHandler.java,v
retrieving revision 1.3
retrieving revision 1.3.34.1
diff -u -p -u -p -r1.3 -r1.3.34.1
--- wizards/com/sun/star/wizards/document/FormHandler.java	27 Oct 2004 13:31:51 -0000	1.3
+++ wizards/com/sun/star/wizards/document/FormHandler.java	21 Jan 2005 06:56:50 -0000	1.3.34.1
@@ -150,7 +150,7 @@ public class FormHandler {
 		sModelServices[SONUMERICCONTROL] = "com.sun.star.form.component.FormattedField";
 		sModelServices[SOGRIDCONTROL] = "com.sun.star.form.component.GridControl";
 		sModelServices[SOIMAGECONTROL] = "com.sun.star.form.component.DatabaseImageControl";
-		oControlData = new ControlData[16]; 
+		oControlData = new ControlData[17]; 
 		oControlData[0] = createControlData(DataType.BIT, SOCHECKBOX, "CheckBox", "CheckBox", false);
 		oControlData[1] = createControlData(DataType.TINYINT, SONUMERICCONTROL, "FormattedField", "FormattedField", false);
 		oControlData[2] = createControlData(DataType.SMALLINT, SONUMERICCONTROL, "FormattedField", "FormattedField", false);
@@ -167,6 +167,7 @@ public class FormHandler {
 		oControlData[13] = createControlData(DataType.DATE, SODATECONTROL, "DateField", "DateField", false);
 		oControlData[14] = createControlData(DataType.TIME, SOTIMECONTROL, "TimeField", "TimeField", false);
 		oControlData[15] = createControlData(DataType.TIMESTAMP, SODATECONTROL, "DateField", "TextField", false);
+		oControlData[16] = createControlData(DataType.BOOLEAN, SOCHECKBOX, "CheckBox", "CheckBox", false);
 		ControlData[] oImageControlData = new ControlData[4]; 
 		oImageControlData[0] = createControlData(DataType.BINARY, SOIMAGECONTROL, "ImageControl", "TextField", false);
 		oImageControlData[1] = createControlData(DataType.VARBINARY, SOIMAGECONTROL, "ImageControl", "TextField", false);
Index: wizards/com/sun/star/wizards/report/DBColumn.java
===================================================================
RCS file: /cvs/installation/wizards/com/sun/star/wizards/report/DBColumn.java,v
retrieving revision 1.2
retrieving revision 1.2.70.1
diff -u -p -u -p -r1.2 -r1.2.70.1
--- wizards/com/sun/star/wizards/report/DBColumn.java	19 May 2004 12:46:21 -0000	1.2
+++ wizards/com/sun/star/wizards/report/DBColumn.java	21 Jan 2005 06:56:51 -0000	1.2.70.1
@@ -290,7 +290,7 @@ public class DBColumn {
 		if (bAlignLeft)
 		Helper.setUnoPropertyValue(xValCellCursor, "ParaAdjust", new Integer(ParagraphAdjust.LEFT_value));
 
-		if (CurDBField.FieldType == com.sun.star.sdbc.DataType.BIT){
+		if (CurDBField.FieldType == com.sun.star.sdbc.DataType.BOOLEAN || CurDBField.FieldType == com.sun.star.sdbc.DataType.BIT){
 			CharFontName = "StarSymbol";
 			Helper.setUnoPropertyValue(xValCellCursor, "CharFontName", CharFontName);
 			if (bIsGroupColumn == false)
@@ -316,7 +316,7 @@ public class DBColumn {
 	try{
 		XPropertyState xPropertyState;
 			int FieldType = CurDBField.FieldType;
-		if (FieldType == com.sun.star.sdbc.DataType.BIT){
+		if (FieldType == com.sun.star.sdbc.DataType.BOOLEAN || FieldType == com.sun.star.sdbc.DataType.BIT){
 			CharFontName = "StarSymbol";
 			PropertyState = com.sun.star.beans.PropertyState.DIRECT_VALUE;
 		}
Index: wizards/source/formwizard/Language.xba
===================================================================
RCS file: /cvs/installation/wizards/source/formwizard/Language.xba,v
retrieving revision 1.26
retrieving revision 1.26.44.1
diff -u -p -u -p -r1.26 -r1.26.44.1
--- wizards/source/formwizard/Language.xba	2 Aug 2004 17:23:54 -0000	1.26
+++ wizards/source/formwizard/Language.xba	21 Jan 2005 06:59:38 -0000	1.26.44.1
@@ -154,8 +154,8 @@ End Sub
 
 Sub InitializeWidthList()
 
-	If Ubound(WidthList(),1) &gt; 15 Then
-		ReDim WidthList(15,4)
+	If Ubound(WidthList(),1) &gt; 16 Then
+		ReDim WidthList(16,4)
 	End If
 
 	WidthList(0,0) = com.sun.star.sdbc.DataType.BIT   			&apos; = -7;
@@ -238,6 +238,11 @@ Sub InitializeWidthList()
 	WidthList(15,2) = False
 	WidthList(15,3) = &quot;DateField&quot;
 
+	WidthList(16,0) = com.sun.star.sdbc.DataType.BOOLEAN   			&apos; = 16;
+	WidthList(16,1) = cCheckbox
+	WidthList(16,2) = False
+	WidthList(16,3) = &quot;CheckBox&quot;
+
 	ImgWidthList(0,0) = com.sun.star.sdbc.DataType.BINARY			&apos; =  -2;
 	ImgWidthList(0,1) = cImageControl
 	ImgWidthList(0,2) = False
@@ -277,4 +282,4 @@ Sub InitializeWidthList()
 	oModelService(cGridControl) = &quot;com.sun.star.form.component.GridControl&quot;
 	oModelService(cImageControl) = &quot;com.sun.star.form.component.DatabaseImageControl&quot;
 End Sub
-</script:module>
\ No newline at end of file
+</script:module>
Index: wizards/source/formwizard/tools.xba
===================================================================
RCS file: /cvs/installation/wizards/source/formwizard/tools.xba,v
retrieving revision 1.32
retrieving revision 1.32.44.1
diff -u -p -u -p -r1.32 -r1.32.44.1
--- wizards/source/formwizard/tools.xba	2 Aug 2004 17:25:02 -0000	1.32
+++ wizards/source/formwizard/tools.xba	21 Jan 2005 06:59:37 -0000	1.32.44.1
@@ -74,6 +74,8 @@ Dim NullValue
 		GetPeerSize() = oPeer.PreferredSize()
 	ElseIf CurFieldType = com.sun.star.sdbc.DataType.BIT Then
 		GetPeerSize() = oPeer.PreferredSize()
+	ElseIf CurFieldType = com.sun.star.sdbc.DataType.BOOLEAN Then
+		GetPeerSize() = oPeer.PreferredSize()
 	ElseIf CurFieldType = com.sun.star.sdbc.DataType.DATE Then
 		oControl.Model.Date = Date
 		GetPeerSize() = oPeer.PreferredSize()
@@ -344,4 +346,4 @@ Dim UIName as String
 	next i
 	GetFilterName() = UIName
 End Function
-</script:module>
\ No newline at end of file
+</script:module>
Index: sfx2/source/appl/workwin.cxx
===================================================================
RCS file: /cvs/framework/sfx2/source/appl/workwin.cxx,v
retrieving revision 1.50
retrieving revision 1.47.78.5
diff -u -p -u -p -r1.50 -r1.47.78.5
--- sfx2/source/appl/workwin.cxx	31 Jan 2005 08:53:09 -0000	1.50
+++ sfx2/source/appl/workwin.cxx	11 Feb 2005 10:15:28 -0000	1.47.78.5
@@ -114,7 +114,6 @@ static const ResIdToResName pToolBarResT
     { 30001,    "objectbar"            },      //chart
     { 30513,    "toolbar"              },      //chart
     { 25005,    "textobjectbar"        },      //calc
-    { 25047,    "formsobjectbar"       },
     { 25053,    "drawobjectbar"        },
     { 25054,    "graphicobjectbar"     },
     { 25001,    "formatobjectbar"      },
@@ -137,7 +136,6 @@ static const ResIdToResName pToolBarResT
     { 23014,    "slideviewobjectbar"   },
     { 23283,    "bezierobjectbar"      },      //writer
     { 23269,    "drawingobjectbar"     },
-    { 23299,    "formsobjectbar"       },
     { 23270,    "drawtextobjectbar"    },
     { 23267,    "frameobjectbar"       },
     { 23268,    "graphicobjectbar"     },
@@ -163,15 +161,9 @@ static const ResIdToResName pToolBarResT
     { 23031,    "mediaobjectbar"       },      //draw/impress
     { 25060,    "mediaobjectbar"       },      //calc
     { 23311,    "mediaobjectbar"       },      //writer
-    { 18004,    "databasecontrols"     },
-    { 18005,    "xformcontrols"        },
-    { 18006,    "formcontrols"         },
-    { 18007,    "moredatabasecontrols" },
-    { 18008,    "morexformcontrols"    },
-    { 18009,    "moreformcontrols"     },
-    { 18010,    "databaseformdesign"   },
-    { 18011,    "xformdesign"          },
-    { 18012,    "formdesign"           },
+    { 18004,    "formcontrols"         },
+    { 18005,    "moreformcontrols"     },
+    { 18006,    "formdesign"           },
     { 0,        ""                     }
 };
 
Index: comphelper/inc/comphelper/asyncnotification.hxx
===================================================================
RCS file: comphelper/inc/comphelper/asyncnotification.hxx
diff -N comphelper/inc/comphelper/asyncnotification.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ comphelper/inc/comphelper/asyncnotification.hxx	13 Jan 2005 14:46:27 -0000	1.1.2.1
@@ -0,0 +1,280 @@
+/*************************************************************************
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to the terms of
+ *  either of the following licenses
+ *
+ *         - GNU Lesser General Public License Version 2.1
+ *         - Sun Industry Standards Source License Version 1.1
+ *
+ *  Sun Microsystems Inc., October, 2000
+ *
+ *  GNU Lesser General Public License Version 2.1
+ *  =============================================
+ *  Copyright 2000 by Sun Microsystems, Inc.
+ *  901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *  This library is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU Lesser General Public
+ *  License version 2.1, as published by the Free Software Foundation.
+ *
+ *  This library is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *  Lesser General Public License for more details.
+ *
+ *  You should have received a copy of the GNU Lesser General Public
+ *  License along with this library; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *  MA  02111-1307  USA
+ *
+ *
+ *  Sun Industry Standards Source License Version 1.1
+ *  =================================================
+ *  The contents of this file are subject to the Sun Industry Standards
+ *  Source License Version 1.1 (the "License"); You may not use this file
+ *  except in compliance with the License. You may obtain a copy of the
+ *  License at http://www.openoffice.org/license.html.
+ *
+ *  Software provided under this License is provided on an "AS IS" basis,
+ *  WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
+ *  WITHOUT LIMITATION, WARRANTIES THAT THE SOFTWARE IS FREE OF DEFECTS,
+ *  MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE, OR NON-INFRINGING.
+ *  See the License for the specific provisions governing your rights and
+ *  obligations concerning the Software.
+ *
+ *  The Initial Developer of the Original Code is: Sun Microsystems, Inc.
+ *
+ *  Copyright: 2000 by Sun Microsystems, Inc.
+ *
+ *  All Rights Reserved.
+ *
+ *  Contributor(s): _______________________________________
+ *
+ *
+ ************************************************************************/
+
+#ifndef COMPHELPER_ASYNCNOTIFICATION_HXX
+#define COMPHELPER_ASYNCNOTIFICATION_HXX
+
+/** === begin UNO includes === **/
+#ifndef _COM_SUN_STAR_LANG_XCOMPONENT_HPP_
+#include <com/sun/star/lang/XComponent.hpp>
+#endif
+#ifndef _COM_SUN_STAR_LANG_XEVENTLISTENER_HPP_
+#include <com/sun/star/lang/XEventListener.hpp>
+#endif
+#ifndef _COM_SUN_STAR_UNO_XADAPTER_HPP_
+#include <com/sun/star/uno/XAdapter.hpp>
+#endif
+/** === end UNO includes === **/
+
+#ifndef _VOS_THREAD_HXX_
+#include <vos/thread.hxx>
+#endif
+#ifndef _OSL_MUTEX_HXX_
+#include <osl/mutex.hxx>
+#endif
+#ifndef _OSL_CONDITN_HXX_
+#include <osl/conditn.hxx>
+#endif
+
+#ifndef _RTL_REF_HXX_
+#include <rtl/ref.hxx>
+#endif
+
+#ifndef _CPPUHELPER_IMPLBASE1_HXX_
+#include <cppuhelper/implbase1.hxx>
+#endif
+
+#include <deque>
+#include <memory>
+
+//........................................................................
+namespace comphelper
+{
+//........................................................................
+
+    //====================================================================
+    //= EventDescription
+	//====================================================================
+    /** the very basic instance to hold a description of an event
+
+        In this simple version, an event is described by an numeric value only, whose
+        semantics is completely up to the user of this class.
+
+        Normally, you won't use this description directly, but instead derive own
+        classes which can hold more information.
+    */
+    class EventDescription : ::rtl::IReference
+    {
+    public:
+        typedef sal_uInt16  EventType;
+
+    private:
+        oslInterlockedCount m_refCount;
+        EventType           m_nType;
+
+    public:
+        EventDescription( EventType nType );
+
+        inline EventType   getEventType() const { return m_nType; }
+
+	    virtual oslInterlockedCount SAL_CALL acquire();
+	    virtual oslInterlockedCount SAL_CALL release();
+
+    protected:
+        EventDescription( const EventDescription& _rSource );
+        EventDescription& operator=( const EventDescription& _rSource );
+
+        virtual ~EventDescription();
+
+    private:
+        EventDescription( );        // never implemented
+    };
+
+    //====================================================================
+    //= EventObjectHolder
+	//====================================================================
+    /** EventDescription derivee holding an UNO EventObject derivee
+    */
+    template <typename EVENT_OBJECT >
+    class EventObjectHolder : public EventDescription
+    {
+    public:
+        typedef EVENT_OBJECT    EventObjectType;
+
+    private:
+        EventObjectType m_aEvent;
+
+    public:
+        inline EventObjectHolder( const EventObjectType& _rUnoEvent, EventType _nType )
+            :EventDescription( _nType )
+            ,m_aEvent( _rUnoEvent )
+        {
+        }
+
+        inline const EventObjectType& getEventObject() const { return m_aEvent; }
+    };
+
+    //====================================================================
+    //= typedefs
+	//====================================================================
+    typedef ::rtl::Reference< EventDescription >    EventDescriptionRef;
+
+    //====================================================================
+    //= IEventProcessor
+    //====================================================================
+    /** an event processor
+
+        @see AsyncEventNotifier
+    */
+    class IEventProcessor
+    {
+    public:
+        /** process a single event
+        */
+        virtual void processEvent( const EventDescription& _rEvent ) = 0;
+
+        /** retrieve the component associated with the event processor
+
+            If this method returns a non-<NULL/> object, this can be used to signal
+            the ending of the life time of the processor.
+            Every instance which hols a pointer to the processor instance is then required
+            to register as <type scope="com::sun::star::lang">XEventListener</type> at the
+            component, and to <em>not</em> access the event processor anymore after the
+            component has notified its disposal.
+        */
+        virtual ::com::sun::star::uno::Reference< ::com::sun::star::lang::XComponent >
+            getComponent() = 0;
+    };
+
+    //====================================================================
+    //= AsyncEventNotifier
+    //====================================================================
+    typedef ::vos::OThread                                                      AsyncEventNotifier_TBASE;
+    typedef ::cppu::WeakImplHelper1< ::com::sun::star::lang::XEventListener >   AsyncEventNotifier_BASE;
+    struct EventNotifierImpl;
+
+    /** a helper class for notifying events asynchronously
+
+        If you need to notify certain events to external components, you usually should
+        not do this while you have mutexes locked, to prevent multi-threading issues.
+
+        However, you do not always have complete control over all mutex guards on the stack.
+        If, in such a case, the listener notification is one-way, you can decide to do it
+        asynchronously.
+
+        For this, you need to
+        <ul>
+            <li>implement the <type>IEventProcessor</type> interface</li>
+            <li>instantiate an <type>AsyncEventNotifier</type> instance, and <member>acquire</member>
+                and <member>create</member> it</li>
+            <li>derive a class from <type>EventDescription</type>, which is able to hold
+                all the necessary information about your event</li>
+            <li>pass an instance of this derived <type>EventDescription</type> to <member>processEvent</member>
+                of your <type>AsyncEventNotifier</type></li>
+        </ul>
+
+        Your event processor's <member>IEventProcessor::processEvent</member> method will then be called
+        with the given event, in a separate thread where definately no mutexes are locked.
+
+        The AsyncEventNotifier is implemented as a thread itself, which sleeps as long as there are no
+        events in the queue. As soon as you add an event, the thread is woken up, processes the event,
+        and sleeps again.
+    */
+    class AsyncEventNotifier
+                :public AsyncEventNotifier_TBASE
+                ,public AsyncEventNotifier_BASE
+    {
+        friend struct EventNotifierImpl;
+
+    private:
+        typedef ::std::deque< EventDescriptionRef > Events;
+
+    private:
+        ::std::auto_ptr< EventNotifierImpl >        m_pImpl;
+
+    protected:
+        // OThread
+        virtual void SAL_CALL run();
+        virtual void SAL_CALL kill();
+        virtual void SAL_CALL onTerminated();
+
+    public:
+        /** constructs a notifier thread
+
+        @param _pProcessor
+            the instance processing the events
+        */
+        AsyncEventNotifier( IEventProcessor* _pProcessor );
+
+        /** adds an event to the queue
+        */
+        void addEvent( const EventDescriptionRef& _rEvent );
+
+        // XEventListener
+        virtual void SAL_CALL disposing(const ::com::sun::star::lang::EventObject& _rSource ) throw (::com::sun::star::uno::RuntimeException);
+
+        /* resolve ambiguity : both OWeakObject and OObject have these memory operators */
+        void* SAL_CALL operator new( size_t size ) throw() { return OThread::operator new( size ); }
+        void SAL_CALL operator delete( void * p ) throw() { OThread::operator delete( p ); }
+
+    protected:
+        virtual ~AsyncEventNotifier();
+
+    private:
+        void    implStarted( );
+        void    implTerminated( );
+    };
+
+//........................................................................
+} // namespace comphelper
+//........................................................................
+
+#endif // COMPHELPER_ASYNCNOTIFICATION_HXX
Index: comphelper/source/misc/asyncnotification.cxx
===================================================================
RCS file: comphelper/source/misc/asyncnotification.cxx
diff -N comphelper/source/misc/asyncnotification.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ comphelper/source/misc/asyncnotification.cxx	13 Jan 2005 14:52:16 -0000	1.1.2.2
@@ -0,0 +1,283 @@
+/*************************************************************************
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to the terms of
+ *  either of the following licenses
+ *
+ *         - GNU Lesser General Public License Version 2.1
+ *         - Sun Industry Standards Source License Version 1.1
+ *
+ *  Sun Microsystems Inc., October, 2000
+ *
+ *  GNU Lesser General Public License Version 2.1
+ *  =============================================
+ *  Copyright 2000 by Sun Microsystems, Inc.
+ *  901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *  This library is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU Lesser General Public
+ *  License version 2.1, as published by the Free Software Foundation.
+ *
+ *  This library is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *  Lesser General Public License for more details.
+ *
+ *  You should have received a copy of the GNU Lesser General Public
+ *  License along with this library; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *  MA  02111-1307  USA
+ *
+ *
+ *  Sun Industry Standards Source License Version 1.1
+ *  =================================================
+ *  The contents of this file are subject to the Sun Industry Standards
+ *  Source License Version 1.1 (the "License"); You may not use this file
+ *  except in compliance with the License. You may obtain a copy of the
+ *  License at http://www.openoffice.org/license.html.
+ *
+ *  Software provided under this License is provided on an "AS IS" basis,
+ *  WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
+ *  WITHOUT LIMITATION, WARRANTIES THAT THE SOFTWARE IS FREE OF DEFECTS,
+ *  MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE, OR NON-INFRINGING.
+ *  See the License for the specific provisions governing your rights and
+ *  obligations concerning the Software.
+ *
+ *  The Initial Developer of the Original Code is: Sun Microsystems, Inc.
+ *
+ *  Copyright: 2000 by Sun Microsystems, Inc.
+ *
+ *  All Rights Reserved.
+ *
+ *  Contributor(s): _______________________________________
+ *
+ *
+ ************************************************************************/
+
+#ifndef COMPHELPER_ASYNCNOTIFICATION_HXX
+#include <comphelper/asyncnotification.hxx>
+#endif
+
+/** === begin UNO includes === **/
+#ifndef _COM_SUN_STAR_AWT_XCONTROL_HPP_
+#include <com/sun/star/awt/XControl.hpp>
+#endif
+/** === end UNO includes === **/
+
+#ifndef _COMPHELPER_GUARDING_HXX_
+#include <comphelper/guarding.hxx>
+#endif
+
+#ifndef _OSL_DIAGNOSE_H_
+#include <osl/diagnose.h>
+#endif
+
+//........................................................................
+namespace comphelper
+{
+//........................................................................
+
+    using namespace ::com::sun::star::uno;
+    using namespace ::com::sun::star::lang;
+    using namespace ::com::sun::star::awt;
+
+    //====================================================================
+    //= EventDescription
+    //====================================================================
+    //--------------------------------------------------------------------
+    EventDescription::EventDescription( sal_uInt16 _nType )
+        :m_refCount( 0 )
+        ,m_nType( _nType )
+    {
+    }
+
+    //--------------------------------------------------------------------
+    EventDescription::EventDescription( const EventDescription& _rSource )
+        :m_refCount( 0 )
+    {
+        *this = _rSource;
+    }
+
+    //--------------------------------------------------------------------
+    EventDescription& EventDescription::operator=( const EventDescription& _rSource )
+    {
+        m_nType = _rSource.m_nType;
+        return *this;
+    }
+
+    //--------------------------------------------------------------------
+    EventDescription::~EventDescription()
+    {
+    }
+
+    //--------------------------------------------------------------------
+    oslInterlockedCount SAL_CALL EventDescription::acquire()
+    {
+        return osl_incrementInterlockedCount( &m_refCount );
+    }
+
+    //--------------------------------------------------------------------
+    oslInterlockedCount SAL_CALL EventDescription::release()
+    {
+        if ( 0 == osl_decrementInterlockedCount( &m_refCount ) )
+        {
+            delete this;
+            return 0;
+        }
+        return m_refCount;
+    }
+
+    //====================================================================
+    //= EventNotifierImpl
+    //====================================================================
+    struct EventNotifierImpl
+    {
+        ::osl::Mutex                    aMutex;
+        ::osl::Condition                aCond;
+
+        AsyncEventNotifier::Events      aEvents;
+
+        IEventProcessor*                pEventProcessor;
+        Reference< XComponent >         xComponent;
+    };
+
+    //====================================================================
+    //= AsyncEventNotifier
+    //====================================================================
+    //--------------------------------------------------------------------
+    AsyncEventNotifier::AsyncEventNotifier( IEventProcessor* _pProcessor )
+        :m_pImpl( new EventNotifierImpl )
+    {
+        // observe the XComponent belonging to the event processor
+        m_pImpl->pEventProcessor = _pProcessor;
+        if ( m_pImpl->pEventProcessor )
+            m_pImpl->xComponent = m_pImpl->pEventProcessor->getComponent();
+        OSL_ENSURE( m_pImpl->xComponent.is(), "AsyncEventNotifier::AsyncEventNotifier: invalid event processor!" );
+
+        if ( m_pImpl->xComponent.is() )
+        {
+            osl_incrementInterlockedCount( &m_refCount );
+            {
+                Reference< XEventListener > xLocalTemporary( this );
+                m_pImpl->xComponent->addEventListener( xLocalTemporary );
+            }
+            osl_incrementInterlockedCount( &m_refCount );
+        }
+    }
+
+    //--------------------------------------------------------------------
+    AsyncEventNotifier::~AsyncEventNotifier()
+    {
+        OSL_ENSURE( m_pImpl->aEvents.empty(), "AsyncEventNotifier::~AsyncEventNotifier: did you dispose me?" );
+    }
+
+    //--------------------------------------------------------------------
+    void SAL_CALL AsyncEventNotifier::disposing( const EventObject& _rSource ) throw (RuntimeException)
+    {
+        if ( ( _rSource.Source == m_pImpl->xComponent ) && m_pImpl->xComponent.is() )
+        {
+            ::osl::MutexGuard aGuard( m_pImpl->aMutex );
+
+            m_pImpl->xComponent->removeEventListener( static_cast< XEventListener* >( this ) );
+
+            // Event-Queue loeschen
+            Events aEmpty;
+            m_pImpl->aEvents.swap( aEmpty );
+
+            // reset m_pImpl->xComponent. This will cause the "run" method to terminate
+            m_pImpl->xComponent.clear();
+
+            // awake the thread
+            m_pImpl->aCond.set();
+            // and terminate
+            terminate();
+        }
+    }
+
+    //--------------------------------------------------------------------
+    void AsyncEventNotifier::addEvent( const EventDescriptionRef& _rEvent )
+    {
+        ::osl::MutexGuard aGuard( m_pImpl->aMutex );
+        m_pImpl->aEvents.push_back( _rEvent );
+
+        // awake the thread
+        m_pImpl->aCond.set();
+    }
+
+    //--------------------------------------------------------------------
+    void AsyncEventNotifier::run()
+    {
+        implStarted( );
+        if ( !m_pImpl->pEventProcessor )
+            return;
+
+        // keep us alive, in case we're disposed in the mid of the following
+        Reference< XInterface > xKeepAlive( *this );
+        do
+        {
+            ::osl::MutexGuard aGuard( m_pImpl->aMutex );
+            while ( m_pImpl->aEvents.size() > 0 )
+            {
+                // keep a reference to the control, so it cannot be deleted
+                // during processEvent
+                Reference< XComponent > xComponent = m_pImpl->xComponent;
+
+                ::rtl::Reference< EventDescription > pEvent = m_pImpl->aEvents.front();
+                m_pImpl->aEvents.pop_front();
+                {
+                    ::comphelper::MutexRelease aReleaseOnce( m_pImpl->aMutex );
+
+                    if ( xComponent.is() && pEvent.get() )
+                        m_pImpl->pEventProcessor->processEvent( *pEvent.get() );
+                }
+            };
+
+            // if we have been disposed in the above, then we're completely done
+            if( !m_pImpl->xComponent.is() )
+                return;
+
+            m_pImpl->aCond.reset();
+            {
+                ::comphelper::MutexRelease aReleaseOnce( m_pImpl->aMutex );
+                // wait until there's a new event to process
+                m_pImpl->aCond.wait();
+            }
+        }
+        while ( sal_True );
+    }
+
+    //--------------------------------------------------------------------
+    void SAL_CALL AsyncEventNotifier::kill()
+    {
+        AsyncEventNotifier_TBASE::kill();
+        implTerminated( );
+    }
+
+    //--------------------------------------------------------------------
+    void SAL_CALL AsyncEventNotifier::onTerminated()
+    {
+        AsyncEventNotifier_TBASE::onTerminated();
+        implTerminated( );
+    }
+
+    //--------------------------------------------------------------------
+    void AsyncEventNotifier::implStarted()
+    {
+        acquire();
+    }
+
+    //--------------------------------------------------------------------
+    void AsyncEventNotifier::implTerminated()
+    {
+        release();
+    }
+
+//........................................................................
+} // namespace comphelper
+//........................................................................
+
Index: comphelper/source/misc/makefile.mk
===================================================================
RCS file: /cvs/util/comphelper/source/misc/makefile.mk,v
retrieving revision 1.28
retrieving revision 1.28.26.1
diff -u -p -u -p -r1.28 -r1.28.26.1
--- comphelper/source/misc/makefile.mk	17 Nov 2004 13:40:09 -0000	1.28
+++ comphelper/source/misc/makefile.mk	13 Jan 2005 14:51:58 -0000	1.28.26.1
@@ -73,6 +73,7 @@ ENABLE_EXCEPTIONS=TRUE
 # --- Files -------------------------------------
 
 SLOFILES=	\
+			$(SLO)$/asyncnotification.obj \
 			$(SLO)$/listenernotification.obj \
 			$(SLO)$/evtlistenerhlp.obj \
 			$(SLO)$/accessiblecomponenthelper.obj \
